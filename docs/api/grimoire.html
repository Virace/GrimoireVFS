<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>grimoire API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#__version__">__version__</a>
            </li>
            <li>
                    <a class="class" href="#GrimoireError">GrimoireError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#HashCollisionError">HashCollisionError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HashCollisionError.__init__">HashCollisionError</a>
                        </li>
                        <li>
                                <a class="variable" href="#HashCollisionError.path1">path1</a>
                        </li>
                        <li>
                                <a class="variable" href="#HashCollisionError.path2">path2</a>
                        </li>
                        <li>
                                <a class="variable" href="#HashCollisionError.hash_value">hash_value</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CorruptedDataError">CorruptedDataError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CorruptedDataError.__init__">CorruptedDataError</a>
                        </li>
                        <li>
                                <a class="variable" href="#CorruptedDataError.vfs_path">vfs_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#CorruptedDataError.expected">expected</a>
                        </li>
                        <li>
                                <a class="variable" href="#CorruptedDataError.actual">actual</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#UnknownAlgorithmError">UnknownAlgorithmError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#UnknownAlgorithmError.__init__">UnknownAlgorithmError</a>
                        </li>
                        <li>
                                <a class="variable" href="#UnknownAlgorithmError.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#UnknownAlgorithmError.algo_type">algo_type</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#InvalidFormatError">InvalidFormatError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#InvalidFormatError.__init__">InvalidFormatError</a>
                        </li>
                        <li>
                                <a class="variable" href="#InvalidFormatError.expected">expected</a>
                        </li>
                        <li>
                                <a class="variable" href="#InvalidFormatError.actual">actual</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IndexNotDecryptedError">IndexNotDecryptedError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#IndexNotDecryptedError.__init__">IndexNotDecryptedError</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#normalize_path">normalize_path</a>
            </li>
            <li>
                    <a class="function" href="#split_path">split_path</a>
            </li>
            <li>
                    <a class="class" href="#ManifestBuilder">ManifestBuilder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ManifestBuilder.__init__">ManifestBuilder</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestBuilder.add_file">add_file</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestBuilder.add_dir">add_dir</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestBuilder.build">build</a>
                        </li>
                        <li>
                                <a class="variable" href="#ManifestBuilder.entry_count">entry_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#ManifestBuilder.path_stats">path_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestBuilder.add_files_batch">add_files_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestBuilder.add_dir_batch">add_dir_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestBuilder.add_dir_batch_rclone">add_dir_batch_rclone</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ManifestReader">ManifestReader</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ManifestReader.__init__">ManifestReader</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.exists">exists</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.get_entry">get_entry</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.verify_file">verify_file</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.list_all">list_all</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.get_all_entries">get_all_entries</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.iter_entries">iter_entries</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.list_hashes">list_hashes</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.get_entry_by_hash">get_entry_by_hash</a>
                        </li>
                        <li>
                                <a class="variable" href="#ManifestReader.file_header">file_header</a>
                        </li>
                        <li>
                                <a class="variable" href="#ManifestReader.index_header">index_header</a>
                        </li>
                        <li>
                                <a class="variable" href="#ManifestReader.entry_count">entry_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#ManifestReader.is_decrypted">is_decrypted</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestReader.close">close</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ArchiveBuilder">ArchiveBuilder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ArchiveBuilder.__init__">ArchiveBuilder</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveBuilder.add_file">add_file</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveBuilder.add_dir">add_dir</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveBuilder.build">build</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveBuilder.entry_count">entry_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveBuilder.path_stats">path_stats</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveBuilder.compression_stats">compression_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveBuilder.add_files_batch">add_files_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveBuilder.add_dir_batch">add_dir_batch</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ArchiveReader">ArchiveReader</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ArchiveReader.__init__">ArchiveReader</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.exists">exists</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.open">open</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.get_entry">get_entry</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.list_all">list_all</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.get_all_entries">get_all_entries</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.iter_entries">iter_entries</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.list_hashes">list_hashes</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveReader.file_header">file_header</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveReader.index_header">index_header</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveReader.data_header">data_header</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveReader.entry_count">entry_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveReader.is_decrypted">is_decrypted</a>
                        </li>
                        <li>
                                <a class="variable" href="#ArchiveReader.is_mmap">is_mmap</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.read_batch">read_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#ArchiveReader.extract_all">extract_all</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ManifestJsonConverter">ManifestJsonConverter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ManifestJsonConverter.manifest_to_json">manifest_to_json</a>
                        </li>
                        <li>
                                <a class="function" href="#ManifestJsonConverter.json_to_manifest">json_to_manifest</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ModeConverter">ModeConverter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ModeConverter.archive_to_manifest">archive_to_manifest</a>
                        </li>
                        <li>
                                <a class="function" href="#ModeConverter.manifest_to_archive">manifest_to_archive</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CompressionHook">CompressionHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#CompressionHook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="function" href="#CompressionHook.compress">compress</a>
                        </li>
                        <li>
                                <a class="function" href="#CompressionHook.decompress">decompress</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ChecksumHook">ChecksumHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ChecksumHook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChecksumHook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChecksumHook.digest_size">digest_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ChecksumHook.compute">compute</a>
                        </li>
                        <li>
                                <a class="function" href="#ChecksumHook.verify">verify</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IndexCryptoHook">IndexCryptoHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#IndexCryptoHook.flags_id">flags_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#IndexCryptoHook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="function" href="#IndexCryptoHook.encrypt">encrypt</a>
                        </li>
                        <li>
                                <a class="function" href="#IndexCryptoHook.decrypt">decrypt</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NoneChecksumHook">NoneChecksumHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#NoneChecksumHook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#NoneChecksumHook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#NoneChecksumHook.digest_size">digest_size</a>
                        </li>
                        <li>
                                <a class="function" href="#NoneChecksumHook.compute">compute</a>
                        </li>
                        <li>
                                <a class="function" href="#NoneChecksumHook.verify">verify</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CRC32Hook">CRC32Hook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#CRC32Hook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#CRC32Hook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#CRC32Hook.digest_size">digest_size</a>
                        </li>
                        <li>
                                <a class="function" href="#CRC32Hook.compute">compute</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MD5Hook">MD5Hook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#MD5Hook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#MD5Hook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#MD5Hook.digest_size">digest_size</a>
                        </li>
                        <li>
                                <a class="function" href="#MD5Hook.compute">compute</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SHA1Hook">SHA1Hook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SHA1Hook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#SHA1Hook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#SHA1Hook.digest_size">digest_size</a>
                        </li>
                        <li>
                                <a class="function" href="#SHA1Hook.compute">compute</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SHA256Hook">SHA256Hook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SHA256Hook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#SHA256Hook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#SHA256Hook.digest_size">digest_size</a>
                        </li>
                        <li>
                                <a class="function" href="#SHA256Hook.compute">compute</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ZlibCompressHook">ZlibCompressHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ZlibCompressHook.__init__">ZlibCompressHook</a>
                        </li>
                        <li>
                                <a class="variable" href="#ZlibCompressHook.flags_id">flags_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ZlibCompressHook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="function" href="#ZlibCompressHook.encrypt">encrypt</a>
                        </li>
                        <li>
                                <a class="function" href="#ZlibCompressHook.decrypt">decrypt</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#XorObfuscateHook">XorObfuscateHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#XorObfuscateHook.__init__">XorObfuscateHook</a>
                        </li>
                        <li>
                                <a class="variable" href="#XorObfuscateHook.flags_id">flags_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#XorObfuscateHook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="function" href="#XorObfuscateHook.encrypt">encrypt</a>
                        </li>
                        <li>
                                <a class="function" href="#XorObfuscateHook.decrypt">decrypt</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ZlibXorHook">ZlibXorHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ZlibXorHook.__init__">ZlibXorHook</a>
                        </li>
                        <li>
                                <a class="variable" href="#ZlibXorHook.flags_id">flags_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ZlibXorHook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="function" href="#ZlibXorHook.encrypt">encrypt</a>
                        </li>
                        <li>
                                <a class="function" href="#ZlibXorHook.decrypt">decrypt</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RcloneHashHook">RcloneHashHook</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RcloneHashHook.__init__">RcloneHashHook</a>
                        </li>
                        <li>
                                <a class="variable" href="#RcloneHashHook.SUPPORTED_ALGORITHMS">SUPPORTED_ALGORITHMS</a>
                        </li>
                        <li>
                                <a class="variable" href="#RcloneHashHook.display_name">display_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#RcloneHashHook.algo_id">algo_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#RcloneHashHook.digest_size">digest_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#RcloneHashHook.algorithm">algorithm</a>
                        </li>
                        <li>
                                <a class="function" href="#RcloneHashHook.compute">compute</a>
                        </li>
                        <li>
                                <a class="function" href="#RcloneHashHook.compute_file">compute_file</a>
                        </li>
                        <li>
                                <a class="function" href="#RcloneHashHook.compute_files_batch">compute_files_batch</a>
                        </li>
                        <li>
                                <a class="function" href="#RcloneHashHook.compute_dir">compute_dir</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RcloneNotFoundError">RcloneNotFoundError</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="function" href="#rclone_hash">rclone_hash</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
grimoire    </h1>

                        <div class="docstring"><p>GrimoireVFS -  Python </p>

<p> Manifest Mode ()  Archive Mode ()</p>
</div>

                        <input id="mod-grimoire-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-grimoire-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">GrimoireVFS -  Python </span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd"> Manifest Mode ()  Archive Mode ()</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Virace&quot;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="c1"># </span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="n">GrimoireError</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">HashCollisionError</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="n">CorruptedDataError</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="n">UnknownAlgorithmError</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="n">InvalidFormatError</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="n">IndexNotDecryptedError</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="p">)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="c1"># </span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">normalize_path</span><span class="p">,</span> <span class="n">split_path</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="c1"># Manifest Mode</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.manifest</span><span class="w"> </span><span class="kn">import</span> <span class="n">ManifestBuilder</span><span class="p">,</span> <span class="n">ManifestReader</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a><span class="c1"># Archive Mode</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.archive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArchiveBuilder</span><span class="p">,</span> <span class="n">ArchiveReader</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="c1"># </span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ManifestJsonConverter</span><span class="p">,</span> <span class="n">ModeConverter</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a><span class="c1"># Hooks</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.hooks</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="n">CompressionHook</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="n">ChecksumHook</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="n">IndexCryptoHook</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="n">NoneChecksumHook</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="n">CRC32Hook</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="n">MD5Hook</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="n">SHA1Hook</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="n">SHA256Hook</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="n">ZlibCompressHook</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="n">XorObfuscateHook</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="n">ZlibXorHook</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a>    <span class="n">RcloneHashHook</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a>    <span class="n">RcloneNotFoundError</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a>    <span class="n">rclone_hash</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a>    <span class="c1"># </span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a>    <span class="s2">&quot;__version__&quot;</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">55</span></a>    <span class="c1"># </span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">56</span></a>    <span class="s2">&quot;GrimoireError&quot;</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">57</span></a>    <span class="s2">&quot;HashCollisionError&quot;</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">58</span></a>    <span class="s2">&quot;CorruptedDataError&quot;</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">59</span></a>    <span class="s2">&quot;UnknownAlgorithmError&quot;</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">60</span></a>    <span class="s2">&quot;InvalidFormatError&quot;</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">61</span></a>    <span class="s2">&quot;IndexNotDecryptedError&quot;</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">62</span></a>    <span class="c1"># </span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">63</span></a>    <span class="s2">&quot;normalize_path&quot;</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">64</span></a>    <span class="s2">&quot;split_path&quot;</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">65</span></a>    <span class="c1"># Manifest</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">66</span></a>    <span class="s2">&quot;ManifestBuilder&quot;</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">67</span></a>    <span class="s2">&quot;ManifestReader&quot;</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">68</span></a>    <span class="c1"># Archive</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">69</span></a>    <span class="s2">&quot;ArchiveBuilder&quot;</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">70</span></a>    <span class="s2">&quot;ArchiveReader&quot;</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">71</span></a>    <span class="c1"># </span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">72</span></a>    <span class="s2">&quot;ManifestJsonConverter&quot;</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">73</span></a>    <span class="s2">&quot;ModeConverter&quot;</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">74</span></a>    <span class="c1"># Hooks</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">75</span></a>    <span class="s2">&quot;CompressionHook&quot;</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">76</span></a>    <span class="s2">&quot;ChecksumHook&quot;</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">77</span></a>    <span class="s2">&quot;IndexCryptoHook&quot;</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">78</span></a>    <span class="s2">&quot;NoneChecksumHook&quot;</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">79</span></a>    <span class="s2">&quot;CRC32Hook&quot;</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">80</span></a>    <span class="s2">&quot;MD5Hook&quot;</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">81</span></a>    <span class="s2">&quot;SHA1Hook&quot;</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">82</span></a>    <span class="s2">&quot;SHA256Hook&quot;</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">83</span></a>    <span class="s2">&quot;ZlibCompressHook&quot;</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">84</span></a>    <span class="s2">&quot;XorObfuscateHook&quot;</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">85</span></a>    <span class="s2">&quot;ZlibXorHook&quot;</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">86</span></a>    <span class="s2">&quot;RcloneHashHook&quot;</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">87</span></a>    <span class="s2">&quot;RcloneNotFoundError&quot;</span><span class="p">,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">88</span></a>    <span class="s2">&quot;rclone_hash&quot;</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">89</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="__version__">
                    <div class="attr variable">
            <span class="name">__version__</span>        =
<span class="default_value">&#39;0.1.0&#39;</span>

        
    </div>
    <a class="headerlink" href="#__version__"></a>
    
    

                </section>
                <section id="GrimoireError">
                            <input id="GrimoireError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GrimoireError</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="GrimoireError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GrimoireError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GrimoireError-13"><a href="#GrimoireError-13"><span class="linenos">13</span></a><span class="k">class</span><span class="w"> </span><span class="nc">GrimoireError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="GrimoireError-14"><a href="#GrimoireError-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GrimoireVFS &quot;&quot;&quot;</span>
</span><span id="GrimoireError-15"><a href="#GrimoireError-15"><span class="linenos">15</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>GrimoireVFS </p>
</div>


                </section>
                <section id="HashCollisionError">
                            <input id="HashCollisionError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HashCollisionError</span><wbr>(<span class="base"><a href="#GrimoireError">grimoire.GrimoireError</a></span>):

                <label class="view-source-button" for="HashCollisionError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HashCollisionError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HashCollisionError-18"><a href="#HashCollisionError-18"><span class="linenos">18</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HashCollisionError</span><span class="p">(</span><span class="n">GrimoireError</span><span class="p">):</span>
</span><span id="HashCollisionError-19"><a href="#HashCollisionError-19"><span class="linenos">19</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HashCollisionError-20"><a href="#HashCollisionError-20"><span class="linenos">20</span></a><span class="sd">     Hash </span>
</span><span id="HashCollisionError-21"><a href="#HashCollisionError-21"><span class="linenos">21</span></a><span class="sd">    </span>
</span><span id="HashCollisionError-22"><a href="#HashCollisionError-22"><span class="linenos">22</span></a><span class="sd">     path_hash </span>
</span><span id="HashCollisionError-23"><a href="#HashCollisionError-23"><span class="linenos">23</span></a><span class="sd">     (xxHash64  1/2^64)</span>
</span><span id="HashCollisionError-24"><a href="#HashCollisionError-24"><span class="linenos">24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HashCollisionError-25"><a href="#HashCollisionError-25"><span class="linenos">25</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hash_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="HashCollisionError-26"><a href="#HashCollisionError-26"><span class="linenos">26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path1</span> <span class="o">=</span> <span class="n">path1</span>
</span><span id="HashCollisionError-27"><a href="#HashCollisionError-27"><span class="linenos">27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path2</span> <span class="o">=</span> <span class="n">path2</span>
</span><span id="HashCollisionError-28"><a href="#HashCollisionError-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_value</span> <span class="o">=</span> <span class="n">hash_value</span>
</span><span id="HashCollisionError-29"><a href="#HashCollisionError-29"><span class="linenos">29</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HashCollisionError-30"><a href="#HashCollisionError-30"><span class="linenos">30</span></a>            <span class="sa">f</span><span class="s2">&quot; Hash : &#39;</span><span class="si">{</span><span class="n">path1</span><span class="si">}</span><span class="s2">&#39;  &#39;</span><span class="si">{</span><span class="n">path2</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
</span><span id="HashCollisionError-31"><a href="#HashCollisionError-31"><span class="linenos">31</span></a>            <span class="sa">f</span><span class="s2">&quot; Hash  </span><span class="si">{</span><span class="n">hash_value</span><span class="si">:</span><span class="s2">#018x</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="HashCollisionError-32"><a href="#HashCollisionError-32"><span class="linenos">32</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> Hash </p>

<p> path_hash 
 (xxHash64  1/2^64)</p>
</div>


                            <div id="HashCollisionError.__init__" class="classattr">
                                        <input id="HashCollisionError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HashCollisionError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">path1</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">path2</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">hash_value</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="HashCollisionError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HashCollisionError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HashCollisionError.__init__-25"><a href="#HashCollisionError.__init__-25"><span class="linenos">25</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hash_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="HashCollisionError.__init__-26"><a href="#HashCollisionError.__init__-26"><span class="linenos">26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path1</span> <span class="o">=</span> <span class="n">path1</span>
</span><span id="HashCollisionError.__init__-27"><a href="#HashCollisionError.__init__-27"><span class="linenos">27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path2</span> <span class="o">=</span> <span class="n">path2</span>
</span><span id="HashCollisionError.__init__-28"><a href="#HashCollisionError.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hash_value</span> <span class="o">=</span> <span class="n">hash_value</span>
</span><span id="HashCollisionError.__init__-29"><a href="#HashCollisionError.__init__-29"><span class="linenos">29</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HashCollisionError.__init__-30"><a href="#HashCollisionError.__init__-30"><span class="linenos">30</span></a>            <span class="sa">f</span><span class="s2">&quot; Hash : &#39;</span><span class="si">{</span><span class="n">path1</span><span class="si">}</span><span class="s2">&#39;  &#39;</span><span class="si">{</span><span class="n">path2</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
</span><span id="HashCollisionError.__init__-31"><a href="#HashCollisionError.__init__-31"><span class="linenos">31</span></a>            <span class="sa">f</span><span class="s2">&quot; Hash  </span><span class="si">{</span><span class="n">hash_value</span><span class="si">:</span><span class="s2">#018x</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="HashCollisionError.__init__-32"><a href="#HashCollisionError.__init__-32"><span class="linenos">32</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="HashCollisionError.path1" class="classattr">
                                <div class="attr variable">
            <span class="name">path1</span>

        
    </div>
    <a class="headerlink" href="#HashCollisionError.path1"></a>
    
    

                            </div>
                            <div id="HashCollisionError.path2" class="classattr">
                                <div class="attr variable">
            <span class="name">path2</span>

        
    </div>
    <a class="headerlink" href="#HashCollisionError.path2"></a>
    
    

                            </div>
                            <div id="HashCollisionError.hash_value" class="classattr">
                                <div class="attr variable">
            <span class="name">hash_value</span>

        
    </div>
    <a class="headerlink" href="#HashCollisionError.hash_value"></a>
    
    

                            </div>
                </section>
                <section id="CorruptedDataError">
                            <input id="CorruptedDataError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CorruptedDataError</span><wbr>(<span class="base"><a href="#GrimoireError">grimoire.GrimoireError</a></span>):

                <label class="view-source-button" for="CorruptedDataError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CorruptedDataError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CorruptedDataError-35"><a href="#CorruptedDataError-35"><span class="linenos">35</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CorruptedDataError</span><span class="p">(</span><span class="n">GrimoireError</span><span class="p">):</span>
</span><span id="CorruptedDataError-36"><a href="#CorruptedDataError-36"><span class="linenos">36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CorruptedDataError-37"><a href="#CorruptedDataError-37"><span class="linenos">37</span></a><span class="sd">    </span>
</span><span id="CorruptedDataError-38"><a href="#CorruptedDataError-38"><span class="linenos">38</span></a><span class="sd">    </span>
</span><span id="CorruptedDataError-39"><a href="#CorruptedDataError-39"><span class="linenos">39</span></a><span class="sd">    </span>
</span><span id="CorruptedDataError-40"><a href="#CorruptedDataError-40"><span class="linenos">40</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CorruptedDataError-41"><a href="#CorruptedDataError-41"><span class="linenos">41</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">actual</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="CorruptedDataError-42"><a href="#CorruptedDataError-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vfs_path</span> <span class="o">=</span> <span class="n">vfs_path</span>
</span><span id="CorruptedDataError-43"><a href="#CorruptedDataError-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span>
</span><span id="CorruptedDataError-44"><a href="#CorruptedDataError-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actual</span> <span class="o">=</span> <span class="n">actual</span>
</span><span id="CorruptedDataError-45"><a href="#CorruptedDataError-45"><span class="linenos">45</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CorruptedDataError-46"><a href="#CorruptedDataError-46"><span class="linenos">46</span></a>            <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&#39; : &quot;</span>
</span><span id="CorruptedDataError-47"><a href="#CorruptedDataError-47"><span class="linenos">47</span></a>            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">expected</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">,  </span><span class="si">{</span><span class="n">actual</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CorruptedDataError-48"><a href="#CorruptedDataError-48"><span class="linenos">48</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>
</div>


                            <div id="CorruptedDataError.__init__" class="classattr">
                                        <input id="CorruptedDataError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CorruptedDataError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span>, </span><span class="param"><span class="n">actual</span><span class="p">:</span> <span class="nb">bytes</span></span>)</span>

                <label class="view-source-button" for="CorruptedDataError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CorruptedDataError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CorruptedDataError.__init__-41"><a href="#CorruptedDataError.__init__-41"><span class="linenos">41</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">actual</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="CorruptedDataError.__init__-42"><a href="#CorruptedDataError.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vfs_path</span> <span class="o">=</span> <span class="n">vfs_path</span>
</span><span id="CorruptedDataError.__init__-43"><a href="#CorruptedDataError.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span>
</span><span id="CorruptedDataError.__init__-44"><a href="#CorruptedDataError.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actual</span> <span class="o">=</span> <span class="n">actual</span>
</span><span id="CorruptedDataError.__init__-45"><a href="#CorruptedDataError.__init__-45"><span class="linenos">45</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CorruptedDataError.__init__-46"><a href="#CorruptedDataError.__init__-46"><span class="linenos">46</span></a>            <span class="sa">f</span><span class="s2">&quot; &#39;</span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&#39; : &quot;</span>
</span><span id="CorruptedDataError.__init__-47"><a href="#CorruptedDataError.__init__-47"><span class="linenos">47</span></a>            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">expected</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">,  </span><span class="si">{</span><span class="n">actual</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="CorruptedDataError.__init__-48"><a href="#CorruptedDataError.__init__-48"><span class="linenos">48</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="CorruptedDataError.vfs_path" class="classattr">
                                <div class="attr variable">
            <span class="name">vfs_path</span>

        
    </div>
    <a class="headerlink" href="#CorruptedDataError.vfs_path"></a>
    
    

                            </div>
                            <div id="CorruptedDataError.expected" class="classattr">
                                <div class="attr variable">
            <span class="name">expected</span>

        
    </div>
    <a class="headerlink" href="#CorruptedDataError.expected"></a>
    
    

                            </div>
                            <div id="CorruptedDataError.actual" class="classattr">
                                <div class="attr variable">
            <span class="name">actual</span>

        
    </div>
    <a class="headerlink" href="#CorruptedDataError.actual"></a>
    
    

                            </div>
                </section>
                <section id="UnknownAlgorithmError">
                            <input id="UnknownAlgorithmError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">UnknownAlgorithmError</span><wbr>(<span class="base"><a href="#GrimoireError">grimoire.GrimoireError</a></span>):

                <label class="view-source-button" for="UnknownAlgorithmError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UnknownAlgorithmError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UnknownAlgorithmError-51"><a href="#UnknownAlgorithmError-51"><span class="linenos">51</span></a><span class="k">class</span><span class="w"> </span><span class="nc">UnknownAlgorithmError</span><span class="p">(</span><span class="n">GrimoireError</span><span class="p">):</span>
</span><span id="UnknownAlgorithmError-52"><a href="#UnknownAlgorithmError-52"><span class="linenos">52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UnknownAlgorithmError-53"><a href="#UnknownAlgorithmError-53"><span class="linenos">53</span></a><span class="sd">     ID </span>
</span><span id="UnknownAlgorithmError-54"><a href="#UnknownAlgorithmError-54"><span class="linenos">54</span></a><span class="sd">    </span>
</span><span id="UnknownAlgorithmError-55"><a href="#UnknownAlgorithmError-55"><span class="linenos">55</span></a><span class="sd">    / ID </span>
</span><span id="UnknownAlgorithmError-56"><a href="#UnknownAlgorithmError-56"><span class="linenos">56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="UnknownAlgorithmError-57"><a href="#UnknownAlgorithmError-57"><span class="linenos">57</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">algo_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;algorithm&quot;</span><span class="p">):</span>
</span><span id="UnknownAlgorithmError-58"><a href="#UnknownAlgorithmError-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algo_id</span> <span class="o">=</span> <span class="n">algo_id</span>
</span><span id="UnknownAlgorithmError-59"><a href="#UnknownAlgorithmError-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algo_type</span> <span class="o">=</span> <span class="n">algo_type</span>
</span><span id="UnknownAlgorithmError-60"><a href="#UnknownAlgorithmError-60"><span class="linenos">60</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">algo_type</span><span class="si">}</span><span class="s2"> ID: </span><span class="si">{</span><span class="n">algo_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> ID </p>

<p>/ ID </p>
</div>


                            <div id="UnknownAlgorithmError.__init__" class="classattr">
                                        <input id="UnknownAlgorithmError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">UnknownAlgorithmError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">algo_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;algorithm&#39;</span></span>)</span>

                <label class="view-source-button" for="UnknownAlgorithmError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UnknownAlgorithmError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UnknownAlgorithmError.__init__-57"><a href="#UnknownAlgorithmError.__init__-57"><span class="linenos">57</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">algo_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;algorithm&quot;</span><span class="p">):</span>
</span><span id="UnknownAlgorithmError.__init__-58"><a href="#UnknownAlgorithmError.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algo_id</span> <span class="o">=</span> <span class="n">algo_id</span>
</span><span id="UnknownAlgorithmError.__init__-59"><a href="#UnknownAlgorithmError.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">algo_type</span> <span class="o">=</span> <span class="n">algo_type</span>
</span><span id="UnknownAlgorithmError.__init__-60"><a href="#UnknownAlgorithmError.__init__-60"><span class="linenos">60</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">algo_type</span><span class="si">}</span><span class="s2"> ID: </span><span class="si">{</span><span class="n">algo_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="UnknownAlgorithmError.algo_id" class="classattr">
                                <div class="attr variable">
            <span class="name">algo_id</span>

        
    </div>
    <a class="headerlink" href="#UnknownAlgorithmError.algo_id"></a>
    
    

                            </div>
                            <div id="UnknownAlgorithmError.algo_type" class="classattr">
                                <div class="attr variable">
            <span class="name">algo_type</span>

        
    </div>
    <a class="headerlink" href="#UnknownAlgorithmError.algo_type"></a>
    
    

                            </div>
                </section>
                <section id="InvalidFormatError">
                            <input id="InvalidFormatError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InvalidFormatError</span><wbr>(<span class="base"><a href="#GrimoireError">grimoire.GrimoireError</a></span>):

                <label class="view-source-button" for="InvalidFormatError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InvalidFormatError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InvalidFormatError-63"><a href="#InvalidFormatError-63"><span class="linenos">63</span></a><span class="k">class</span><span class="w"> </span><span class="nc">InvalidFormatError</span><span class="p">(</span><span class="n">GrimoireError</span><span class="p">):</span>
</span><span id="InvalidFormatError-64"><a href="#InvalidFormatError-64"><span class="linenos">64</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InvalidFormatError-65"><a href="#InvalidFormatError-65"><span class="linenos">65</span></a><span class="sd">    </span>
</span><span id="InvalidFormatError-66"><a href="#InvalidFormatError-66"><span class="linenos">66</span></a><span class="sd">    </span>
</span><span id="InvalidFormatError-67"><a href="#InvalidFormatError-67"><span class="linenos">67</span></a><span class="sd">    </span>
</span><span id="InvalidFormatError-68"><a href="#InvalidFormatError-68"><span class="linenos">68</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="InvalidFormatError-69"><a href="#InvalidFormatError-69"><span class="linenos">69</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">actual</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="InvalidFormatError-70"><a href="#InvalidFormatError-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span>
</span><span id="InvalidFormatError-71"><a href="#InvalidFormatError-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actual</span> <span class="o">=</span> <span class="n">actual</span>
</span><span id="InvalidFormatError-72"><a href="#InvalidFormatError-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="n">expected</span> <span class="ow">and</span> <span class="n">actual</span><span class="p">:</span>
</span><span id="InvalidFormatError-73"><a href="#InvalidFormatError-73"><span class="linenos">73</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">:  </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2">,  </span><span class="si">{</span><span class="n">actual</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="InvalidFormatError-74"><a href="#InvalidFormatError-74"><span class="linenos">74</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>
</div>


                            <div id="InvalidFormatError.__init__" class="classattr">
                                        <input id="InvalidFormatError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">InvalidFormatError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">message</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">expected</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">actual</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="InvalidFormatError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InvalidFormatError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InvalidFormatError.__init__-69"><a href="#InvalidFormatError.__init__-69"><span class="linenos">69</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">actual</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="InvalidFormatError.__init__-70"><a href="#InvalidFormatError.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span>
</span><span id="InvalidFormatError.__init__-71"><a href="#InvalidFormatError.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">actual</span> <span class="o">=</span> <span class="n">actual</span>
</span><span id="InvalidFormatError.__init__-72"><a href="#InvalidFormatError.__init__-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="n">expected</span> <span class="ow">and</span> <span class="n">actual</span><span class="p">:</span>
</span><span id="InvalidFormatError.__init__-73"><a href="#InvalidFormatError.__init__-73"><span class="linenos">73</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">:  </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2">,  </span><span class="si">{</span><span class="n">actual</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="InvalidFormatError.__init__-74"><a href="#InvalidFormatError.__init__-74"><span class="linenos">74</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="InvalidFormatError.expected" class="classattr">
                                <div class="attr variable">
            <span class="name">expected</span>

        
    </div>
    <a class="headerlink" href="#InvalidFormatError.expected"></a>
    
    

                            </div>
                            <div id="InvalidFormatError.actual" class="classattr">
                                <div class="attr variable">
            <span class="name">actual</span>

        
    </div>
    <a class="headerlink" href="#InvalidFormatError.actual"></a>
    
    

                            </div>
                </section>
                <section id="IndexNotDecryptedError">
                            <input id="IndexNotDecryptedError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IndexNotDecryptedError</span><wbr>(<span class="base"><a href="#GrimoireError">grimoire.GrimoireError</a></span>):

                <label class="view-source-button" for="IndexNotDecryptedError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexNotDecryptedError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexNotDecryptedError-92"><a href="#IndexNotDecryptedError-92"><span class="linenos"> 92</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexNotDecryptedError</span><span class="p">(</span><span class="n">GrimoireError</span><span class="p">):</span>
</span><span id="IndexNotDecryptedError-93"><a href="#IndexNotDecryptedError-93"><span class="linenos"> 93</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexNotDecryptedError-94"><a href="#IndexNotDecryptedError-94"><span class="linenos"> 94</span></a><span class="sd">    </span>
</span><span id="IndexNotDecryptedError-95"><a href="#IndexNotDecryptedError-95"><span class="linenos"> 95</span></a><span class="sd">    </span>
</span><span id="IndexNotDecryptedError-96"><a href="#IndexNotDecryptedError-96"><span class="linenos"> 96</span></a><span class="sd">    </span>
</span><span id="IndexNotDecryptedError-97"><a href="#IndexNotDecryptedError-97"><span class="linenos"> 97</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="IndexNotDecryptedError-98"><a href="#IndexNotDecryptedError-98"><span class="linenos"> 98</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="IndexNotDecryptedError-99"><a href="#IndexNotDecryptedError-99"><span class="linenos"> 99</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IndexNotDecryptedError-100"><a href="#IndexNotDecryptedError-100"><span class="linenos">100</span></a>            <span class="n">message</span> <span class="ow">or</span> <span class="s2">&quot; IndexCryptoHook &quot;</span>
</span><span id="IndexNotDecryptedError-101"><a href="#IndexNotDecryptedError-101"><span class="linenos">101</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>
</div>


                            <div id="IndexNotDecryptedError.__init__" class="classattr">
                                        <input id="IndexNotDecryptedError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">IndexNotDecryptedError</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="IndexNotDecryptedError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexNotDecryptedError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexNotDecryptedError.__init__-98"><a href="#IndexNotDecryptedError.__init__-98"><span class="linenos"> 98</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="IndexNotDecryptedError.__init__-99"><a href="#IndexNotDecryptedError.__init__-99"><span class="linenos"> 99</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IndexNotDecryptedError.__init__-100"><a href="#IndexNotDecryptedError.__init__-100"><span class="linenos">100</span></a>            <span class="n">message</span> <span class="ow">or</span> <span class="s2">&quot; IndexCryptoHook &quot;</span>
</span><span id="IndexNotDecryptedError.__init__-101"><a href="#IndexNotDecryptedError.__init__-101"><span class="linenos">101</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="normalize_path">
                            <input id="normalize_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">absolute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="normalize_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#normalize_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="normalize_path-15"><a href="#normalize_path-15"><span class="linenos">15</span></a><span class="k">def</span><span class="w"> </span><span class="nf">normalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">absolute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="normalize_path-16"><a href="#normalize_path-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="normalize_path-17"><a href="#normalize_path-17"><span class="linenos">17</span></a><span class="sd">    </span>
</span><span id="normalize_path-18"><a href="#normalize_path-18"><span class="linenos">18</span></a><span class="sd">    </span>
</span><span id="normalize_path-19"><a href="#normalize_path-19"><span class="linenos">19</span></a><span class="sd">    1. </span>
</span><span id="normalize_path-20"><a href="#normalize_path-20"><span class="linenos">20</span></a><span class="sd">    2. </span>
</span><span id="normalize_path-21"><a href="#normalize_path-21"><span class="linenos">21</span></a><span class="sd">    3. </span>
</span><span id="normalize_path-22"><a href="#normalize_path-22"><span class="linenos">22</span></a><span class="sd">    4. :  /  (absolute=True)</span>
</span><span id="normalize_path-23"><a href="#normalize_path-23"><span class="linenos">23</span></a><span class="sd">    </span>
</span><span id="normalize_path-24"><a href="#normalize_path-24"><span class="linenos">24</span></a><span class="sd">    Args:</span>
</span><span id="normalize_path-25"><a href="#normalize_path-25"><span class="linenos">25</span></a><span class="sd">        path: </span>
</span><span id="normalize_path-26"><a href="#normalize_path-26"><span class="linenos">26</span></a><span class="sd">        absolute:  /  () False</span>
</span><span id="normalize_path-27"><a href="#normalize_path-27"><span class="linenos">27</span></a><span class="sd">        </span>
</span><span id="normalize_path-28"><a href="#normalize_path-28"><span class="linenos">28</span></a><span class="sd">    Returns:</span>
</span><span id="normalize_path-29"><a href="#normalize_path-29"><span class="linenos">29</span></a><span class="sd">        </span>
</span><span id="normalize_path-30"><a href="#normalize_path-30"><span class="linenos">30</span></a><span class="sd">        </span>
</span><span id="normalize_path-31"><a href="#normalize_path-31"><span class="linenos">31</span></a><span class="sd">    Examples:</span>
</span><span id="normalize_path-32"><a href="#normalize_path-32"><span class="linenos">32</span></a><span class="sd">        &gt;&gt;&gt; normalize_path(&quot;Game\\\\MOD\\\\hero.wad&quot;)</span>
</span><span id="normalize_path-33"><a href="#normalize_path-33"><span class="linenos">33</span></a><span class="sd">        &#39;Game/MOD/hero.wad&#39;</span>
</span><span id="normalize_path-34"><a href="#normalize_path-34"><span class="linenos">34</span></a><span class="sd">        &gt;&gt;&gt; normalize_path(&quot;/Game/MOD/&quot;)</span>
</span><span id="normalize_path-35"><a href="#normalize_path-35"><span class="linenos">35</span></a><span class="sd">        &#39;Game/MOD&#39;</span>
</span><span id="normalize_path-36"><a href="#normalize_path-36"><span class="linenos">36</span></a><span class="sd">        &gt;&gt;&gt; normalize_path(&quot;hero.wad&quot;)</span>
</span><span id="normalize_path-37"><a href="#normalize_path-37"><span class="linenos">37</span></a><span class="sd">        &#39;hero.wad&#39;</span>
</span><span id="normalize_path-38"><a href="#normalize_path-38"><span class="linenos">38</span></a><span class="sd">        &gt;&gt;&gt; normalize_path(&quot;Game/MOD&quot;, absolute=True)</span>
</span><span id="normalize_path-39"><a href="#normalize_path-39"><span class="linenos">39</span></a><span class="sd">        &#39;/Game/MOD&#39;</span>
</span><span id="normalize_path-40"><a href="#normalize_path-40"><span class="linenos">40</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="normalize_path-41"><a href="#normalize_path-41"><span class="linenos">41</span></a>    <span class="c1">#   </span>
</span><span id="normalize_path-42"><a href="#normalize_path-42"><span class="linenos">42</span></a>    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="normalize_path-43"><a href="#normalize_path-43"><span class="linenos">43</span></a>    
</span><span id="normalize_path-44"><a href="#normalize_path-44"><span class="linenos">44</span></a>    <span class="c1"># </span>
</span><span id="normalize_path-45"><a href="#normalize_path-45"><span class="linenos">45</span></a>    <span class="k">while</span> <span class="s2">&quot;//&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="normalize_path-46"><a href="#normalize_path-46"><span class="linenos">46</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="normalize_path-47"><a href="#normalize_path-47"><span class="linenos">47</span></a>    
</span><span id="normalize_path-48"><a href="#normalize_path-48"><span class="linenos">48</span></a>    <span class="c1">#  ()</span>
</span><span id="normalize_path-49"><a href="#normalize_path-49"><span class="linenos">49</span></a>    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="normalize_path-50"><a href="#normalize_path-50"><span class="linenos">50</span></a>    
</span><span id="normalize_path-51"><a href="#normalize_path-51"><span class="linenos">51</span></a>    <span class="c1">#  ()</span>
</span><span id="normalize_path-52"><a href="#normalize_path-52"><span class="linenos">52</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">absolute</span><span class="p">:</span>
</span><span id="normalize_path-53"><a href="#normalize_path-53"><span class="linenos">53</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="normalize_path-54"><a href="#normalize_path-54"><span class="linenos">54</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="normalize_path-55"><a href="#normalize_path-55"><span class="linenos">55</span></a>        <span class="c1">#  / </span>
</span><span id="normalize_path-56"><a href="#normalize_path-56"><span class="linenos">56</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
</span><span id="normalize_path-57"><a href="#normalize_path-57"><span class="linenos">57</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">path</span>
</span><span id="normalize_path-58"><a href="#normalize_path-58"><span class="linenos">58</span></a>    
</span><span id="normalize_path-59"><a href="#normalize_path-59"><span class="linenos">59</span></a>    <span class="c1"># </span>
</span><span id="normalize_path-60"><a href="#normalize_path-60"><span class="linenos">60</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
</span><span id="normalize_path-61"><a href="#normalize_path-61"><span class="linenos">61</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="k">if</span> <span class="n">absolute</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="normalize_path-62"><a href="#normalize_path-62"><span class="linenos">62</span></a>    
</span><span id="normalize_path-63"><a href="#normalize_path-63"><span class="linenos">63</span></a>    <span class="k">return</span> <span class="n">path</span>
</span></pre></div>


            <div class="docstring"><p></p>

<ol>
<li></li>
<li></li>
<li></li>
<li>:  /  (absolute=True)</li>
</ol>

<p>Args:
    path: 
    absolute:  /  () False</p>

<p>Returns:
    </p>

<p>Examples:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>normalize_path("Game\MOD\hero.wad")
          'Game/MOD/hero.wad'
      normalize_path("/Game/MOD/")
          'Game/MOD'
      normalize_path("hero.wad")
          'hero.wad'
      normalize_path("Game/MOD", absolute=True)
          '/Game/MOD'</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                </section>
                <section id="split_path">
                            <input id="split_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">full_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="split_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#split_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="split_path-66"><a href="#split_path-66"><span class="linenos"> 66</span></a><span class="k">def</span><span class="w"> </span><span class="nf">split_path</span><span class="p">(</span><span class="n">full_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="split_path-67"><a href="#split_path-67"><span class="linenos"> 67</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="split_path-68"><a href="#split_path-68"><span class="linenos"> 68</span></a><span class="sd">     (, , )</span>
</span><span id="split_path-69"><a href="#split_path-69"><span class="linenos"> 69</span></a><span class="sd">    </span>
</span><span id="split_path-70"><a href="#split_path-70"><span class="linenos"> 70</span></a><span class="sd">    </span>
</span><span id="split_path-71"><a href="#split_path-71"><span class="linenos"> 71</span></a><span class="sd">    </span>
</span><span id="split_path-72"><a href="#split_path-72"><span class="linenos"> 72</span></a><span class="sd">    </span>
</span><span id="split_path-73"><a href="#split_path-73"><span class="linenos"> 73</span></a><span class="sd">    Args:</span>
</span><span id="split_path-74"><a href="#split_path-74"><span class="linenos"> 74</span></a><span class="sd">        full_path: </span>
</span><span id="split_path-75"><a href="#split_path-75"><span class="linenos"> 75</span></a><span class="sd">        </span>
</span><span id="split_path-76"><a href="#split_path-76"><span class="linenos"> 76</span></a><span class="sd">    Returns:</span>
</span><span id="split_path-77"><a href="#split_path-77"><span class="linenos"> 77</span></a><span class="sd">        (, , ) </span>
</span><span id="split_path-78"><a href="#split_path-78"><span class="linenos"> 78</span></a><span class="sd">        </span>
</span><span id="split_path-79"><a href="#split_path-79"><span class="linenos"> 79</span></a><span class="sd">    Examples:</span>
</span><span id="split_path-80"><a href="#split_path-80"><span class="linenos"> 80</span></a><span class="sd">        &gt;&gt;&gt; split_path(&quot;/Game/MOD/hero_skin.wad&quot;)</span>
</span><span id="split_path-81"><a href="#split_path-81"><span class="linenos"> 81</span></a><span class="sd">        (&#39;/Game/MOD&#39;, &#39;hero_skin&#39;, &#39;.wad&#39;)</span>
</span><span id="split_path-82"><a href="#split_path-82"><span class="linenos"> 82</span></a><span class="sd">        &gt;&gt;&gt; split_path(&quot;/config.json&quot;)</span>
</span><span id="split_path-83"><a href="#split_path-83"><span class="linenos"> 83</span></a><span class="sd">        (&#39;/&#39;, &#39;config&#39;, &#39;.json&#39;)</span>
</span><span id="split_path-84"><a href="#split_path-84"><span class="linenos"> 84</span></a><span class="sd">        &gt;&gt;&gt; split_path(&quot;/data/README&quot;)</span>
</span><span id="split_path-85"><a href="#split_path-85"><span class="linenos"> 85</span></a><span class="sd">        (&#39;/data&#39;, &#39;README&#39;, &#39;&#39;)</span>
</span><span id="split_path-86"><a href="#split_path-86"><span class="linenos"> 86</span></a><span class="sd">        &gt;&gt;&gt; split_path(&quot;DATA/file.txt&quot;)</span>
</span><span id="split_path-87"><a href="#split_path-87"><span class="linenos"> 87</span></a><span class="sd">        (&#39;DATA&#39;, &#39;file&#39;, &#39;.txt&#39;)</span>
</span><span id="split_path-88"><a href="#split_path-88"><span class="linenos"> 88</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="split_path-89"><a href="#split_path-89"><span class="linenos"> 89</span></a>    <span class="c1">#  / </span>
</span><span id="split_path-90"><a href="#split_path-90"><span class="linenos"> 90</span></a>    <span class="n">is_absolute</span> <span class="o">=</span> <span class="n">full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">full_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="split_path-91"><a href="#split_path-91"><span class="linenos"> 91</span></a>    <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="n">is_absolute</span><span class="p">)</span>
</span><span id="split_path-92"><a href="#split_path-92"><span class="linenos"> 92</span></a>    
</span><span id="split_path-93"><a href="#split_path-93"><span class="linenos"> 93</span></a>    <span class="c1"># </span>
</span><span id="split_path-94"><a href="#split_path-94"><span class="linenos"> 94</span></a>    <span class="n">dir_part</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="split_path-95"><a href="#split_path-95"><span class="linenos"> 95</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dir_part</span><span class="p">:</span>
</span><span id="split_path-96"><a href="#split_path-96"><span class="linenos"> 96</span></a>        <span class="n">dir_part</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="k">if</span> <span class="n">is_absolute</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="split_path-97"><a href="#split_path-97"><span class="linenos"> 97</span></a>    
</span><span id="split_path-98"><a href="#split_path-98"><span class="linenos"> 98</span></a>    <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="split_path-99"><a href="#split_path-99"><span class="linenos"> 99</span></a>    
</span><span id="split_path-100"><a href="#split_path-100"><span class="linenos">100</span></a>    <span class="c1"># </span>
</span><span id="split_path-101"><a href="#split_path-101"><span class="linenos">101</span></a>    <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
</span><span id="split_path-102"><a href="#split_path-102"><span class="linenos">102</span></a>    
</span><span id="split_path-103"><a href="#split_path-103"><span class="linenos">103</span></a>    <span class="k">return</span> <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span>
</span></pre></div>


            <div class="docstring"><p> (, , )</p>

<p>
</p>

<p>Args:
    full_path: </p>

<p>Returns:
    (, , ) </p>

<p>Examples:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>split_path("/Game/MOD/hero_skin.wad")
          ('/Game/MOD', 'hero_skin', '.wad')
      split_path("/config.json")
          ('/', 'config', '.json')
      split_path("/data/README")
          ('/data', 'README', '')
      split_path("DATA/file.txt")
          ('DATA', 'file', '.txt')</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                </section>
                <section id="ManifestBuilder">
                            <input id="ManifestBuilder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ManifestBuilder</span>:

                <label class="view-source-button" for="ManifestBuilder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder-21"><a href="#ManifestBuilder-21"><span class="linenos"> 21</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ManifestBuilder</span><span class="p">:</span>
</span><span id="ManifestBuilder-22"><a href="#ManifestBuilder-22"><span class="linenos"> 22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-23"><a href="#ManifestBuilder-23"><span class="linenos"> 23</span></a><span class="sd">    Manifest </span>
</span><span id="ManifestBuilder-24"><a href="#ManifestBuilder-24"><span class="linenos"> 24</span></a><span class="sd">    </span>
</span><span id="ManifestBuilder-25"><a href="#ManifestBuilder-25"><span class="linenos"> 25</span></a><span class="sd">    </span>
</span><span id="ManifestBuilder-26"><a href="#ManifestBuilder-26"><span class="linenos"> 26</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-27"><a href="#ManifestBuilder-27"><span class="linenos"> 27</span></a>    
</span><span id="ManifestBuilder-28"><a href="#ManifestBuilder-28"><span class="linenos"> 28</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ManifestBuilder-29"><a href="#ManifestBuilder-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder-30"><a href="#ManifestBuilder-30"><span class="linenos"> 30</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestBuilder-31"><a href="#ManifestBuilder-31"><span class="linenos"> 31</span></a>        <span class="n">magic</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GRIM&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder-32"><a href="#ManifestBuilder-32"><span class="linenos"> 32</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder-33"><a href="#ManifestBuilder-33"><span class="linenos"> 33</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder-34"><a href="#ManifestBuilder-34"><span class="linenos"> 34</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder-35"><a href="#ManifestBuilder-35"><span class="linenos"> 35</span></a>    <span class="p">):</span>
</span><span id="ManifestBuilder-36"><a href="#ManifestBuilder-36"><span class="linenos"> 36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-37"><a href="#ManifestBuilder-37"><span class="linenos"> 37</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-38"><a href="#ManifestBuilder-38"><span class="linenos"> 38</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-39"><a href="#ManifestBuilder-39"><span class="linenos"> 39</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder-40"><a href="#ManifestBuilder-40"><span class="linenos"> 40</span></a><span class="sd">            output_path: </span>
</span><span id="ManifestBuilder-41"><a href="#ManifestBuilder-41"><span class="linenos"> 41</span></a><span class="sd">            magic:  (4 bytes)</span>
</span><span id="ManifestBuilder-42"><a href="#ManifestBuilder-42"><span class="linenos"> 42</span></a><span class="sd">            checksum_hook:  ()</span>
</span><span id="ManifestBuilder-43"><a href="#ManifestBuilder-43"><span class="linenos"> 43</span></a><span class="sd">            index_crypto:  ()</span>
</span><span id="ManifestBuilder-44"><a href="#ManifestBuilder-44"><span class="linenos"> 44</span></a><span class="sd">            path_hash_func:  Hash  ()</span>
</span><span id="ManifestBuilder-45"><a href="#ManifestBuilder-45"><span class="linenos"> 45</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-46"><a href="#ManifestBuilder-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="ManifestBuilder-47"><a href="#ManifestBuilder-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_magic</span> <span class="o">=</span> <span class="n">magic</span>
</span><span id="ManifestBuilder-48"><a href="#ManifestBuilder-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ManifestBuilder-49"><a href="#ManifestBuilder-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ManifestBuilder-50"><a href="#ManifestBuilder-50"><span class="linenos"> 50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ManifestBuilder-51"><a href="#ManifestBuilder-51"><span class="linenos"> 51</span></a>        
</span><span id="ManifestBuilder-52"><a href="#ManifestBuilder-52"><span class="linenos"> 52</span></a>        <span class="c1"># </span>
</span><span id="ManifestBuilder-53"><a href="#ManifestBuilder-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span> <span class="o">=</span> <span class="n">PathDictionary</span><span class="p">()</span>
</span><span id="ManifestBuilder-54"><a href="#ManifestBuilder-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ManifestEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestBuilder-55"><a href="#ManifestBuilder-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder-56"><a href="#ManifestBuilder-56"><span class="linenos"> 56</span></a>    
</span><span id="ManifestBuilder-57"><a href="#ManifestBuilder-57"><span class="linenos"> 57</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestBuilder-58"><a href="#ManifestBuilder-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-59"><a href="#ManifestBuilder-59"><span class="linenos"> 59</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-60"><a href="#ManifestBuilder-60"><span class="linenos"> 60</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-61"><a href="#ManifestBuilder-61"><span class="linenos"> 61</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder-62"><a href="#ManifestBuilder-62"><span class="linenos"> 62</span></a><span class="sd">            local_path: </span>
</span><span id="ManifestBuilder-63"><a href="#ManifestBuilder-63"><span class="linenos"> 63</span></a><span class="sd">            vfs_path:  ()</span>
</span><span id="ManifestBuilder-64"><a href="#ManifestBuilder-64"><span class="linenos"> 64</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder-65"><a href="#ManifestBuilder-65"><span class="linenos"> 65</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestBuilder-66"><a href="#ManifestBuilder-66"><span class="linenos"> 66</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ManifestBuilder-67"><a href="#ManifestBuilder-67"><span class="linenos"> 67</span></a><span class="sd">            HashCollisionError:  Hash </span>
</span><span id="ManifestBuilder-68"><a href="#ManifestBuilder-68"><span class="linenos"> 68</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-69"><a href="#ManifestBuilder-69"><span class="linenos"> 69</span></a>        <span class="c1"># 1. </span>
</span><span id="ManifestBuilder-70"><a href="#ManifestBuilder-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ManifestBuilder-71"><a href="#ManifestBuilder-71"><span class="linenos"> 71</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ManifestBuilder-72"><a href="#ManifestBuilder-72"><span class="linenos"> 72</span></a>        
</span><span id="ManifestBuilder-73"><a href="#ManifestBuilder-73"><span class="linenos"> 73</span></a>        <span class="c1"># 2. </span>
</span><span id="ManifestBuilder-74"><a href="#ManifestBuilder-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="n">vfs_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestBuilder-75"><a href="#ManifestBuilder-75"><span class="linenos"> 75</span></a>            <span class="n">vfs_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-76"><a href="#ManifestBuilder-76"><span class="linenos"> 76</span></a>        
</span><span id="ManifestBuilder-77"><a href="#ManifestBuilder-77"><span class="linenos"> 77</span></a>        <span class="c1"># 3. </span>
</span><span id="ManifestBuilder-78"><a href="#ManifestBuilder-78"><span class="linenos"> 78</span></a>        <span class="n">is_absolute</span> <span class="o">=</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ManifestBuilder-79"><a href="#ManifestBuilder-79"><span class="linenos"> 79</span></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="n">is_absolute</span><span class="p">)</span>
</span><span id="ManifestBuilder-80"><a href="#ManifestBuilder-80"><span class="linenos"> 80</span></a>        <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder-81"><a href="#ManifestBuilder-81"><span class="linenos"> 81</span></a>        
</span><span id="ManifestBuilder-82"><a href="#ManifestBuilder-82"><span class="linenos"> 82</span></a>        <span class="c1"># 4.  path_hash </span>
</span><span id="ManifestBuilder-83"><a href="#ManifestBuilder-83"><span class="linenos"> 83</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder-84"><a href="#ManifestBuilder-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span>
</span><span id="ManifestBuilder-85"><a href="#ManifestBuilder-85"><span class="linenos"> 85</span></a>            <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ManifestBuilder-86"><a href="#ManifestBuilder-86"><span class="linenos"> 86</span></a>            <span class="k">if</span> <span class="n">existing</span> <span class="o">!=</span> <span class="n">normalized</span><span class="p">:</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder-87"><a href="#ManifestBuilder-87"><span class="linenos"> 87</span></a>                <span class="k">raise</span> <span class="n">HashCollisionError</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">normalized</span><span class="p">,</span> <span class="n">path_hash</span><span class="p">)</span>
</span><span id="ManifestBuilder-88"><a href="#ManifestBuilder-88"><span class="linenos"> 88</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder-89"><a href="#ManifestBuilder-89"><span class="linenos"> 89</span></a>                <span class="k">return</span>
</span><span id="ManifestBuilder-90"><a href="#ManifestBuilder-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ManifestBuilder-91"><a href="#ManifestBuilder-91"><span class="linenos"> 91</span></a>        
</span><span id="ManifestBuilder-92"><a href="#ManifestBuilder-92"><span class="linenos"> 92</span></a>        <span class="c1"># 5. </span>
</span><span id="ManifestBuilder-93"><a href="#ManifestBuilder-93"><span class="linenos"> 93</span></a>        <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ManifestBuilder-94"><a href="#ManifestBuilder-94"><span class="linenos"> 94</span></a>        
</span><span id="ManifestBuilder-95"><a href="#ManifestBuilder-95"><span class="linenos"> 95</span></a>        <span class="c1"># 6. </span>
</span><span id="ManifestBuilder-96"><a href="#ManifestBuilder-96"><span class="linenos"> 96</span></a>        <span class="n">raw_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-97"><a href="#ManifestBuilder-97"><span class="linenos"> 97</span></a>        
</span><span id="ManifestBuilder-98"><a href="#ManifestBuilder-98"><span class="linenos"> 98</span></a>        <span class="n">checksum</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="ManifestBuilder-99"><a href="#ManifestBuilder-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">:</span>
</span><span id="ManifestBuilder-100"><a href="#ManifestBuilder-100"><span class="linenos">100</span></a>            <span class="c1">#  compute_file ( RcloneHashHook) I/O</span>
</span><span id="ManifestBuilder-101"><a href="#ManifestBuilder-101"><span class="linenos">101</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">,</span> <span class="s1">&#39;compute_file&#39;</span><span class="p">):</span>
</span><span id="ManifestBuilder-102"><a href="#ManifestBuilder-102"><span class="linenos">102</span></a>                <span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-103"><a href="#ManifestBuilder-103"><span class="linenos">103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestBuilder-104"><a href="#ManifestBuilder-104"><span class="linenos">104</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder-105"><a href="#ManifestBuilder-105"><span class="linenos">105</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestBuilder-106"><a href="#ManifestBuilder-106"><span class="linenos">106</span></a>                    <span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ManifestBuilder-107"><a href="#ManifestBuilder-107"><span class="linenos">107</span></a>        
</span><span id="ManifestBuilder-108"><a href="#ManifestBuilder-108"><span class="linenos">108</span></a>        <span class="c1"># 7.  Entry</span>
</span><span id="ManifestBuilder-109"><a href="#ManifestBuilder-109"><span class="linenos">109</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="p">(</span>
</span><span id="ManifestBuilder-110"><a href="#ManifestBuilder-110"><span class="linenos">110</span></a>            <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ManifestBuilder-111"><a href="#ManifestBuilder-111"><span class="linenos">111</span></a>            <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ManifestBuilder-112"><a href="#ManifestBuilder-112"><span class="linenos">112</span></a>            <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ManifestBuilder-113"><a href="#ManifestBuilder-113"><span class="linenos">113</span></a>            <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ManifestBuilder-114"><a href="#ManifestBuilder-114"><span class="linenos">114</span></a>            <span class="n">raw_size</span><span class="o">=</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestBuilder-115"><a href="#ManifestBuilder-115"><span class="linenos">115</span></a>            <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ManifestBuilder-116"><a href="#ManifestBuilder-116"><span class="linenos">116</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder-117"><a href="#ManifestBuilder-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="ManifestBuilder-118"><a href="#ManifestBuilder-118"><span class="linenos">118</span></a>    
</span><span id="ManifestBuilder-119"><a href="#ManifestBuilder-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir</span><span class="p">(</span>
</span><span id="ManifestBuilder-120"><a href="#ManifestBuilder-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="ManifestBuilder-121"><a href="#ManifestBuilder-121"><span class="linenos">121</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="ManifestBuilder-122"><a href="#ManifestBuilder-122"><span class="linenos">122</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ManifestBuilder-123"><a href="#ManifestBuilder-123"><span class="linenos">123</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ManifestBuilder-124"><a href="#ManifestBuilder-124"><span class="linenos">124</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ManifestBuilder-125"><a href="#ManifestBuilder-125"><span class="linenos">125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-126"><a href="#ManifestBuilder-126"><span class="linenos">126</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-127"><a href="#ManifestBuilder-127"><span class="linenos">127</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-128"><a href="#ManifestBuilder-128"><span class="linenos">128</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder-129"><a href="#ManifestBuilder-129"><span class="linenos">129</span></a><span class="sd">            local_dir: </span>
</span><span id="ManifestBuilder-130"><a href="#ManifestBuilder-130"><span class="linenos">130</span></a><span class="sd">            mount_point: </span>
</span><span id="ManifestBuilder-131"><a href="#ManifestBuilder-131"><span class="linenos">131</span></a><span class="sd">            recursive: </span>
</span><span id="ManifestBuilder-132"><a href="#ManifestBuilder-132"><span class="linenos">132</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder-133"><a href="#ManifestBuilder-133"><span class="linenos">133</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder-134"><a href="#ManifestBuilder-134"><span class="linenos">134</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder-135"><a href="#ManifestBuilder-135"><span class="linenos">135</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder-136"><a href="#ManifestBuilder-136"><span class="linenos">136</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestBuilder-137"><a href="#ManifestBuilder-137"><span class="linenos">137</span></a><span class="sd">            NotADirectoryError: </span>
</span><span id="ManifestBuilder-138"><a href="#ManifestBuilder-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-139"><a href="#ManifestBuilder-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ManifestBuilder-140"><a href="#ManifestBuilder-140"><span class="linenos">140</span></a>            <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ManifestBuilder-141"><a href="#ManifestBuilder-141"><span class="linenos">141</span></a>        
</span><span id="ManifestBuilder-142"><a href="#ManifestBuilder-142"><span class="linenos">142</span></a>        <span class="n">mount_point</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">mount_point</span><span class="p">)</span>
</span><span id="ManifestBuilder-143"><a href="#ManifestBuilder-143"><span class="linenos">143</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ManifestBuilder-144"><a href="#ManifestBuilder-144"><span class="linenos">144</span></a>        
</span><span id="ManifestBuilder-145"><a href="#ManifestBuilder-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="ManifestBuilder-146"><a href="#ManifestBuilder-146"><span class="linenos">146</span></a>            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ManifestBuilder-147"><a href="#ManifestBuilder-147"><span class="linenos">147</span></a>                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="ManifestBuilder-148"><a href="#ManifestBuilder-148"><span class="linenos">148</span></a>                    <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ManifestBuilder-149"><a href="#ManifestBuilder-149"><span class="linenos">149</span></a>                    <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">)</span>
</span><span id="ManifestBuilder-150"><a href="#ManifestBuilder-150"><span class="linenos">150</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="ManifestBuilder-151"><a href="#ManifestBuilder-151"><span class="linenos">151</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-152"><a href="#ManifestBuilder-152"><span class="linenos">152</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder-153"><a href="#ManifestBuilder-153"><span class="linenos">153</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestBuilder-154"><a href="#ManifestBuilder-154"><span class="linenos">154</span></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ManifestBuilder-155"><a href="#ManifestBuilder-155"><span class="linenos">155</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ManifestBuilder-156"><a href="#ManifestBuilder-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ManifestBuilder-157"><a href="#ManifestBuilder-157"><span class="linenos">157</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
</span><span id="ManifestBuilder-158"><a href="#ManifestBuilder-158"><span class="linenos">158</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-159"><a href="#ManifestBuilder-159"><span class="linenos">159</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder-160"><a href="#ManifestBuilder-160"><span class="linenos">160</span></a>        
</span><span id="ManifestBuilder-161"><a href="#ManifestBuilder-161"><span class="linenos">161</span></a>        <span class="k">return</span> <span class="n">count</span>
</span><span id="ManifestBuilder-162"><a href="#ManifestBuilder-162"><span class="linenos">162</span></a>    
</span><span id="ManifestBuilder-163"><a href="#ManifestBuilder-163"><span class="linenos">163</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestBuilder-164"><a href="#ManifestBuilder-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-165"><a href="#ManifestBuilder-165"><span class="linenos">165</span></a><span class="sd">         Manifest </span>
</span><span id="ManifestBuilder-166"><a href="#ManifestBuilder-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-167"><a href="#ManifestBuilder-167"><span class="linenos">167</span></a><span class="sd">        :</span>
</span><span id="ManifestBuilder-168"><a href="#ManifestBuilder-168"><span class="linenos">168</span></a><span class="sd">        1.  FileHeader </span>
</span><span id="ManifestBuilder-169"><a href="#ManifestBuilder-169"><span class="linenos">169</span></a><span class="sd">        2.  IndexHeader</span>
</span><span id="ManifestBuilder-170"><a href="#ManifestBuilder-170"><span class="linenos">170</span></a><span class="sd">        3.  String Tables ()</span>
</span><span id="ManifestBuilder-171"><a href="#ManifestBuilder-171"><span class="linenos">171</span></a><span class="sd">        4.  Entry Table</span>
</span><span id="ManifestBuilder-172"><a href="#ManifestBuilder-172"><span class="linenos">172</span></a><span class="sd">        5.  FileHeader  IndexHeader</span>
</span><span id="ManifestBuilder-173"><a href="#ManifestBuilder-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-174"><a href="#ManifestBuilder-174"><span class="linenos">174</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span><span class="p">,</span> <span class="s1">&#39;w+b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestBuilder-175"><a href="#ManifestBuilder-175"><span class="linenos">175</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">BinaryWriter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="ManifestBuilder-176"><a href="#ManifestBuilder-176"><span class="linenos">176</span></a>            
</span><span id="ManifestBuilder-177"><a href="#ManifestBuilder-177"><span class="linenos">177</span></a>            <span class="c1"># ========== 1.  FileHeader  ==========</span>
</span><span id="ManifestBuilder-178"><a href="#ManifestBuilder-178"><span class="linenos">178</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ManifestBuilder-179"><a href="#ManifestBuilder-179"><span class="linenos">179</span></a>            
</span><span id="ManifestBuilder-180"><a href="#ManifestBuilder-180"><span class="linenos">180</span></a>            <span class="c1"># ========== 2.  IndexHeader  ==========</span>
</span><span id="ManifestBuilder-181"><a href="#ManifestBuilder-181"><span class="linenos">181</span></a>            <span class="n">index_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ManifestBuilder-182"><a href="#ManifestBuilder-182"><span class="linenos">182</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">IndexHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ManifestBuilder-183"><a href="#ManifestBuilder-183"><span class="linenos">183</span></a>            
</span><span id="ManifestBuilder-184"><a href="#ManifestBuilder-184"><span class="linenos">184</span></a>            <span class="c1"># ========== 3.  String Tables ==========</span>
</span><span id="ManifestBuilder-185"><a href="#ManifestBuilder-185"><span class="linenos">185</span></a>            <span class="n">string_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ManifestBuilder-186"><a href="#ManifestBuilder-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
</span><span id="ManifestBuilder-187"><a href="#ManifestBuilder-187"><span class="linenos">187</span></a>            <span class="n">string_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">string_start</span>
</span><span id="ManifestBuilder-188"><a href="#ManifestBuilder-188"><span class="linenos">188</span></a>            
</span><span id="ManifestBuilder-189"><a href="#ManifestBuilder-189"><span class="linenos">189</span></a>            <span class="c1"># /</span>
</span><span id="ManifestBuilder-190"><a href="#ManifestBuilder-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ManifestBuilder-191"><a href="#ManifestBuilder-191"><span class="linenos">191</span></a>                <span class="c1">#  String Tables </span>
</span><span id="ManifestBuilder-192"><a href="#ManifestBuilder-192"><span class="linenos">192</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ManifestBuilder-193"><a href="#ManifestBuilder-193"><span class="linenos">193</span></a>                <span class="n">string_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">string_size</span><span class="p">)</span>
</span><span id="ManifestBuilder-194"><a href="#ManifestBuilder-194"><span class="linenos">194</span></a>                
</span><span id="ManifestBuilder-195"><a href="#ManifestBuilder-195"><span class="linenos">195</span></a>                <span class="c1"># /</span>
</span><span id="ManifestBuilder-196"><a href="#ManifestBuilder-196"><span class="linenos">196</span></a>                <span class="n">encrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ManifestBuilder-197"><a href="#ManifestBuilder-197"><span class="linenos">197</span></a>                
</span><span id="ManifestBuilder-198"><a href="#ManifestBuilder-198"><span class="linenos">198</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder-199"><a href="#ManifestBuilder-199"><span class="linenos">199</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ManifestBuilder-200"><a href="#ManifestBuilder-200"><span class="linenos">200</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span><span id="ManifestBuilder-201"><a href="#ManifestBuilder-201"><span class="linenos">201</span></a>                
</span><span id="ManifestBuilder-202"><a href="#ManifestBuilder-202"><span class="linenos">202</span></a>                <span class="c1">#  string_size </span>
</span><span id="ManifestBuilder-203"><a href="#ManifestBuilder-203"><span class="linenos">203</span></a>                <span class="n">string_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span><span id="ManifestBuilder-204"><a href="#ManifestBuilder-204"><span class="linenos">204</span></a>                
</span><span id="ManifestBuilder-205"><a href="#ManifestBuilder-205"><span class="linenos">205</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder-206"><a href="#ManifestBuilder-206"><span class="linenos">206</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span> <span class="o">+</span> <span class="n">string_size</span><span class="p">)</span>
</span><span id="ManifestBuilder-207"><a href="#ManifestBuilder-207"><span class="linenos">207</span></a>            
</span><span id="ManifestBuilder-208"><a href="#ManifestBuilder-208"><span class="linenos">208</span></a>            <span class="c1"># ========== 4.  Entry Table ==========</span>
</span><span id="ManifestBuilder-209"><a href="#ManifestBuilder-209"><span class="linenos">209</span></a>            <span class="n">checksum_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">digest_size</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ManifestBuilder-210"><a href="#ManifestBuilder-210"><span class="linenos">210</span></a>            
</span><span id="ManifestBuilder-211"><a href="#ManifestBuilder-211"><span class="linenos">211</span></a>            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ManifestBuilder-212"><a href="#ManifestBuilder-212"><span class="linenos">212</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ManifestBuilder-213"><a href="#ManifestBuilder-213"><span class="linenos">213</span></a>            
</span><span id="ManifestBuilder-214"><a href="#ManifestBuilder-214"><span class="linenos">214</span></a>            <span class="n">index_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">index_start</span>
</span><span id="ManifestBuilder-215"><a href="#ManifestBuilder-215"><span class="linenos">215</span></a>            
</span><span id="ManifestBuilder-216"><a href="#ManifestBuilder-216"><span class="linenos">216</span></a>            <span class="c1"># ========== 5.  IndexHeader ==========</span>
</span><span id="ManifestBuilder-217"><a href="#ManifestBuilder-217"><span class="linenos">217</span></a>            <span class="n">index_header</span> <span class="o">=</span> <span class="n">IndexHeader</span><span class="p">(</span>
</span><span id="ManifestBuilder-218"><a href="#ManifestBuilder-218"><span class="linenos">218</span></a>                <span class="n">dir_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">dirs</span><span class="p">),</span>
</span><span id="ManifestBuilder-219"><a href="#ManifestBuilder-219"><span class="linenos">219</span></a>                <span class="n">name_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">names</span><span class="p">),</span>
</span><span id="ManifestBuilder-220"><a href="#ManifestBuilder-220"><span class="linenos">220</span></a>                <span class="n">ext_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">exts</span><span class="p">),</span>
</span><span id="ManifestBuilder-221"><a href="#ManifestBuilder-221"><span class="linenos">221</span></a>                <span class="n">string_table_size</span><span class="o">=</span><span class="n">string_size</span><span class="p">,</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder-222"><a href="#ManifestBuilder-222"><span class="linenos">222</span></a>                <span class="n">checksum_size</span><span class="o">=</span><span class="n">checksum_size</span>
</span><span id="ManifestBuilder-223"><a href="#ManifestBuilder-223"><span class="linenos">223</span></a>            <span class="p">)</span>
</span><span id="ManifestBuilder-224"><a href="#ManifestBuilder-224"><span class="linenos">224</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">index_start</span><span class="p">)</span>
</span><span id="ManifestBuilder-225"><a href="#ManifestBuilder-225"><span class="linenos">225</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">index_header</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ManifestBuilder-226"><a href="#ManifestBuilder-226"><span class="linenos">226</span></a>            
</span><span id="ManifestBuilder-227"><a href="#ManifestBuilder-227"><span class="linenos">227</span></a>            <span class="c1"># ========== 6.  FileHeader ==========</span>
</span><span id="ManifestBuilder-228"><a href="#ManifestBuilder-228"><span class="linenos">228</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">flags_id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ManifestBuilder-229"><a href="#ManifestBuilder-229"><span class="linenos">229</span></a>            
</span><span id="ManifestBuilder-230"><a href="#ManifestBuilder-230"><span class="linenos">230</span></a>            <span class="n">file_header</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="p">(</span>
</span><span id="ManifestBuilder-231"><a href="#ManifestBuilder-231"><span class="linenos">231</span></a>                <span class="n">magic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_magic</span><span class="p">,</span>
</span><span id="ManifestBuilder-232"><a href="#ManifestBuilder-232"><span class="linenos">232</span></a>                <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="ManifestBuilder-233"><a href="#ManifestBuilder-233"><span class="linenos">233</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">MODE_MANIFEST</span><span class="p">,</span>
</span><span id="ManifestBuilder-234"><a href="#ManifestBuilder-234"><span class="linenos">234</span></a>                <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
</span><span id="ManifestBuilder-235"><a href="#ManifestBuilder-235"><span class="linenos">235</span></a>                <span class="n">checksum_algo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">algo_id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ManifestBuilder-236"><a href="#ManifestBuilder-236"><span class="linenos">236</span></a>                <span class="n">index_offset</span><span class="o">=</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">,</span>
</span><span id="ManifestBuilder-237"><a href="#ManifestBuilder-237"><span class="linenos">237</span></a>                <span class="n">index_size</span><span class="o">=</span><span class="n">index_size</span><span class="p">,</span>
</span><span id="ManifestBuilder-238"><a href="#ManifestBuilder-238"><span class="linenos">238</span></a>                <span class="n">data_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Manifest </span>
</span><span id="ManifestBuilder-239"><a href="#ManifestBuilder-239"><span class="linenos">239</span></a>                <span class="n">entry_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ManifestBuilder-240"><a href="#ManifestBuilder-240"><span class="linenos">240</span></a>            <span class="p">)</span>
</span><span id="ManifestBuilder-241"><a href="#ManifestBuilder-241"><span class="linenos">241</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestBuilder-242"><a href="#ManifestBuilder-242"><span class="linenos">242</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">file_header</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ManifestBuilder-243"><a href="#ManifestBuilder-243"><span class="linenos">243</span></a>    
</span><span id="ManifestBuilder-244"><a href="#ManifestBuilder-244"><span class="linenos">244</span></a>    <span class="nd">@property</span>
</span><span id="ManifestBuilder-245"><a href="#ManifestBuilder-245"><span class="linenos">245</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ManifestBuilder-246"><a href="#ManifestBuilder-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-247"><a href="#ManifestBuilder-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ManifestBuilder-248"><a href="#ManifestBuilder-248"><span class="linenos">248</span></a>    
</span><span id="ManifestBuilder-249"><a href="#ManifestBuilder-249"><span class="linenos">249</span></a>    <span class="nd">@property</span>
</span><span id="ManifestBuilder-250"><a href="#ManifestBuilder-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">path_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ManifestBuilder-251"><a href="#ManifestBuilder-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-252"><a href="#ManifestBuilder-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">stats</span>
</span><span id="ManifestBuilder-253"><a href="#ManifestBuilder-253"><span class="linenos">253</span></a>    
</span><span id="ManifestBuilder-254"><a href="#ManifestBuilder-254"><span class="linenos">254</span></a>    <span class="c1"># ====================  API ====================</span>
</span><span id="ManifestBuilder-255"><a href="#ManifestBuilder-255"><span class="linenos">255</span></a>    
</span><span id="ManifestBuilder-256"><a href="#ManifestBuilder-256"><span class="linenos">256</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_files_batch</span><span class="p">(</span>
</span><span id="ManifestBuilder-257"><a href="#ManifestBuilder-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder-258"><a href="#ManifestBuilder-258"><span class="linenos">258</span></a>        <span class="n">items</span><span class="p">:</span> <span class="s1">&#39;List[FileItem] | Iterator[FileItem]&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder-259"><a href="#ManifestBuilder-259"><span class="linenos">259</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder-260"><a href="#ManifestBuilder-260"><span class="linenos">260</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder-261"><a href="#ManifestBuilder-261"><span class="linenos">261</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder-262"><a href="#ManifestBuilder-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-263"><a href="#ManifestBuilder-263"><span class="linenos">263</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-264"><a href="#ManifestBuilder-264"><span class="linenos">264</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-265"><a href="#ManifestBuilder-265"><span class="linenos">265</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder-266"><a href="#ManifestBuilder-266"><span class="linenos">266</span></a><span class="sd">            items: FileItem </span>
</span><span id="ManifestBuilder-267"><a href="#ManifestBuilder-267"><span class="linenos">267</span></a><span class="sd">            on_error:  (&#39;raise&#39;, &#39;skip&#39;, &#39;abort&#39;)</span>
</span><span id="ManifestBuilder-268"><a href="#ManifestBuilder-268"><span class="linenos">268</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestBuilder-269"><a href="#ManifestBuilder-269"><span class="linenos">269</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder-270"><a href="#ManifestBuilder-270"><span class="linenos">270</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder-271"><a href="#ManifestBuilder-271"><span class="linenos">271</span></a><span class="sd">            BatchResult </span>
</span><span id="ManifestBuilder-272"><a href="#ManifestBuilder-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-273"><a href="#ManifestBuilder-273"><span class="linenos">273</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="ManifestBuilder-274"><a href="#ManifestBuilder-274"><span class="linenos">274</span></a>            <span class="n">FileItem</span><span class="p">,</span> <span class="n">ProgressInfo</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span><span class="p">,</span>
</span><span id="ManifestBuilder-275"><a href="#ManifestBuilder-275"><span class="linenos">275</span></a>            <span class="n">estimate_total_bytes</span>
</span><span id="ManifestBuilder-276"><a href="#ManifestBuilder-276"><span class="linenos">276</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder-277"><a href="#ManifestBuilder-277"><span class="linenos">277</span></a>        
</span><span id="ManifestBuilder-278"><a href="#ManifestBuilder-278"><span class="linenos">278</span></a>        <span class="c1"># </span>
</span><span id="ManifestBuilder-279"><a href="#ManifestBuilder-279"><span class="linenos">279</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ManifestBuilder-280"><a href="#ManifestBuilder-280"><span class="linenos">280</span></a>            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ManifestBuilder-281"><a href="#ManifestBuilder-281"><span class="linenos">281</span></a>        
</span><span id="ManifestBuilder-282"><a href="#ManifestBuilder-282"><span class="linenos">282</span></a>        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ManifestBuilder-283"><a href="#ManifestBuilder-283"><span class="linenos">283</span></a>        <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">estimate_total_bytes</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ManifestBuilder-284"><a href="#ManifestBuilder-284"><span class="linenos">284</span></a>        
</span><span id="ManifestBuilder-285"><a href="#ManifestBuilder-285"><span class="linenos">285</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ManifestBuilder-286"><a href="#ManifestBuilder-286"><span class="linenos">286</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="n">total_files</span><span class="p">,</span>
</span><span id="ManifestBuilder-287"><a href="#ManifestBuilder-287"><span class="linenos">287</span></a>            <span class="n">total_bytes</span><span class="o">=</span><span class="n">total_bytes</span><span class="p">,</span>
</span><span id="ManifestBuilder-288"><a href="#ManifestBuilder-288"><span class="linenos">288</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ManifestBuilder-289"><a href="#ManifestBuilder-289"><span class="linenos">289</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder-290"><a href="#ManifestBuilder-290"><span class="linenos">290</span></a>        
</span><span id="ManifestBuilder-291"><a href="#ManifestBuilder-291"><span class="linenos">291</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ManifestBuilder-292"><a href="#ManifestBuilder-292"><span class="linenos">292</span></a>        
</span><span id="ManifestBuilder-293"><a href="#ManifestBuilder-293"><span class="linenos">293</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="ManifestBuilder-294"><a href="#ManifestBuilder-294"><span class="linenos">294</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ManifestBuilder-295"><a href="#ManifestBuilder-295"><span class="linenos">295</span></a>                <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-296"><a href="#ManifestBuilder-296"><span class="linenos">296</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-297"><a href="#ManifestBuilder-297"><span class="linenos">297</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder-298"><a href="#ManifestBuilder-298"><span class="linenos">298</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">file_size</span>
</span><span id="ManifestBuilder-299"><a href="#ManifestBuilder-299"><span class="linenos">299</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">file_size</span><span class="p">)</span>
</span><span id="ManifestBuilder-300"><a href="#ManifestBuilder-300"><span class="linenos">300</span></a>                
</span><span id="ManifestBuilder-301"><a href="#ManifestBuilder-301"><span class="linenos">301</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ManifestBuilder-302"><a href="#ManifestBuilder-302"><span class="linenos">302</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder-303"><a href="#ManifestBuilder-303"><span class="linenos">303</span></a>                    <span class="k">raise</span>
</span><span id="ManifestBuilder-304"><a href="#ManifestBuilder-304"><span class="linenos">304</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder-305"><a href="#ManifestBuilder-305"><span class="linenos">305</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder-306"><a href="#ManifestBuilder-306"><span class="linenos">306</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestBuilder-307"><a href="#ManifestBuilder-307"><span class="linenos">307</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestBuilder-308"><a href="#ManifestBuilder-308"><span class="linenos">308</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;abort&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder-309"><a href="#ManifestBuilder-309"><span class="linenos">309</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder-310"><a href="#ManifestBuilder-310"><span class="linenos">310</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestBuilder-311"><a href="#ManifestBuilder-311"><span class="linenos">311</span></a>                    <span class="k">break</span>
</span><span id="ManifestBuilder-312"><a href="#ManifestBuilder-312"><span class="linenos">312</span></a>        
</span><span id="ManifestBuilder-313"><a href="#ManifestBuilder-313"><span class="linenos">313</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ManifestBuilder-314"><a href="#ManifestBuilder-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ManifestBuilder-315"><a href="#ManifestBuilder-315"><span class="linenos">315</span></a>    
</span><span id="ManifestBuilder-316"><a href="#ManifestBuilder-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir_batch</span><span class="p">(</span>
</span><span id="ManifestBuilder-317"><a href="#ManifestBuilder-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder-318"><a href="#ManifestBuilder-318"><span class="linenos">318</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestBuilder-319"><a href="#ManifestBuilder-319"><span class="linenos">319</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ManifestBuilder-320"><a href="#ManifestBuilder-320"><span class="linenos">320</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ManifestBuilder-321"><a href="#ManifestBuilder-321"><span class="linenos">321</span></a>        <span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder-322"><a href="#ManifestBuilder-322"><span class="linenos">322</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder-323"><a href="#ManifestBuilder-323"><span class="linenos">323</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder-324"><a href="#ManifestBuilder-324"><span class="linenos">324</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder-325"><a href="#ManifestBuilder-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-326"><a href="#ManifestBuilder-326"><span class="linenos">326</span></a><span class="sd">         ()</span>
</span><span id="ManifestBuilder-327"><a href="#ManifestBuilder-327"><span class="linenos">327</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-328"><a href="#ManifestBuilder-328"><span class="linenos">328</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder-329"><a href="#ManifestBuilder-329"><span class="linenos">329</span></a><span class="sd">            local_dir: </span>
</span><span id="ManifestBuilder-330"><a href="#ManifestBuilder-330"><span class="linenos">330</span></a><span class="sd">            mount_point: </span>
</span><span id="ManifestBuilder-331"><a href="#ManifestBuilder-331"><span class="linenos">331</span></a><span class="sd">            recursive: </span>
</span><span id="ManifestBuilder-332"><a href="#ManifestBuilder-332"><span class="linenos">332</span></a><span class="sd">            exclude_patterns: </span>
</span><span id="ManifestBuilder-333"><a href="#ManifestBuilder-333"><span class="linenos">333</span></a><span class="sd">            on_error: </span>
</span><span id="ManifestBuilder-334"><a href="#ManifestBuilder-334"><span class="linenos">334</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestBuilder-335"><a href="#ManifestBuilder-335"><span class="linenos">335</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder-336"><a href="#ManifestBuilder-336"><span class="linenos">336</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder-337"><a href="#ManifestBuilder-337"><span class="linenos">337</span></a><span class="sd">            BatchResult </span>
</span><span id="ManifestBuilder-338"><a href="#ManifestBuilder-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-339"><a href="#ManifestBuilder-339"><span class="linenos">339</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">scan_directory</span><span class="p">,</span> <span class="n">FileItem</span>
</span><span id="ManifestBuilder-340"><a href="#ManifestBuilder-340"><span class="linenos">340</span></a>        
</span><span id="ManifestBuilder-341"><a href="#ManifestBuilder-341"><span class="linenos">341</span></a>        <span class="c1">#  Manifest  FileItem (algo_id  0)</span>
</span><span id="ManifestBuilder-342"><a href="#ManifestBuilder-342"><span class="linenos">342</span></a>        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_directory</span><span class="p">(</span>
</span><span id="ManifestBuilder-343"><a href="#ManifestBuilder-343"><span class="linenos">343</span></a>            <span class="n">local_dir</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">algo_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">exclude_patterns</span><span class="o">=</span><span class="n">exclude_patterns</span>
</span><span id="ManifestBuilder-344"><a href="#ManifestBuilder-344"><span class="linenos">344</span></a>        <span class="p">))</span>
</span><span id="ManifestBuilder-345"><a href="#ManifestBuilder-345"><span class="linenos">345</span></a>        
</span><span id="ManifestBuilder-346"><a href="#ManifestBuilder-346"><span class="linenos">346</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_files_batch</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">on_error</span><span class="p">,</span> <span class="n">progress_callback</span><span class="p">)</span>
</span><span id="ManifestBuilder-347"><a href="#ManifestBuilder-347"><span class="linenos">347</span></a>    
</span><span id="ManifestBuilder-348"><a href="#ManifestBuilder-348"><span class="linenos">348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir_batch_rclone</span><span class="p">(</span>
</span><span id="ManifestBuilder-349"><a href="#ManifestBuilder-349"><span class="linenos">349</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder-350"><a href="#ManifestBuilder-350"><span class="linenos">350</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestBuilder-351"><a href="#ManifestBuilder-351"><span class="linenos">351</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ManifestBuilder-352"><a href="#ManifestBuilder-352"><span class="linenos">352</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ManifestBuilder-353"><a href="#ManifestBuilder-353"><span class="linenos">353</span></a>        <span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder-354"><a href="#ManifestBuilder-354"><span class="linenos">354</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder-355"><a href="#ManifestBuilder-355"><span class="linenos">355</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder-356"><a href="#ManifestBuilder-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-357"><a href="#ManifestBuilder-357"><span class="linenos">357</span></a><span class="sd">         ( rclone )</span>
</span><span id="ManifestBuilder-358"><a href="#ManifestBuilder-358"><span class="linenos">358</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-359"><a href="#ManifestBuilder-359"><span class="linenos">359</span></a><span class="sd">         checksum_hook  RcloneHashHook</span>
</span><span id="ManifestBuilder-360"><a href="#ManifestBuilder-360"><span class="linenos">360</span></a><span class="sd">         rclone hashsum </span>
</span><span id="ManifestBuilder-361"><a href="#ManifestBuilder-361"><span class="linenos">361</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder-362"><a href="#ManifestBuilder-362"><span class="linenos">362</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder-363"><a href="#ManifestBuilder-363"><span class="linenos">363</span></a><span class="sd">            local_dir: </span>
</span><span id="ManifestBuilder-364"><a href="#ManifestBuilder-364"><span class="linenos">364</span></a><span class="sd">            mount_point: </span>
</span><span id="ManifestBuilder-365"><a href="#ManifestBuilder-365"><span class="linenos">365</span></a><span class="sd">            recursive: </span>
</span><span id="ManifestBuilder-366"><a href="#ManifestBuilder-366"><span class="linenos">366</span></a><span class="sd">            exclude_patterns: </span>
</span><span id="ManifestBuilder-367"><a href="#ManifestBuilder-367"><span class="linenos">367</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestBuilder-368"><a href="#ManifestBuilder-368"><span class="linenos">368</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder-369"><a href="#ManifestBuilder-369"><span class="linenos">369</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder-370"><a href="#ManifestBuilder-370"><span class="linenos">370</span></a><span class="sd">            BatchResult </span>
</span><span id="ManifestBuilder-371"><a href="#ManifestBuilder-371"><span class="linenos">371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder-372"><a href="#ManifestBuilder-372"><span class="linenos">372</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">scan_directory</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span>
</span><span id="ManifestBuilder-373"><a href="#ManifestBuilder-373"><span class="linenos">373</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..hooks.rclone</span><span class="w"> </span><span class="kn">import</span> <span class="n">RcloneHashHook</span>
</span><span id="ManifestBuilder-374"><a href="#ManifestBuilder-374"><span class="linenos">374</span></a>        
</span><span id="ManifestBuilder-375"><a href="#ManifestBuilder-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">,</span> <span class="n">RcloneHashHook</span><span class="p">):</span>
</span><span id="ManifestBuilder-376"><a href="#ManifestBuilder-376"><span class="linenos">376</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="ManifestBuilder-377"><a href="#ManifestBuilder-377"><span class="linenos">377</span></a>                <span class="s2">&quot;add_dir_batch_rclone  checksum_hook  RcloneHashHook&quot;</span>
</span><span id="ManifestBuilder-378"><a href="#ManifestBuilder-378"><span class="linenos">378</span></a>                <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ManifestBuilder-379"><a href="#ManifestBuilder-379"><span class="linenos">379</span></a>            <span class="p">)</span>
</span><span id="ManifestBuilder-380"><a href="#ManifestBuilder-380"><span class="linenos">380</span></a>        
</span><span id="ManifestBuilder-381"><a href="#ManifestBuilder-381"><span class="linenos">381</span></a>        <span class="n">local_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">local_dir</span><span class="p">)</span>
</span><span id="ManifestBuilder-382"><a href="#ManifestBuilder-382"><span class="linenos">382</span></a>        
</span><span id="ManifestBuilder-383"><a href="#ManifestBuilder-383"><span class="linenos">383</span></a>        <span class="c1"># 1.  rclone </span>
</span><span id="ManifestBuilder-384"><a href="#ManifestBuilder-384"><span class="linenos">384</span></a>        <span class="n">hash_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute_dir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
</span><span id="ManifestBuilder-385"><a href="#ManifestBuilder-385"><span class="linenos">385</span></a>        
</span><span id="ManifestBuilder-386"><a href="#ManifestBuilder-386"><span class="linenos">386</span></a>        <span class="c1"># 2. </span>
</span><span id="ManifestBuilder-387"><a href="#ManifestBuilder-387"><span class="linenos">387</span></a>        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_directory</span><span class="p">(</span>
</span><span id="ManifestBuilder-388"><a href="#ManifestBuilder-388"><span class="linenos">388</span></a>            <span class="n">local_dir</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">algo_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">exclude_patterns</span><span class="o">=</span><span class="n">exclude_patterns</span>
</span><span id="ManifestBuilder-389"><a href="#ManifestBuilder-389"><span class="linenos">389</span></a>        <span class="p">))</span>
</span><span id="ManifestBuilder-390"><a href="#ManifestBuilder-390"><span class="linenos">390</span></a>        
</span><span id="ManifestBuilder-391"><a href="#ManifestBuilder-391"><span class="linenos">391</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ManifestBuilder-392"><a href="#ManifestBuilder-392"><span class="linenos">392</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">),</span>
</span><span id="ManifestBuilder-393"><a href="#ManifestBuilder-393"><span class="linenos">393</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ManifestBuilder-394"><a href="#ManifestBuilder-394"><span class="linenos">394</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder-395"><a href="#ManifestBuilder-395"><span class="linenos">395</span></a>        
</span><span id="ManifestBuilder-396"><a href="#ManifestBuilder-396"><span class="linenos">396</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ManifestBuilder-397"><a href="#ManifestBuilder-397"><span class="linenos">397</span></a>        
</span><span id="ManifestBuilder-398"><a href="#ManifestBuilder-398"><span class="linenos">398</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="ManifestBuilder-399"><a href="#ManifestBuilder-399"><span class="linenos">399</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ManifestBuilder-400"><a href="#ManifestBuilder-400"><span class="linenos">400</span></a>                <span class="c1">#  key</span>
</span><span id="ManifestBuilder-401"><a href="#ManifestBuilder-401"><span class="linenos">401</span></a>                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">)</span>
</span><span id="ManifestBuilder-402"><a href="#ManifestBuilder-402"><span class="linenos">402</span></a>                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder-403"><a href="#ManifestBuilder-403"><span class="linenos">403</span></a>                
</span><span id="ManifestBuilder-404"><a href="#ManifestBuilder-404"><span class="linenos">404</span></a>                <span class="n">raw_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-405"><a href="#ManifestBuilder-405"><span class="linenos">405</span></a>                
</span><span id="ManifestBuilder-406"><a href="#ManifestBuilder-406"><span class="linenos">406</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder-407"><a href="#ManifestBuilder-407"><span class="linenos">407</span></a>                <span class="n">checksum</span> <span class="o">=</span> <span class="n">hash_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="ManifestBuilder-408"><a href="#ManifestBuilder-408"><span class="linenos">408</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">checksum</span><span class="p">:</span>
</span><span id="ManifestBuilder-409"><a href="#ManifestBuilder-409"><span class="linenos">409</span></a>                    <span class="c1">#  key </span>
</span><span id="ManifestBuilder-410"><a href="#ManifestBuilder-410"><span class="linenos">410</span></a>                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hash_map</span><span class="p">:</span>
</span><span id="ManifestBuilder-411"><a href="#ManifestBuilder-411"><span class="linenos">411</span></a>                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)):</span>
</span><span id="ManifestBuilder-412"><a href="#ManifestBuilder-412"><span class="linenos">412</span></a>                            <span class="n">checksum</span> <span class="o">=</span> <span class="n">hash_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="ManifestBuilder-413"><a href="#ManifestBuilder-413"><span class="linenos">413</span></a>                            <span class="k">break</span>
</span><span id="ManifestBuilder-414"><a href="#ManifestBuilder-414"><span class="linenos">414</span></a>                
</span><span id="ManifestBuilder-415"><a href="#ManifestBuilder-415"><span class="linenos">415</span></a>                <span class="c1">#  ( add_file )</span>
</span><span id="ManifestBuilder-416"><a href="#ManifestBuilder-416"><span class="linenos">416</span></a>                <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder-417"><a href="#ManifestBuilder-417"><span class="linenos">417</span></a>                <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder-418"><a href="#ManifestBuilder-418"><span class="linenos">418</span></a>                <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder-419"><a href="#ManifestBuilder-419"><span class="linenos">419</span></a>                
</span><span id="ManifestBuilder-420"><a href="#ManifestBuilder-420"><span class="linenos">420</span></a>                <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span>
</span><span id="ManifestBuilder-421"><a href="#ManifestBuilder-421"><span class="linenos">421</span></a>                    <span class="k">continue</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder-422"><a href="#ManifestBuilder-422"><span class="linenos">422</span></a>                
</span><span id="ManifestBuilder-423"><a href="#ManifestBuilder-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ManifestBuilder-424"><a href="#ManifestBuilder-424"><span class="linenos">424</span></a>                <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ManifestBuilder-425"><a href="#ManifestBuilder-425"><span class="linenos">425</span></a>                
</span><span id="ManifestBuilder-426"><a href="#ManifestBuilder-426"><span class="linenos">426</span></a>                <span class="n">entry</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="p">(</span>
</span><span id="ManifestBuilder-427"><a href="#ManifestBuilder-427"><span class="linenos">427</span></a>                    <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ManifestBuilder-428"><a href="#ManifestBuilder-428"><span class="linenos">428</span></a>                    <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ManifestBuilder-429"><a href="#ManifestBuilder-429"><span class="linenos">429</span></a>                    <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ManifestBuilder-430"><a href="#ManifestBuilder-430"><span class="linenos">430</span></a>                    <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ManifestBuilder-431"><a href="#ManifestBuilder-431"><span class="linenos">431</span></a>                    <span class="n">raw_size</span><span class="o">=</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestBuilder-432"><a href="#ManifestBuilder-432"><span class="linenos">432</span></a>                    <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ManifestBuilder-433"><a href="#ManifestBuilder-433"><span class="linenos">433</span></a>                <span class="p">)</span>
</span><span id="ManifestBuilder-434"><a href="#ManifestBuilder-434"><span class="linenos">434</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="ManifestBuilder-435"><a href="#ManifestBuilder-435"><span class="linenos">435</span></a>                
</span><span id="ManifestBuilder-436"><a href="#ManifestBuilder-436"><span class="linenos">436</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder-437"><a href="#ManifestBuilder-437"><span class="linenos">437</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">raw_size</span>
</span><span id="ManifestBuilder-438"><a href="#ManifestBuilder-438"><span class="linenos">438</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">raw_size</span><span class="p">)</span>
</span><span id="ManifestBuilder-439"><a href="#ManifestBuilder-439"><span class="linenos">439</span></a>                
</span><span id="ManifestBuilder-440"><a href="#ManifestBuilder-440"><span class="linenos">440</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ManifestBuilder-441"><a href="#ManifestBuilder-441"><span class="linenos">441</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder-442"><a href="#ManifestBuilder-442"><span class="linenos">442</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestBuilder-443"><a href="#ManifestBuilder-443"><span class="linenos">443</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestBuilder-444"><a href="#ManifestBuilder-444"><span class="linenos">444</span></a>        
</span><span id="ManifestBuilder-445"><a href="#ManifestBuilder-445"><span class="linenos">445</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ManifestBuilder-446"><a href="#ManifestBuilder-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Manifest </p>

<p></p>
</div>


                            <div id="ManifestBuilder.__init__" class="classattr">
                                        <input id="ManifestBuilder.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ManifestBuilder</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">magic</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GRIM&#39;</span>,</span><span class="param">	<span class="n">checksum_hook</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_crypto</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ManifestBuilder.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.__init__-28"><a href="#ManifestBuilder.__init__-28"><span class="linenos">28</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ManifestBuilder.__init__-29"><a href="#ManifestBuilder.__init__-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder.__init__-30"><a href="#ManifestBuilder.__init__-30"><span class="linenos">30</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestBuilder.__init__-31"><a href="#ManifestBuilder.__init__-31"><span class="linenos">31</span></a>        <span class="n">magic</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GRIM&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder.__init__-32"><a href="#ManifestBuilder.__init__-32"><span class="linenos">32</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder.__init__-33"><a href="#ManifestBuilder.__init__-33"><span class="linenos">33</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder.__init__-34"><a href="#ManifestBuilder.__init__-34"><span class="linenos">34</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder.__init__-35"><a href="#ManifestBuilder.__init__-35"><span class="linenos">35</span></a>    <span class="p">):</span>
</span><span id="ManifestBuilder.__init__-36"><a href="#ManifestBuilder.__init__-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.__init__-37"><a href="#ManifestBuilder.__init__-37"><span class="linenos">37</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.__init__-38"><a href="#ManifestBuilder.__init__-38"><span class="linenos">38</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.__init__-39"><a href="#ManifestBuilder.__init__-39"><span class="linenos">39</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder.__init__-40"><a href="#ManifestBuilder.__init__-40"><span class="linenos">40</span></a><span class="sd">            output_path: </span>
</span><span id="ManifestBuilder.__init__-41"><a href="#ManifestBuilder.__init__-41"><span class="linenos">41</span></a><span class="sd">            magic:  (4 bytes)</span>
</span><span id="ManifestBuilder.__init__-42"><a href="#ManifestBuilder.__init__-42"><span class="linenos">42</span></a><span class="sd">            checksum_hook:  ()</span>
</span><span id="ManifestBuilder.__init__-43"><a href="#ManifestBuilder.__init__-43"><span class="linenos">43</span></a><span class="sd">            index_crypto:  ()</span>
</span><span id="ManifestBuilder.__init__-44"><a href="#ManifestBuilder.__init__-44"><span class="linenos">44</span></a><span class="sd">            path_hash_func:  Hash  ()</span>
</span><span id="ManifestBuilder.__init__-45"><a href="#ManifestBuilder.__init__-45"><span class="linenos">45</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.__init__-46"><a href="#ManifestBuilder.__init__-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="ManifestBuilder.__init__-47"><a href="#ManifestBuilder.__init__-47"><span class="linenos">47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_magic</span> <span class="o">=</span> <span class="n">magic</span>
</span><span id="ManifestBuilder.__init__-48"><a href="#ManifestBuilder.__init__-48"><span class="linenos">48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ManifestBuilder.__init__-49"><a href="#ManifestBuilder.__init__-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ManifestBuilder.__init__-50"><a href="#ManifestBuilder.__init__-50"><span class="linenos">50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ManifestBuilder.__init__-51"><a href="#ManifestBuilder.__init__-51"><span class="linenos">51</span></a>        
</span><span id="ManifestBuilder.__init__-52"><a href="#ManifestBuilder.__init__-52"><span class="linenos">52</span></a>        <span class="c1"># </span>
</span><span id="ManifestBuilder.__init__-53"><a href="#ManifestBuilder.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span> <span class="o">=</span> <span class="n">PathDictionary</span><span class="p">()</span>
</span><span id="ManifestBuilder.__init__-54"><a href="#ManifestBuilder.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ManifestEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestBuilder.__init__-55"><a href="#ManifestBuilder.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># </span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    output_path: 
    magic:  (4 bytes)
    checksum_hook:  ()
    index_crypto:  ()
    path_hash_func:  Hash  ()</p>
</div>


                            </div>
                            <div id="ManifestBuilder.add_file" class="classattr">
                                        <input id="ManifestBuilder.add_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ManifestBuilder.add_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.add_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.add_file-57"><a href="#ManifestBuilder.add_file-57"><span class="linenos"> 57</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_file-58"><a href="#ManifestBuilder.add_file-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_file-59"><a href="#ManifestBuilder.add_file-59"><span class="linenos"> 59</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_file-60"><a href="#ManifestBuilder.add_file-60"><span class="linenos"> 60</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_file-61"><a href="#ManifestBuilder.add_file-61"><span class="linenos"> 61</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder.add_file-62"><a href="#ManifestBuilder.add_file-62"><span class="linenos"> 62</span></a><span class="sd">            local_path: </span>
</span><span id="ManifestBuilder.add_file-63"><a href="#ManifestBuilder.add_file-63"><span class="linenos"> 63</span></a><span class="sd">            vfs_path:  ()</span>
</span><span id="ManifestBuilder.add_file-64"><a href="#ManifestBuilder.add_file-64"><span class="linenos"> 64</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder.add_file-65"><a href="#ManifestBuilder.add_file-65"><span class="linenos"> 65</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestBuilder.add_file-66"><a href="#ManifestBuilder.add_file-66"><span class="linenos"> 66</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ManifestBuilder.add_file-67"><a href="#ManifestBuilder.add_file-67"><span class="linenos"> 67</span></a><span class="sd">            HashCollisionError:  Hash </span>
</span><span id="ManifestBuilder.add_file-68"><a href="#ManifestBuilder.add_file-68"><span class="linenos"> 68</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_file-69"><a href="#ManifestBuilder.add_file-69"><span class="linenos"> 69</span></a>        <span class="c1"># 1. </span>
</span><span id="ManifestBuilder.add_file-70"><a href="#ManifestBuilder.add_file-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_file-71"><a href="#ManifestBuilder.add_file-71"><span class="linenos"> 71</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-72"><a href="#ManifestBuilder.add_file-72"><span class="linenos"> 72</span></a>        
</span><span id="ManifestBuilder.add_file-73"><a href="#ManifestBuilder.add_file-73"><span class="linenos"> 73</span></a>        <span class="c1"># 2. </span>
</span><span id="ManifestBuilder.add_file-74"><a href="#ManifestBuilder.add_file-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="n">vfs_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_file-75"><a href="#ManifestBuilder.add_file-75"><span class="linenos"> 75</span></a>            <span class="n">vfs_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-76"><a href="#ManifestBuilder.add_file-76"><span class="linenos"> 76</span></a>        
</span><span id="ManifestBuilder.add_file-77"><a href="#ManifestBuilder.add_file-77"><span class="linenos"> 77</span></a>        <span class="c1"># 3. </span>
</span><span id="ManifestBuilder.add_file-78"><a href="#ManifestBuilder.add_file-78"><span class="linenos"> 78</span></a>        <span class="n">is_absolute</span> <span class="o">=</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-79"><a href="#ManifestBuilder.add_file-79"><span class="linenos"> 79</span></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="n">is_absolute</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-80"><a href="#ManifestBuilder.add_file-80"><span class="linenos"> 80</span></a>        <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-81"><a href="#ManifestBuilder.add_file-81"><span class="linenos"> 81</span></a>        
</span><span id="ManifestBuilder.add_file-82"><a href="#ManifestBuilder.add_file-82"><span class="linenos"> 82</span></a>        <span class="c1"># 4.  path_hash </span>
</span><span id="ManifestBuilder.add_file-83"><a href="#ManifestBuilder.add_file-83"><span class="linenos"> 83</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-84"><a href="#ManifestBuilder.add_file-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_file-85"><a href="#ManifestBuilder.add_file-85"><span class="linenos"> 85</span></a>            <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ManifestBuilder.add_file-86"><a href="#ManifestBuilder.add_file-86"><span class="linenos"> 86</span></a>            <span class="k">if</span> <span class="n">existing</span> <span class="o">!=</span> <span class="n">normalized</span><span class="p">:</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder.add_file-87"><a href="#ManifestBuilder.add_file-87"><span class="linenos"> 87</span></a>                <span class="k">raise</span> <span class="n">HashCollisionError</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">normalized</span><span class="p">,</span> <span class="n">path_hash</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-88"><a href="#ManifestBuilder.add_file-88"><span class="linenos"> 88</span></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder.add_file-89"><a href="#ManifestBuilder.add_file-89"><span class="linenos"> 89</span></a>                <span class="k">return</span>
</span><span id="ManifestBuilder.add_file-90"><a href="#ManifestBuilder.add_file-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ManifestBuilder.add_file-91"><a href="#ManifestBuilder.add_file-91"><span class="linenos"> 91</span></a>        
</span><span id="ManifestBuilder.add_file-92"><a href="#ManifestBuilder.add_file-92"><span class="linenos"> 92</span></a>        <span class="c1"># 5. </span>
</span><span id="ManifestBuilder.add_file-93"><a href="#ManifestBuilder.add_file-93"><span class="linenos"> 93</span></a>        <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-94"><a href="#ManifestBuilder.add_file-94"><span class="linenos"> 94</span></a>        
</span><span id="ManifestBuilder.add_file-95"><a href="#ManifestBuilder.add_file-95"><span class="linenos"> 95</span></a>        <span class="c1"># 6. </span>
</span><span id="ManifestBuilder.add_file-96"><a href="#ManifestBuilder.add_file-96"><span class="linenos"> 96</span></a>        <span class="n">raw_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-97"><a href="#ManifestBuilder.add_file-97"><span class="linenos"> 97</span></a>        
</span><span id="ManifestBuilder.add_file-98"><a href="#ManifestBuilder.add_file-98"><span class="linenos"> 98</span></a>        <span class="n">checksum</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="ManifestBuilder.add_file-99"><a href="#ManifestBuilder.add_file-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_file-100"><a href="#ManifestBuilder.add_file-100"><span class="linenos">100</span></a>            <span class="c1">#  compute_file ( RcloneHashHook) I/O</span>
</span><span id="ManifestBuilder.add_file-101"><a href="#ManifestBuilder.add_file-101"><span class="linenos">101</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">,</span> <span class="s1">&#39;compute_file&#39;</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_file-102"><a href="#ManifestBuilder.add_file-102"><span class="linenos">102</span></a>                <span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_file-103"><a href="#ManifestBuilder.add_file-103"><span class="linenos">103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_file-104"><a href="#ManifestBuilder.add_file-104"><span class="linenos">104</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder.add_file-105"><a href="#ManifestBuilder.add_file-105"><span class="linenos">105</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_file-106"><a href="#ManifestBuilder.add_file-106"><span class="linenos">106</span></a>                    <span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ManifestBuilder.add_file-107"><a href="#ManifestBuilder.add_file-107"><span class="linenos">107</span></a>        
</span><span id="ManifestBuilder.add_file-108"><a href="#ManifestBuilder.add_file-108"><span class="linenos">108</span></a>        <span class="c1"># 7.  Entry</span>
</span><span id="ManifestBuilder.add_file-109"><a href="#ManifestBuilder.add_file-109"><span class="linenos">109</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_file-110"><a href="#ManifestBuilder.add_file-110"><span class="linenos">110</span></a>            <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_file-111"><a href="#ManifestBuilder.add_file-111"><span class="linenos">111</span></a>            <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_file-112"><a href="#ManifestBuilder.add_file-112"><span class="linenos">112</span></a>            <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_file-113"><a href="#ManifestBuilder.add_file-113"><span class="linenos">113</span></a>            <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_file-114"><a href="#ManifestBuilder.add_file-114"><span class="linenos">114</span></a>            <span class="n">raw_size</span><span class="o">=</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_file-115"><a href="#ManifestBuilder.add_file-115"><span class="linenos">115</span></a>            <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ManifestBuilder.add_file-116"><a href="#ManifestBuilder.add_file-116"><span class="linenos">116</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder.add_file-117"><a href="#ManifestBuilder.add_file-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    local_path: 
    vfs_path:  ()</p>

<p>Raises:
    FileNotFoundError: 
    HashCollisionError:  Hash </p>
</div>


                            </div>
                            <div id="ManifestBuilder.add_dir" class="classattr">
                                        <input id="ManifestBuilder.add_dir-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_dir</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ManifestBuilder.add_dir-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.add_dir"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.add_dir-119"><a href="#ManifestBuilder.add_dir-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir-120"><a href="#ManifestBuilder.add_dir-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="ManifestBuilder.add_dir-121"><a href="#ManifestBuilder.add_dir-121"><span class="linenos">121</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="ManifestBuilder.add_dir-122"><a href="#ManifestBuilder.add_dir-122"><span class="linenos">122</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir-123"><a href="#ManifestBuilder.add_dir-123"><span class="linenos">123</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ManifestBuilder.add_dir-124"><a href="#ManifestBuilder.add_dir-124"><span class="linenos">124</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir-125"><a href="#ManifestBuilder.add_dir-125"><span class="linenos">125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_dir-126"><a href="#ManifestBuilder.add_dir-126"><span class="linenos">126</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_dir-127"><a href="#ManifestBuilder.add_dir-127"><span class="linenos">127</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_dir-128"><a href="#ManifestBuilder.add_dir-128"><span class="linenos">128</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder.add_dir-129"><a href="#ManifestBuilder.add_dir-129"><span class="linenos">129</span></a><span class="sd">            local_dir: </span>
</span><span id="ManifestBuilder.add_dir-130"><a href="#ManifestBuilder.add_dir-130"><span class="linenos">130</span></a><span class="sd">            mount_point: </span>
</span><span id="ManifestBuilder.add_dir-131"><a href="#ManifestBuilder.add_dir-131"><span class="linenos">131</span></a><span class="sd">            recursive: </span>
</span><span id="ManifestBuilder.add_dir-132"><a href="#ManifestBuilder.add_dir-132"><span class="linenos">132</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder.add_dir-133"><a href="#ManifestBuilder.add_dir-133"><span class="linenos">133</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder.add_dir-134"><a href="#ManifestBuilder.add_dir-134"><span class="linenos">134</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder.add_dir-135"><a href="#ManifestBuilder.add_dir-135"><span class="linenos">135</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder.add_dir-136"><a href="#ManifestBuilder.add_dir-136"><span class="linenos">136</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestBuilder.add_dir-137"><a href="#ManifestBuilder.add_dir-137"><span class="linenos">137</span></a><span class="sd">            NotADirectoryError: </span>
</span><span id="ManifestBuilder.add_dir-138"><a href="#ManifestBuilder.add_dir-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_dir-139"><a href="#ManifestBuilder.add_dir-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_dir-140"><a href="#ManifestBuilder.add_dir-140"><span class="linenos">140</span></a>            <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-141"><a href="#ManifestBuilder.add_dir-141"><span class="linenos">141</span></a>        
</span><span id="ManifestBuilder.add_dir-142"><a href="#ManifestBuilder.add_dir-142"><span class="linenos">142</span></a>        <span class="n">mount_point</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">mount_point</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-143"><a href="#ManifestBuilder.add_dir-143"><span class="linenos">143</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ManifestBuilder.add_dir-144"><a href="#ManifestBuilder.add_dir-144"><span class="linenos">144</span></a>        
</span><span id="ManifestBuilder.add_dir-145"><a href="#ManifestBuilder.add_dir-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir-146"><a href="#ManifestBuilder.add_dir-146"><span class="linenos">146</span></a>            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_dir-147"><a href="#ManifestBuilder.add_dir-147"><span class="linenos">147</span></a>                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir-148"><a href="#ManifestBuilder.add_dir-148"><span class="linenos">148</span></a>                    <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-149"><a href="#ManifestBuilder.add_dir-149"><span class="linenos">149</span></a>                    <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-150"><a href="#ManifestBuilder.add_dir-150"><span class="linenos">150</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-151"><a href="#ManifestBuilder.add_dir-151"><span class="linenos">151</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-152"><a href="#ManifestBuilder.add_dir-152"><span class="linenos">152</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder.add_dir-153"><a href="#ManifestBuilder.add_dir-153"><span class="linenos">153</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir-154"><a href="#ManifestBuilder.add_dir-154"><span class="linenos">154</span></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_dir-155"><a href="#ManifestBuilder.add_dir-155"><span class="linenos">155</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-156"><a href="#ManifestBuilder.add_dir-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_dir-157"><a href="#ManifestBuilder.add_dir-157"><span class="linenos">157</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
</span><span id="ManifestBuilder.add_dir-158"><a href="#ManifestBuilder.add_dir-158"><span class="linenos">158</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir-159"><a href="#ManifestBuilder.add_dir-159"><span class="linenos">159</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder.add_dir-160"><a href="#ManifestBuilder.add_dir-160"><span class="linenos">160</span></a>        
</span><span id="ManifestBuilder.add_dir-161"><a href="#ManifestBuilder.add_dir-161"><span class="linenos">161</span></a>        <span class="k">return</span> <span class="n">count</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    local_dir: 
    mount_point: 
    recursive: </p>

<p>Returns:
    </p>

<p>Raises:
    NotADirectoryError: </p>
</div>


                            </div>
                            <div id="ManifestBuilder.build" class="classattr">
                                        <input id="ManifestBuilder.build-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ManifestBuilder.build-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.build"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.build-163"><a href="#ManifestBuilder.build-163"><span class="linenos">163</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestBuilder.build-164"><a href="#ManifestBuilder.build-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.build-165"><a href="#ManifestBuilder.build-165"><span class="linenos">165</span></a><span class="sd">         Manifest </span>
</span><span id="ManifestBuilder.build-166"><a href="#ManifestBuilder.build-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.build-167"><a href="#ManifestBuilder.build-167"><span class="linenos">167</span></a><span class="sd">        :</span>
</span><span id="ManifestBuilder.build-168"><a href="#ManifestBuilder.build-168"><span class="linenos">168</span></a><span class="sd">        1.  FileHeader </span>
</span><span id="ManifestBuilder.build-169"><a href="#ManifestBuilder.build-169"><span class="linenos">169</span></a><span class="sd">        2.  IndexHeader</span>
</span><span id="ManifestBuilder.build-170"><a href="#ManifestBuilder.build-170"><span class="linenos">170</span></a><span class="sd">        3.  String Tables ()</span>
</span><span id="ManifestBuilder.build-171"><a href="#ManifestBuilder.build-171"><span class="linenos">171</span></a><span class="sd">        4.  Entry Table</span>
</span><span id="ManifestBuilder.build-172"><a href="#ManifestBuilder.build-172"><span class="linenos">172</span></a><span class="sd">        5.  FileHeader  IndexHeader</span>
</span><span id="ManifestBuilder.build-173"><a href="#ManifestBuilder.build-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.build-174"><a href="#ManifestBuilder.build-174"><span class="linenos">174</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span><span class="p">,</span> <span class="s1">&#39;w+b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestBuilder.build-175"><a href="#ManifestBuilder.build-175"><span class="linenos">175</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">BinaryWriter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-176"><a href="#ManifestBuilder.build-176"><span class="linenos">176</span></a>            
</span><span id="ManifestBuilder.build-177"><a href="#ManifestBuilder.build-177"><span class="linenos">177</span></a>            <span class="c1"># ========== 1.  FileHeader  ==========</span>
</span><span id="ManifestBuilder.build-178"><a href="#ManifestBuilder.build-178"><span class="linenos">178</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-179"><a href="#ManifestBuilder.build-179"><span class="linenos">179</span></a>            
</span><span id="ManifestBuilder.build-180"><a href="#ManifestBuilder.build-180"><span class="linenos">180</span></a>            <span class="c1"># ========== 2.  IndexHeader  ==========</span>
</span><span id="ManifestBuilder.build-181"><a href="#ManifestBuilder.build-181"><span class="linenos">181</span></a>            <span class="n">index_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ManifestBuilder.build-182"><a href="#ManifestBuilder.build-182"><span class="linenos">182</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">IndexHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-183"><a href="#ManifestBuilder.build-183"><span class="linenos">183</span></a>            
</span><span id="ManifestBuilder.build-184"><a href="#ManifestBuilder.build-184"><span class="linenos">184</span></a>            <span class="c1"># ========== 3.  String Tables ==========</span>
</span><span id="ManifestBuilder.build-185"><a href="#ManifestBuilder.build-185"><span class="linenos">185</span></a>            <span class="n">string_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ManifestBuilder.build-186"><a href="#ManifestBuilder.build-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-187"><a href="#ManifestBuilder.build-187"><span class="linenos">187</span></a>            <span class="n">string_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">string_start</span>
</span><span id="ManifestBuilder.build-188"><a href="#ManifestBuilder.build-188"><span class="linenos">188</span></a>            
</span><span id="ManifestBuilder.build-189"><a href="#ManifestBuilder.build-189"><span class="linenos">189</span></a>            <span class="c1"># /</span>
</span><span id="ManifestBuilder.build-190"><a href="#ManifestBuilder.build-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ManifestBuilder.build-191"><a href="#ManifestBuilder.build-191"><span class="linenos">191</span></a>                <span class="c1">#  String Tables </span>
</span><span id="ManifestBuilder.build-192"><a href="#ManifestBuilder.build-192"><span class="linenos">192</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-193"><a href="#ManifestBuilder.build-193"><span class="linenos">193</span></a>                <span class="n">string_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">string_size</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-194"><a href="#ManifestBuilder.build-194"><span class="linenos">194</span></a>                
</span><span id="ManifestBuilder.build-195"><a href="#ManifestBuilder.build-195"><span class="linenos">195</span></a>                <span class="c1"># /</span>
</span><span id="ManifestBuilder.build-196"><a href="#ManifestBuilder.build-196"><span class="linenos">196</span></a>                <span class="n">encrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-197"><a href="#ManifestBuilder.build-197"><span class="linenos">197</span></a>                
</span><span id="ManifestBuilder.build-198"><a href="#ManifestBuilder.build-198"><span class="linenos">198</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder.build-199"><a href="#ManifestBuilder.build-199"><span class="linenos">199</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-200"><a href="#ManifestBuilder.build-200"><span class="linenos">200</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-201"><a href="#ManifestBuilder.build-201"><span class="linenos">201</span></a>                
</span><span id="ManifestBuilder.build-202"><a href="#ManifestBuilder.build-202"><span class="linenos">202</span></a>                <span class="c1">#  string_size </span>
</span><span id="ManifestBuilder.build-203"><a href="#ManifestBuilder.build-203"><span class="linenos">203</span></a>                <span class="n">string_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-204"><a href="#ManifestBuilder.build-204"><span class="linenos">204</span></a>                
</span><span id="ManifestBuilder.build-205"><a href="#ManifestBuilder.build-205"><span class="linenos">205</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder.build-206"><a href="#ManifestBuilder.build-206"><span class="linenos">206</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span> <span class="o">+</span> <span class="n">string_size</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-207"><a href="#ManifestBuilder.build-207"><span class="linenos">207</span></a>            
</span><span id="ManifestBuilder.build-208"><a href="#ManifestBuilder.build-208"><span class="linenos">208</span></a>            <span class="c1"># ========== 4.  Entry Table ==========</span>
</span><span id="ManifestBuilder.build-209"><a href="#ManifestBuilder.build-209"><span class="linenos">209</span></a>            <span class="n">checksum_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">digest_size</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ManifestBuilder.build-210"><a href="#ManifestBuilder.build-210"><span class="linenos">210</span></a>            
</span><span id="ManifestBuilder.build-211"><a href="#ManifestBuilder.build-211"><span class="linenos">211</span></a>            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ManifestBuilder.build-212"><a href="#ManifestBuilder.build-212"><span class="linenos">212</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ManifestBuilder.build-213"><a href="#ManifestBuilder.build-213"><span class="linenos">213</span></a>            
</span><span id="ManifestBuilder.build-214"><a href="#ManifestBuilder.build-214"><span class="linenos">214</span></a>            <span class="n">index_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">index_start</span>
</span><span id="ManifestBuilder.build-215"><a href="#ManifestBuilder.build-215"><span class="linenos">215</span></a>            
</span><span id="ManifestBuilder.build-216"><a href="#ManifestBuilder.build-216"><span class="linenos">216</span></a>            <span class="c1"># ========== 5.  IndexHeader ==========</span>
</span><span id="ManifestBuilder.build-217"><a href="#ManifestBuilder.build-217"><span class="linenos">217</span></a>            <span class="n">index_header</span> <span class="o">=</span> <span class="n">IndexHeader</span><span class="p">(</span>
</span><span id="ManifestBuilder.build-218"><a href="#ManifestBuilder.build-218"><span class="linenos">218</span></a>                <span class="n">dir_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">dirs</span><span class="p">),</span>
</span><span id="ManifestBuilder.build-219"><a href="#ManifestBuilder.build-219"><span class="linenos">219</span></a>                <span class="n">name_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">names</span><span class="p">),</span>
</span><span id="ManifestBuilder.build-220"><a href="#ManifestBuilder.build-220"><span class="linenos">220</span></a>                <span class="n">ext_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">exts</span><span class="p">),</span>
</span><span id="ManifestBuilder.build-221"><a href="#ManifestBuilder.build-221"><span class="linenos">221</span></a>                <span class="n">string_table_size</span><span class="o">=</span><span class="n">string_size</span><span class="p">,</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder.build-222"><a href="#ManifestBuilder.build-222"><span class="linenos">222</span></a>                <span class="n">checksum_size</span><span class="o">=</span><span class="n">checksum_size</span>
</span><span id="ManifestBuilder.build-223"><a href="#ManifestBuilder.build-223"><span class="linenos">223</span></a>            <span class="p">)</span>
</span><span id="ManifestBuilder.build-224"><a href="#ManifestBuilder.build-224"><span class="linenos">224</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">index_start</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-225"><a href="#ManifestBuilder.build-225"><span class="linenos">225</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">index_header</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ManifestBuilder.build-226"><a href="#ManifestBuilder.build-226"><span class="linenos">226</span></a>            
</span><span id="ManifestBuilder.build-227"><a href="#ManifestBuilder.build-227"><span class="linenos">227</span></a>            <span class="c1"># ========== 6.  FileHeader ==========</span>
</span><span id="ManifestBuilder.build-228"><a href="#ManifestBuilder.build-228"><span class="linenos">228</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">flags_id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ManifestBuilder.build-229"><a href="#ManifestBuilder.build-229"><span class="linenos">229</span></a>            
</span><span id="ManifestBuilder.build-230"><a href="#ManifestBuilder.build-230"><span class="linenos">230</span></a>            <span class="n">file_header</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="p">(</span>
</span><span id="ManifestBuilder.build-231"><a href="#ManifestBuilder.build-231"><span class="linenos">231</span></a>                <span class="n">magic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_magic</span><span class="p">,</span>
</span><span id="ManifestBuilder.build-232"><a href="#ManifestBuilder.build-232"><span class="linenos">232</span></a>                <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="ManifestBuilder.build-233"><a href="#ManifestBuilder.build-233"><span class="linenos">233</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">MODE_MANIFEST</span><span class="p">,</span>
</span><span id="ManifestBuilder.build-234"><a href="#ManifestBuilder.build-234"><span class="linenos">234</span></a>                <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
</span><span id="ManifestBuilder.build-235"><a href="#ManifestBuilder.build-235"><span class="linenos">235</span></a>                <span class="n">checksum_algo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">algo_id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ManifestBuilder.build-236"><a href="#ManifestBuilder.build-236"><span class="linenos">236</span></a>                <span class="n">index_offset</span><span class="o">=</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">,</span>
</span><span id="ManifestBuilder.build-237"><a href="#ManifestBuilder.build-237"><span class="linenos">237</span></a>                <span class="n">index_size</span><span class="o">=</span><span class="n">index_size</span><span class="p">,</span>
</span><span id="ManifestBuilder.build-238"><a href="#ManifestBuilder.build-238"><span class="linenos">238</span></a>                <span class="n">data_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Manifest </span>
</span><span id="ManifestBuilder.build-239"><a href="#ManifestBuilder.build-239"><span class="linenos">239</span></a>                <span class="n">entry_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-240"><a href="#ManifestBuilder.build-240"><span class="linenos">240</span></a>            <span class="p">)</span>
</span><span id="ManifestBuilder.build-241"><a href="#ManifestBuilder.build-241"><span class="linenos">241</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestBuilder.build-242"><a href="#ManifestBuilder.build-242"><span class="linenos">242</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">file_header</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p> Manifest </p>

<p>:</p>

<ol>
<li> FileHeader </li>
<li> IndexHeader</li>
<li> String Tables ()</li>
<li> Entry Table</li>
<li> FileHeader  IndexHeader</li>
</ol>
</div>


                            </div>
                            <div id="ManifestBuilder.entry_count" class="classattr">
                                        <input id="ManifestBuilder.entry_count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">entry_count</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ManifestBuilder.entry_count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.entry_count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.entry_count-244"><a href="#ManifestBuilder.entry_count-244"><span class="linenos">244</span></a>    <span class="nd">@property</span>
</span><span id="ManifestBuilder.entry_count-245"><a href="#ManifestBuilder.entry_count-245"><span class="linenos">245</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ManifestBuilder.entry_count-246"><a href="#ManifestBuilder.entry_count-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.entry_count-247"><a href="#ManifestBuilder.entry_count-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ManifestBuilder.path_stats" class="classattr">
                                        <input id="ManifestBuilder.path_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">path_stats</span><span class="annotation">: dict</span>

                <label class="view-source-button" for="ManifestBuilder.path_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.path_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.path_stats-249"><a href="#ManifestBuilder.path_stats-249"><span class="linenos">249</span></a>    <span class="nd">@property</span>
</span><span id="ManifestBuilder.path_stats-250"><a href="#ManifestBuilder.path_stats-250"><span class="linenos">250</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">path_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ManifestBuilder.path_stats-251"><a href="#ManifestBuilder.path_stats-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.path_stats-252"><a href="#ManifestBuilder.path_stats-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ManifestBuilder.add_files_batch" class="classattr">
                                        <input id="ManifestBuilder.add_files_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_files_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">items</span><span class="p">:</span> <span class="s1">&#39;List[FileItem] | Iterator[FileItem]&#39;</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">)],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ManifestBuilder.add_files_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.add_files_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.add_files_batch-256"><a href="#ManifestBuilder.add_files_batch-256"><span class="linenos">256</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_files_batch</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_files_batch-257"><a href="#ManifestBuilder.add_files_batch-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_files_batch-258"><a href="#ManifestBuilder.add_files_batch-258"><span class="linenos">258</span></a>        <span class="n">items</span><span class="p">:</span> <span class="s1">&#39;List[FileItem] | Iterator[FileItem]&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_files_batch-259"><a href="#ManifestBuilder.add_files_batch-259"><span class="linenos">259</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_files_batch-260"><a href="#ManifestBuilder.add_files_batch-260"><span class="linenos">260</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder.add_files_batch-261"><a href="#ManifestBuilder.add_files_batch-261"><span class="linenos">261</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_files_batch-262"><a href="#ManifestBuilder.add_files_batch-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_files_batch-263"><a href="#ManifestBuilder.add_files_batch-263"><span class="linenos">263</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_files_batch-264"><a href="#ManifestBuilder.add_files_batch-264"><span class="linenos">264</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_files_batch-265"><a href="#ManifestBuilder.add_files_batch-265"><span class="linenos">265</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder.add_files_batch-266"><a href="#ManifestBuilder.add_files_batch-266"><span class="linenos">266</span></a><span class="sd">            items: FileItem </span>
</span><span id="ManifestBuilder.add_files_batch-267"><a href="#ManifestBuilder.add_files_batch-267"><span class="linenos">267</span></a><span class="sd">            on_error:  (&#39;raise&#39;, &#39;skip&#39;, &#39;abort&#39;)</span>
</span><span id="ManifestBuilder.add_files_batch-268"><a href="#ManifestBuilder.add_files_batch-268"><span class="linenos">268</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestBuilder.add_files_batch-269"><a href="#ManifestBuilder.add_files_batch-269"><span class="linenos">269</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder.add_files_batch-270"><a href="#ManifestBuilder.add_files_batch-270"><span class="linenos">270</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder.add_files_batch-271"><a href="#ManifestBuilder.add_files_batch-271"><span class="linenos">271</span></a><span class="sd">            BatchResult </span>
</span><span id="ManifestBuilder.add_files_batch-272"><a href="#ManifestBuilder.add_files_batch-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_files_batch-273"><a href="#ManifestBuilder.add_files_batch-273"><span class="linenos">273</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="ManifestBuilder.add_files_batch-274"><a href="#ManifestBuilder.add_files_batch-274"><span class="linenos">274</span></a>            <span class="n">FileItem</span><span class="p">,</span> <span class="n">ProgressInfo</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_files_batch-275"><a href="#ManifestBuilder.add_files_batch-275"><span class="linenos">275</span></a>            <span class="n">estimate_total_bytes</span>
</span><span id="ManifestBuilder.add_files_batch-276"><a href="#ManifestBuilder.add_files_batch-276"><span class="linenos">276</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-277"><a href="#ManifestBuilder.add_files_batch-277"><span class="linenos">277</span></a>        
</span><span id="ManifestBuilder.add_files_batch-278"><a href="#ManifestBuilder.add_files_batch-278"><span class="linenos">278</span></a>        <span class="c1"># </span>
</span><span id="ManifestBuilder.add_files_batch-279"><a href="#ManifestBuilder.add_files_batch-279"><span class="linenos">279</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_files_batch-280"><a href="#ManifestBuilder.add_files_batch-280"><span class="linenos">280</span></a>            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-281"><a href="#ManifestBuilder.add_files_batch-281"><span class="linenos">281</span></a>        
</span><span id="ManifestBuilder.add_files_batch-282"><a href="#ManifestBuilder.add_files_batch-282"><span class="linenos">282</span></a>        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-283"><a href="#ManifestBuilder.add_files_batch-283"><span class="linenos">283</span></a>        <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">estimate_total_bytes</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-284"><a href="#ManifestBuilder.add_files_batch-284"><span class="linenos">284</span></a>        
</span><span id="ManifestBuilder.add_files_batch-285"><a href="#ManifestBuilder.add_files_batch-285"><span class="linenos">285</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_files_batch-286"><a href="#ManifestBuilder.add_files_batch-286"><span class="linenos">286</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="n">total_files</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_files_batch-287"><a href="#ManifestBuilder.add_files_batch-287"><span class="linenos">287</span></a>            <span class="n">total_bytes</span><span class="o">=</span><span class="n">total_bytes</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_files_batch-288"><a href="#ManifestBuilder.add_files_batch-288"><span class="linenos">288</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ManifestBuilder.add_files_batch-289"><a href="#ManifestBuilder.add_files_batch-289"><span class="linenos">289</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-290"><a href="#ManifestBuilder.add_files_batch-290"><span class="linenos">290</span></a>        
</span><span id="ManifestBuilder.add_files_batch-291"><a href="#ManifestBuilder.add_files_batch-291"><span class="linenos">291</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ManifestBuilder.add_files_batch-292"><a href="#ManifestBuilder.add_files_batch-292"><span class="linenos">292</span></a>        
</span><span id="ManifestBuilder.add_files_batch-293"><a href="#ManifestBuilder.add_files_batch-293"><span class="linenos">293</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_files_batch-294"><a href="#ManifestBuilder.add_files_batch-294"><span class="linenos">294</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_files_batch-295"><a href="#ManifestBuilder.add_files_batch-295"><span class="linenos">295</span></a>                <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-296"><a href="#ManifestBuilder.add_files_batch-296"><span class="linenos">296</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-297"><a href="#ManifestBuilder.add_files_batch-297"><span class="linenos">297</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder.add_files_batch-298"><a href="#ManifestBuilder.add_files_batch-298"><span class="linenos">298</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">file_size</span>
</span><span id="ManifestBuilder.add_files_batch-299"><a href="#ManifestBuilder.add_files_batch-299"><span class="linenos">299</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">file_size</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-300"><a href="#ManifestBuilder.add_files_batch-300"><span class="linenos">300</span></a>                
</span><span id="ManifestBuilder.add_files_batch-301"><a href="#ManifestBuilder.add_files_batch-301"><span class="linenos">301</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_files_batch-302"><a href="#ManifestBuilder.add_files_batch-302"><span class="linenos">302</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_files_batch-303"><a href="#ManifestBuilder.add_files_batch-303"><span class="linenos">303</span></a>                    <span class="k">raise</span>
</span><span id="ManifestBuilder.add_files_batch-304"><a href="#ManifestBuilder.add_files_batch-304"><span class="linenos">304</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_files_batch-305"><a href="#ManifestBuilder.add_files_batch-305"><span class="linenos">305</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder.add_files_batch-306"><a href="#ManifestBuilder.add_files_batch-306"><span class="linenos">306</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestBuilder.add_files_batch-307"><a href="#ManifestBuilder.add_files_batch-307"><span class="linenos">307</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_files_batch-308"><a href="#ManifestBuilder.add_files_batch-308"><span class="linenos">308</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;abort&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_files_batch-309"><a href="#ManifestBuilder.add_files_batch-309"><span class="linenos">309</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder.add_files_batch-310"><a href="#ManifestBuilder.add_files_batch-310"><span class="linenos">310</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestBuilder.add_files_batch-311"><a href="#ManifestBuilder.add_files_batch-311"><span class="linenos">311</span></a>                    <span class="k">break</span>
</span><span id="ManifestBuilder.add_files_batch-312"><a href="#ManifestBuilder.add_files_batch-312"><span class="linenos">312</span></a>        
</span><span id="ManifestBuilder.add_files_batch-313"><a href="#ManifestBuilder.add_files_batch-313"><span class="linenos">313</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ManifestBuilder.add_files_batch-314"><a href="#ManifestBuilder.add_files_batch-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    items: FileItem 
    on_error:  ('raise', 'skip', 'abort')
    progress_callback: </p>

<p>Returns:
    BatchResult </p>
</div>


                            </div>
                            <div id="ManifestBuilder.add_dir_batch" class="classattr">
                                        <input id="ManifestBuilder.add_dir_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_dir_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">)],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ManifestBuilder.add_dir_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.add_dir_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.add_dir_batch-316"><a href="#ManifestBuilder.add_dir_batch-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir_batch</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir_batch-317"><a href="#ManifestBuilder.add_dir_batch-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch-318"><a href="#ManifestBuilder.add_dir_batch-318"><span class="linenos">318</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch-319"><a href="#ManifestBuilder.add_dir_batch-319"><span class="linenos">319</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch-320"><a href="#ManifestBuilder.add_dir_batch-320"><span class="linenos">320</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch-321"><a href="#ManifestBuilder.add_dir_batch-321"><span class="linenos">321</span></a>        <span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch-322"><a href="#ManifestBuilder.add_dir_batch-322"><span class="linenos">322</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch-323"><a href="#ManifestBuilder.add_dir_batch-323"><span class="linenos">323</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder.add_dir_batch-324"><a href="#ManifestBuilder.add_dir_batch-324"><span class="linenos">324</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch-325"><a href="#ManifestBuilder.add_dir_batch-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_dir_batch-326"><a href="#ManifestBuilder.add_dir_batch-326"><span class="linenos">326</span></a><span class="sd">         ()</span>
</span><span id="ManifestBuilder.add_dir_batch-327"><a href="#ManifestBuilder.add_dir_batch-327"><span class="linenos">327</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_dir_batch-328"><a href="#ManifestBuilder.add_dir_batch-328"><span class="linenos">328</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder.add_dir_batch-329"><a href="#ManifestBuilder.add_dir_batch-329"><span class="linenos">329</span></a><span class="sd">            local_dir: </span>
</span><span id="ManifestBuilder.add_dir_batch-330"><a href="#ManifestBuilder.add_dir_batch-330"><span class="linenos">330</span></a><span class="sd">            mount_point: </span>
</span><span id="ManifestBuilder.add_dir_batch-331"><a href="#ManifestBuilder.add_dir_batch-331"><span class="linenos">331</span></a><span class="sd">            recursive: </span>
</span><span id="ManifestBuilder.add_dir_batch-332"><a href="#ManifestBuilder.add_dir_batch-332"><span class="linenos">332</span></a><span class="sd">            exclude_patterns: </span>
</span><span id="ManifestBuilder.add_dir_batch-333"><a href="#ManifestBuilder.add_dir_batch-333"><span class="linenos">333</span></a><span class="sd">            on_error: </span>
</span><span id="ManifestBuilder.add_dir_batch-334"><a href="#ManifestBuilder.add_dir_batch-334"><span class="linenos">334</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestBuilder.add_dir_batch-335"><a href="#ManifestBuilder.add_dir_batch-335"><span class="linenos">335</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder.add_dir_batch-336"><a href="#ManifestBuilder.add_dir_batch-336"><span class="linenos">336</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder.add_dir_batch-337"><a href="#ManifestBuilder.add_dir_batch-337"><span class="linenos">337</span></a><span class="sd">            BatchResult </span>
</span><span id="ManifestBuilder.add_dir_batch-338"><a href="#ManifestBuilder.add_dir_batch-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_dir_batch-339"><a href="#ManifestBuilder.add_dir_batch-339"><span class="linenos">339</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">scan_directory</span><span class="p">,</span> <span class="n">FileItem</span>
</span><span id="ManifestBuilder.add_dir_batch-340"><a href="#ManifestBuilder.add_dir_batch-340"><span class="linenos">340</span></a>        
</span><span id="ManifestBuilder.add_dir_batch-341"><a href="#ManifestBuilder.add_dir_batch-341"><span class="linenos">341</span></a>        <span class="c1">#  Manifest  FileItem (algo_id  0)</span>
</span><span id="ManifestBuilder.add_dir_batch-342"><a href="#ManifestBuilder.add_dir_batch-342"><span class="linenos">342</span></a>        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_directory</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir_batch-343"><a href="#ManifestBuilder.add_dir_batch-343"><span class="linenos">343</span></a>            <span class="n">local_dir</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">algo_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">exclude_patterns</span><span class="o">=</span><span class="n">exclude_patterns</span>
</span><span id="ManifestBuilder.add_dir_batch-344"><a href="#ManifestBuilder.add_dir_batch-344"><span class="linenos">344</span></a>        <span class="p">))</span>
</span><span id="ManifestBuilder.add_dir_batch-345"><a href="#ManifestBuilder.add_dir_batch-345"><span class="linenos">345</span></a>        
</span><span id="ManifestBuilder.add_dir_batch-346"><a href="#ManifestBuilder.add_dir_batch-346"><span class="linenos">346</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_files_batch</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">on_error</span><span class="p">,</span> <span class="n">progress_callback</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> ()</p>

<p>Args:
    local_dir: 
    mount_point: 
    recursive: 
    exclude_patterns: 
    on_error: 
    progress_callback: </p>

<p>Returns:
    BatchResult </p>
</div>


                            </div>
                            <div id="ManifestBuilder.add_dir_batch_rclone" class="classattr">
                                        <input id="ManifestBuilder.add_dir_batch_rclone-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_dir_batch_rclone</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">)],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ManifestBuilder.add_dir_batch_rclone-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestBuilder.add_dir_batch_rclone"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestBuilder.add_dir_batch_rclone-348"><a href="#ManifestBuilder.add_dir_batch_rclone-348"><span class="linenos">348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir_batch_rclone</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-349"><a href="#ManifestBuilder.add_dir_batch_rclone-349"><span class="linenos">349</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-350"><a href="#ManifestBuilder.add_dir_batch_rclone-350"><span class="linenos">350</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-351"><a href="#ManifestBuilder.add_dir_batch_rclone-351"><span class="linenos">351</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-352"><a href="#ManifestBuilder.add_dir_batch_rclone-352"><span class="linenos">352</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-353"><a href="#ManifestBuilder.add_dir_batch_rclone-353"><span class="linenos">353</span></a>        <span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-354"><a href="#ManifestBuilder.add_dir_batch_rclone-354"><span class="linenos">354</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-355"><a href="#ManifestBuilder.add_dir_batch_rclone-355"><span class="linenos">355</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-356"><a href="#ManifestBuilder.add_dir_batch_rclone-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-357"><a href="#ManifestBuilder.add_dir_batch_rclone-357"><span class="linenos">357</span></a><span class="sd">         ( rclone )</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-358"><a href="#ManifestBuilder.add_dir_batch_rclone-358"><span class="linenos">358</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-359"><a href="#ManifestBuilder.add_dir_batch_rclone-359"><span class="linenos">359</span></a><span class="sd">         checksum_hook  RcloneHashHook</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-360"><a href="#ManifestBuilder.add_dir_batch_rclone-360"><span class="linenos">360</span></a><span class="sd">         rclone hashsum </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-361"><a href="#ManifestBuilder.add_dir_batch_rclone-361"><span class="linenos">361</span></a><span class="sd">        </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-362"><a href="#ManifestBuilder.add_dir_batch_rclone-362"><span class="linenos">362</span></a><span class="sd">        Args:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-363"><a href="#ManifestBuilder.add_dir_batch_rclone-363"><span class="linenos">363</span></a><span class="sd">            local_dir: </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-364"><a href="#ManifestBuilder.add_dir_batch_rclone-364"><span class="linenos">364</span></a><span class="sd">            mount_point: </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-365"><a href="#ManifestBuilder.add_dir_batch_rclone-365"><span class="linenos">365</span></a><span class="sd">            recursive: </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-366"><a href="#ManifestBuilder.add_dir_batch_rclone-366"><span class="linenos">366</span></a><span class="sd">            exclude_patterns: </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-367"><a href="#ManifestBuilder.add_dir_batch_rclone-367"><span class="linenos">367</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-368"><a href="#ManifestBuilder.add_dir_batch_rclone-368"><span class="linenos">368</span></a><span class="sd">            </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-369"><a href="#ManifestBuilder.add_dir_batch_rclone-369"><span class="linenos">369</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-370"><a href="#ManifestBuilder.add_dir_batch_rclone-370"><span class="linenos">370</span></a><span class="sd">            BatchResult </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-371"><a href="#ManifestBuilder.add_dir_batch_rclone-371"><span class="linenos">371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-372"><a href="#ManifestBuilder.add_dir_batch_rclone-372"><span class="linenos">372</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">scan_directory</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-373"><a href="#ManifestBuilder.add_dir_batch_rclone-373"><span class="linenos">373</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..hooks.rclone</span><span class="w"> </span><span class="kn">import</span> <span class="n">RcloneHashHook</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-374"><a href="#ManifestBuilder.add_dir_batch_rclone-374"><span class="linenos">374</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-375"><a href="#ManifestBuilder.add_dir_batch_rclone-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">,</span> <span class="n">RcloneHashHook</span><span class="p">):</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-376"><a href="#ManifestBuilder.add_dir_batch_rclone-376"><span class="linenos">376</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-377"><a href="#ManifestBuilder.add_dir_batch_rclone-377"><span class="linenos">377</span></a>                <span class="s2">&quot;add_dir_batch_rclone  checksum_hook  RcloneHashHook&quot;</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-378"><a href="#ManifestBuilder.add_dir_batch_rclone-378"><span class="linenos">378</span></a>                <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-379"><a href="#ManifestBuilder.add_dir_batch_rclone-379"><span class="linenos">379</span></a>            <span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-380"><a href="#ManifestBuilder.add_dir_batch_rclone-380"><span class="linenos">380</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-381"><a href="#ManifestBuilder.add_dir_batch_rclone-381"><span class="linenos">381</span></a>        <span class="n">local_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">local_dir</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-382"><a href="#ManifestBuilder.add_dir_batch_rclone-382"><span class="linenos">382</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-383"><a href="#ManifestBuilder.add_dir_batch_rclone-383"><span class="linenos">383</span></a>        <span class="c1"># 1.  rclone </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-384"><a href="#ManifestBuilder.add_dir_batch_rclone-384"><span class="linenos">384</span></a>        <span class="n">hash_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute_dir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-385"><a href="#ManifestBuilder.add_dir_batch_rclone-385"><span class="linenos">385</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-386"><a href="#ManifestBuilder.add_dir_batch_rclone-386"><span class="linenos">386</span></a>        <span class="c1"># 2. </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-387"><a href="#ManifestBuilder.add_dir_batch_rclone-387"><span class="linenos">387</span></a>        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_directory</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-388"><a href="#ManifestBuilder.add_dir_batch_rclone-388"><span class="linenos">388</span></a>            <span class="n">local_dir</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">algo_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">exclude_patterns</span><span class="o">=</span><span class="n">exclude_patterns</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-389"><a href="#ManifestBuilder.add_dir_batch_rclone-389"><span class="linenos">389</span></a>        <span class="p">))</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-390"><a href="#ManifestBuilder.add_dir_batch_rclone-390"><span class="linenos">390</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-391"><a href="#ManifestBuilder.add_dir_batch_rclone-391"><span class="linenos">391</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-392"><a href="#ManifestBuilder.add_dir_batch_rclone-392"><span class="linenos">392</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">),</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-393"><a href="#ManifestBuilder.add_dir_batch_rclone-393"><span class="linenos">393</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-394"><a href="#ManifestBuilder.add_dir_batch_rclone-394"><span class="linenos">394</span></a>        <span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-395"><a href="#ManifestBuilder.add_dir_batch_rclone-395"><span class="linenos">395</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-396"><a href="#ManifestBuilder.add_dir_batch_rclone-396"><span class="linenos">396</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-397"><a href="#ManifestBuilder.add_dir_batch_rclone-397"><span class="linenos">397</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-398"><a href="#ManifestBuilder.add_dir_batch_rclone-398"><span class="linenos">398</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-399"><a href="#ManifestBuilder.add_dir_batch_rclone-399"><span class="linenos">399</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-400"><a href="#ManifestBuilder.add_dir_batch_rclone-400"><span class="linenos">400</span></a>                <span class="c1">#  key</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-401"><a href="#ManifestBuilder.add_dir_batch_rclone-401"><span class="linenos">401</span></a>                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-402"><a href="#ManifestBuilder.add_dir_batch_rclone-402"><span class="linenos">402</span></a>                <span class="n">rel_path</span> <span class="o">=</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-403"><a href="#ManifestBuilder.add_dir_batch_rclone-403"><span class="linenos">403</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-404"><a href="#ManifestBuilder.add_dir_batch_rclone-404"><span class="linenos">404</span></a>                <span class="n">raw_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-405"><a href="#ManifestBuilder.add_dir_batch_rclone-405"><span class="linenos">405</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-406"><a href="#ManifestBuilder.add_dir_batch_rclone-406"><span class="linenos">406</span></a>                <span class="c1"># </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-407"><a href="#ManifestBuilder.add_dir_batch_rclone-407"><span class="linenos">407</span></a>                <span class="n">checksum</span> <span class="o">=</span> <span class="n">hash_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-408"><a href="#ManifestBuilder.add_dir_batch_rclone-408"><span class="linenos">408</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">checksum</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-409"><a href="#ManifestBuilder.add_dir_batch_rclone-409"><span class="linenos">409</span></a>                    <span class="c1">#  key </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-410"><a href="#ManifestBuilder.add_dir_batch_rclone-410"><span class="linenos">410</span></a>                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hash_map</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-411"><a href="#ManifestBuilder.add_dir_batch_rclone-411"><span class="linenos">411</span></a>                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)):</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-412"><a href="#ManifestBuilder.add_dir_batch_rclone-412"><span class="linenos">412</span></a>                            <span class="n">checksum</span> <span class="o">=</span> <span class="n">hash_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-413"><a href="#ManifestBuilder.add_dir_batch_rclone-413"><span class="linenos">413</span></a>                            <span class="k">break</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-414"><a href="#ManifestBuilder.add_dir_batch_rclone-414"><span class="linenos">414</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-415"><a href="#ManifestBuilder.add_dir_batch_rclone-415"><span class="linenos">415</span></a>                <span class="c1">#  ( add_file )</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-416"><a href="#ManifestBuilder.add_dir_batch_rclone-416"><span class="linenos">416</span></a>                <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-417"><a href="#ManifestBuilder.add_dir_batch_rclone-417"><span class="linenos">417</span></a>                <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-418"><a href="#ManifestBuilder.add_dir_batch_rclone-418"><span class="linenos">418</span></a>                <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-419"><a href="#ManifestBuilder.add_dir_batch_rclone-419"><span class="linenos">419</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-420"><a href="#ManifestBuilder.add_dir_batch_rclone-420"><span class="linenos">420</span></a>                <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-421"><a href="#ManifestBuilder.add_dir_batch_rclone-421"><span class="linenos">421</span></a>                    <span class="k">continue</span>  <span class="c1"># </span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-422"><a href="#ManifestBuilder.add_dir_batch_rclone-422"><span class="linenos">422</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-423"><a href="#ManifestBuilder.add_dir_batch_rclone-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-424"><a href="#ManifestBuilder.add_dir_batch_rclone-424"><span class="linenos">424</span></a>                <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-425"><a href="#ManifestBuilder.add_dir_batch_rclone-425"><span class="linenos">425</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-426"><a href="#ManifestBuilder.add_dir_batch_rclone-426"><span class="linenos">426</span></a>                <span class="n">entry</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="p">(</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-427"><a href="#ManifestBuilder.add_dir_batch_rclone-427"><span class="linenos">427</span></a>                    <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-428"><a href="#ManifestBuilder.add_dir_batch_rclone-428"><span class="linenos">428</span></a>                    <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-429"><a href="#ManifestBuilder.add_dir_batch_rclone-429"><span class="linenos">429</span></a>                    <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-430"><a href="#ManifestBuilder.add_dir_batch_rclone-430"><span class="linenos">430</span></a>                    <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-431"><a href="#ManifestBuilder.add_dir_batch_rclone-431"><span class="linenos">431</span></a>                    <span class="n">raw_size</span><span class="o">=</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-432"><a href="#ManifestBuilder.add_dir_batch_rclone-432"><span class="linenos">432</span></a>                    <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-433"><a href="#ManifestBuilder.add_dir_batch_rclone-433"><span class="linenos">433</span></a>                <span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-434"><a href="#ManifestBuilder.add_dir_batch_rclone-434"><span class="linenos">434</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-435"><a href="#ManifestBuilder.add_dir_batch_rclone-435"><span class="linenos">435</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-436"><a href="#ManifestBuilder.add_dir_batch_rclone-436"><span class="linenos">436</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-437"><a href="#ManifestBuilder.add_dir_batch_rclone-437"><span class="linenos">437</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">raw_size</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-438"><a href="#ManifestBuilder.add_dir_batch_rclone-438"><span class="linenos">438</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">raw_size</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-439"><a href="#ManifestBuilder.add_dir_batch_rclone-439"><span class="linenos">439</span></a>                
</span><span id="ManifestBuilder.add_dir_batch_rclone-440"><a href="#ManifestBuilder.add_dir_batch_rclone-440"><span class="linenos">440</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-441"><a href="#ManifestBuilder.add_dir_batch_rclone-441"><span class="linenos">441</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-442"><a href="#ManifestBuilder.add_dir_batch_rclone-442"><span class="linenos">442</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-443"><a href="#ManifestBuilder.add_dir_batch_rclone-443"><span class="linenos">443</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-444"><a href="#ManifestBuilder.add_dir_batch_rclone-444"><span class="linenos">444</span></a>        
</span><span id="ManifestBuilder.add_dir_batch_rclone-445"><a href="#ManifestBuilder.add_dir_batch_rclone-445"><span class="linenos">445</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ManifestBuilder.add_dir_batch_rclone-446"><a href="#ManifestBuilder.add_dir_batch_rclone-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p> ( rclone )</p>

<p> checksum_hook  RcloneHashHook
 rclone hashsum </p>

<p>Args:
    local_dir: 
    mount_point: 
    recursive: 
    exclude_patterns: 
    progress_callback: </p>

<p>Returns:
    BatchResult </p>
</div>


                            </div>
                </section>
                <section id="ManifestReader">
                            <input id="ManifestReader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ManifestReader</span>:

                <label class="view-source-button" for="ManifestReader-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader-26"><a href="#ManifestReader-26"><span class="linenos"> 26</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ManifestReader</span><span class="p">:</span>
</span><span id="ManifestReader-27"><a href="#ManifestReader-27"><span class="linenos"> 27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-28"><a href="#ManifestReader-28"><span class="linenos"> 28</span></a><span class="sd">    Manifest </span>
</span><span id="ManifestReader-29"><a href="#ManifestReader-29"><span class="linenos"> 29</span></a><span class="sd">    </span>
</span><span id="ManifestReader-30"><a href="#ManifestReader-30"><span class="linenos"> 30</span></a><span class="sd">    </span>
</span><span id="ManifestReader-31"><a href="#ManifestReader-31"><span class="linenos"> 31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ManifestReader-32"><a href="#ManifestReader-32"><span class="linenos"> 32</span></a>    
</span><span id="ManifestReader-33"><a href="#ManifestReader-33"><span class="linenos"> 33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ManifestReader-34"><a href="#ManifestReader-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestReader-35"><a href="#ManifestReader-35"><span class="linenos"> 35</span></a>        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestReader-36"><a href="#ManifestReader-36"><span class="linenos"> 36</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestReader-37"><a href="#ManifestReader-37"><span class="linenos"> 37</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestReader-38"><a href="#ManifestReader-38"><span class="linenos"> 38</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader-39"><a href="#ManifestReader-39"><span class="linenos"> 39</span></a>    <span class="p">):</span>
</span><span id="ManifestReader-40"><a href="#ManifestReader-40"><span class="linenos"> 40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-41"><a href="#ManifestReader-41"><span class="linenos"> 41</span></a><span class="sd">        </span>
</span><span id="ManifestReader-42"><a href="#ManifestReader-42"><span class="linenos"> 42</span></a><span class="sd">        </span>
</span><span id="ManifestReader-43"><a href="#ManifestReader-43"><span class="linenos"> 43</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader-44"><a href="#ManifestReader-44"><span class="linenos"> 44</span></a><span class="sd">            file_path: Manifest </span>
</span><span id="ManifestReader-45"><a href="#ManifestReader-45"><span class="linenos"> 45</span></a><span class="sd">            checksum_hook:  ()</span>
</span><span id="ManifestReader-46"><a href="#ManifestReader-46"><span class="linenos"> 46</span></a><span class="sd">            index_crypto:  ()</span>
</span><span id="ManifestReader-47"><a href="#ManifestReader-47"><span class="linenos"> 47</span></a><span class="sd">            path_hash_func:  Hash </span>
</span><span id="ManifestReader-48"><a href="#ManifestReader-48"><span class="linenos"> 48</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-49"><a href="#ManifestReader-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
</span><span id="ManifestReader-50"><a href="#ManifestReader-50"><span class="linenos"> 50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ManifestReader-51"><a href="#ManifestReader-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ManifestReader-52"><a href="#ManifestReader-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ManifestReader-53"><a href="#ManifestReader-53"><span class="linenos"> 53</span></a>        
</span><span id="ManifestReader-54"><a href="#ManifestReader-54"><span class="linenos"> 54</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-55"><a href="#ManifestReader-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="ManifestReader-56"><a href="#ManifestReader-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">BinaryReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
</span><span id="ManifestReader-57"><a href="#ManifestReader-57"><span class="linenos"> 57</span></a>        
</span><span id="ManifestReader-58"><a href="#ManifestReader-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader-59"><a href="#ManifestReader-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader-60"><a href="#ManifestReader-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathDictionary</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader-61"><a href="#ManifestReader-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ManifestEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># path_hash -&gt; Entry</span>
</span><span id="ManifestReader-62"><a href="#ManifestReader-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ManifestReader-63"><a href="#ManifestReader-63"><span class="linenos"> 63</span></a>        
</span><span id="ManifestReader-64"><a href="#ManifestReader-64"><span class="linenos"> 64</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-65"><a href="#ManifestReader-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>
</span><span id="ManifestReader-66"><a href="#ManifestReader-66"><span class="linenos"> 66</span></a>    
</span><span id="ManifestReader-67"><a href="#ManifestReader-67"><span class="linenos"> 67</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestReader-68"><a href="#ManifestReader-68"><span class="linenos"> 68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader-69"><a href="#ManifestReader-69"><span class="linenos"> 69</span></a>        <span class="c1"># ========== 1.  FileHeader ==========</span>
</span><span id="ManifestReader-70"><a href="#ManifestReader-70"><span class="linenos"> 70</span></a>        <span class="n">header_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ManifestReader-71"><a href="#ManifestReader-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">header_data</span><span class="p">)</span>
</span><span id="ManifestReader-72"><a href="#ManifestReader-72"><span class="linenos"> 72</span></a>        
</span><span id="ManifestReader-73"><a href="#ManifestReader-73"><span class="linenos"> 73</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-74"><a href="#ManifestReader-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">magic</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="ManifestReader-75"><a href="#ManifestReader-75"><span class="linenos"> 75</span></a>            <span class="k">raise</span> <span class="n">InvalidFormatError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ManifestReader-76"><a href="#ManifestReader-76"><span class="linenos"> 76</span></a>        
</span><span id="ManifestReader-77"><a href="#ManifestReader-77"><span class="linenos"> 77</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-78"><a href="#ManifestReader-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">MODE_MANIFEST</span><span class="p">:</span>
</span><span id="ManifestReader-79"><a href="#ManifestReader-79"><span class="linenos"> 79</span></a>            <span class="k">raise</span> <span class="n">InvalidFormatError</span><span class="p">(</span>
</span><span id="ManifestReader-80"><a href="#ManifestReader-80"><span class="linenos"> 80</span></a>                <span class="sa">f</span><span class="s2">&quot; Manifest &quot;</span><span class="p">,</span>
</span><span id="ManifestReader-81"><a href="#ManifestReader-81"><span class="linenos"> 81</span></a>                <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;MODE_MANIFEST (0x01)&quot;</span><span class="p">,</span>
</span><span id="ManifestReader-82"><a href="#ManifestReader-82"><span class="linenos"> 82</span></a>                <span class="n">actual</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;0x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">mode</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ManifestReader-83"><a href="#ManifestReader-83"><span class="linenos"> 83</span></a>            <span class="p">)</span>
</span><span id="ManifestReader-84"><a href="#ManifestReader-84"><span class="linenos"> 84</span></a>        
</span><span id="ManifestReader-85"><a href="#ManifestReader-85"><span class="linenos"> 85</span></a>        <span class="c1"># ========== 2.  IndexHeader ==========</span>
</span><span id="ManifestReader-86"><a href="#ManifestReader-86"><span class="linenos"> 86</span></a>        <span class="n">index_header_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">IndexHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ManifestReader-87"><a href="#ManifestReader-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span> <span class="o">=</span> <span class="n">IndexHeader</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">index_header_data</span><span class="p">)</span>
</span><span id="ManifestReader-88"><a href="#ManifestReader-88"><span class="linenos"> 88</span></a>        
</span><span id="ManifestReader-89"><a href="#ManifestReader-89"><span class="linenos"> 89</span></a>        <span class="c1"># ========== 3.  String Tables ==========</span>
</span><span id="ManifestReader-90"><a href="#ManifestReader-90"><span class="linenos"> 90</span></a>        <span class="n">string_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">string_table_size</span><span class="p">)</span>
</span><span id="ManifestReader-91"><a href="#ManifestReader-91"><span class="linenos"> 91</span></a>        
</span><span id="ManifestReader-92"><a href="#ManifestReader-92"><span class="linenos"> 92</span></a>        <span class="c1"># flags  (/)</span>
</span><span id="ManifestReader-93"><a href="#ManifestReader-93"><span class="linenos"> 93</span></a>        <span class="n">needs_processing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">flags</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ManifestReader-94"><a href="#ManifestReader-94"><span class="linenos"> 94</span></a>        
</span><span id="ManifestReader-95"><a href="#ManifestReader-95"><span class="linenos"> 95</span></a>        <span class="k">if</span> <span class="n">needs_processing</span><span class="p">:</span>
</span><span id="ManifestReader-96"><a href="#ManifestReader-96"><span class="linenos"> 96</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ManifestReader-97"><a href="#ManifestReader-97"><span class="linenos"> 97</span></a>                <span class="c1"># /</span>
</span><span id="ManifestReader-98"><a href="#ManifestReader-98"><span class="linenos"> 98</span></a>                <span class="n">string_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ManifestReader-99"><a href="#ManifestReader-99"><span class="linenos"> 99</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ManifestReader-100"><a href="#ManifestReader-100"><span class="linenos">100</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestReader-101"><a href="#ManifestReader-101"><span class="linenos">101</span></a>                <span class="c1"># </span>
</span><span id="ManifestReader-102"><a href="#ManifestReader-102"><span class="linenos">102</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ManifestReader-103"><a href="#ManifestReader-103"><span class="linenos">103</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestReader-104"><a href="#ManifestReader-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ManifestReader-105"><a href="#ManifestReader-105"><span class="linenos">105</span></a>        
</span><span id="ManifestReader-106"><a href="#ManifestReader-106"><span class="linenos">106</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-107"><a href="#ManifestReader-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ManifestReader-108"><a href="#ManifestReader-108"><span class="linenos">108</span></a>            <span class="n">string_reader</span> <span class="o">=</span> <span class="n">BinaryReader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">string_data</span><span class="p">))</span>
</span><span id="ManifestReader-109"><a href="#ManifestReader-109"><span class="linenos">109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span> <span class="o">=</span> <span class="n">PathDictionary</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
</span><span id="ManifestReader-110"><a href="#ManifestReader-110"><span class="linenos">110</span></a>                <span class="n">string_reader</span><span class="p">,</span>
</span><span id="ManifestReader-111"><a href="#ManifestReader-111"><span class="linenos">111</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">dir_count</span><span class="p">,</span>
</span><span id="ManifestReader-112"><a href="#ManifestReader-112"><span class="linenos">112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">name_count</span><span class="p">,</span>
</span><span id="ManifestReader-113"><a href="#ManifestReader-113"><span class="linenos">113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">ext_count</span>
</span><span id="ManifestReader-114"><a href="#ManifestReader-114"><span class="linenos">114</span></a>            <span class="p">)</span>
</span><span id="ManifestReader-115"><a href="#ManifestReader-115"><span class="linenos">115</span></a>        
</span><span id="ManifestReader-116"><a href="#ManifestReader-116"><span class="linenos">116</span></a>        <span class="c1"># ========== 4.  Entry Table ==========</span>
</span><span id="ManifestReader-117"><a href="#ManifestReader-117"><span class="linenos">117</span></a>        <span class="n">checksum_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">checksum_size</span>
</span><span id="ManifestReader-118"><a href="#ManifestReader-118"><span class="linenos">118</span></a>        <span class="n">entry_size</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="o">.</span><span class="n">entry_size</span><span class="p">(</span><span class="n">checksum_size</span><span class="p">)</span>
</span><span id="ManifestReader-119"><a href="#ManifestReader-119"><span class="linenos">119</span></a>        
</span><span id="ManifestReader-120"><a href="#ManifestReader-120"><span class="linenos">120</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">entry_count</span><span class="p">):</span>
</span><span id="ManifestReader-121"><a href="#ManifestReader-121"><span class="linenos">121</span></a>            <span class="n">entry_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">entry_size</span><span class="p">)</span>
</span><span id="ManifestReader-122"><a href="#ManifestReader-122"><span class="linenos">122</span></a>            <span class="n">entry</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">entry_data</span><span class="p">,</span> <span class="n">checksum_size</span><span class="p">)</span>
</span><span id="ManifestReader-123"><a href="#ManifestReader-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
</span><span id="ManifestReader-124"><a href="#ManifestReader-124"><span class="linenos">124</span></a>    
</span><span id="ManifestReader-125"><a href="#ManifestReader-125"><span class="linenos">125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ManifestReader-126"><a href="#ManifestReader-126"><span class="linenos">126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-127"><a href="#ManifestReader-127"><span class="linenos">127</span></a><span class="sd">        </span>
</span><span id="ManifestReader-128"><a href="#ManifestReader-128"><span class="linenos">128</span></a><span class="sd">        </span>
</span><span id="ManifestReader-129"><a href="#ManifestReader-129"><span class="linenos">129</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader-130"><a href="#ManifestReader-130"><span class="linenos">130</span></a><span class="sd">            vfs_path: </span>
</span><span id="ManifestReader-131"><a href="#ManifestReader-131"><span class="linenos">131</span></a><span class="sd">            </span>
</span><span id="ManifestReader-132"><a href="#ManifestReader-132"><span class="linenos">132</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader-133"><a href="#ManifestReader-133"><span class="linenos">133</span></a><span class="sd">            </span>
</span><span id="ManifestReader-134"><a href="#ManifestReader-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-135"><a href="#ManifestReader-135"><span class="linenos">135</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ManifestReader-136"><a href="#ManifestReader-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>
</span><span id="ManifestReader-137"><a href="#ManifestReader-137"><span class="linenos">137</span></a>    
</span><span id="ManifestReader-138"><a href="#ManifestReader-138"><span class="linenos">138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ManifestEntry</span><span class="p">:</span>
</span><span id="ManifestReader-139"><a href="#ManifestReader-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-140"><a href="#ManifestReader-140"><span class="linenos">140</span></a><span class="sd">        </span>
</span><span id="ManifestReader-141"><a href="#ManifestReader-141"><span class="linenos">141</span></a><span class="sd">        </span>
</span><span id="ManifestReader-142"><a href="#ManifestReader-142"><span class="linenos">142</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader-143"><a href="#ManifestReader-143"><span class="linenos">143</span></a><span class="sd">            vfs_path: </span>
</span><span id="ManifestReader-144"><a href="#ManifestReader-144"><span class="linenos">144</span></a><span class="sd">            </span>
</span><span id="ManifestReader-145"><a href="#ManifestReader-145"><span class="linenos">145</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader-146"><a href="#ManifestReader-146"><span class="linenos">146</span></a><span class="sd">            ManifestEntry </span>
</span><span id="ManifestReader-147"><a href="#ManifestReader-147"><span class="linenos">147</span></a><span class="sd">            </span>
</span><span id="ManifestReader-148"><a href="#ManifestReader-148"><span class="linenos">148</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader-149"><a href="#ManifestReader-149"><span class="linenos">149</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ManifestReader-150"><a href="#ManifestReader-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-151"><a href="#ManifestReader-151"><span class="linenos">151</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ManifestReader-152"><a href="#ManifestReader-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ManifestReader-153"><a href="#ManifestReader-153"><span class="linenos">153</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ManifestReader-154"><a href="#ManifestReader-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ManifestReader-155"><a href="#ManifestReader-155"><span class="linenos">155</span></a>    
</span><span id="ManifestReader-156"><a href="#ManifestReader-156"><span class="linenos">156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ManifestReader-157"><a href="#ManifestReader-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-158"><a href="#ManifestReader-158"><span class="linenos">158</span></a><span class="sd">        </span>
</span><span id="ManifestReader-159"><a href="#ManifestReader-159"><span class="linenos">159</span></a><span class="sd">        </span>
</span><span id="ManifestReader-160"><a href="#ManifestReader-160"><span class="linenos">160</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader-161"><a href="#ManifestReader-161"><span class="linenos">161</span></a><span class="sd">            vfs_path: </span>
</span><span id="ManifestReader-162"><a href="#ManifestReader-162"><span class="linenos">162</span></a><span class="sd">            local_path: </span>
</span><span id="ManifestReader-163"><a href="#ManifestReader-163"><span class="linenos">163</span></a><span class="sd">            </span>
</span><span id="ManifestReader-164"><a href="#ManifestReader-164"><span class="linenos">164</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader-165"><a href="#ManifestReader-165"><span class="linenos">165</span></a><span class="sd">            </span>
</span><span id="ManifestReader-166"><a href="#ManifestReader-166"><span class="linenos">166</span></a><span class="sd">            </span>
</span><span id="ManifestReader-167"><a href="#ManifestReader-167"><span class="linenos">167</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader-168"><a href="#ManifestReader-168"><span class="linenos">168</span></a><span class="sd">            FileNotFoundError: vfs_path </span>
</span><span id="ManifestReader-169"><a href="#ManifestReader-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-170"><a href="#ManifestReader-170"><span class="linenos">170</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestReader-171"><a href="#ManifestReader-171"><span class="linenos">171</span></a>        
</span><span id="ManifestReader-172"><a href="#ManifestReader-172"><span class="linenos">172</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-173"><a href="#ManifestReader-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ManifestReader-174"><a href="#ManifestReader-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ManifestReader-175"><a href="#ManifestReader-175"><span class="linenos">175</span></a>        
</span><span id="ManifestReader-176"><a href="#ManifestReader-176"><span class="linenos">176</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-177"><a href="#ManifestReader-177"><span class="linenos">177</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestReader-178"><a href="#ManifestReader-178"><span class="linenos">178</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ManifestReader-179"><a href="#ManifestReader-179"><span class="linenos">179</span></a>        
</span><span id="ManifestReader-180"><a href="#ManifestReader-180"><span class="linenos">180</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader-181"><a href="#ManifestReader-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">:</span>
</span><span id="ManifestReader-182"><a href="#ManifestReader-182"><span class="linenos">182</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ManifestReader-183"><a href="#ManifestReader-183"><span class="linenos">183</span></a>        
</span><span id="ManifestReader-184"><a href="#ManifestReader-184"><span class="linenos">184</span></a>        <span class="c1">#  checksum</span>
</span><span id="ManifestReader-185"><a href="#ManifestReader-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">:</span>
</span><span id="ManifestReader-186"><a href="#ManifestReader-186"><span class="linenos">186</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">)</span>
</span><span id="ManifestReader-187"><a href="#ManifestReader-187"><span class="linenos">187</span></a>        
</span><span id="ManifestReader-188"><a href="#ManifestReader-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="ManifestReader-189"><a href="#ManifestReader-189"><span class="linenos">189</span></a>    
</span><span id="ManifestReader-190"><a href="#ManifestReader-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ManifestReader-191"><a href="#ManifestReader-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-192"><a href="#ManifestReader-192"><span class="linenos">192</span></a><span class="sd">        </span>
</span><span id="ManifestReader-193"><a href="#ManifestReader-193"><span class="linenos">193</span></a><span class="sd">        </span>
</span><span id="ManifestReader-194"><a href="#ManifestReader-194"><span class="linenos">194</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader-195"><a href="#ManifestReader-195"><span class="linenos">195</span></a><span class="sd">            </span>
</span><span id="ManifestReader-196"><a href="#ManifestReader-196"><span class="linenos">196</span></a><span class="sd">            </span>
</span><span id="ManifestReader-197"><a href="#ManifestReader-197"><span class="linenos">197</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader-198"><a href="#ManifestReader-198"><span class="linenos">198</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ManifestReader-199"><a href="#ManifestReader-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-200"><a href="#ManifestReader-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ManifestReader-201"><a href="#ManifestReader-201"><span class="linenos">201</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ManifestReader-202"><a href="#ManifestReader-202"><span class="linenos">202</span></a>        
</span><span id="ManifestReader-203"><a href="#ManifestReader-203"><span class="linenos">203</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestReader-204"><a href="#ManifestReader-204"><span class="linenos">204</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ManifestReader-205"><a href="#ManifestReader-205"><span class="linenos">205</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ManifestReader-206"><a href="#ManifestReader-206"><span class="linenos">206</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ManifestReader-207"><a href="#ManifestReader-207"><span class="linenos">207</span></a>            <span class="p">)</span>
</span><span id="ManifestReader-208"><a href="#ManifestReader-208"><span class="linenos">208</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
</span><span id="ManifestReader-209"><a href="#ManifestReader-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ManifestReader-210"><a href="#ManifestReader-210"><span class="linenos">210</span></a>    
</span><span id="ManifestReader-211"><a href="#ManifestReader-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="ManifestReader-212"><a href="#ManifestReader-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-213"><a href="#ManifestReader-213"><span class="linenos">213</span></a><span class="sd">        </span>
</span><span id="ManifestReader-214"><a href="#ManifestReader-214"><span class="linenos">214</span></a><span class="sd">        </span>
</span><span id="ManifestReader-215"><a href="#ManifestReader-215"><span class="linenos">215</span></a><span class="sd">        </span>
</span><span id="ManifestReader-216"><a href="#ManifestReader-216"><span class="linenos">216</span></a><span class="sd">        </span>
</span><span id="ManifestReader-217"><a href="#ManifestReader-217"><span class="linenos">217</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader-218"><a href="#ManifestReader-218"><span class="linenos">218</span></a><span class="sd">            :</span>
</span><span id="ManifestReader-219"><a href="#ManifestReader-219"><span class="linenos">219</span></a><span class="sd">            - path: </span>
</span><span id="ManifestReader-220"><a href="#ManifestReader-220"><span class="linenos">220</span></a><span class="sd">            - size: </span>
</span><span id="ManifestReader-221"><a href="#ManifestReader-221"><span class="linenos">221</span></a><span class="sd">            - checksum:  (bytes)</span>
</span><span id="ManifestReader-222"><a href="#ManifestReader-222"><span class="linenos">222</span></a><span class="sd">            - checksum_hex:  (hex)</span>
</span><span id="ManifestReader-223"><a href="#ManifestReader-223"><span class="linenos">223</span></a><span class="sd">            </span>
</span><span id="ManifestReader-224"><a href="#ManifestReader-224"><span class="linenos">224</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader-225"><a href="#ManifestReader-225"><span class="linenos">225</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ManifestReader-226"><a href="#ManifestReader-226"><span class="linenos">226</span></a><span class="sd">            </span>
</span><span id="ManifestReader-227"><a href="#ManifestReader-227"><span class="linenos">227</span></a><span class="sd">        Example:</span>
</span><span id="ManifestReader-228"><a href="#ManifestReader-228"><span class="linenos">228</span></a><span class="sd">            &gt;&gt;&gt; for entry in reader.get_all_entries():</span>
</span><span id="ManifestReader-229"><a href="#ManifestReader-229"><span class="linenos">229</span></a><span class="sd">            ...     print(f&quot;{entry[&#39;path&#39;]}: {entry[&#39;size&#39;]} bytes&quot;)</span>
</span><span id="ManifestReader-230"><a href="#ManifestReader-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-231"><a href="#ManifestReader-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ManifestReader-232"><a href="#ManifestReader-232"><span class="linenos">232</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ManifestReader-233"><a href="#ManifestReader-233"><span class="linenos">233</span></a>        
</span><span id="ManifestReader-234"><a href="#ManifestReader-234"><span class="linenos">234</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestReader-235"><a href="#ManifestReader-235"><span class="linenos">235</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ManifestReader-236"><a href="#ManifestReader-236"><span class="linenos">236</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ManifestReader-237"><a href="#ManifestReader-237"><span class="linenos">237</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ManifestReader-238"><a href="#ManifestReader-238"><span class="linenos">238</span></a>            <span class="p">)</span>
</span><span id="ManifestReader-239"><a href="#ManifestReader-239"><span class="linenos">239</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ManifestReader-240"><a href="#ManifestReader-240"><span class="linenos">240</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">full_path</span><span class="p">,</span>
</span><span id="ManifestReader-241"><a href="#ManifestReader-241"><span class="linenos">241</span></a>                <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestReader-242"><a href="#ManifestReader-242"><span class="linenos">242</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span>
</span><span id="ManifestReader-243"><a href="#ManifestReader-243"><span class="linenos">243</span></a>                <span class="s1">&#39;checksum_hex&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="ManifestReader-244"><a href="#ManifestReader-244"><span class="linenos">244</span></a>            <span class="p">})</span>
</span><span id="ManifestReader-245"><a href="#ManifestReader-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ManifestReader-246"><a href="#ManifestReader-246"><span class="linenos">246</span></a>    
</span><span id="ManifestReader-247"><a href="#ManifestReader-247"><span class="linenos">247</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iter_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ManifestReader-248"><a href="#ManifestReader-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-249"><a href="#ManifestReader-249"><span class="linenos">249</span></a><span class="sd">         ()</span>
</span><span id="ManifestReader-250"><a href="#ManifestReader-250"><span class="linenos">250</span></a><span class="sd">        </span>
</span><span id="ManifestReader-251"><a href="#ManifestReader-251"><span class="linenos">251</span></a><span class="sd">        Yields:</span>
</span><span id="ManifestReader-252"><a href="#ManifestReader-252"><span class="linenos">252</span></a><span class="sd">            (path, entry) </span>
</span><span id="ManifestReader-253"><a href="#ManifestReader-253"><span class="linenos">253</span></a><span class="sd">            </span>
</span><span id="ManifestReader-254"><a href="#ManifestReader-254"><span class="linenos">254</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader-255"><a href="#ManifestReader-255"><span class="linenos">255</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ManifestReader-256"><a href="#ManifestReader-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-257"><a href="#ManifestReader-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ManifestReader-258"><a href="#ManifestReader-258"><span class="linenos">258</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ManifestReader-259"><a href="#ManifestReader-259"><span class="linenos">259</span></a>        
</span><span id="ManifestReader-260"><a href="#ManifestReader-260"><span class="linenos">260</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ManifestReader-261"><a href="#ManifestReader-261"><span class="linenos">261</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ManifestReader-262"><a href="#ManifestReader-262"><span class="linenos">262</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ManifestReader-263"><a href="#ManifestReader-263"><span class="linenos">263</span></a>            <span class="p">)</span>
</span><span id="ManifestReader-264"><a href="#ManifestReader-264"><span class="linenos">264</span></a>            <span class="k">yield</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">entry</span>
</span><span id="ManifestReader-265"><a href="#ManifestReader-265"><span class="linenos">265</span></a>    
</span><span id="ManifestReader-266"><a href="#ManifestReader-266"><span class="linenos">266</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ManifestReader-267"><a href="#ManifestReader-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-268"><a href="#ManifestReader-268"><span class="linenos">268</span></a><span class="sd">         Hash</span>
</span><span id="ManifestReader-269"><a href="#ManifestReader-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="ManifestReader-270"><a href="#ManifestReader-270"><span class="linenos">270</span></a><span class="sd">        </span>
</span><span id="ManifestReader-271"><a href="#ManifestReader-271"><span class="linenos">271</span></a><span class="sd">        </span>
</span><span id="ManifestReader-272"><a href="#ManifestReader-272"><span class="linenos">272</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader-273"><a href="#ManifestReader-273"><span class="linenos">273</span></a><span class="sd">             path_hash </span>
</span><span id="ManifestReader-274"><a href="#ManifestReader-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-275"><a href="#ManifestReader-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ManifestReader-276"><a href="#ManifestReader-276"><span class="linenos">276</span></a>    
</span><span id="ManifestReader-277"><a href="#ManifestReader-277"><span class="linenos">277</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry_by_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_hash</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ManifestEntry</span><span class="p">]:</span>
</span><span id="ManifestReader-278"><a href="#ManifestReader-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader-279"><a href="#ManifestReader-279"><span class="linenos">279</span></a><span class="sd">         Hash </span>
</span><span id="ManifestReader-280"><a href="#ManifestReader-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="ManifestReader-281"><a href="#ManifestReader-281"><span class="linenos">281</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader-282"><a href="#ManifestReader-282"><span class="linenos">282</span></a><span class="sd">            path_hash:  Hash </span>
</span><span id="ManifestReader-283"><a href="#ManifestReader-283"><span class="linenos">283</span></a><span class="sd">            </span>
</span><span id="ManifestReader-284"><a href="#ManifestReader-284"><span class="linenos">284</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader-285"><a href="#ManifestReader-285"><span class="linenos">285</span></a><span class="sd">            ManifestEntry  None</span>
</span><span id="ManifestReader-286"><a href="#ManifestReader-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader-287"><a href="#ManifestReader-287"><span class="linenos">287</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path_hash</span><span class="p">)</span>
</span><span id="ManifestReader-288"><a href="#ManifestReader-288"><span class="linenos">288</span></a>    
</span><span id="ManifestReader-289"><a href="#ManifestReader-289"><span class="linenos">289</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader-290"><a href="#ManifestReader-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileHeader</span><span class="p">:</span>
</span><span id="ManifestReader-291"><a href="#ManifestReader-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader-292"><a href="#ManifestReader-292"><span class="linenos">292</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span>
</span><span id="ManifestReader-293"><a href="#ManifestReader-293"><span class="linenos">293</span></a>    
</span><span id="ManifestReader-294"><a href="#ManifestReader-294"><span class="linenos">294</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader-295"><a href="#ManifestReader-295"><span class="linenos">295</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">index_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndexHeader</span><span class="p">:</span>
</span><span id="ManifestReader-296"><a href="#ManifestReader-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader-297"><a href="#ManifestReader-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span>
</span><span id="ManifestReader-298"><a href="#ManifestReader-298"><span class="linenos">298</span></a>    
</span><span id="ManifestReader-299"><a href="#ManifestReader-299"><span class="linenos">299</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader-300"><a href="#ManifestReader-300"><span class="linenos">300</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ManifestReader-301"><a href="#ManifestReader-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader-302"><a href="#ManifestReader-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ManifestReader-303"><a href="#ManifestReader-303"><span class="linenos">303</span></a>    
</span><span id="ManifestReader-304"><a href="#ManifestReader-304"><span class="linenos">304</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader-305"><a href="#ManifestReader-305"><span class="linenos">305</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_decrypted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ManifestReader-306"><a href="#ManifestReader-306"><span class="linenos">306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader-307"><a href="#ManifestReader-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span>
</span><span id="ManifestReader-308"><a href="#ManifestReader-308"><span class="linenos">308</span></a>    
</span><span id="ManifestReader-309"><a href="#ManifestReader-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestReader-310"><a href="#ManifestReader-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader-311"><a href="#ManifestReader-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span>
</span><span id="ManifestReader-312"><a href="#ManifestReader-312"><span class="linenos">312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ManifestReader-313"><a href="#ManifestReader-313"><span class="linenos">313</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader-314"><a href="#ManifestReader-314"><span class="linenos">314</span></a>    
</span><span id="ManifestReader-315"><a href="#ManifestReader-315"><span class="linenos">315</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ManifestReader&#39;</span><span class="p">:</span>
</span><span id="ManifestReader-316"><a href="#ManifestReader-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="ManifestReader-317"><a href="#ManifestReader-317"><span class="linenos">317</span></a>    
</span><span id="ManifestReader-318"><a href="#ManifestReader-318"><span class="linenos">318</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestReader-319"><a href="#ManifestReader-319"><span class="linenos">319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Manifest </p>

<p></p>
</div>


                            <div id="ManifestReader.__init__" class="classattr">
                                        <input id="ManifestReader.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ManifestReader</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">checksum_hook</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_crypto</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ManifestReader.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.__init__-33"><a href="#ManifestReader.__init__-33"><span class="linenos">33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ManifestReader.__init__-34"><a href="#ManifestReader.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ManifestReader.__init__-35"><a href="#ManifestReader.__init__-35"><span class="linenos">35</span></a>        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestReader.__init__-36"><a href="#ManifestReader.__init__-36"><span class="linenos">36</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestReader.__init__-37"><a href="#ManifestReader.__init__-37"><span class="linenos">37</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestReader.__init__-38"><a href="#ManifestReader.__init__-38"><span class="linenos">38</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader.__init__-39"><a href="#ManifestReader.__init__-39"><span class="linenos">39</span></a>    <span class="p">):</span>
</span><span id="ManifestReader.__init__-40"><a href="#ManifestReader.__init__-40"><span class="linenos">40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.__init__-41"><a href="#ManifestReader.__init__-41"><span class="linenos">41</span></a><span class="sd">        </span>
</span><span id="ManifestReader.__init__-42"><a href="#ManifestReader.__init__-42"><span class="linenos">42</span></a><span class="sd">        </span>
</span><span id="ManifestReader.__init__-43"><a href="#ManifestReader.__init__-43"><span class="linenos">43</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader.__init__-44"><a href="#ManifestReader.__init__-44"><span class="linenos">44</span></a><span class="sd">            file_path: Manifest </span>
</span><span id="ManifestReader.__init__-45"><a href="#ManifestReader.__init__-45"><span class="linenos">45</span></a><span class="sd">            checksum_hook:  ()</span>
</span><span id="ManifestReader.__init__-46"><a href="#ManifestReader.__init__-46"><span class="linenos">46</span></a><span class="sd">            index_crypto:  ()</span>
</span><span id="ManifestReader.__init__-47"><a href="#ManifestReader.__init__-47"><span class="linenos">47</span></a><span class="sd">            path_hash_func:  Hash </span>
</span><span id="ManifestReader.__init__-48"><a href="#ManifestReader.__init__-48"><span class="linenos">48</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.__init__-49"><a href="#ManifestReader.__init__-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
</span><span id="ManifestReader.__init__-50"><a href="#ManifestReader.__init__-50"><span class="linenos">50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ManifestReader.__init__-51"><a href="#ManifestReader.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ManifestReader.__init__-52"><a href="#ManifestReader.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ManifestReader.__init__-53"><a href="#ManifestReader.__init__-53"><span class="linenos">53</span></a>        
</span><span id="ManifestReader.__init__-54"><a href="#ManifestReader.__init__-54"><span class="linenos">54</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader.__init__-55"><a href="#ManifestReader.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="ManifestReader.__init__-56"><a href="#ManifestReader.__init__-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">BinaryReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
</span><span id="ManifestReader.__init__-57"><a href="#ManifestReader.__init__-57"><span class="linenos">57</span></a>        
</span><span id="ManifestReader.__init__-58"><a href="#ManifestReader.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader.__init__-59"><a href="#ManifestReader.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader.__init__-60"><a href="#ManifestReader.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathDictionary</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestReader.__init__-61"><a href="#ManifestReader.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ManifestEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># path_hash -&gt; Entry</span>
</span><span id="ManifestReader.__init__-62"><a href="#ManifestReader.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ManifestReader.__init__-63"><a href="#ManifestReader.__init__-63"><span class="linenos">63</span></a>        
</span><span id="ManifestReader.__init__-64"><a href="#ManifestReader.__init__-64"><span class="linenos">64</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader.__init__-65"><a href="#ManifestReader.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    file_path: Manifest 
    checksum_hook:  ()
    index_crypto:  ()
    path_hash_func:  Hash </p>
</div>


                            </div>
                            <div id="ManifestReader.exists" class="classattr">
                                        <input id="ManifestReader.exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.exists-125"><a href="#ManifestReader.exists-125"><span class="linenos">125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ManifestReader.exists-126"><a href="#ManifestReader.exists-126"><span class="linenos">126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.exists-127"><a href="#ManifestReader.exists-127"><span class="linenos">127</span></a><span class="sd">        </span>
</span><span id="ManifestReader.exists-128"><a href="#ManifestReader.exists-128"><span class="linenos">128</span></a><span class="sd">        </span>
</span><span id="ManifestReader.exists-129"><a href="#ManifestReader.exists-129"><span class="linenos">129</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader.exists-130"><a href="#ManifestReader.exists-130"><span class="linenos">130</span></a><span class="sd">            vfs_path: </span>
</span><span id="ManifestReader.exists-131"><a href="#ManifestReader.exists-131"><span class="linenos">131</span></a><span class="sd">            </span>
</span><span id="ManifestReader.exists-132"><a href="#ManifestReader.exists-132"><span class="linenos">132</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader.exists-133"><a href="#ManifestReader.exists-133"><span class="linenos">133</span></a><span class="sd">            </span>
</span><span id="ManifestReader.exists-134"><a href="#ManifestReader.exists-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.exists-135"><a href="#ManifestReader.exists-135"><span class="linenos">135</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ManifestReader.exists-136"><a href="#ManifestReader.exists-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    vfs_path: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="ManifestReader.get_entry" class="classattr">
                                        <input id="ManifestReader.get_entry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_entry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">grimoire</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">ManifestEntry</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.get_entry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.get_entry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.get_entry-138"><a href="#ManifestReader.get_entry-138"><span class="linenos">138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ManifestEntry</span><span class="p">:</span>
</span><span id="ManifestReader.get_entry-139"><a href="#ManifestReader.get_entry-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.get_entry-140"><a href="#ManifestReader.get_entry-140"><span class="linenos">140</span></a><span class="sd">        </span>
</span><span id="ManifestReader.get_entry-141"><a href="#ManifestReader.get_entry-141"><span class="linenos">141</span></a><span class="sd">        </span>
</span><span id="ManifestReader.get_entry-142"><a href="#ManifestReader.get_entry-142"><span class="linenos">142</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader.get_entry-143"><a href="#ManifestReader.get_entry-143"><span class="linenos">143</span></a><span class="sd">            vfs_path: </span>
</span><span id="ManifestReader.get_entry-144"><a href="#ManifestReader.get_entry-144"><span class="linenos">144</span></a><span class="sd">            </span>
</span><span id="ManifestReader.get_entry-145"><a href="#ManifestReader.get_entry-145"><span class="linenos">145</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader.get_entry-146"><a href="#ManifestReader.get_entry-146"><span class="linenos">146</span></a><span class="sd">            ManifestEntry </span>
</span><span id="ManifestReader.get_entry-147"><a href="#ManifestReader.get_entry-147"><span class="linenos">147</span></a><span class="sd">            </span>
</span><span id="ManifestReader.get_entry-148"><a href="#ManifestReader.get_entry-148"><span class="linenos">148</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader.get_entry-149"><a href="#ManifestReader.get_entry-149"><span class="linenos">149</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ManifestReader.get_entry-150"><a href="#ManifestReader.get_entry-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.get_entry-151"><a href="#ManifestReader.get_entry-151"><span class="linenos">151</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ManifestReader.get_entry-152"><a href="#ManifestReader.get_entry-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ManifestReader.get_entry-153"><a href="#ManifestReader.get_entry-153"><span class="linenos">153</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ManifestReader.get_entry-154"><a href="#ManifestReader.get_entry-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    vfs_path: </p>

<p>Returns:
    ManifestEntry </p>

<p>Raises:
    FileNotFoundError: </p>
</div>


                            </div>
                            <div id="ManifestReader.verify_file" class="classattr">
                                        <input id="ManifestReader.verify_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">verify_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.verify_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.verify_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.verify_file-156"><a href="#ManifestReader.verify_file-156"><span class="linenos">156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ManifestReader.verify_file-157"><a href="#ManifestReader.verify_file-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.verify_file-158"><a href="#ManifestReader.verify_file-158"><span class="linenos">158</span></a><span class="sd">        </span>
</span><span id="ManifestReader.verify_file-159"><a href="#ManifestReader.verify_file-159"><span class="linenos">159</span></a><span class="sd">        </span>
</span><span id="ManifestReader.verify_file-160"><a href="#ManifestReader.verify_file-160"><span class="linenos">160</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader.verify_file-161"><a href="#ManifestReader.verify_file-161"><span class="linenos">161</span></a><span class="sd">            vfs_path: </span>
</span><span id="ManifestReader.verify_file-162"><a href="#ManifestReader.verify_file-162"><span class="linenos">162</span></a><span class="sd">            local_path: </span>
</span><span id="ManifestReader.verify_file-163"><a href="#ManifestReader.verify_file-163"><span class="linenos">163</span></a><span class="sd">            </span>
</span><span id="ManifestReader.verify_file-164"><a href="#ManifestReader.verify_file-164"><span class="linenos">164</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader.verify_file-165"><a href="#ManifestReader.verify_file-165"><span class="linenos">165</span></a><span class="sd">            </span>
</span><span id="ManifestReader.verify_file-166"><a href="#ManifestReader.verify_file-166"><span class="linenos">166</span></a><span class="sd">            </span>
</span><span id="ManifestReader.verify_file-167"><a href="#ManifestReader.verify_file-167"><span class="linenos">167</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader.verify_file-168"><a href="#ManifestReader.verify_file-168"><span class="linenos">168</span></a><span class="sd">            FileNotFoundError: vfs_path </span>
</span><span id="ManifestReader.verify_file-169"><a href="#ManifestReader.verify_file-169"><span class="linenos">169</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.verify_file-170"><a href="#ManifestReader.verify_file-170"><span class="linenos">170</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestReader.verify_file-171"><a href="#ManifestReader.verify_file-171"><span class="linenos">171</span></a>        
</span><span id="ManifestReader.verify_file-172"><a href="#ManifestReader.verify_file-172"><span class="linenos">172</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader.verify_file-173"><a href="#ManifestReader.verify_file-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ManifestReader.verify_file-174"><a href="#ManifestReader.verify_file-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ManifestReader.verify_file-175"><a href="#ManifestReader.verify_file-175"><span class="linenos">175</span></a>        
</span><span id="ManifestReader.verify_file-176"><a href="#ManifestReader.verify_file-176"><span class="linenos">176</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader.verify_file-177"><a href="#ManifestReader.verify_file-177"><span class="linenos">177</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestReader.verify_file-178"><a href="#ManifestReader.verify_file-178"><span class="linenos">178</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ManifestReader.verify_file-179"><a href="#ManifestReader.verify_file-179"><span class="linenos">179</span></a>        
</span><span id="ManifestReader.verify_file-180"><a href="#ManifestReader.verify_file-180"><span class="linenos">180</span></a>        <span class="c1"># </span>
</span><span id="ManifestReader.verify_file-181"><a href="#ManifestReader.verify_file-181"><span class="linenos">181</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">:</span>
</span><span id="ManifestReader.verify_file-182"><a href="#ManifestReader.verify_file-182"><span class="linenos">182</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ManifestReader.verify_file-183"><a href="#ManifestReader.verify_file-183"><span class="linenos">183</span></a>        
</span><span id="ManifestReader.verify_file-184"><a href="#ManifestReader.verify_file-184"><span class="linenos">184</span></a>        <span class="c1">#  checksum</span>
</span><span id="ManifestReader.verify_file-185"><a href="#ManifestReader.verify_file-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">:</span>
</span><span id="ManifestReader.verify_file-186"><a href="#ManifestReader.verify_file-186"><span class="linenos">186</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">)</span>
</span><span id="ManifestReader.verify_file-187"><a href="#ManifestReader.verify_file-187"><span class="linenos">187</span></a>        
</span><span id="ManifestReader.verify_file-188"><a href="#ManifestReader.verify_file-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    vfs_path: 
    local_path: </p>

<p>Returns:
    </p>

<p>Raises:
    FileNotFoundError: vfs_path </p>
</div>


                            </div>
                            <div id="ManifestReader.list_all" class="classattr">
                                        <input id="ManifestReader.list_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_all</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.list_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.list_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.list_all-190"><a href="#ManifestReader.list_all-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ManifestReader.list_all-191"><a href="#ManifestReader.list_all-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.list_all-192"><a href="#ManifestReader.list_all-192"><span class="linenos">192</span></a><span class="sd">        </span>
</span><span id="ManifestReader.list_all-193"><a href="#ManifestReader.list_all-193"><span class="linenos">193</span></a><span class="sd">        </span>
</span><span id="ManifestReader.list_all-194"><a href="#ManifestReader.list_all-194"><span class="linenos">194</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader.list_all-195"><a href="#ManifestReader.list_all-195"><span class="linenos">195</span></a><span class="sd">            </span>
</span><span id="ManifestReader.list_all-196"><a href="#ManifestReader.list_all-196"><span class="linenos">196</span></a><span class="sd">            </span>
</span><span id="ManifestReader.list_all-197"><a href="#ManifestReader.list_all-197"><span class="linenos">197</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader.list_all-198"><a href="#ManifestReader.list_all-198"><span class="linenos">198</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ManifestReader.list_all-199"><a href="#ManifestReader.list_all-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.list_all-200"><a href="#ManifestReader.list_all-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ManifestReader.list_all-201"><a href="#ManifestReader.list_all-201"><span class="linenos">201</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ManifestReader.list_all-202"><a href="#ManifestReader.list_all-202"><span class="linenos">202</span></a>        
</span><span id="ManifestReader.list_all-203"><a href="#ManifestReader.list_all-203"><span class="linenos">203</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestReader.list_all-204"><a href="#ManifestReader.list_all-204"><span class="linenos">204</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ManifestReader.list_all-205"><a href="#ManifestReader.list_all-205"><span class="linenos">205</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ManifestReader.list_all-206"><a href="#ManifestReader.list_all-206"><span class="linenos">206</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ManifestReader.list_all-207"><a href="#ManifestReader.list_all-207"><span class="linenos">207</span></a>            <span class="p">)</span>
</span><span id="ManifestReader.list_all-208"><a href="#ManifestReader.list_all-208"><span class="linenos">208</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
</span><span id="ManifestReader.list_all-209"><a href="#ManifestReader.list_all-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
    </p>

<p>Raises:
    IndexNotDecryptedError: </p>
</div>


                            </div>
                            <div id="ManifestReader.get_all_entries" class="classattr">
                                        <input id="ManifestReader.get_all_entries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_entries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.get_all_entries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.get_all_entries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.get_all_entries-211"><a href="#ManifestReader.get_all_entries-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="ManifestReader.get_all_entries-212"><a href="#ManifestReader.get_all_entries-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.get_all_entries-213"><a href="#ManifestReader.get_all_entries-213"><span class="linenos">213</span></a><span class="sd">        </span>
</span><span id="ManifestReader.get_all_entries-214"><a href="#ManifestReader.get_all_entries-214"><span class="linenos">214</span></a><span class="sd">        </span>
</span><span id="ManifestReader.get_all_entries-215"><a href="#ManifestReader.get_all_entries-215"><span class="linenos">215</span></a><span class="sd">        </span>
</span><span id="ManifestReader.get_all_entries-216"><a href="#ManifestReader.get_all_entries-216"><span class="linenos">216</span></a><span class="sd">        </span>
</span><span id="ManifestReader.get_all_entries-217"><a href="#ManifestReader.get_all_entries-217"><span class="linenos">217</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader.get_all_entries-218"><a href="#ManifestReader.get_all_entries-218"><span class="linenos">218</span></a><span class="sd">            :</span>
</span><span id="ManifestReader.get_all_entries-219"><a href="#ManifestReader.get_all_entries-219"><span class="linenos">219</span></a><span class="sd">            - path: </span>
</span><span id="ManifestReader.get_all_entries-220"><a href="#ManifestReader.get_all_entries-220"><span class="linenos">220</span></a><span class="sd">            - size: </span>
</span><span id="ManifestReader.get_all_entries-221"><a href="#ManifestReader.get_all_entries-221"><span class="linenos">221</span></a><span class="sd">            - checksum:  (bytes)</span>
</span><span id="ManifestReader.get_all_entries-222"><a href="#ManifestReader.get_all_entries-222"><span class="linenos">222</span></a><span class="sd">            - checksum_hex:  (hex)</span>
</span><span id="ManifestReader.get_all_entries-223"><a href="#ManifestReader.get_all_entries-223"><span class="linenos">223</span></a><span class="sd">            </span>
</span><span id="ManifestReader.get_all_entries-224"><a href="#ManifestReader.get_all_entries-224"><span class="linenos">224</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader.get_all_entries-225"><a href="#ManifestReader.get_all_entries-225"><span class="linenos">225</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ManifestReader.get_all_entries-226"><a href="#ManifestReader.get_all_entries-226"><span class="linenos">226</span></a><span class="sd">            </span>
</span><span id="ManifestReader.get_all_entries-227"><a href="#ManifestReader.get_all_entries-227"><span class="linenos">227</span></a><span class="sd">        Example:</span>
</span><span id="ManifestReader.get_all_entries-228"><a href="#ManifestReader.get_all_entries-228"><span class="linenos">228</span></a><span class="sd">            &gt;&gt;&gt; for entry in reader.get_all_entries():</span>
</span><span id="ManifestReader.get_all_entries-229"><a href="#ManifestReader.get_all_entries-229"><span class="linenos">229</span></a><span class="sd">            ...     print(f&quot;{entry[&#39;path&#39;]}: {entry[&#39;size&#39;]} bytes&quot;)</span>
</span><span id="ManifestReader.get_all_entries-230"><a href="#ManifestReader.get_all_entries-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.get_all_entries-231"><a href="#ManifestReader.get_all_entries-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ManifestReader.get_all_entries-232"><a href="#ManifestReader.get_all_entries-232"><span class="linenos">232</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ManifestReader.get_all_entries-233"><a href="#ManifestReader.get_all_entries-233"><span class="linenos">233</span></a>        
</span><span id="ManifestReader.get_all_entries-234"><a href="#ManifestReader.get_all_entries-234"><span class="linenos">234</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestReader.get_all_entries-235"><a href="#ManifestReader.get_all_entries-235"><span class="linenos">235</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ManifestReader.get_all_entries-236"><a href="#ManifestReader.get_all_entries-236"><span class="linenos">236</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ManifestReader.get_all_entries-237"><a href="#ManifestReader.get_all_entries-237"><span class="linenos">237</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ManifestReader.get_all_entries-238"><a href="#ManifestReader.get_all_entries-238"><span class="linenos">238</span></a>            <span class="p">)</span>
</span><span id="ManifestReader.get_all_entries-239"><a href="#ManifestReader.get_all_entries-239"><span class="linenos">239</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ManifestReader.get_all_entries-240"><a href="#ManifestReader.get_all_entries-240"><span class="linenos">240</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">full_path</span><span class="p">,</span>
</span><span id="ManifestReader.get_all_entries-241"><a href="#ManifestReader.get_all_entries-241"><span class="linenos">241</span></a>                <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestReader.get_all_entries-242"><a href="#ManifestReader.get_all_entries-242"><span class="linenos">242</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span>
</span><span id="ManifestReader.get_all_entries-243"><a href="#ManifestReader.get_all_entries-243"><span class="linenos">243</span></a>                <span class="s1">&#39;checksum_hex&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="ManifestReader.get_all_entries-244"><a href="#ManifestReader.get_all_entries-244"><span class="linenos">244</span></a>            <span class="p">})</span>
</span><span id="ManifestReader.get_all_entries-245"><a href="#ManifestReader.get_all_entries-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>

<p>Returns:
    :
    - path: 
    - size: 
    - checksum:  (bytes)
    - checksum_hex:  (hex)</p>

<p>Raises:
    IndexNotDecryptedError: </p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>for entry in reader.get_all_entries():
          ...     print(f"{entry['path']}: {entry['size']} bytes")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="ManifestReader.iter_entries" class="classattr">
                                        <input id="ManifestReader.iter_entries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">iter_entries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ManifestReader.iter_entries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.iter_entries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.iter_entries-247"><a href="#ManifestReader.iter_entries-247"><span class="linenos">247</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iter_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ManifestReader.iter_entries-248"><a href="#ManifestReader.iter_entries-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.iter_entries-249"><a href="#ManifestReader.iter_entries-249"><span class="linenos">249</span></a><span class="sd">         ()</span>
</span><span id="ManifestReader.iter_entries-250"><a href="#ManifestReader.iter_entries-250"><span class="linenos">250</span></a><span class="sd">        </span>
</span><span id="ManifestReader.iter_entries-251"><a href="#ManifestReader.iter_entries-251"><span class="linenos">251</span></a><span class="sd">        Yields:</span>
</span><span id="ManifestReader.iter_entries-252"><a href="#ManifestReader.iter_entries-252"><span class="linenos">252</span></a><span class="sd">            (path, entry) </span>
</span><span id="ManifestReader.iter_entries-253"><a href="#ManifestReader.iter_entries-253"><span class="linenos">253</span></a><span class="sd">            </span>
</span><span id="ManifestReader.iter_entries-254"><a href="#ManifestReader.iter_entries-254"><span class="linenos">254</span></a><span class="sd">        Raises:</span>
</span><span id="ManifestReader.iter_entries-255"><a href="#ManifestReader.iter_entries-255"><span class="linenos">255</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ManifestReader.iter_entries-256"><a href="#ManifestReader.iter_entries-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.iter_entries-257"><a href="#ManifestReader.iter_entries-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ManifestReader.iter_entries-258"><a href="#ManifestReader.iter_entries-258"><span class="linenos">258</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ManifestReader.iter_entries-259"><a href="#ManifestReader.iter_entries-259"><span class="linenos">259</span></a>        
</span><span id="ManifestReader.iter_entries-260"><a href="#ManifestReader.iter_entries-260"><span class="linenos">260</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ManifestReader.iter_entries-261"><a href="#ManifestReader.iter_entries-261"><span class="linenos">261</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ManifestReader.iter_entries-262"><a href="#ManifestReader.iter_entries-262"><span class="linenos">262</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ManifestReader.iter_entries-263"><a href="#ManifestReader.iter_entries-263"><span class="linenos">263</span></a>            <span class="p">)</span>
</span><span id="ManifestReader.iter_entries-264"><a href="#ManifestReader.iter_entries-264"><span class="linenos">264</span></a>            <span class="k">yield</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">entry</span>
</span></pre></div>


            <div class="docstring"><p> ()</p>

<p>Yields:
    (path, entry) </p>

<p>Raises:
    IndexNotDecryptedError: </p>
</div>


                            </div>
                            <div id="ManifestReader.list_hashes" class="classattr">
                                        <input id="ManifestReader.list_hashes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_hashes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.list_hashes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.list_hashes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.list_hashes-266"><a href="#ManifestReader.list_hashes-266"><span class="linenos">266</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ManifestReader.list_hashes-267"><a href="#ManifestReader.list_hashes-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.list_hashes-268"><a href="#ManifestReader.list_hashes-268"><span class="linenos">268</span></a><span class="sd">         Hash</span>
</span><span id="ManifestReader.list_hashes-269"><a href="#ManifestReader.list_hashes-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="ManifestReader.list_hashes-270"><a href="#ManifestReader.list_hashes-270"><span class="linenos">270</span></a><span class="sd">        </span>
</span><span id="ManifestReader.list_hashes-271"><a href="#ManifestReader.list_hashes-271"><span class="linenos">271</span></a><span class="sd">        </span>
</span><span id="ManifestReader.list_hashes-272"><a href="#ManifestReader.list_hashes-272"><span class="linenos">272</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader.list_hashes-273"><a href="#ManifestReader.list_hashes-273"><span class="linenos">273</span></a><span class="sd">             path_hash </span>
</span><span id="ManifestReader.list_hashes-274"><a href="#ManifestReader.list_hashes-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.list_hashes-275"><a href="#ManifestReader.list_hashes-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p> Hash</p>

<p></p>

<p>Returns:
     path_hash </p>
</div>


                            </div>
                            <div id="ManifestReader.get_entry_by_hash" class="classattr">
                                        <input id="ManifestReader.get_entry_by_hash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_entry_by_hash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path_hash</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">grimoire</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">ManifestEntry</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.get_entry_by_hash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.get_entry_by_hash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.get_entry_by_hash-277"><a href="#ManifestReader.get_entry_by_hash-277"><span class="linenos">277</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry_by_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_hash</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ManifestEntry</span><span class="p">]:</span>
</span><span id="ManifestReader.get_entry_by_hash-278"><a href="#ManifestReader.get_entry_by_hash-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestReader.get_entry_by_hash-279"><a href="#ManifestReader.get_entry_by_hash-279"><span class="linenos">279</span></a><span class="sd">         Hash </span>
</span><span id="ManifestReader.get_entry_by_hash-280"><a href="#ManifestReader.get_entry_by_hash-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="ManifestReader.get_entry_by_hash-281"><a href="#ManifestReader.get_entry_by_hash-281"><span class="linenos">281</span></a><span class="sd">        Args:</span>
</span><span id="ManifestReader.get_entry_by_hash-282"><a href="#ManifestReader.get_entry_by_hash-282"><span class="linenos">282</span></a><span class="sd">            path_hash:  Hash </span>
</span><span id="ManifestReader.get_entry_by_hash-283"><a href="#ManifestReader.get_entry_by_hash-283"><span class="linenos">283</span></a><span class="sd">            </span>
</span><span id="ManifestReader.get_entry_by_hash-284"><a href="#ManifestReader.get_entry_by_hash-284"><span class="linenos">284</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestReader.get_entry_by_hash-285"><a href="#ManifestReader.get_entry_by_hash-285"><span class="linenos">285</span></a><span class="sd">            ManifestEntry  None</span>
</span><span id="ManifestReader.get_entry_by_hash-286"><a href="#ManifestReader.get_entry_by_hash-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestReader.get_entry_by_hash-287"><a href="#ManifestReader.get_entry_by_hash-287"><span class="linenos">287</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path_hash</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> Hash </p>

<p>Args:
    path_hash:  Hash </p>

<p>Returns:
    ManifestEntry  None</p>
</div>


                            </div>
                            <div id="ManifestReader.file_header" class="classattr">
                                        <input id="ManifestReader.file_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">file_header</span><span class="annotation">: grimoire.core.schema.FileHeader</span>

                <label class="view-source-button" for="ManifestReader.file_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.file_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.file_header-289"><a href="#ManifestReader.file_header-289"><span class="linenos">289</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader.file_header-290"><a href="#ManifestReader.file_header-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileHeader</span><span class="p">:</span>
</span><span id="ManifestReader.file_header-291"><a href="#ManifestReader.file_header-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader.file_header-292"><a href="#ManifestReader.file_header-292"><span class="linenos">292</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ManifestReader.index_header" class="classattr">
                                        <input id="ManifestReader.index_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">index_header</span><span class="annotation">: grimoire.core.schema.IndexHeader</span>

                <label class="view-source-button" for="ManifestReader.index_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.index_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.index_header-294"><a href="#ManifestReader.index_header-294"><span class="linenos">294</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader.index_header-295"><a href="#ManifestReader.index_header-295"><span class="linenos">295</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">index_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndexHeader</span><span class="p">:</span>
</span><span id="ManifestReader.index_header-296"><a href="#ManifestReader.index_header-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader.index_header-297"><a href="#ManifestReader.index_header-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ManifestReader.entry_count" class="classattr">
                                        <input id="ManifestReader.entry_count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">entry_count</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ManifestReader.entry_count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.entry_count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.entry_count-299"><a href="#ManifestReader.entry_count-299"><span class="linenos">299</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader.entry_count-300"><a href="#ManifestReader.entry_count-300"><span class="linenos">300</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ManifestReader.entry_count-301"><a href="#ManifestReader.entry_count-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader.entry_count-302"><a href="#ManifestReader.entry_count-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ManifestReader.is_decrypted" class="classattr">
                                        <input id="ManifestReader.is_decrypted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">is_decrypted</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="ManifestReader.is_decrypted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.is_decrypted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.is_decrypted-304"><a href="#ManifestReader.is_decrypted-304"><span class="linenos">304</span></a>    <span class="nd">@property</span>
</span><span id="ManifestReader.is_decrypted-305"><a href="#ManifestReader.is_decrypted-305"><span class="linenos">305</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_decrypted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ManifestReader.is_decrypted-306"><a href="#ManifestReader.is_decrypted-306"><span class="linenos">306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader.is_decrypted-307"><a href="#ManifestReader.is_decrypted-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ManifestReader.close" class="classattr">
                                        <input id="ManifestReader.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ManifestReader.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestReader.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestReader.close-309"><a href="#ManifestReader.close-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestReader.close-310"><a href="#ManifestReader.close-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ManifestReader.close-311"><a href="#ManifestReader.close-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span>
</span><span id="ManifestReader.close-312"><a href="#ManifestReader.close-312"><span class="linenos">312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ManifestReader.close-313"><a href="#ManifestReader.close-313"><span class="linenos">313</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                </section>
                <section id="ArchiveBuilder">
                            <input id="ArchiveBuilder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ArchiveBuilder</span>:

                <label class="view-source-button" for="ArchiveBuilder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder-24"><a href="#ArchiveBuilder-24"><span class="linenos"> 24</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ArchiveBuilder</span><span class="p">:</span>
</span><span id="ArchiveBuilder-25"><a href="#ArchiveBuilder-25"><span class="linenos"> 25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-26"><a href="#ArchiveBuilder-26"><span class="linenos"> 26</span></a><span class="sd">    Archive </span>
</span><span id="ArchiveBuilder-27"><a href="#ArchiveBuilder-27"><span class="linenos"> 27</span></a><span class="sd">    </span>
</span><span id="ArchiveBuilder-28"><a href="#ArchiveBuilder-28"><span class="linenos"> 28</span></a><span class="sd">    </span>
</span><span id="ArchiveBuilder-29"><a href="#ArchiveBuilder-29"><span class="linenos"> 29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-30"><a href="#ArchiveBuilder-30"><span class="linenos"> 30</span></a>    
</span><span id="ArchiveBuilder-31"><a href="#ArchiveBuilder-31"><span class="linenos"> 31</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArchiveBuilder-32"><a href="#ArchiveBuilder-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder-33"><a href="#ArchiveBuilder-33"><span class="linenos"> 33</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder-34"><a href="#ArchiveBuilder-34"><span class="linenos"> 34</span></a>        <span class="n">magic</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GRIM&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder-35"><a href="#ArchiveBuilder-35"><span class="linenos"> 35</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder-36"><a href="#ArchiveBuilder-36"><span class="linenos"> 36</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder-37"><a href="#ArchiveBuilder-37"><span class="linenos"> 37</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder-38"><a href="#ArchiveBuilder-38"><span class="linenos"> 38</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveBuilder-39"><a href="#ArchiveBuilder-39"><span class="linenos"> 39</span></a>    <span class="p">):</span>
</span><span id="ArchiveBuilder-40"><a href="#ArchiveBuilder-40"><span class="linenos"> 40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-41"><a href="#ArchiveBuilder-41"><span class="linenos"> 41</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-42"><a href="#ArchiveBuilder-42"><span class="linenos"> 42</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-43"><a href="#ArchiveBuilder-43"><span class="linenos"> 43</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder-44"><a href="#ArchiveBuilder-44"><span class="linenos"> 44</span></a><span class="sd">            output_path: </span>
</span><span id="ArchiveBuilder-45"><a href="#ArchiveBuilder-45"><span class="linenos"> 45</span></a><span class="sd">            magic:  (4 bytes)</span>
</span><span id="ArchiveBuilder-46"><a href="#ArchiveBuilder-46"><span class="linenos"> 46</span></a><span class="sd">            compression_hooks: </span>
</span><span id="ArchiveBuilder-47"><a href="#ArchiveBuilder-47"><span class="linenos"> 47</span></a><span class="sd">            checksum_hook:  ()</span>
</span><span id="ArchiveBuilder-48"><a href="#ArchiveBuilder-48"><span class="linenos"> 48</span></a><span class="sd">            index_crypto:  ()</span>
</span><span id="ArchiveBuilder-49"><a href="#ArchiveBuilder-49"><span class="linenos"> 49</span></a><span class="sd">            path_hash_func:  Hash  ()</span>
</span><span id="ArchiveBuilder-50"><a href="#ArchiveBuilder-50"><span class="linenos"> 50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-51"><a href="#ArchiveBuilder-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="ArchiveBuilder-52"><a href="#ArchiveBuilder-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_magic</span> <span class="o">=</span> <span class="n">magic</span>
</span><span id="ArchiveBuilder-53"><a href="#ArchiveBuilder-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ArchiveBuilder-54"><a href="#ArchiveBuilder-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ArchiveBuilder-55"><a href="#ArchiveBuilder-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ArchiveBuilder-56"><a href="#ArchiveBuilder-56"><span class="linenos"> 56</span></a>        
</span><span id="ArchiveBuilder-57"><a href="#ArchiveBuilder-57"><span class="linenos"> 57</span></a>        <span class="c1"># </span>
</span><span id="ArchiveBuilder-58"><a href="#ArchiveBuilder-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">CompressionHook</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ArchiveBuilder-59"><a href="#ArchiveBuilder-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveBuilder-60"><a href="#ArchiveBuilder-60"><span class="linenos"> 60</span></a>            <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveBuilder-61"><a href="#ArchiveBuilder-61"><span class="linenos"> 61</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">hook</span><span class="o">.</span><span class="n">algo_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">hook</span>
</span><span id="ArchiveBuilder-62"><a href="#ArchiveBuilder-62"><span class="linenos"> 62</span></a>        
</span><span id="ArchiveBuilder-63"><a href="#ArchiveBuilder-63"><span class="linenos"> 63</span></a>        <span class="c1"># </span>
</span><span id="ArchiveBuilder-64"><a href="#ArchiveBuilder-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span> <span class="o">=</span> <span class="n">PathDictionary</span><span class="p">()</span>
</span><span id="ArchiveBuilder-65"><a href="#ArchiveBuilder-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ArchiveEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArchiveBuilder-66"><a href="#ArchiveBuilder-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># </span>
</span><span id="ArchiveBuilder-67"><a href="#ArchiveBuilder-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># </span>
</span><span id="ArchiveBuilder-68"><a href="#ArchiveBuilder-68"><span class="linenos"> 68</span></a>    
</span><span id="ArchiveBuilder-69"><a href="#ArchiveBuilder-69"><span class="linenos"> 69</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_file</span><span class="p">(</span>
</span><span id="ArchiveBuilder-70"><a href="#ArchiveBuilder-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder-71"><a href="#ArchiveBuilder-71"><span class="linenos"> 71</span></a>        <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder-72"><a href="#ArchiveBuilder-72"><span class="linenos"> 72</span></a>        <span class="n">vfs_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder-73"><a href="#ArchiveBuilder-73"><span class="linenos"> 73</span></a>        <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder-74"><a href="#ArchiveBuilder-74"><span class="linenos"> 74</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveBuilder-75"><a href="#ArchiveBuilder-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-76"><a href="#ArchiveBuilder-76"><span class="linenos"> 76</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-77"><a href="#ArchiveBuilder-77"><span class="linenos"> 77</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-78"><a href="#ArchiveBuilder-78"><span class="linenos"> 78</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder-79"><a href="#ArchiveBuilder-79"><span class="linenos"> 79</span></a><span class="sd">            local_path: </span>
</span><span id="ArchiveBuilder-80"><a href="#ArchiveBuilder-80"><span class="linenos"> 80</span></a><span class="sd">            vfs_path:  ()</span>
</span><span id="ArchiveBuilder-81"><a href="#ArchiveBuilder-81"><span class="linenos"> 81</span></a><span class="sd">            algo_id:  ID (0=)</span>
</span><span id="ArchiveBuilder-82"><a href="#ArchiveBuilder-82"><span class="linenos"> 82</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder-83"><a href="#ArchiveBuilder-83"><span class="linenos"> 83</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveBuilder-84"><a href="#ArchiveBuilder-84"><span class="linenos"> 84</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ArchiveBuilder-85"><a href="#ArchiveBuilder-85"><span class="linenos"> 85</span></a><span class="sd">            HashCollisionError:  Hash </span>
</span><span id="ArchiveBuilder-86"><a href="#ArchiveBuilder-86"><span class="linenos"> 86</span></a><span class="sd">            UnknownAlgorithmError: </span>
</span><span id="ArchiveBuilder-87"><a href="#ArchiveBuilder-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-88"><a href="#ArchiveBuilder-88"><span class="linenos"> 88</span></a>        <span class="c1"># 1. </span>
</span><span id="ArchiveBuilder-89"><a href="#ArchiveBuilder-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ArchiveBuilder-90"><a href="#ArchiveBuilder-90"><span class="linenos"> 90</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder-91"><a href="#ArchiveBuilder-91"><span class="linenos"> 91</span></a>        
</span><span id="ArchiveBuilder-92"><a href="#ArchiveBuilder-92"><span class="linenos"> 92</span></a>        <span class="c1"># 2. </span>
</span><span id="ArchiveBuilder-93"><a href="#ArchiveBuilder-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="n">algo_id</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">algo_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveBuilder-94"><a href="#ArchiveBuilder-94"><span class="linenos"> 94</span></a>            <span class="k">raise</span> <span class="n">UnknownAlgorithmError</span><span class="p">(</span><span class="n">algo_id</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder-95"><a href="#ArchiveBuilder-95"><span class="linenos"> 95</span></a>        
</span><span id="ArchiveBuilder-96"><a href="#ArchiveBuilder-96"><span class="linenos"> 96</span></a>        <span class="c1"># 3. </span>
</span><span id="ArchiveBuilder-97"><a href="#ArchiveBuilder-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="n">vfs_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveBuilder-98"><a href="#ArchiveBuilder-98"><span class="linenos"> 98</span></a>            <span class="n">vfs_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ArchiveBuilder-99"><a href="#ArchiveBuilder-99"><span class="linenos"> 99</span></a>        
</span><span id="ArchiveBuilder-100"><a href="#ArchiveBuilder-100"><span class="linenos">100</span></a>        <span class="c1"># 4. </span>
</span><span id="ArchiveBuilder-101"><a href="#ArchiveBuilder-101"><span class="linenos">101</span></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ArchiveBuilder-102"><a href="#ArchiveBuilder-102"><span class="linenos">102</span></a>        <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ArchiveBuilder-103"><a href="#ArchiveBuilder-103"><span class="linenos">103</span></a>        
</span><span id="ArchiveBuilder-104"><a href="#ArchiveBuilder-104"><span class="linenos">104</span></a>        <span class="c1"># 5.  path_hash </span>
</span><span id="ArchiveBuilder-105"><a href="#ArchiveBuilder-105"><span class="linenos">105</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ArchiveBuilder-106"><a href="#ArchiveBuilder-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span>
</span><span id="ArchiveBuilder-107"><a href="#ArchiveBuilder-107"><span class="linenos">107</span></a>            <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ArchiveBuilder-108"><a href="#ArchiveBuilder-108"><span class="linenos">108</span></a>            <span class="k">if</span> <span class="n">existing</span> <span class="o">!=</span> <span class="n">normalized</span><span class="p">:</span>
</span><span id="ArchiveBuilder-109"><a href="#ArchiveBuilder-109"><span class="linenos">109</span></a>                <span class="k">raise</span> <span class="n">HashCollisionError</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">normalized</span><span class="p">,</span> <span class="n">path_hash</span><span class="p">)</span>
</span><span id="ArchiveBuilder-110"><a href="#ArchiveBuilder-110"><span class="linenos">110</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveBuilder-111"><a href="#ArchiveBuilder-111"><span class="linenos">111</span></a>                <span class="k">return</span>  <span class="c1"># </span>
</span><span id="ArchiveBuilder-112"><a href="#ArchiveBuilder-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ArchiveBuilder-113"><a href="#ArchiveBuilder-113"><span class="linenos">113</span></a>        
</span><span id="ArchiveBuilder-114"><a href="#ArchiveBuilder-114"><span class="linenos">114</span></a>        <span class="c1"># 6. </span>
</span><span id="ArchiveBuilder-115"><a href="#ArchiveBuilder-115"><span class="linenos">115</span></a>        <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ArchiveBuilder-116"><a href="#ArchiveBuilder-116"><span class="linenos">116</span></a>        
</span><span id="ArchiveBuilder-117"><a href="#ArchiveBuilder-117"><span class="linenos">117</span></a>        <span class="c1"># 7. </span>
</span><span id="ArchiveBuilder-118"><a href="#ArchiveBuilder-118"><span class="linenos">118</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ArchiveBuilder-119"><a href="#ArchiveBuilder-119"><span class="linenos">119</span></a>            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ArchiveBuilder-120"><a href="#ArchiveBuilder-120"><span class="linenos">120</span></a>        <span class="n">raw_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-121"><a href="#ArchiveBuilder-121"><span class="linenos">121</span></a>        
</span><span id="ArchiveBuilder-122"><a href="#ArchiveBuilder-122"><span class="linenos">122</span></a>        <span class="c1"># 8.  ()</span>
</span><span id="ArchiveBuilder-123"><a href="#ArchiveBuilder-123"><span class="linenos">123</span></a>        <span class="n">checksum</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="ArchiveBuilder-124"><a href="#ArchiveBuilder-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">:</span>
</span><span id="ArchiveBuilder-125"><a href="#ArchiveBuilder-125"><span class="linenos">125</span></a>            <span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-126"><a href="#ArchiveBuilder-126"><span class="linenos">126</span></a>        
</span><span id="ArchiveBuilder-127"><a href="#ArchiveBuilder-127"><span class="linenos">127</span></a>        <span class="c1"># 9. </span>
</span><span id="ArchiveBuilder-128"><a href="#ArchiveBuilder-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="n">algo_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ArchiveBuilder-129"><a href="#ArchiveBuilder-129"><span class="linenos">129</span></a>            <span class="n">hook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">algo_id</span><span class="p">]</span>
</span><span id="ArchiveBuilder-130"><a href="#ArchiveBuilder-130"><span class="linenos">130</span></a>            <span class="n">packed_data</span> <span class="o">=</span> <span class="n">hook</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-131"><a href="#ArchiveBuilder-131"><span class="linenos">131</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="n">ENTRY_FLAG_COMPRESSED</span>
</span><span id="ArchiveBuilder-132"><a href="#ArchiveBuilder-132"><span class="linenos">132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveBuilder-133"><a href="#ArchiveBuilder-133"><span class="linenos">133</span></a>            <span class="n">packed_data</span> <span class="o">=</span> <span class="n">raw_data</span>
</span><span id="ArchiveBuilder-134"><a href="#ArchiveBuilder-134"><span class="linenos">134</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder-135"><a href="#ArchiveBuilder-135"><span class="linenos">135</span></a>        
</span><span id="ArchiveBuilder-136"><a href="#ArchiveBuilder-136"><span class="linenos">136</span></a>        <span class="n">packed_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">packed_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-137"><a href="#ArchiveBuilder-137"><span class="linenos">137</span></a>        
</span><span id="ArchiveBuilder-138"><a href="#ArchiveBuilder-138"><span class="linenos">138</span></a>        <span class="c1"># 10.  (offset )</span>
</span><span id="ArchiveBuilder-139"><a href="#ArchiveBuilder-139"><span class="linenos">139</span></a>        <span class="n">blob_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="p">)</span>
</span><span id="ArchiveBuilder-140"><a href="#ArchiveBuilder-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packed_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-141"><a href="#ArchiveBuilder-141"><span class="linenos">141</span></a>        
</span><span id="ArchiveBuilder-142"><a href="#ArchiveBuilder-142"><span class="linenos">142</span></a>        <span class="c1"># 11.  Entry (offset  blob_index)</span>
</span><span id="ArchiveBuilder-143"><a href="#ArchiveBuilder-143"><span class="linenos">143</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">ArchiveEntry</span><span class="p">(</span>
</span><span id="ArchiveBuilder-144"><a href="#ArchiveBuilder-144"><span class="linenos">144</span></a>            <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ArchiveBuilder-145"><a href="#ArchiveBuilder-145"><span class="linenos">145</span></a>            <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder-146"><a href="#ArchiveBuilder-146"><span class="linenos">146</span></a>            <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder-147"><a href="#ArchiveBuilder-147"><span class="linenos">147</span></a>            <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder-148"><a href="#ArchiveBuilder-148"><span class="linenos">148</span></a>            <span class="n">offset</span><span class="o">=</span><span class="n">blob_index</span><span class="p">,</span>  <span class="c1"># build()  offset</span>
</span><span id="ArchiveBuilder-149"><a href="#ArchiveBuilder-149"><span class="linenos">149</span></a>            <span class="n">packed_size</span><span class="o">=</span><span class="n">packed_size</span><span class="p">,</span>
</span><span id="ArchiveBuilder-150"><a href="#ArchiveBuilder-150"><span class="linenos">150</span></a>            <span class="n">raw_size</span><span class="o">=</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ArchiveBuilder-151"><a href="#ArchiveBuilder-151"><span class="linenos">151</span></a>            <span class="n">algo_id</span><span class="o">=</span><span class="n">algo_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder-152"><a href="#ArchiveBuilder-152"><span class="linenos">152</span></a>            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
</span><span id="ArchiveBuilder-153"><a href="#ArchiveBuilder-153"><span class="linenos">153</span></a>            <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ArchiveBuilder-154"><a href="#ArchiveBuilder-154"><span class="linenos">154</span></a>        <span class="p">)</span>
</span><span id="ArchiveBuilder-155"><a href="#ArchiveBuilder-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="ArchiveBuilder-156"><a href="#ArchiveBuilder-156"><span class="linenos">156</span></a>    
</span><span id="ArchiveBuilder-157"><a href="#ArchiveBuilder-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir</span><span class="p">(</span>
</span><span id="ArchiveBuilder-158"><a href="#ArchiveBuilder-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder-159"><a href="#ArchiveBuilder-159"><span class="linenos">159</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder-160"><a href="#ArchiveBuilder-160"><span class="linenos">160</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ArchiveBuilder-161"><a href="#ArchiveBuilder-161"><span class="linenos">161</span></a>        <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ArchiveBuilder-162"><a href="#ArchiveBuilder-162"><span class="linenos">162</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ArchiveBuilder-163"><a href="#ArchiveBuilder-163"><span class="linenos">163</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ArchiveBuilder-164"><a href="#ArchiveBuilder-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-165"><a href="#ArchiveBuilder-165"><span class="linenos">165</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-166"><a href="#ArchiveBuilder-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-167"><a href="#ArchiveBuilder-167"><span class="linenos">167</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder-168"><a href="#ArchiveBuilder-168"><span class="linenos">168</span></a><span class="sd">            local_dir: </span>
</span><span id="ArchiveBuilder-169"><a href="#ArchiveBuilder-169"><span class="linenos">169</span></a><span class="sd">            mount_point: </span>
</span><span id="ArchiveBuilder-170"><a href="#ArchiveBuilder-170"><span class="linenos">170</span></a><span class="sd">            algo_id:  ID</span>
</span><span id="ArchiveBuilder-171"><a href="#ArchiveBuilder-171"><span class="linenos">171</span></a><span class="sd">            recursive: </span>
</span><span id="ArchiveBuilder-172"><a href="#ArchiveBuilder-172"><span class="linenos">172</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder-173"><a href="#ArchiveBuilder-173"><span class="linenos">173</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveBuilder-174"><a href="#ArchiveBuilder-174"><span class="linenos">174</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder-175"><a href="#ArchiveBuilder-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-176"><a href="#ArchiveBuilder-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ArchiveBuilder-177"><a href="#ArchiveBuilder-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder-178"><a href="#ArchiveBuilder-178"><span class="linenos">178</span></a>        
</span><span id="ArchiveBuilder-179"><a href="#ArchiveBuilder-179"><span class="linenos">179</span></a>        <span class="n">mount_point</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">mount_point</span><span class="p">)</span>
</span><span id="ArchiveBuilder-180"><a href="#ArchiveBuilder-180"><span class="linenos">180</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder-181"><a href="#ArchiveBuilder-181"><span class="linenos">181</span></a>        
</span><span id="ArchiveBuilder-182"><a href="#ArchiveBuilder-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="ArchiveBuilder-183"><a href="#ArchiveBuilder-183"><span class="linenos">183</span></a>            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ArchiveBuilder-184"><a href="#ArchiveBuilder-184"><span class="linenos">184</span></a>                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="ArchiveBuilder-185"><a href="#ArchiveBuilder-185"><span class="linenos">185</span></a>                    <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ArchiveBuilder-186"><a href="#ArchiveBuilder-186"><span class="linenos">186</span></a>                    <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">)</span>
</span><span id="ArchiveBuilder-187"><a href="#ArchiveBuilder-187"><span class="linenos">187</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder-188"><a href="#ArchiveBuilder-188"><span class="linenos">188</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">)</span>
</span><span id="ArchiveBuilder-189"><a href="#ArchiveBuilder-189"><span class="linenos">189</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder-190"><a href="#ArchiveBuilder-190"><span class="linenos">190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveBuilder-191"><a href="#ArchiveBuilder-191"><span class="linenos">191</span></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ArchiveBuilder-192"><a href="#ArchiveBuilder-192"><span class="linenos">192</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ArchiveBuilder-193"><a href="#ArchiveBuilder-193"><span class="linenos">193</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ArchiveBuilder-194"><a href="#ArchiveBuilder-194"><span class="linenos">194</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
</span><span id="ArchiveBuilder-195"><a href="#ArchiveBuilder-195"><span class="linenos">195</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">)</span>
</span><span id="ArchiveBuilder-196"><a href="#ArchiveBuilder-196"><span class="linenos">196</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder-197"><a href="#ArchiveBuilder-197"><span class="linenos">197</span></a>        
</span><span id="ArchiveBuilder-198"><a href="#ArchiveBuilder-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="n">count</span>
</span><span id="ArchiveBuilder-199"><a href="#ArchiveBuilder-199"><span class="linenos">199</span></a>    
</span><span id="ArchiveBuilder-200"><a href="#ArchiveBuilder-200"><span class="linenos">200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveBuilder-201"><a href="#ArchiveBuilder-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-202"><a href="#ArchiveBuilder-202"><span class="linenos">202</span></a><span class="sd">         Archive </span>
</span><span id="ArchiveBuilder-203"><a href="#ArchiveBuilder-203"><span class="linenos">203</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-204"><a href="#ArchiveBuilder-204"><span class="linenos">204</span></a><span class="sd">        :</span>
</span><span id="ArchiveBuilder-205"><a href="#ArchiveBuilder-205"><span class="linenos">205</span></a><span class="sd">        1.  FileHeader </span>
</span><span id="ArchiveBuilder-206"><a href="#ArchiveBuilder-206"><span class="linenos">206</span></a><span class="sd">        2.  IndexHeader + String Tables + Entry Table</span>
</span><span id="ArchiveBuilder-207"><a href="#ArchiveBuilder-207"><span class="linenos">207</span></a><span class="sd">        3.  DataHeader + Data Block</span>
</span><span id="ArchiveBuilder-208"><a href="#ArchiveBuilder-208"><span class="linenos">208</span></a><span class="sd">        4.  Headers</span>
</span><span id="ArchiveBuilder-209"><a href="#ArchiveBuilder-209"><span class="linenos">209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-210"><a href="#ArchiveBuilder-210"><span class="linenos">210</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span><span class="p">,</span> <span class="s1">&#39;w+b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ArchiveBuilder-211"><a href="#ArchiveBuilder-211"><span class="linenos">211</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">BinaryWriter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="ArchiveBuilder-212"><a href="#ArchiveBuilder-212"><span class="linenos">212</span></a>            
</span><span id="ArchiveBuilder-213"><a href="#ArchiveBuilder-213"><span class="linenos">213</span></a>            <span class="c1"># ========== 1.  FileHeader  ==========</span>
</span><span id="ArchiveBuilder-214"><a href="#ArchiveBuilder-214"><span class="linenos">214</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveBuilder-215"><a href="#ArchiveBuilder-215"><span class="linenos">215</span></a>            
</span><span id="ArchiveBuilder-216"><a href="#ArchiveBuilder-216"><span class="linenos">216</span></a>            <span class="c1"># ========== 2.  Index Block ==========</span>
</span><span id="ArchiveBuilder-217"><a href="#ArchiveBuilder-217"><span class="linenos">217</span></a>            <span class="n">index_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder-218"><a href="#ArchiveBuilder-218"><span class="linenos">218</span></a>            
</span><span id="ArchiveBuilder-219"><a href="#ArchiveBuilder-219"><span class="linenos">219</span></a>            <span class="c1"># 2.1  IndexHeader </span>
</span><span id="ArchiveBuilder-220"><a href="#ArchiveBuilder-220"><span class="linenos">220</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">IndexHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveBuilder-221"><a href="#ArchiveBuilder-221"><span class="linenos">221</span></a>            
</span><span id="ArchiveBuilder-222"><a href="#ArchiveBuilder-222"><span class="linenos">222</span></a>            <span class="c1"># 2.2  String Tables</span>
</span><span id="ArchiveBuilder-223"><a href="#ArchiveBuilder-223"><span class="linenos">223</span></a>            <span class="n">string_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder-224"><a href="#ArchiveBuilder-224"><span class="linenos">224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
</span><span id="ArchiveBuilder-225"><a href="#ArchiveBuilder-225"><span class="linenos">225</span></a>            <span class="n">string_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">string_start</span>
</span><span id="ArchiveBuilder-226"><a href="#ArchiveBuilder-226"><span class="linenos">226</span></a>            
</span><span id="ArchiveBuilder-227"><a href="#ArchiveBuilder-227"><span class="linenos">227</span></a>            <span class="c1"># 2.3 </span>
</span><span id="ArchiveBuilder-228"><a href="#ArchiveBuilder-228"><span class="linenos">228</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ArchiveBuilder-229"><a href="#ArchiveBuilder-229"><span class="linenos">229</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ArchiveBuilder-230"><a href="#ArchiveBuilder-230"><span class="linenos">230</span></a>                <span class="n">string_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">string_size</span><span class="p">)</span>
</span><span id="ArchiveBuilder-231"><a href="#ArchiveBuilder-231"><span class="linenos">231</span></a>                <span class="n">encrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-232"><a href="#ArchiveBuilder-232"><span class="linenos">232</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ArchiveBuilder-233"><a href="#ArchiveBuilder-233"><span class="linenos">233</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span><span id="ArchiveBuilder-234"><a href="#ArchiveBuilder-234"><span class="linenos">234</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">))</span>
</span><span id="ArchiveBuilder-235"><a href="#ArchiveBuilder-235"><span class="linenos">235</span></a>            
</span><span id="ArchiveBuilder-236"><a href="#ArchiveBuilder-236"><span class="linenos">236</span></a>            <span class="c1"># ========== 3.  Data Block ==========</span>
</span><span id="ArchiveBuilder-237"><a href="#ArchiveBuilder-237"><span class="linenos">237</span></a>            <span class="c1"># 3.1  DataHeader</span>
</span><span id="ArchiveBuilder-238"><a href="#ArchiveBuilder-238"><span class="linenos">238</span></a>            <span class="n">data_header_pos</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder-239"><a href="#ArchiveBuilder-239"><span class="linenos">239</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">DataHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveBuilder-240"><a href="#ArchiveBuilder-240"><span class="linenos">240</span></a>            
</span><span id="ArchiveBuilder-241"><a href="#ArchiveBuilder-241"><span class="linenos">241</span></a>            <span class="c1"># 3.2  Entry  offset </span>
</span><span id="ArchiveBuilder-242"><a href="#ArchiveBuilder-242"><span class="linenos">242</span></a>            <span class="n">data_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder-243"><a href="#ArchiveBuilder-243"><span class="linenos">243</span></a>            <span class="n">current_offset</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder-244"><a href="#ArchiveBuilder-244"><span class="linenos">244</span></a>            
</span><span id="ArchiveBuilder-245"><a href="#ArchiveBuilder-245"><span class="linenos">245</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">):</span>
</span><span id="ArchiveBuilder-246"><a href="#ArchiveBuilder-246"><span class="linenos">246</span></a>                <span class="n">blob_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ArchiveBuilder-247"><a href="#ArchiveBuilder-247"><span class="linenos">247</span></a>                
</span><span id="ArchiveBuilder-248"><a href="#ArchiveBuilder-248"><span class="linenos">248</span></a>                <span class="c1">#  Entry  offset ( Data Block )</span>
</span><span id="ArchiveBuilder-249"><a href="#ArchiveBuilder-249"><span class="linenos">249</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">data_start</span> <span class="o">+</span> <span class="n">current_offset</span>
</span><span id="ArchiveBuilder-250"><a href="#ArchiveBuilder-250"><span class="linenos">250</span></a>                
</span><span id="ArchiveBuilder-251"><a href="#ArchiveBuilder-251"><span class="linenos">251</span></a>                <span class="c1"># </span>
</span><span id="ArchiveBuilder-252"><a href="#ArchiveBuilder-252"><span class="linenos">252</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">blob_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-253"><a href="#ArchiveBuilder-253"><span class="linenos">253</span></a>                <span class="n">current_offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blob_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-254"><a href="#ArchiveBuilder-254"><span class="linenos">254</span></a>            
</span><span id="ArchiveBuilder-255"><a href="#ArchiveBuilder-255"><span class="linenos">255</span></a>            <span class="n">data_total_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">data_start</span>
</span><span id="ArchiveBuilder-256"><a href="#ArchiveBuilder-256"><span class="linenos">256</span></a>            
</span><span id="ArchiveBuilder-257"><a href="#ArchiveBuilder-257"><span class="linenos">257</span></a>            <span class="c1"># ========== 4.  Entry Table ( String Tables ) ==========</span>
</span><span id="ArchiveBuilder-258"><a href="#ArchiveBuilder-258"><span class="linenos">258</span></a>            <span class="c1">#  Entry Table </span>
</span><span id="ArchiveBuilder-259"><a href="#ArchiveBuilder-259"><span class="linenos">259</span></a>            <span class="n">entry_table_pos</span> <span class="o">=</span> <span class="n">string_start</span> <span class="o">+</span> <span class="n">string_size</span>
</span><span id="ArchiveBuilder-260"><a href="#ArchiveBuilder-260"><span class="linenos">260</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ArchiveBuilder-261"><a href="#ArchiveBuilder-261"><span class="linenos">261</span></a>                <span class="c1"># </span>
</span><span id="ArchiveBuilder-262"><a href="#ArchiveBuilder-262"><span class="linenos">262</span></a>                <span class="k">pass</span>
</span><span id="ArchiveBuilder-263"><a href="#ArchiveBuilder-263"><span class="linenos">263</span></a>            
</span><span id="ArchiveBuilder-264"><a href="#ArchiveBuilder-264"><span class="linenos">264</span></a>            <span class="c1">#  Entry Table </span>
</span><span id="ArchiveBuilder-265"><a href="#ArchiveBuilder-265"><span class="linenos">265</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">data_header_pos</span><span class="p">)</span>  <span class="c1"># </span>
</span><span id="ArchiveBuilder-266"><a href="#ArchiveBuilder-266"><span class="linenos">266</span></a>            
</span><span id="ArchiveBuilder-267"><a href="#ArchiveBuilder-267"><span class="linenos">267</span></a>            <span class="c1"># </span>
</span><span id="ArchiveBuilder-268"><a href="#ArchiveBuilder-268"><span class="linenos">268</span></a>            <span class="c1">#  Entry  offset  Data </span>
</span><span id="ArchiveBuilder-269"><a href="#ArchiveBuilder-269"><span class="linenos">269</span></a>            <span class="c1"># </span>
</span><span id="ArchiveBuilder-270"><a href="#ArchiveBuilder-270"><span class="linenos">270</span></a>            
</span><span id="ArchiveBuilder-271"><a href="#ArchiveBuilder-271"><span class="linenos">271</span></a>        <span class="c1"># =====  =====</span>
</span><span id="ArchiveBuilder-272"><a href="#ArchiveBuilder-272"><span class="linenos">272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build_two_phase</span><span class="p">()</span>
</span><span id="ArchiveBuilder-273"><a href="#ArchiveBuilder-273"><span class="linenos">273</span></a>    
</span><span id="ArchiveBuilder-274"><a href="#ArchiveBuilder-274"><span class="linenos">274</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_two_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveBuilder-275"><a href="#ArchiveBuilder-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-276"><a href="#ArchiveBuilder-276"><span class="linenos">276</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-277"><a href="#ArchiveBuilder-277"><span class="linenos">277</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-278"><a href="#ArchiveBuilder-278"><span class="linenos">278</span></a><span class="sd">         1:  offset</span>
</span><span id="ArchiveBuilder-279"><a href="#ArchiveBuilder-279"><span class="linenos">279</span></a><span class="sd">         2: </span>
</span><span id="ArchiveBuilder-280"><a href="#ArchiveBuilder-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-281"><a href="#ArchiveBuilder-281"><span class="linenos">281</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="ArchiveBuilder-282"><a href="#ArchiveBuilder-282"><span class="linenos">282</span></a>        
</span><span id="ArchiveBuilder-283"><a href="#ArchiveBuilder-283"><span class="linenos">283</span></a>        <span class="c1"># =====  1:  =====</span>
</span><span id="ArchiveBuilder-284"><a href="#ArchiveBuilder-284"><span class="linenos">284</span></a>        
</span><span id="ArchiveBuilder-285"><a href="#ArchiveBuilder-285"><span class="linenos">285</span></a>        <span class="c1">#  String Tables </span>
</span><span id="ArchiveBuilder-286"><a href="#ArchiveBuilder-286"><span class="linenos">286</span></a>        <span class="n">string_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
</span><span id="ArchiveBuilder-287"><a href="#ArchiveBuilder-287"><span class="linenos">287</span></a>        <span class="n">string_writer</span> <span class="o">=</span> <span class="n">BinaryWriter</span><span class="p">(</span><span class="n">string_buffer</span><span class="p">)</span>
</span><span id="ArchiveBuilder-288"><a href="#ArchiveBuilder-288"><span class="linenos">288</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">string_writer</span><span class="p">)</span>
</span><span id="ArchiveBuilder-289"><a href="#ArchiveBuilder-289"><span class="linenos">289</span></a>        <span class="n">string_data</span> <span class="o">=</span> <span class="n">string_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="ArchiveBuilder-290"><a href="#ArchiveBuilder-290"><span class="linenos">290</span></a>        
</span><span id="ArchiveBuilder-291"><a href="#ArchiveBuilder-291"><span class="linenos">291</span></a>        <span class="c1">#  ()</span>
</span><span id="ArchiveBuilder-292"><a href="#ArchiveBuilder-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ArchiveBuilder-293"><a href="#ArchiveBuilder-293"><span class="linenos">293</span></a>            <span class="n">string_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-294"><a href="#ArchiveBuilder-294"><span class="linenos">294</span></a>        
</span><span id="ArchiveBuilder-295"><a href="#ArchiveBuilder-295"><span class="linenos">295</span></a>        <span class="n">string_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-296"><a href="#ArchiveBuilder-296"><span class="linenos">296</span></a>        
</span><span id="ArchiveBuilder-297"><a href="#ArchiveBuilder-297"><span class="linenos">297</span></a>        <span class="c1">#  Entry Table </span>
</span><span id="ArchiveBuilder-298"><a href="#ArchiveBuilder-298"><span class="linenos">298</span></a>        <span class="n">checksum_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">digest_size</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder-299"><a href="#ArchiveBuilder-299"><span class="linenos">299</span></a>        <span class="n">entry_size</span> <span class="o">=</span> <span class="n">ArchiveEntry</span><span class="o">.</span><span class="n">entry_size</span><span class="p">(</span><span class="n">checksum_size</span><span class="p">)</span>
</span><span id="ArchiveBuilder-300"><a href="#ArchiveBuilder-300"><span class="linenos">300</span></a>        <span class="n">entry_table_size</span> <span class="o">=</span> <span class="n">entry_size</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveBuilder-301"><a href="#ArchiveBuilder-301"><span class="linenos">301</span></a>        
</span><span id="ArchiveBuilder-302"><a href="#ArchiveBuilder-302"><span class="linenos">302</span></a>        <span class="c1"># </span>
</span><span id="ArchiveBuilder-303"><a href="#ArchiveBuilder-303"><span class="linenos">303</span></a>        <span class="n">file_header_size</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span>
</span><span id="ArchiveBuilder-304"><a href="#ArchiveBuilder-304"><span class="linenos">304</span></a>        <span class="n">index_header_size</span> <span class="o">=</span> <span class="n">IndexHeader</span><span class="o">.</span><span class="n">SIZE</span>
</span><span id="ArchiveBuilder-305"><a href="#ArchiveBuilder-305"><span class="linenos">305</span></a>        <span class="n">data_header_size</span> <span class="o">=</span> <span class="n">DataHeader</span><span class="o">.</span><span class="n">SIZE</span>
</span><span id="ArchiveBuilder-306"><a href="#ArchiveBuilder-306"><span class="linenos">306</span></a>        
</span><span id="ArchiveBuilder-307"><a href="#ArchiveBuilder-307"><span class="linenos">307</span></a>        <span class="n">index_start</span> <span class="o">=</span> <span class="n">file_header_size</span>
</span><span id="ArchiveBuilder-308"><a href="#ArchiveBuilder-308"><span class="linenos">308</span></a>        <span class="n">string_start</span> <span class="o">=</span> <span class="n">index_start</span> <span class="o">+</span> <span class="n">index_header_size</span>
</span><span id="ArchiveBuilder-309"><a href="#ArchiveBuilder-309"><span class="linenos">309</span></a>        <span class="n">entry_start</span> <span class="o">=</span> <span class="n">string_start</span> <span class="o">+</span> <span class="n">string_size</span>
</span><span id="ArchiveBuilder-310"><a href="#ArchiveBuilder-310"><span class="linenos">310</span></a>        <span class="n">data_header_start</span> <span class="o">=</span> <span class="n">entry_start</span> <span class="o">+</span> <span class="n">entry_table_size</span>
</span><span id="ArchiveBuilder-311"><a href="#ArchiveBuilder-311"><span class="linenos">311</span></a>        <span class="n">data_start</span> <span class="o">=</span> <span class="n">data_header_start</span> <span class="o">+</span> <span class="n">data_header_size</span>
</span><span id="ArchiveBuilder-312"><a href="#ArchiveBuilder-312"><span class="linenos">312</span></a>        
</span><span id="ArchiveBuilder-313"><a href="#ArchiveBuilder-313"><span class="linenos">313</span></a>        <span class="c1">#  Entry  offset</span>
</span><span id="ArchiveBuilder-314"><a href="#ArchiveBuilder-314"><span class="linenos">314</span></a>        <span class="n">current_data_offset</span> <span class="o">=</span> <span class="n">data_start</span>
</span><span id="ArchiveBuilder-315"><a href="#ArchiveBuilder-315"><span class="linenos">315</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">):</span>
</span><span id="ArchiveBuilder-316"><a href="#ArchiveBuilder-316"><span class="linenos">316</span></a>            <span class="n">entry</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">current_data_offset</span>
</span><span id="ArchiveBuilder-317"><a href="#ArchiveBuilder-317"><span class="linenos">317</span></a>            <span class="n">current_data_offset</span> <span class="o">+=</span> <span class="n">entry</span><span class="o">.</span><span class="n">packed_size</span>
</span><span id="ArchiveBuilder-318"><a href="#ArchiveBuilder-318"><span class="linenos">318</span></a>        
</span><span id="ArchiveBuilder-319"><a href="#ArchiveBuilder-319"><span class="linenos">319</span></a>        <span class="n">data_total_size</span> <span class="o">=</span> <span class="n">current_data_offset</span> <span class="o">-</span> <span class="n">data_start</span>
</span><span id="ArchiveBuilder-320"><a href="#ArchiveBuilder-320"><span class="linenos">320</span></a>        <span class="n">index_size</span> <span class="o">=</span> <span class="n">data_header_start</span> <span class="o">-</span> <span class="n">index_start</span>
</span><span id="ArchiveBuilder-321"><a href="#ArchiveBuilder-321"><span class="linenos">321</span></a>        
</span><span id="ArchiveBuilder-322"><a href="#ArchiveBuilder-322"><span class="linenos">322</span></a>        <span class="c1"># =====  2:  =====</span>
</span><span id="ArchiveBuilder-323"><a href="#ArchiveBuilder-323"><span class="linenos">323</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ArchiveBuilder-324"><a href="#ArchiveBuilder-324"><span class="linenos">324</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">BinaryWriter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="ArchiveBuilder-325"><a href="#ArchiveBuilder-325"><span class="linenos">325</span></a>            
</span><span id="ArchiveBuilder-326"><a href="#ArchiveBuilder-326"><span class="linenos">326</span></a>            <span class="c1"># 1. FileHeader</span>
</span><span id="ArchiveBuilder-327"><a href="#ArchiveBuilder-327"><span class="linenos">327</span></a>            <span class="n">file_header</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="p">(</span>
</span><span id="ArchiveBuilder-328"><a href="#ArchiveBuilder-328"><span class="linenos">328</span></a>                <span class="n">magic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_magic</span><span class="p">,</span>
</span><span id="ArchiveBuilder-329"><a href="#ArchiveBuilder-329"><span class="linenos">329</span></a>                <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span id="ArchiveBuilder-330"><a href="#ArchiveBuilder-330"><span class="linenos">330</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">MODE_ARCHIVE</span><span class="p">,</span>
</span><span id="ArchiveBuilder-331"><a href="#ArchiveBuilder-331"><span class="linenos">331</span></a>                <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">flags_id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ArchiveBuilder-332"><a href="#ArchiveBuilder-332"><span class="linenos">332</span></a>                <span class="n">checksum_algo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">algo_id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ArchiveBuilder-333"><a href="#ArchiveBuilder-333"><span class="linenos">333</span></a>                <span class="n">index_offset</span><span class="o">=</span><span class="n">index_start</span><span class="p">,</span>
</span><span id="ArchiveBuilder-334"><a href="#ArchiveBuilder-334"><span class="linenos">334</span></a>                <span class="n">index_size</span><span class="o">=</span><span class="n">index_size</span><span class="p">,</span>
</span><span id="ArchiveBuilder-335"><a href="#ArchiveBuilder-335"><span class="linenos">335</span></a>                <span class="n">data_offset</span><span class="o">=</span><span class="n">data_header_start</span><span class="p">,</span>
</span><span id="ArchiveBuilder-336"><a href="#ArchiveBuilder-336"><span class="linenos">336</span></a>                <span class="n">entry_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveBuilder-337"><a href="#ArchiveBuilder-337"><span class="linenos">337</span></a>            <span class="p">)</span>
</span><span id="ArchiveBuilder-338"><a href="#ArchiveBuilder-338"><span class="linenos">338</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">file_header</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ArchiveBuilder-339"><a href="#ArchiveBuilder-339"><span class="linenos">339</span></a>            
</span><span id="ArchiveBuilder-340"><a href="#ArchiveBuilder-340"><span class="linenos">340</span></a>            <span class="c1"># 2. IndexHeader</span>
</span><span id="ArchiveBuilder-341"><a href="#ArchiveBuilder-341"><span class="linenos">341</span></a>            <span class="n">index_header</span> <span class="o">=</span> <span class="n">IndexHeader</span><span class="p">(</span>
</span><span id="ArchiveBuilder-342"><a href="#ArchiveBuilder-342"><span class="linenos">342</span></a>                <span class="n">dir_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">dirs</span><span class="p">),</span>
</span><span id="ArchiveBuilder-343"><a href="#ArchiveBuilder-343"><span class="linenos">343</span></a>                <span class="n">name_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">names</span><span class="p">),</span>
</span><span id="ArchiveBuilder-344"><a href="#ArchiveBuilder-344"><span class="linenos">344</span></a>                <span class="n">ext_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">exts</span><span class="p">),</span>
</span><span id="ArchiveBuilder-345"><a href="#ArchiveBuilder-345"><span class="linenos">345</span></a>                <span class="n">string_table_size</span><span class="o">=</span><span class="n">string_size</span><span class="p">,</span>
</span><span id="ArchiveBuilder-346"><a href="#ArchiveBuilder-346"><span class="linenos">346</span></a>                <span class="n">checksum_size</span><span class="o">=</span><span class="n">checksum_size</span>
</span><span id="ArchiveBuilder-347"><a href="#ArchiveBuilder-347"><span class="linenos">347</span></a>            <span class="p">)</span>
</span><span id="ArchiveBuilder-348"><a href="#ArchiveBuilder-348"><span class="linenos">348</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">index_header</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ArchiveBuilder-349"><a href="#ArchiveBuilder-349"><span class="linenos">349</span></a>            
</span><span id="ArchiveBuilder-350"><a href="#ArchiveBuilder-350"><span class="linenos">350</span></a>            <span class="c1"># 3. String Tables</span>
</span><span id="ArchiveBuilder-351"><a href="#ArchiveBuilder-351"><span class="linenos">351</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder-352"><a href="#ArchiveBuilder-352"><span class="linenos">352</span></a>            
</span><span id="ArchiveBuilder-353"><a href="#ArchiveBuilder-353"><span class="linenos">353</span></a>            <span class="c1"># 4. Entry Table</span>
</span><span id="ArchiveBuilder-354"><a href="#ArchiveBuilder-354"><span class="linenos">354</span></a>            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ArchiveBuilder-355"><a href="#ArchiveBuilder-355"><span class="linenos">355</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ArchiveBuilder-356"><a href="#ArchiveBuilder-356"><span class="linenos">356</span></a>            
</span><span id="ArchiveBuilder-357"><a href="#ArchiveBuilder-357"><span class="linenos">357</span></a>            <span class="c1"># 5. DataHeader</span>
</span><span id="ArchiveBuilder-358"><a href="#ArchiveBuilder-358"><span class="linenos">358</span></a>            <span class="n">data_header</span> <span class="o">=</span> <span class="n">DataHeader</span><span class="p">(</span>
</span><span id="ArchiveBuilder-359"><a href="#ArchiveBuilder-359"><span class="linenos">359</span></a>                <span class="n">magic</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;DATA&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder-360"><a href="#ArchiveBuilder-360"><span class="linenos">360</span></a>                <span class="n">block_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">),</span>
</span><span id="ArchiveBuilder-361"><a href="#ArchiveBuilder-361"><span class="linenos">361</span></a>                <span class="n">total_size</span><span class="o">=</span><span class="n">data_total_size</span>
</span><span id="ArchiveBuilder-362"><a href="#ArchiveBuilder-362"><span class="linenos">362</span></a>            <span class="p">)</span>
</span><span id="ArchiveBuilder-363"><a href="#ArchiveBuilder-363"><span class="linenos">363</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">data_header</span><span class="o">.</span><span class="n">pack</span><span class="p">())</span>
</span><span id="ArchiveBuilder-364"><a href="#ArchiveBuilder-364"><span class="linenos">364</span></a>            
</span><span id="ArchiveBuilder-365"><a href="#ArchiveBuilder-365"><span class="linenos">365</span></a>            <span class="c1"># 6. Data Block</span>
</span><span id="ArchiveBuilder-366"><a href="#ArchiveBuilder-366"><span class="linenos">366</span></a>            <span class="k">for</span> <span class="n">blob</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="p">:</span>
</span><span id="ArchiveBuilder-367"><a href="#ArchiveBuilder-367"><span class="linenos">367</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
</span><span id="ArchiveBuilder-368"><a href="#ArchiveBuilder-368"><span class="linenos">368</span></a>    
</span><span id="ArchiveBuilder-369"><a href="#ArchiveBuilder-369"><span class="linenos">369</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveBuilder-370"><a href="#ArchiveBuilder-370"><span class="linenos">370</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ArchiveBuilder-371"><a href="#ArchiveBuilder-371"><span class="linenos">371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-372"><a href="#ArchiveBuilder-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveBuilder-373"><a href="#ArchiveBuilder-373"><span class="linenos">373</span></a>    
</span><span id="ArchiveBuilder-374"><a href="#ArchiveBuilder-374"><span class="linenos">374</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveBuilder-375"><a href="#ArchiveBuilder-375"><span class="linenos">375</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">path_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ArchiveBuilder-376"><a href="#ArchiveBuilder-376"><span class="linenos">376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-377"><a href="#ArchiveBuilder-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">stats</span>
</span><span id="ArchiveBuilder-378"><a href="#ArchiveBuilder-378"><span class="linenos">378</span></a>    
</span><span id="ArchiveBuilder-379"><a href="#ArchiveBuilder-379"><span class="linenos">379</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveBuilder-380"><a href="#ArchiveBuilder-380"><span class="linenos">380</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compression_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ArchiveBuilder-381"><a href="#ArchiveBuilder-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-382"><a href="#ArchiveBuilder-382"><span class="linenos">382</span></a>        <span class="n">total_raw</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">raw_size</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveBuilder-383"><a href="#ArchiveBuilder-383"><span class="linenos">383</span></a>        <span class="n">total_packed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">packed_size</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveBuilder-384"><a href="#ArchiveBuilder-384"><span class="linenos">384</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ArchiveBuilder-385"><a href="#ArchiveBuilder-385"><span class="linenos">385</span></a>            <span class="s1">&#39;total_raw&#39;</span><span class="p">:</span> <span class="n">total_raw</span><span class="p">,</span>
</span><span id="ArchiveBuilder-386"><a href="#ArchiveBuilder-386"><span class="linenos">386</span></a>            <span class="s1">&#39;total_packed&#39;</span><span class="p">:</span> <span class="n">total_packed</span><span class="p">,</span>
</span><span id="ArchiveBuilder-387"><a href="#ArchiveBuilder-387"><span class="linenos">387</span></a>            <span class="s1">&#39;ratio&#39;</span><span class="p">:</span> <span class="n">total_packed</span> <span class="o">/</span> <span class="n">total_raw</span> <span class="k">if</span> <span class="n">total_raw</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="ArchiveBuilder-388"><a href="#ArchiveBuilder-388"><span class="linenos">388</span></a>        <span class="p">}</span>
</span><span id="ArchiveBuilder-389"><a href="#ArchiveBuilder-389"><span class="linenos">389</span></a>    
</span><span id="ArchiveBuilder-390"><a href="#ArchiveBuilder-390"><span class="linenos">390</span></a>    <span class="c1"># ====================  API ====================</span>
</span><span id="ArchiveBuilder-391"><a href="#ArchiveBuilder-391"><span class="linenos">391</span></a>    
</span><span id="ArchiveBuilder-392"><a href="#ArchiveBuilder-392"><span class="linenos">392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_files_batch</span><span class="p">(</span>
</span><span id="ArchiveBuilder-393"><a href="#ArchiveBuilder-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder-394"><a href="#ArchiveBuilder-394"><span class="linenos">394</span></a>        <span class="n">items</span><span class="p">:</span> <span class="s1">&#39;List[FileItem] | Iterator[FileItem]&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder-395"><a href="#ArchiveBuilder-395"><span class="linenos">395</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder-396"><a href="#ArchiveBuilder-396"><span class="linenos">396</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveBuilder-397"><a href="#ArchiveBuilder-397"><span class="linenos">397</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder-398"><a href="#ArchiveBuilder-398"><span class="linenos">398</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-399"><a href="#ArchiveBuilder-399"><span class="linenos">399</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-400"><a href="#ArchiveBuilder-400"><span class="linenos">400</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-401"><a href="#ArchiveBuilder-401"><span class="linenos">401</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder-402"><a href="#ArchiveBuilder-402"><span class="linenos">402</span></a><span class="sd">            items: FileItem </span>
</span><span id="ArchiveBuilder-403"><a href="#ArchiveBuilder-403"><span class="linenos">403</span></a><span class="sd">            on_error:  (&#39;raise&#39;, &#39;skip&#39;, &#39;abort&#39;)</span>
</span><span id="ArchiveBuilder-404"><a href="#ArchiveBuilder-404"><span class="linenos">404</span></a><span class="sd">            progress_callback: </span>
</span><span id="ArchiveBuilder-405"><a href="#ArchiveBuilder-405"><span class="linenos">405</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder-406"><a href="#ArchiveBuilder-406"><span class="linenos">406</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveBuilder-407"><a href="#ArchiveBuilder-407"><span class="linenos">407</span></a><span class="sd">            BatchResult </span>
</span><span id="ArchiveBuilder-408"><a href="#ArchiveBuilder-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-409"><a href="#ArchiveBuilder-409"><span class="linenos">409</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="ArchiveBuilder-410"><a href="#ArchiveBuilder-410"><span class="linenos">410</span></a>            <span class="n">FileItem</span><span class="p">,</span> <span class="n">ProgressInfo</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span><span class="p">,</span>
</span><span id="ArchiveBuilder-411"><a href="#ArchiveBuilder-411"><span class="linenos">411</span></a>            <span class="n">ErrorPolicy</span><span class="p">,</span> <span class="n">estimate_total_bytes</span>
</span><span id="ArchiveBuilder-412"><a href="#ArchiveBuilder-412"><span class="linenos">412</span></a>        <span class="p">)</span>
</span><span id="ArchiveBuilder-413"><a href="#ArchiveBuilder-413"><span class="linenos">413</span></a>        
</span><span id="ArchiveBuilder-414"><a href="#ArchiveBuilder-414"><span class="linenos">414</span></a>        <span class="c1">#  ()</span>
</span><span id="ArchiveBuilder-415"><a href="#ArchiveBuilder-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ArchiveBuilder-416"><a href="#ArchiveBuilder-416"><span class="linenos">416</span></a>            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ArchiveBuilder-417"><a href="#ArchiveBuilder-417"><span class="linenos">417</span></a>        
</span><span id="ArchiveBuilder-418"><a href="#ArchiveBuilder-418"><span class="linenos">418</span></a>        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ArchiveBuilder-419"><a href="#ArchiveBuilder-419"><span class="linenos">419</span></a>        <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">estimate_total_bytes</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ArchiveBuilder-420"><a href="#ArchiveBuilder-420"><span class="linenos">420</span></a>        
</span><span id="ArchiveBuilder-421"><a href="#ArchiveBuilder-421"><span class="linenos">421</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ArchiveBuilder-422"><a href="#ArchiveBuilder-422"><span class="linenos">422</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="n">total_files</span><span class="p">,</span>
</span><span id="ArchiveBuilder-423"><a href="#ArchiveBuilder-423"><span class="linenos">423</span></a>            <span class="n">total_bytes</span><span class="o">=</span><span class="n">total_bytes</span><span class="p">,</span>
</span><span id="ArchiveBuilder-424"><a href="#ArchiveBuilder-424"><span class="linenos">424</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ArchiveBuilder-425"><a href="#ArchiveBuilder-425"><span class="linenos">425</span></a>        <span class="p">)</span>
</span><span id="ArchiveBuilder-426"><a href="#ArchiveBuilder-426"><span class="linenos">426</span></a>        
</span><span id="ArchiveBuilder-427"><a href="#ArchiveBuilder-427"><span class="linenos">427</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ArchiveBuilder-428"><a href="#ArchiveBuilder-428"><span class="linenos">428</span></a>        
</span><span id="ArchiveBuilder-429"><a href="#ArchiveBuilder-429"><span class="linenos">429</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="ArchiveBuilder-430"><a href="#ArchiveBuilder-430"><span class="linenos">430</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ArchiveBuilder-431"><a href="#ArchiveBuilder-431"><span class="linenos">431</span></a>                <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ArchiveBuilder-432"><a href="#ArchiveBuilder-432"><span class="linenos">432</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">algo_id</span><span class="p">)</span>
</span><span id="ArchiveBuilder-433"><a href="#ArchiveBuilder-433"><span class="linenos">433</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder-434"><a href="#ArchiveBuilder-434"><span class="linenos">434</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">file_size</span>
</span><span id="ArchiveBuilder-435"><a href="#ArchiveBuilder-435"><span class="linenos">435</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">file_size</span><span class="p">)</span>
</span><span id="ArchiveBuilder-436"><a href="#ArchiveBuilder-436"><span class="linenos">436</span></a>                
</span><span id="ArchiveBuilder-437"><a href="#ArchiveBuilder-437"><span class="linenos">437</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ArchiveBuilder-438"><a href="#ArchiveBuilder-438"><span class="linenos">438</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder-439"><a href="#ArchiveBuilder-439"><span class="linenos">439</span></a>                    <span class="k">raise</span>
</span><span id="ArchiveBuilder-440"><a href="#ArchiveBuilder-440"><span class="linenos">440</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder-441"><a href="#ArchiveBuilder-441"><span class="linenos">441</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder-442"><a href="#ArchiveBuilder-442"><span class="linenos">442</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveBuilder-443"><a href="#ArchiveBuilder-443"><span class="linenos">443</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ArchiveBuilder-444"><a href="#ArchiveBuilder-444"><span class="linenos">444</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;abort&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder-445"><a href="#ArchiveBuilder-445"><span class="linenos">445</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder-446"><a href="#ArchiveBuilder-446"><span class="linenos">446</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveBuilder-447"><a href="#ArchiveBuilder-447"><span class="linenos">447</span></a>                    <span class="k">break</span>
</span><span id="ArchiveBuilder-448"><a href="#ArchiveBuilder-448"><span class="linenos">448</span></a>        
</span><span id="ArchiveBuilder-449"><a href="#ArchiveBuilder-449"><span class="linenos">449</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ArchiveBuilder-450"><a href="#ArchiveBuilder-450"><span class="linenos">450</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ArchiveBuilder-451"><a href="#ArchiveBuilder-451"><span class="linenos">451</span></a>    
</span><span id="ArchiveBuilder-452"><a href="#ArchiveBuilder-452"><span class="linenos">452</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir_batch</span><span class="p">(</span>
</span><span id="ArchiveBuilder-453"><a href="#ArchiveBuilder-453"><span class="linenos">453</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder-454"><a href="#ArchiveBuilder-454"><span class="linenos">454</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder-455"><a href="#ArchiveBuilder-455"><span class="linenos">455</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ArchiveBuilder-456"><a href="#ArchiveBuilder-456"><span class="linenos">456</span></a>        <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ArchiveBuilder-457"><a href="#ArchiveBuilder-457"><span class="linenos">457</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ArchiveBuilder-458"><a href="#ArchiveBuilder-458"><span class="linenos">458</span></a>        <span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder-459"><a href="#ArchiveBuilder-459"><span class="linenos">459</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder-460"><a href="#ArchiveBuilder-460"><span class="linenos">460</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveBuilder-461"><a href="#ArchiveBuilder-461"><span class="linenos">461</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder-462"><a href="#ArchiveBuilder-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-463"><a href="#ArchiveBuilder-463"><span class="linenos">463</span></a><span class="sd">         ()</span>
</span><span id="ArchiveBuilder-464"><a href="#ArchiveBuilder-464"><span class="linenos">464</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder-465"><a href="#ArchiveBuilder-465"><span class="linenos">465</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder-466"><a href="#ArchiveBuilder-466"><span class="linenos">466</span></a><span class="sd">            local_dir: </span>
</span><span id="ArchiveBuilder-467"><a href="#ArchiveBuilder-467"><span class="linenos">467</span></a><span class="sd">            mount_point: </span>
</span><span id="ArchiveBuilder-468"><a href="#ArchiveBuilder-468"><span class="linenos">468</span></a><span class="sd">            algo_id:  ID</span>
</span><span id="ArchiveBuilder-469"><a href="#ArchiveBuilder-469"><span class="linenos">469</span></a><span class="sd">            recursive: </span>
</span><span id="ArchiveBuilder-470"><a href="#ArchiveBuilder-470"><span class="linenos">470</span></a><span class="sd">            exclude_patterns: </span>
</span><span id="ArchiveBuilder-471"><a href="#ArchiveBuilder-471"><span class="linenos">471</span></a><span class="sd">            on_error: </span>
</span><span id="ArchiveBuilder-472"><a href="#ArchiveBuilder-472"><span class="linenos">472</span></a><span class="sd">            progress_callback: </span>
</span><span id="ArchiveBuilder-473"><a href="#ArchiveBuilder-473"><span class="linenos">473</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder-474"><a href="#ArchiveBuilder-474"><span class="linenos">474</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveBuilder-475"><a href="#ArchiveBuilder-475"><span class="linenos">475</span></a><span class="sd">            BatchResult </span>
</span><span id="ArchiveBuilder-476"><a href="#ArchiveBuilder-476"><span class="linenos">476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder-477"><a href="#ArchiveBuilder-477"><span class="linenos">477</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">scan_directory</span>
</span><span id="ArchiveBuilder-478"><a href="#ArchiveBuilder-478"><span class="linenos">478</span></a>        
</span><span id="ArchiveBuilder-479"><a href="#ArchiveBuilder-479"><span class="linenos">479</span></a>        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_directory</span><span class="p">(</span>
</span><span id="ArchiveBuilder-480"><a href="#ArchiveBuilder-480"><span class="linenos">480</span></a>            <span class="n">local_dir</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">,</span> <span class="n">exclude_patterns</span>
</span><span id="ArchiveBuilder-481"><a href="#ArchiveBuilder-481"><span class="linenos">481</span></a>        <span class="p">))</span>
</span><span id="ArchiveBuilder-482"><a href="#ArchiveBuilder-482"><span class="linenos">482</span></a>        
</span><span id="ArchiveBuilder-483"><a href="#ArchiveBuilder-483"><span class="linenos">483</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_files_batch</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">on_error</span><span class="p">,</span> <span class="n">progress_callback</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Archive </p>

<p></p>
</div>


                            <div id="ArchiveBuilder.__init__" class="classattr">
                                        <input id="ArchiveBuilder.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ArchiveBuilder</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">magic</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GRIM&#39;</span>,</span><span class="param">	<span class="n">compression_hooks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#CompressionHook">CompressionHook</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">checksum_hook</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_crypto</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ArchiveBuilder.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.__init__-31"><a href="#ArchiveBuilder.__init__-31"><span class="linenos">31</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArchiveBuilder.__init__-32"><a href="#ArchiveBuilder.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder.__init__-33"><a href="#ArchiveBuilder.__init__-33"><span class="linenos">33</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder.__init__-34"><a href="#ArchiveBuilder.__init__-34"><span class="linenos">34</span></a>        <span class="n">magic</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GRIM&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder.__init__-35"><a href="#ArchiveBuilder.__init__-35"><span class="linenos">35</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder.__init__-36"><a href="#ArchiveBuilder.__init__-36"><span class="linenos">36</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder.__init__-37"><a href="#ArchiveBuilder.__init__-37"><span class="linenos">37</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder.__init__-38"><a href="#ArchiveBuilder.__init__-38"><span class="linenos">38</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveBuilder.__init__-39"><a href="#ArchiveBuilder.__init__-39"><span class="linenos">39</span></a>    <span class="p">):</span>
</span><span id="ArchiveBuilder.__init__-40"><a href="#ArchiveBuilder.__init__-40"><span class="linenos">40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.__init__-41"><a href="#ArchiveBuilder.__init__-41"><span class="linenos">41</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.__init__-42"><a href="#ArchiveBuilder.__init__-42"><span class="linenos">42</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.__init__-43"><a href="#ArchiveBuilder.__init__-43"><span class="linenos">43</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder.__init__-44"><a href="#ArchiveBuilder.__init__-44"><span class="linenos">44</span></a><span class="sd">            output_path: </span>
</span><span id="ArchiveBuilder.__init__-45"><a href="#ArchiveBuilder.__init__-45"><span class="linenos">45</span></a><span class="sd">            magic:  (4 bytes)</span>
</span><span id="ArchiveBuilder.__init__-46"><a href="#ArchiveBuilder.__init__-46"><span class="linenos">46</span></a><span class="sd">            compression_hooks: </span>
</span><span id="ArchiveBuilder.__init__-47"><a href="#ArchiveBuilder.__init__-47"><span class="linenos">47</span></a><span class="sd">            checksum_hook:  ()</span>
</span><span id="ArchiveBuilder.__init__-48"><a href="#ArchiveBuilder.__init__-48"><span class="linenos">48</span></a><span class="sd">            index_crypto:  ()</span>
</span><span id="ArchiveBuilder.__init__-49"><a href="#ArchiveBuilder.__init__-49"><span class="linenos">49</span></a><span class="sd">            path_hash_func:  Hash  ()</span>
</span><span id="ArchiveBuilder.__init__-50"><a href="#ArchiveBuilder.__init__-50"><span class="linenos">50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.__init__-51"><a href="#ArchiveBuilder.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span> <span class="o">=</span> <span class="n">output_path</span>
</span><span id="ArchiveBuilder.__init__-52"><a href="#ArchiveBuilder.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_magic</span> <span class="o">=</span> <span class="n">magic</span>
</span><span id="ArchiveBuilder.__init__-53"><a href="#ArchiveBuilder.__init__-53"><span class="linenos">53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ArchiveBuilder.__init__-54"><a href="#ArchiveBuilder.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ArchiveBuilder.__init__-55"><a href="#ArchiveBuilder.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ArchiveBuilder.__init__-56"><a href="#ArchiveBuilder.__init__-56"><span class="linenos">56</span></a>        
</span><span id="ArchiveBuilder.__init__-57"><a href="#ArchiveBuilder.__init__-57"><span class="linenos">57</span></a>        <span class="c1"># </span>
</span><span id="ArchiveBuilder.__init__-58"><a href="#ArchiveBuilder.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">CompressionHook</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ArchiveBuilder.__init__-59"><a href="#ArchiveBuilder.__init__-59"><span class="linenos">59</span></a>        <span class="k">if</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveBuilder.__init__-60"><a href="#ArchiveBuilder.__init__-60"><span class="linenos">60</span></a>            <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveBuilder.__init__-61"><a href="#ArchiveBuilder.__init__-61"><span class="linenos">61</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">hook</span><span class="o">.</span><span class="n">algo_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">hook</span>
</span><span id="ArchiveBuilder.__init__-62"><a href="#ArchiveBuilder.__init__-62"><span class="linenos">62</span></a>        
</span><span id="ArchiveBuilder.__init__-63"><a href="#ArchiveBuilder.__init__-63"><span class="linenos">63</span></a>        <span class="c1"># </span>
</span><span id="ArchiveBuilder.__init__-64"><a href="#ArchiveBuilder.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span> <span class="o">=</span> <span class="n">PathDictionary</span><span class="p">()</span>
</span><span id="ArchiveBuilder.__init__-65"><a href="#ArchiveBuilder.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ArchiveEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArchiveBuilder.__init__-66"><a href="#ArchiveBuilder.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># </span>
</span><span id="ArchiveBuilder.__init__-67"><a href="#ArchiveBuilder.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># </span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    output_path: 
    magic:  (4 bytes)
    compression_hooks: 
    checksum_hook:  ()
    index_crypto:  ()
    path_hash_func:  Hash  ()</p>
</div>


                            </div>
                            <div id="ArchiveBuilder.add_file" class="classattr">
                                        <input id="ArchiveBuilder.add_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ArchiveBuilder.add_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.add_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.add_file-69"><a href="#ArchiveBuilder.add_file-69"><span class="linenos"> 69</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_file</span><span class="p">(</span>
</span><span id="ArchiveBuilder.add_file-70"><a href="#ArchiveBuilder.add_file-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-71"><a href="#ArchiveBuilder.add_file-71"><span class="linenos"> 71</span></a>        <span class="n">local_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-72"><a href="#ArchiveBuilder.add_file-72"><span class="linenos"> 72</span></a>        <span class="n">vfs_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-73"><a href="#ArchiveBuilder.add_file-73"><span class="linenos"> 73</span></a>        <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder.add_file-74"><a href="#ArchiveBuilder.add_file-74"><span class="linenos"> 74</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-75"><a href="#ArchiveBuilder.add_file-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_file-76"><a href="#ArchiveBuilder.add_file-76"><span class="linenos"> 76</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.add_file-77"><a href="#ArchiveBuilder.add_file-77"><span class="linenos"> 77</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.add_file-78"><a href="#ArchiveBuilder.add_file-78"><span class="linenos"> 78</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder.add_file-79"><a href="#ArchiveBuilder.add_file-79"><span class="linenos"> 79</span></a><span class="sd">            local_path: </span>
</span><span id="ArchiveBuilder.add_file-80"><a href="#ArchiveBuilder.add_file-80"><span class="linenos"> 80</span></a><span class="sd">            vfs_path:  ()</span>
</span><span id="ArchiveBuilder.add_file-81"><a href="#ArchiveBuilder.add_file-81"><span class="linenos"> 81</span></a><span class="sd">            algo_id:  ID (0=)</span>
</span><span id="ArchiveBuilder.add_file-82"><a href="#ArchiveBuilder.add_file-82"><span class="linenos"> 82</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder.add_file-83"><a href="#ArchiveBuilder.add_file-83"><span class="linenos"> 83</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveBuilder.add_file-84"><a href="#ArchiveBuilder.add_file-84"><span class="linenos"> 84</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ArchiveBuilder.add_file-85"><a href="#ArchiveBuilder.add_file-85"><span class="linenos"> 85</span></a><span class="sd">            HashCollisionError:  Hash </span>
</span><span id="ArchiveBuilder.add_file-86"><a href="#ArchiveBuilder.add_file-86"><span class="linenos"> 86</span></a><span class="sd">            UnknownAlgorithmError: </span>
</span><span id="ArchiveBuilder.add_file-87"><a href="#ArchiveBuilder.add_file-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_file-88"><a href="#ArchiveBuilder.add_file-88"><span class="linenos"> 88</span></a>        <span class="c1"># 1. </span>
</span><span id="ArchiveBuilder.add_file-89"><a href="#ArchiveBuilder.add_file-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ArchiveBuilder.add_file-90"><a href="#ArchiveBuilder.add_file-90"><span class="linenos"> 90</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-91"><a href="#ArchiveBuilder.add_file-91"><span class="linenos"> 91</span></a>        
</span><span id="ArchiveBuilder.add_file-92"><a href="#ArchiveBuilder.add_file-92"><span class="linenos"> 92</span></a>        <span class="c1"># 2. </span>
</span><span id="ArchiveBuilder.add_file-93"><a href="#ArchiveBuilder.add_file-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="n">algo_id</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">algo_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-94"><a href="#ArchiveBuilder.add_file-94"><span class="linenos"> 94</span></a>            <span class="k">raise</span> <span class="n">UnknownAlgorithmError</span><span class="p">(</span><span class="n">algo_id</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-95"><a href="#ArchiveBuilder.add_file-95"><span class="linenos"> 95</span></a>        
</span><span id="ArchiveBuilder.add_file-96"><a href="#ArchiveBuilder.add_file-96"><span class="linenos"> 96</span></a>        <span class="c1"># 3. </span>
</span><span id="ArchiveBuilder.add_file-97"><a href="#ArchiveBuilder.add_file-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="n">vfs_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-98"><a href="#ArchiveBuilder.add_file-98"><span class="linenos"> 98</span></a>            <span class="n">vfs_path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-99"><a href="#ArchiveBuilder.add_file-99"><span class="linenos"> 99</span></a>        
</span><span id="ArchiveBuilder.add_file-100"><a href="#ArchiveBuilder.add_file-100"><span class="linenos">100</span></a>        <span class="c1"># 4. </span>
</span><span id="ArchiveBuilder.add_file-101"><a href="#ArchiveBuilder.add_file-101"><span class="linenos">101</span></a>        <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-102"><a href="#ArchiveBuilder.add_file-102"><span class="linenos">102</span></a>        <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-103"><a href="#ArchiveBuilder.add_file-103"><span class="linenos">103</span></a>        
</span><span id="ArchiveBuilder.add_file-104"><a href="#ArchiveBuilder.add_file-104"><span class="linenos">104</span></a>        <span class="c1"># 5.  path_hash </span>
</span><span id="ArchiveBuilder.add_file-105"><a href="#ArchiveBuilder.add_file-105"><span class="linenos">105</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-106"><a href="#ArchiveBuilder.add_file-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-107"><a href="#ArchiveBuilder.add_file-107"><span class="linenos">107</span></a>            <span class="n">existing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ArchiveBuilder.add_file-108"><a href="#ArchiveBuilder.add_file-108"><span class="linenos">108</span></a>            <span class="k">if</span> <span class="n">existing</span> <span class="o">!=</span> <span class="n">normalized</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-109"><a href="#ArchiveBuilder.add_file-109"><span class="linenos">109</span></a>                <span class="k">raise</span> <span class="n">HashCollisionError</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">normalized</span><span class="p">,</span> <span class="n">path_hash</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-110"><a href="#ArchiveBuilder.add_file-110"><span class="linenos">110</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-111"><a href="#ArchiveBuilder.add_file-111"><span class="linenos">111</span></a>                <span class="k">return</span>  <span class="c1"># </span>
</span><span id="ArchiveBuilder.add_file-112"><a href="#ArchiveBuilder.add_file-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ArchiveBuilder.add_file-113"><a href="#ArchiveBuilder.add_file-113"><span class="linenos">113</span></a>        
</span><span id="ArchiveBuilder.add_file-114"><a href="#ArchiveBuilder.add_file-114"><span class="linenos">114</span></a>        <span class="c1"># 6. </span>
</span><span id="ArchiveBuilder.add_file-115"><a href="#ArchiveBuilder.add_file-115"><span class="linenos">115</span></a>        <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-116"><a href="#ArchiveBuilder.add_file-116"><span class="linenos">116</span></a>        
</span><span id="ArchiveBuilder.add_file-117"><a href="#ArchiveBuilder.add_file-117"><span class="linenos">117</span></a>        <span class="c1"># 7. </span>
</span><span id="ArchiveBuilder.add_file-118"><a href="#ArchiveBuilder.add_file-118"><span class="linenos">118</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-119"><a href="#ArchiveBuilder.add_file-119"><span class="linenos">119</span></a>            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="ArchiveBuilder.add_file-120"><a href="#ArchiveBuilder.add_file-120"><span class="linenos">120</span></a>        <span class="n">raw_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-121"><a href="#ArchiveBuilder.add_file-121"><span class="linenos">121</span></a>        
</span><span id="ArchiveBuilder.add_file-122"><a href="#ArchiveBuilder.add_file-122"><span class="linenos">122</span></a>        <span class="c1"># 8.  ()</span>
</span><span id="ArchiveBuilder.add_file-123"><a href="#ArchiveBuilder.add_file-123"><span class="linenos">123</span></a>        <span class="n">checksum</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="ArchiveBuilder.add_file-124"><a href="#ArchiveBuilder.add_file-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-125"><a href="#ArchiveBuilder.add_file-125"><span class="linenos">125</span></a>            <span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-126"><a href="#ArchiveBuilder.add_file-126"><span class="linenos">126</span></a>        
</span><span id="ArchiveBuilder.add_file-127"><a href="#ArchiveBuilder.add_file-127"><span class="linenos">127</span></a>        <span class="c1"># 9. </span>
</span><span id="ArchiveBuilder.add_file-128"><a href="#ArchiveBuilder.add_file-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="n">algo_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-129"><a href="#ArchiveBuilder.add_file-129"><span class="linenos">129</span></a>            <span class="n">hook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">algo_id</span><span class="p">]</span>
</span><span id="ArchiveBuilder.add_file-130"><a href="#ArchiveBuilder.add_file-130"><span class="linenos">130</span></a>            <span class="n">packed_data</span> <span class="o">=</span> <span class="n">hook</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-131"><a href="#ArchiveBuilder.add_file-131"><span class="linenos">131</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="n">ENTRY_FLAG_COMPRESSED</span>
</span><span id="ArchiveBuilder.add_file-132"><a href="#ArchiveBuilder.add_file-132"><span class="linenos">132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_file-133"><a href="#ArchiveBuilder.add_file-133"><span class="linenos">133</span></a>            <span class="n">packed_data</span> <span class="o">=</span> <span class="n">raw_data</span>
</span><span id="ArchiveBuilder.add_file-134"><a href="#ArchiveBuilder.add_file-134"><span class="linenos">134</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder.add_file-135"><a href="#ArchiveBuilder.add_file-135"><span class="linenos">135</span></a>        
</span><span id="ArchiveBuilder.add_file-136"><a href="#ArchiveBuilder.add_file-136"><span class="linenos">136</span></a>        <span class="n">packed_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">packed_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-137"><a href="#ArchiveBuilder.add_file-137"><span class="linenos">137</span></a>        
</span><span id="ArchiveBuilder.add_file-138"><a href="#ArchiveBuilder.add_file-138"><span class="linenos">138</span></a>        <span class="c1"># 10.  (offset )</span>
</span><span id="ArchiveBuilder.add_file-139"><a href="#ArchiveBuilder.add_file-139"><span class="linenos">139</span></a>        <span class="n">blob_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-140"><a href="#ArchiveBuilder.add_file-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packed_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-141"><a href="#ArchiveBuilder.add_file-141"><span class="linenos">141</span></a>        
</span><span id="ArchiveBuilder.add_file-142"><a href="#ArchiveBuilder.add_file-142"><span class="linenos">142</span></a>        <span class="c1"># 11.  Entry (offset  blob_index)</span>
</span><span id="ArchiveBuilder.add_file-143"><a href="#ArchiveBuilder.add_file-143"><span class="linenos">143</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="n">ArchiveEntry</span><span class="p">(</span>
</span><span id="ArchiveBuilder.add_file-144"><a href="#ArchiveBuilder.add_file-144"><span class="linenos">144</span></a>            <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-145"><a href="#ArchiveBuilder.add_file-145"><span class="linenos">145</span></a>            <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-146"><a href="#ArchiveBuilder.add_file-146"><span class="linenos">146</span></a>            <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-147"><a href="#ArchiveBuilder.add_file-147"><span class="linenos">147</span></a>            <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-148"><a href="#ArchiveBuilder.add_file-148"><span class="linenos">148</span></a>            <span class="n">offset</span><span class="o">=</span><span class="n">blob_index</span><span class="p">,</span>  <span class="c1"># build()  offset</span>
</span><span id="ArchiveBuilder.add_file-149"><a href="#ArchiveBuilder.add_file-149"><span class="linenos">149</span></a>            <span class="n">packed_size</span><span class="o">=</span><span class="n">packed_size</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-150"><a href="#ArchiveBuilder.add_file-150"><span class="linenos">150</span></a>            <span class="n">raw_size</span><span class="o">=</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-151"><a href="#ArchiveBuilder.add_file-151"><span class="linenos">151</span></a>            <span class="n">algo_id</span><span class="o">=</span><span class="n">algo_id</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-152"><a href="#ArchiveBuilder.add_file-152"><span class="linenos">152</span></a>            <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_file-153"><a href="#ArchiveBuilder.add_file-153"><span class="linenos">153</span></a>            <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ArchiveBuilder.add_file-154"><a href="#ArchiveBuilder.add_file-154"><span class="linenos">154</span></a>        <span class="p">)</span>
</span><span id="ArchiveBuilder.add_file-155"><a href="#ArchiveBuilder.add_file-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    local_path: 
    vfs_path:  ()
    algo_id:  ID (0=)</p>

<p>Raises:
    FileNotFoundError: 
    HashCollisionError:  Hash 
    UnknownAlgorithmError: </p>
</div>


                            </div>
                            <div id="ArchiveBuilder.add_dir" class="classattr">
                                        <input id="ArchiveBuilder.add_dir-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_dir</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>,</span><span class="param">	<span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ArchiveBuilder.add_dir-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.add_dir"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.add_dir-157"><a href="#ArchiveBuilder.add_dir-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir</span><span class="p">(</span>
</span><span id="ArchiveBuilder.add_dir-158"><a href="#ArchiveBuilder.add_dir-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir-159"><a href="#ArchiveBuilder.add_dir-159"><span class="linenos">159</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir-160"><a href="#ArchiveBuilder.add_dir-160"><span class="linenos">160</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir-161"><a href="#ArchiveBuilder.add_dir-161"><span class="linenos">161</span></a>        <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir-162"><a href="#ArchiveBuilder.add_dir-162"><span class="linenos">162</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ArchiveBuilder.add_dir-163"><a href="#ArchiveBuilder.add_dir-163"><span class="linenos">163</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_dir-164"><a href="#ArchiveBuilder.add_dir-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_dir-165"><a href="#ArchiveBuilder.add_dir-165"><span class="linenos">165</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.add_dir-166"><a href="#ArchiveBuilder.add_dir-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.add_dir-167"><a href="#ArchiveBuilder.add_dir-167"><span class="linenos">167</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder.add_dir-168"><a href="#ArchiveBuilder.add_dir-168"><span class="linenos">168</span></a><span class="sd">            local_dir: </span>
</span><span id="ArchiveBuilder.add_dir-169"><a href="#ArchiveBuilder.add_dir-169"><span class="linenos">169</span></a><span class="sd">            mount_point: </span>
</span><span id="ArchiveBuilder.add_dir-170"><a href="#ArchiveBuilder.add_dir-170"><span class="linenos">170</span></a><span class="sd">            algo_id:  ID</span>
</span><span id="ArchiveBuilder.add_dir-171"><a href="#ArchiveBuilder.add_dir-171"><span class="linenos">171</span></a><span class="sd">            recursive: </span>
</span><span id="ArchiveBuilder.add_dir-172"><a href="#ArchiveBuilder.add_dir-172"><span class="linenos">172</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder.add_dir-173"><a href="#ArchiveBuilder.add_dir-173"><span class="linenos">173</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveBuilder.add_dir-174"><a href="#ArchiveBuilder.add_dir-174"><span class="linenos">174</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder.add_dir-175"><a href="#ArchiveBuilder.add_dir-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_dir-176"><a href="#ArchiveBuilder.add_dir-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ArchiveBuilder.add_dir-177"><a href="#ArchiveBuilder.add_dir-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">local_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-178"><a href="#ArchiveBuilder.add_dir-178"><span class="linenos">178</span></a>        
</span><span id="ArchiveBuilder.add_dir-179"><a href="#ArchiveBuilder.add_dir-179"><span class="linenos">179</span></a>        <span class="n">mount_point</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">mount_point</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-180"><a href="#ArchiveBuilder.add_dir-180"><span class="linenos">180</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder.add_dir-181"><a href="#ArchiveBuilder.add_dir-181"><span class="linenos">181</span></a>        
</span><span id="ArchiveBuilder.add_dir-182"><a href="#ArchiveBuilder.add_dir-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_dir-183"><a href="#ArchiveBuilder.add_dir-183"><span class="linenos">183</span></a>            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ArchiveBuilder.add_dir-184"><a href="#ArchiveBuilder.add_dir-184"><span class="linenos">184</span></a>                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_dir-185"><a href="#ArchiveBuilder.add_dir-185"><span class="linenos">185</span></a>                    <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-186"><a href="#ArchiveBuilder.add_dir-186"><span class="linenos">186</span></a>                    <span class="n">rel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-187"><a href="#ArchiveBuilder.add_dir-187"><span class="linenos">187</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-188"><a href="#ArchiveBuilder.add_dir-188"><span class="linenos">188</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-189"><a href="#ArchiveBuilder.add_dir-189"><span class="linenos">189</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder.add_dir-190"><a href="#ArchiveBuilder.add_dir-190"><span class="linenos">190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_dir-191"><a href="#ArchiveBuilder.add_dir-191"><span class="linenos">191</span></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">local_dir</span><span class="p">):</span>
</span><span id="ArchiveBuilder.add_dir-192"><a href="#ArchiveBuilder.add_dir-192"><span class="linenos">192</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-193"><a href="#ArchiveBuilder.add_dir-193"><span class="linenos">193</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
</span><span id="ArchiveBuilder.add_dir-194"><a href="#ArchiveBuilder.add_dir-194"><span class="linenos">194</span></a>                    <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">mount_point</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
</span><span id="ArchiveBuilder.add_dir-195"><a href="#ArchiveBuilder.add_dir-195"><span class="linenos">195</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_dir-196"><a href="#ArchiveBuilder.add_dir-196"><span class="linenos">196</span></a>                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder.add_dir-197"><a href="#ArchiveBuilder.add_dir-197"><span class="linenos">197</span></a>        
</span><span id="ArchiveBuilder.add_dir-198"><a href="#ArchiveBuilder.add_dir-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="n">count</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    local_dir: 
    mount_point: 
    algo_id:  ID
    recursive: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="ArchiveBuilder.build" class="classattr">
                                        <input id="ArchiveBuilder.build-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ArchiveBuilder.build-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.build"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.build-200"><a href="#ArchiveBuilder.build-200"><span class="linenos">200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveBuilder.build-201"><a href="#ArchiveBuilder.build-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.build-202"><a href="#ArchiveBuilder.build-202"><span class="linenos">202</span></a><span class="sd">         Archive </span>
</span><span id="ArchiveBuilder.build-203"><a href="#ArchiveBuilder.build-203"><span class="linenos">203</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.build-204"><a href="#ArchiveBuilder.build-204"><span class="linenos">204</span></a><span class="sd">        :</span>
</span><span id="ArchiveBuilder.build-205"><a href="#ArchiveBuilder.build-205"><span class="linenos">205</span></a><span class="sd">        1.  FileHeader </span>
</span><span id="ArchiveBuilder.build-206"><a href="#ArchiveBuilder.build-206"><span class="linenos">206</span></a><span class="sd">        2.  IndexHeader + String Tables + Entry Table</span>
</span><span id="ArchiveBuilder.build-207"><a href="#ArchiveBuilder.build-207"><span class="linenos">207</span></a><span class="sd">        3.  DataHeader + Data Block</span>
</span><span id="ArchiveBuilder.build-208"><a href="#ArchiveBuilder.build-208"><span class="linenos">208</span></a><span class="sd">        4.  Headers</span>
</span><span id="ArchiveBuilder.build-209"><a href="#ArchiveBuilder.build-209"><span class="linenos">209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.build-210"><a href="#ArchiveBuilder.build-210"><span class="linenos">210</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_path</span><span class="p">,</span> <span class="s1">&#39;w+b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ArchiveBuilder.build-211"><a href="#ArchiveBuilder.build-211"><span class="linenos">211</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">BinaryWriter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-212"><a href="#ArchiveBuilder.build-212"><span class="linenos">212</span></a>            
</span><span id="ArchiveBuilder.build-213"><a href="#ArchiveBuilder.build-213"><span class="linenos">213</span></a>            <span class="c1"># ========== 1.  FileHeader  ==========</span>
</span><span id="ArchiveBuilder.build-214"><a href="#ArchiveBuilder.build-214"><span class="linenos">214</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-215"><a href="#ArchiveBuilder.build-215"><span class="linenos">215</span></a>            
</span><span id="ArchiveBuilder.build-216"><a href="#ArchiveBuilder.build-216"><span class="linenos">216</span></a>            <span class="c1"># ========== 2.  Index Block ==========</span>
</span><span id="ArchiveBuilder.build-217"><a href="#ArchiveBuilder.build-217"><span class="linenos">217</span></a>            <span class="n">index_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder.build-218"><a href="#ArchiveBuilder.build-218"><span class="linenos">218</span></a>            
</span><span id="ArchiveBuilder.build-219"><a href="#ArchiveBuilder.build-219"><span class="linenos">219</span></a>            <span class="c1"># 2.1  IndexHeader </span>
</span><span id="ArchiveBuilder.build-220"><a href="#ArchiveBuilder.build-220"><span class="linenos">220</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">IndexHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-221"><a href="#ArchiveBuilder.build-221"><span class="linenos">221</span></a>            
</span><span id="ArchiveBuilder.build-222"><a href="#ArchiveBuilder.build-222"><span class="linenos">222</span></a>            <span class="c1"># 2.2  String Tables</span>
</span><span id="ArchiveBuilder.build-223"><a href="#ArchiveBuilder.build-223"><span class="linenos">223</span></a>            <span class="n">string_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder.build-224"><a href="#ArchiveBuilder.build-224"><span class="linenos">224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-225"><a href="#ArchiveBuilder.build-225"><span class="linenos">225</span></a>            <span class="n">string_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">string_start</span>
</span><span id="ArchiveBuilder.build-226"><a href="#ArchiveBuilder.build-226"><span class="linenos">226</span></a>            
</span><span id="ArchiveBuilder.build-227"><a href="#ArchiveBuilder.build-227"><span class="linenos">227</span></a>            <span class="c1"># 2.3 </span>
</span><span id="ArchiveBuilder.build-228"><a href="#ArchiveBuilder.build-228"><span class="linenos">228</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ArchiveBuilder.build-229"><a href="#ArchiveBuilder.build-229"><span class="linenos">229</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-230"><a href="#ArchiveBuilder.build-230"><span class="linenos">230</span></a>                <span class="n">string_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">string_size</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-231"><a href="#ArchiveBuilder.build-231"><span class="linenos">231</span></a>                <span class="n">encrypted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-232"><a href="#ArchiveBuilder.build-232"><span class="linenos">232</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-233"><a href="#ArchiveBuilder.build-233"><span class="linenos">233</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-234"><a href="#ArchiveBuilder.build-234"><span class="linenos">234</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">string_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">))</span>
</span><span id="ArchiveBuilder.build-235"><a href="#ArchiveBuilder.build-235"><span class="linenos">235</span></a>            
</span><span id="ArchiveBuilder.build-236"><a href="#ArchiveBuilder.build-236"><span class="linenos">236</span></a>            <span class="c1"># ========== 3.  Data Block ==========</span>
</span><span id="ArchiveBuilder.build-237"><a href="#ArchiveBuilder.build-237"><span class="linenos">237</span></a>            <span class="c1"># 3.1  DataHeader</span>
</span><span id="ArchiveBuilder.build-238"><a href="#ArchiveBuilder.build-238"><span class="linenos">238</span></a>            <span class="n">data_header_pos</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder.build-239"><a href="#ArchiveBuilder.build-239"><span class="linenos">239</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">DataHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-240"><a href="#ArchiveBuilder.build-240"><span class="linenos">240</span></a>            
</span><span id="ArchiveBuilder.build-241"><a href="#ArchiveBuilder.build-241"><span class="linenos">241</span></a>            <span class="c1"># 3.2  Entry  offset </span>
</span><span id="ArchiveBuilder.build-242"><a href="#ArchiveBuilder.build-242"><span class="linenos">242</span></a>            <span class="n">data_start</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span>
</span><span id="ArchiveBuilder.build-243"><a href="#ArchiveBuilder.build-243"><span class="linenos">243</span></a>            <span class="n">current_offset</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ArchiveBuilder.build-244"><a href="#ArchiveBuilder.build-244"><span class="linenos">244</span></a>            
</span><span id="ArchiveBuilder.build-245"><a href="#ArchiveBuilder.build-245"><span class="linenos">245</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">):</span>
</span><span id="ArchiveBuilder.build-246"><a href="#ArchiveBuilder.build-246"><span class="linenos">246</span></a>                <span class="n">blob_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_blobs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ArchiveBuilder.build-247"><a href="#ArchiveBuilder.build-247"><span class="linenos">247</span></a>                
</span><span id="ArchiveBuilder.build-248"><a href="#ArchiveBuilder.build-248"><span class="linenos">248</span></a>                <span class="c1">#  Entry  offset ( Data Block )</span>
</span><span id="ArchiveBuilder.build-249"><a href="#ArchiveBuilder.build-249"><span class="linenos">249</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">data_start</span> <span class="o">+</span> <span class="n">current_offset</span>
</span><span id="ArchiveBuilder.build-250"><a href="#ArchiveBuilder.build-250"><span class="linenos">250</span></a>                
</span><span id="ArchiveBuilder.build-251"><a href="#ArchiveBuilder.build-251"><span class="linenos">251</span></a>                <span class="c1"># </span>
</span><span id="ArchiveBuilder.build-252"><a href="#ArchiveBuilder.build-252"><span class="linenos">252</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">blob_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-253"><a href="#ArchiveBuilder.build-253"><span class="linenos">253</span></a>                <span class="n">current_offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blob_data</span><span class="p">)</span>
</span><span id="ArchiveBuilder.build-254"><a href="#ArchiveBuilder.build-254"><span class="linenos">254</span></a>            
</span><span id="ArchiveBuilder.build-255"><a href="#ArchiveBuilder.build-255"><span class="linenos">255</span></a>            <span class="n">data_total_size</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">data_start</span>
</span><span id="ArchiveBuilder.build-256"><a href="#ArchiveBuilder.build-256"><span class="linenos">256</span></a>            
</span><span id="ArchiveBuilder.build-257"><a href="#ArchiveBuilder.build-257"><span class="linenos">257</span></a>            <span class="c1"># ========== 4.  Entry Table ( String Tables ) ==========</span>
</span><span id="ArchiveBuilder.build-258"><a href="#ArchiveBuilder.build-258"><span class="linenos">258</span></a>            <span class="c1">#  Entry Table </span>
</span><span id="ArchiveBuilder.build-259"><a href="#ArchiveBuilder.build-259"><span class="linenos">259</span></a>            <span class="n">entry_table_pos</span> <span class="o">=</span> <span class="n">string_start</span> <span class="o">+</span> <span class="n">string_size</span>
</span><span id="ArchiveBuilder.build-260"><a href="#ArchiveBuilder.build-260"><span class="linenos">260</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ArchiveBuilder.build-261"><a href="#ArchiveBuilder.build-261"><span class="linenos">261</span></a>                <span class="c1"># </span>
</span><span id="ArchiveBuilder.build-262"><a href="#ArchiveBuilder.build-262"><span class="linenos">262</span></a>                <span class="k">pass</span>
</span><span id="ArchiveBuilder.build-263"><a href="#ArchiveBuilder.build-263"><span class="linenos">263</span></a>            
</span><span id="ArchiveBuilder.build-264"><a href="#ArchiveBuilder.build-264"><span class="linenos">264</span></a>            <span class="c1">#  Entry Table </span>
</span><span id="ArchiveBuilder.build-265"><a href="#ArchiveBuilder.build-265"><span class="linenos">265</span></a>            <span class="n">writer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">data_header_pos</span><span class="p">)</span>  <span class="c1"># </span>
</span><span id="ArchiveBuilder.build-266"><a href="#ArchiveBuilder.build-266"><span class="linenos">266</span></a>            
</span><span id="ArchiveBuilder.build-267"><a href="#ArchiveBuilder.build-267"><span class="linenos">267</span></a>            <span class="c1"># </span>
</span><span id="ArchiveBuilder.build-268"><a href="#ArchiveBuilder.build-268"><span class="linenos">268</span></a>            <span class="c1">#  Entry  offset  Data </span>
</span><span id="ArchiveBuilder.build-269"><a href="#ArchiveBuilder.build-269"><span class="linenos">269</span></a>            <span class="c1"># </span>
</span><span id="ArchiveBuilder.build-270"><a href="#ArchiveBuilder.build-270"><span class="linenos">270</span></a>            
</span><span id="ArchiveBuilder.build-271"><a href="#ArchiveBuilder.build-271"><span class="linenos">271</span></a>        <span class="c1"># =====  =====</span>
</span><span id="ArchiveBuilder.build-272"><a href="#ArchiveBuilder.build-272"><span class="linenos">272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build_two_phase</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p> Archive </p>

<p>:</p>

<ol>
<li> FileHeader </li>
<li> IndexHeader + String Tables + Entry Table</li>
<li> DataHeader + Data Block</li>
<li> Headers</li>
</ol>
</div>


                            </div>
                            <div id="ArchiveBuilder.entry_count" class="classattr">
                                        <input id="ArchiveBuilder.entry_count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">entry_count</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ArchiveBuilder.entry_count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.entry_count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.entry_count-369"><a href="#ArchiveBuilder.entry_count-369"><span class="linenos">369</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveBuilder.entry_count-370"><a href="#ArchiveBuilder.entry_count-370"><span class="linenos">370</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ArchiveBuilder.entry_count-371"><a href="#ArchiveBuilder.entry_count-371"><span class="linenos">371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.entry_count-372"><a href="#ArchiveBuilder.entry_count-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ArchiveBuilder.path_stats" class="classattr">
                                        <input id="ArchiveBuilder.path_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">path_stats</span><span class="annotation">: dict</span>

                <label class="view-source-button" for="ArchiveBuilder.path_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.path_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.path_stats-374"><a href="#ArchiveBuilder.path_stats-374"><span class="linenos">374</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveBuilder.path_stats-375"><a href="#ArchiveBuilder.path_stats-375"><span class="linenos">375</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">path_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ArchiveBuilder.path_stats-376"><a href="#ArchiveBuilder.path_stats-376"><span class="linenos">376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.path_stats-377"><a href="#ArchiveBuilder.path_stats-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ArchiveBuilder.compression_stats" class="classattr">
                                        <input id="ArchiveBuilder.compression_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">compression_stats</span><span class="annotation">: dict</span>

                <label class="view-source-button" for="ArchiveBuilder.compression_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.compression_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.compression_stats-379"><a href="#ArchiveBuilder.compression_stats-379"><span class="linenos">379</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveBuilder.compression_stats-380"><a href="#ArchiveBuilder.compression_stats-380"><span class="linenos">380</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compression_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ArchiveBuilder.compression_stats-381"><a href="#ArchiveBuilder.compression_stats-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.compression_stats-382"><a href="#ArchiveBuilder.compression_stats-382"><span class="linenos">382</span></a>        <span class="n">total_raw</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">raw_size</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveBuilder.compression_stats-383"><a href="#ArchiveBuilder.compression_stats-383"><span class="linenos">383</span></a>        <span class="n">total_packed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">packed_size</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveBuilder.compression_stats-384"><a href="#ArchiveBuilder.compression_stats-384"><span class="linenos">384</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ArchiveBuilder.compression_stats-385"><a href="#ArchiveBuilder.compression_stats-385"><span class="linenos">385</span></a>            <span class="s1">&#39;total_raw&#39;</span><span class="p">:</span> <span class="n">total_raw</span><span class="p">,</span>
</span><span id="ArchiveBuilder.compression_stats-386"><a href="#ArchiveBuilder.compression_stats-386"><span class="linenos">386</span></a>            <span class="s1">&#39;total_packed&#39;</span><span class="p">:</span> <span class="n">total_packed</span><span class="p">,</span>
</span><span id="ArchiveBuilder.compression_stats-387"><a href="#ArchiveBuilder.compression_stats-387"><span class="linenos">387</span></a>            <span class="s1">&#39;ratio&#39;</span><span class="p">:</span> <span class="n">total_packed</span> <span class="o">/</span> <span class="n">total_raw</span> <span class="k">if</span> <span class="n">total_raw</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="ArchiveBuilder.compression_stats-388"><a href="#ArchiveBuilder.compression_stats-388"><span class="linenos">388</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ArchiveBuilder.add_files_batch" class="classattr">
                                        <input id="ArchiveBuilder.add_files_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_files_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">items</span><span class="p">:</span> <span class="s1">&#39;List[FileItem] | Iterator[FileItem]&#39;</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">)],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ArchiveBuilder.add_files_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.add_files_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.add_files_batch-392"><a href="#ArchiveBuilder.add_files_batch-392"><span class="linenos">392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_files_batch</span><span class="p">(</span>
</span><span id="ArchiveBuilder.add_files_batch-393"><a href="#ArchiveBuilder.add_files_batch-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_files_batch-394"><a href="#ArchiveBuilder.add_files_batch-394"><span class="linenos">394</span></a>        <span class="n">items</span><span class="p">:</span> <span class="s1">&#39;List[FileItem] | Iterator[FileItem]&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_files_batch-395"><a href="#ArchiveBuilder.add_files_batch-395"><span class="linenos">395</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_files_batch-396"><a href="#ArchiveBuilder.add_files_batch-396"><span class="linenos">396</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveBuilder.add_files_batch-397"><a href="#ArchiveBuilder.add_files_batch-397"><span class="linenos">397</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_files_batch-398"><a href="#ArchiveBuilder.add_files_batch-398"><span class="linenos">398</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_files_batch-399"><a href="#ArchiveBuilder.add_files_batch-399"><span class="linenos">399</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.add_files_batch-400"><a href="#ArchiveBuilder.add_files_batch-400"><span class="linenos">400</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.add_files_batch-401"><a href="#ArchiveBuilder.add_files_batch-401"><span class="linenos">401</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder.add_files_batch-402"><a href="#ArchiveBuilder.add_files_batch-402"><span class="linenos">402</span></a><span class="sd">            items: FileItem </span>
</span><span id="ArchiveBuilder.add_files_batch-403"><a href="#ArchiveBuilder.add_files_batch-403"><span class="linenos">403</span></a><span class="sd">            on_error:  (&#39;raise&#39;, &#39;skip&#39;, &#39;abort&#39;)</span>
</span><span id="ArchiveBuilder.add_files_batch-404"><a href="#ArchiveBuilder.add_files_batch-404"><span class="linenos">404</span></a><span class="sd">            progress_callback: </span>
</span><span id="ArchiveBuilder.add_files_batch-405"><a href="#ArchiveBuilder.add_files_batch-405"><span class="linenos">405</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder.add_files_batch-406"><a href="#ArchiveBuilder.add_files_batch-406"><span class="linenos">406</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveBuilder.add_files_batch-407"><a href="#ArchiveBuilder.add_files_batch-407"><span class="linenos">407</span></a><span class="sd">            BatchResult </span>
</span><span id="ArchiveBuilder.add_files_batch-408"><a href="#ArchiveBuilder.add_files_batch-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_files_batch-409"><a href="#ArchiveBuilder.add_files_batch-409"><span class="linenos">409</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="ArchiveBuilder.add_files_batch-410"><a href="#ArchiveBuilder.add_files_batch-410"><span class="linenos">410</span></a>            <span class="n">FileItem</span><span class="p">,</span> <span class="n">ProgressInfo</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_files_batch-411"><a href="#ArchiveBuilder.add_files_batch-411"><span class="linenos">411</span></a>            <span class="n">ErrorPolicy</span><span class="p">,</span> <span class="n">estimate_total_bytes</span>
</span><span id="ArchiveBuilder.add_files_batch-412"><a href="#ArchiveBuilder.add_files_batch-412"><span class="linenos">412</span></a>        <span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-413"><a href="#ArchiveBuilder.add_files_batch-413"><span class="linenos">413</span></a>        
</span><span id="ArchiveBuilder.add_files_batch-414"><a href="#ArchiveBuilder.add_files_batch-414"><span class="linenos">414</span></a>        <span class="c1">#  ()</span>
</span><span id="ArchiveBuilder.add_files_batch-415"><a href="#ArchiveBuilder.add_files_batch-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ArchiveBuilder.add_files_batch-416"><a href="#ArchiveBuilder.add_files_batch-416"><span class="linenos">416</span></a>            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-417"><a href="#ArchiveBuilder.add_files_batch-417"><span class="linenos">417</span></a>        
</span><span id="ArchiveBuilder.add_files_batch-418"><a href="#ArchiveBuilder.add_files_batch-418"><span class="linenos">418</span></a>        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-419"><a href="#ArchiveBuilder.add_files_batch-419"><span class="linenos">419</span></a>        <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">estimate_total_bytes</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-420"><a href="#ArchiveBuilder.add_files_batch-420"><span class="linenos">420</span></a>        
</span><span id="ArchiveBuilder.add_files_batch-421"><a href="#ArchiveBuilder.add_files_batch-421"><span class="linenos">421</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ArchiveBuilder.add_files_batch-422"><a href="#ArchiveBuilder.add_files_batch-422"><span class="linenos">422</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="n">total_files</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_files_batch-423"><a href="#ArchiveBuilder.add_files_batch-423"><span class="linenos">423</span></a>            <span class="n">total_bytes</span><span class="o">=</span><span class="n">total_bytes</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_files_batch-424"><a href="#ArchiveBuilder.add_files_batch-424"><span class="linenos">424</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ArchiveBuilder.add_files_batch-425"><a href="#ArchiveBuilder.add_files_batch-425"><span class="linenos">425</span></a>        <span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-426"><a href="#ArchiveBuilder.add_files_batch-426"><span class="linenos">426</span></a>        
</span><span id="ArchiveBuilder.add_files_batch-427"><a href="#ArchiveBuilder.add_files_batch-427"><span class="linenos">427</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ArchiveBuilder.add_files_batch-428"><a href="#ArchiveBuilder.add_files_batch-428"><span class="linenos">428</span></a>        
</span><span id="ArchiveBuilder.add_files_batch-429"><a href="#ArchiveBuilder.add_files_batch-429"><span class="linenos">429</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_files_batch-430"><a href="#ArchiveBuilder.add_files_batch-430"><span class="linenos">430</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_files_batch-431"><a href="#ArchiveBuilder.add_files_batch-431"><span class="linenos">431</span></a>                <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-432"><a href="#ArchiveBuilder.add_files_batch-432"><span class="linenos">432</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">algo_id</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-433"><a href="#ArchiveBuilder.add_files_batch-433"><span class="linenos">433</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder.add_files_batch-434"><a href="#ArchiveBuilder.add_files_batch-434"><span class="linenos">434</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">file_size</span>
</span><span id="ArchiveBuilder.add_files_batch-435"><a href="#ArchiveBuilder.add_files_batch-435"><span class="linenos">435</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">file_size</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-436"><a href="#ArchiveBuilder.add_files_batch-436"><span class="linenos">436</span></a>                
</span><span id="ArchiveBuilder.add_files_batch-437"><a href="#ArchiveBuilder.add_files_batch-437"><span class="linenos">437</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_files_batch-438"><a href="#ArchiveBuilder.add_files_batch-438"><span class="linenos">438</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_files_batch-439"><a href="#ArchiveBuilder.add_files_batch-439"><span class="linenos">439</span></a>                    <span class="k">raise</span>
</span><span id="ArchiveBuilder.add_files_batch-440"><a href="#ArchiveBuilder.add_files_batch-440"><span class="linenos">440</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_files_batch-441"><a href="#ArchiveBuilder.add_files_batch-441"><span class="linenos">441</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder.add_files_batch-442"><a href="#ArchiveBuilder.add_files_batch-442"><span class="linenos">442</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveBuilder.add_files_batch-443"><a href="#ArchiveBuilder.add_files_batch-443"><span class="linenos">443</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ArchiveBuilder.add_files_batch-444"><a href="#ArchiveBuilder.add_files_batch-444"><span class="linenos">444</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;abort&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_files_batch-445"><a href="#ArchiveBuilder.add_files_batch-445"><span class="linenos">445</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveBuilder.add_files_batch-446"><a href="#ArchiveBuilder.add_files_batch-446"><span class="linenos">446</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveBuilder.add_files_batch-447"><a href="#ArchiveBuilder.add_files_batch-447"><span class="linenos">447</span></a>                    <span class="k">break</span>
</span><span id="ArchiveBuilder.add_files_batch-448"><a href="#ArchiveBuilder.add_files_batch-448"><span class="linenos">448</span></a>        
</span><span id="ArchiveBuilder.add_files_batch-449"><a href="#ArchiveBuilder.add_files_batch-449"><span class="linenos">449</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ArchiveBuilder.add_files_batch-450"><a href="#ArchiveBuilder.add_files_batch-450"><span class="linenos">450</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    items: FileItem 
    on_error:  ('raise', 'skip', 'abort')
    progress_callback: </p>

<p>Returns:
    BatchResult </p>
</div>


                            </div>
                            <div id="ArchiveBuilder.add_dir_batch" class="classattr">
                                        <input id="ArchiveBuilder.add_dir_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_dir_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>,</span><span class="param">	<span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">)],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ArchiveBuilder.add_dir_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveBuilder.add_dir_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveBuilder.add_dir_batch-452"><a href="#ArchiveBuilder.add_dir_batch-452"><span class="linenos">452</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_dir_batch</span><span class="p">(</span>
</span><span id="ArchiveBuilder.add_dir_batch-453"><a href="#ArchiveBuilder.add_dir_batch-453"><span class="linenos">453</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir_batch-454"><a href="#ArchiveBuilder.add_dir_batch-454"><span class="linenos">454</span></a>        <span class="n">local_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir_batch-455"><a href="#ArchiveBuilder.add_dir_batch-455"><span class="linenos">455</span></a>        <span class="n">mount_point</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir_batch-456"><a href="#ArchiveBuilder.add_dir_batch-456"><span class="linenos">456</span></a>        <span class="n">algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir_batch-457"><a href="#ArchiveBuilder.add_dir_batch-457"><span class="linenos">457</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir_batch-458"><a href="#ArchiveBuilder.add_dir_batch-458"><span class="linenos">458</span></a>        <span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir_batch-459"><a href="#ArchiveBuilder.add_dir_batch-459"><span class="linenos">459</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ArchiveBuilder.add_dir_batch-460"><a href="#ArchiveBuilder.add_dir_batch-460"><span class="linenos">460</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s1">&#39;ProgressInfo&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveBuilder.add_dir_batch-461"><a href="#ArchiveBuilder.add_dir_batch-461"><span class="linenos">461</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ArchiveBuilder.add_dir_batch-462"><a href="#ArchiveBuilder.add_dir_batch-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_dir_batch-463"><a href="#ArchiveBuilder.add_dir_batch-463"><span class="linenos">463</span></a><span class="sd">         ()</span>
</span><span id="ArchiveBuilder.add_dir_batch-464"><a href="#ArchiveBuilder.add_dir_batch-464"><span class="linenos">464</span></a><span class="sd">        </span>
</span><span id="ArchiveBuilder.add_dir_batch-465"><a href="#ArchiveBuilder.add_dir_batch-465"><span class="linenos">465</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveBuilder.add_dir_batch-466"><a href="#ArchiveBuilder.add_dir_batch-466"><span class="linenos">466</span></a><span class="sd">            local_dir: </span>
</span><span id="ArchiveBuilder.add_dir_batch-467"><a href="#ArchiveBuilder.add_dir_batch-467"><span class="linenos">467</span></a><span class="sd">            mount_point: </span>
</span><span id="ArchiveBuilder.add_dir_batch-468"><a href="#ArchiveBuilder.add_dir_batch-468"><span class="linenos">468</span></a><span class="sd">            algo_id:  ID</span>
</span><span id="ArchiveBuilder.add_dir_batch-469"><a href="#ArchiveBuilder.add_dir_batch-469"><span class="linenos">469</span></a><span class="sd">            recursive: </span>
</span><span id="ArchiveBuilder.add_dir_batch-470"><a href="#ArchiveBuilder.add_dir_batch-470"><span class="linenos">470</span></a><span class="sd">            exclude_patterns: </span>
</span><span id="ArchiveBuilder.add_dir_batch-471"><a href="#ArchiveBuilder.add_dir_batch-471"><span class="linenos">471</span></a><span class="sd">            on_error: </span>
</span><span id="ArchiveBuilder.add_dir_batch-472"><a href="#ArchiveBuilder.add_dir_batch-472"><span class="linenos">472</span></a><span class="sd">            progress_callback: </span>
</span><span id="ArchiveBuilder.add_dir_batch-473"><a href="#ArchiveBuilder.add_dir_batch-473"><span class="linenos">473</span></a><span class="sd">            </span>
</span><span id="ArchiveBuilder.add_dir_batch-474"><a href="#ArchiveBuilder.add_dir_batch-474"><span class="linenos">474</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveBuilder.add_dir_batch-475"><a href="#ArchiveBuilder.add_dir_batch-475"><span class="linenos">475</span></a><span class="sd">            BatchResult </span>
</span><span id="ArchiveBuilder.add_dir_batch-476"><a href="#ArchiveBuilder.add_dir_batch-476"><span class="linenos">476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveBuilder.add_dir_batch-477"><a href="#ArchiveBuilder.add_dir_batch-477"><span class="linenos">477</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">scan_directory</span>
</span><span id="ArchiveBuilder.add_dir_batch-478"><a href="#ArchiveBuilder.add_dir_batch-478"><span class="linenos">478</span></a>        
</span><span id="ArchiveBuilder.add_dir_batch-479"><a href="#ArchiveBuilder.add_dir_batch-479"><span class="linenos">479</span></a>        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scan_directory</span><span class="p">(</span>
</span><span id="ArchiveBuilder.add_dir_batch-480"><a href="#ArchiveBuilder.add_dir_batch-480"><span class="linenos">480</span></a>            <span class="n">local_dir</span><span class="p">,</span> <span class="n">mount_point</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">algo_id</span><span class="p">,</span> <span class="n">exclude_patterns</span>
</span><span id="ArchiveBuilder.add_dir_batch-481"><a href="#ArchiveBuilder.add_dir_batch-481"><span class="linenos">481</span></a>        <span class="p">))</span>
</span><span id="ArchiveBuilder.add_dir_batch-482"><a href="#ArchiveBuilder.add_dir_batch-482"><span class="linenos">482</span></a>        
</span><span id="ArchiveBuilder.add_dir_batch-483"><a href="#ArchiveBuilder.add_dir_batch-483"><span class="linenos">483</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_files_batch</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">on_error</span><span class="p">,</span> <span class="n">progress_callback</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> ()</p>

<p>Args:
    local_dir: 
    mount_point: 
    algo_id:  ID
    recursive: 
    exclude_patterns: 
    on_error: 
    progress_callback: </p>

<p>Returns:
    BatchResult </p>
</div>


                            </div>
                </section>
                <section id="ArchiveReader">
                            <input id="ArchiveReader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ArchiveReader</span>:

                <label class="view-source-button" for="ArchiveReader-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader-32"><a href="#ArchiveReader-32"><span class="linenos"> 32</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ArchiveReader</span><span class="p">:</span>
</span><span id="ArchiveReader-33"><a href="#ArchiveReader-33"><span class="linenos"> 33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-34"><a href="#ArchiveReader-34"><span class="linenos"> 34</span></a><span class="sd">    Archive </span>
</span><span id="ArchiveReader-35"><a href="#ArchiveReader-35"><span class="linenos"> 35</span></a><span class="sd">    </span>
</span><span id="ArchiveReader-36"><a href="#ArchiveReader-36"><span class="linenos"> 36</span></a><span class="sd">    :</span>
</span><span id="ArchiveReader-37"><a href="#ArchiveReader-37"><span class="linenos"> 37</span></a><span class="sd">    - mmap  (): </span>
</span><span id="ArchiveReader-38"><a href="#ArchiveReader-38"><span class="linenos"> 38</span></a><span class="sd">    - :  I/O</span>
</span><span id="ArchiveReader-39"><a href="#ArchiveReader-39"><span class="linenos"> 39</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-40"><a href="#ArchiveReader-40"><span class="linenos"> 40</span></a>    
</span><span id="ArchiveReader-41"><a href="#ArchiveReader-41"><span class="linenos"> 41</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArchiveReader-42"><a href="#ArchiveReader-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveReader-43"><a href="#ArchiveReader-43"><span class="linenos"> 43</span></a>        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveReader-44"><a href="#ArchiveReader-44"><span class="linenos"> 44</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader-45"><a href="#ArchiveReader-45"><span class="linenos"> 45</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader-46"><a href="#ArchiveReader-46"><span class="linenos"> 46</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader-47"><a href="#ArchiveReader-47"><span class="linenos"> 47</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader-48"><a href="#ArchiveReader-48"><span class="linenos"> 48</span></a>        <span class="n">use_mmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ArchiveReader-49"><a href="#ArchiveReader-49"><span class="linenos"> 49</span></a>    <span class="p">):</span>
</span><span id="ArchiveReader-50"><a href="#ArchiveReader-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-51"><a href="#ArchiveReader-51"><span class="linenos"> 51</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-52"><a href="#ArchiveReader-52"><span class="linenos"> 52</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-53"><a href="#ArchiveReader-53"><span class="linenos"> 53</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader-54"><a href="#ArchiveReader-54"><span class="linenos"> 54</span></a><span class="sd">            file_path: Archive </span>
</span><span id="ArchiveReader-55"><a href="#ArchiveReader-55"><span class="linenos"> 55</span></a><span class="sd">            compression_hooks: </span>
</span><span id="ArchiveReader-56"><a href="#ArchiveReader-56"><span class="linenos"> 56</span></a><span class="sd">            checksum_hook: </span>
</span><span id="ArchiveReader-57"><a href="#ArchiveReader-57"><span class="linenos"> 57</span></a><span class="sd">            index_crypto: </span>
</span><span id="ArchiveReader-58"><a href="#ArchiveReader-58"><span class="linenos"> 58</span></a><span class="sd">            path_hash_func:  Hash </span>
</span><span id="ArchiveReader-59"><a href="#ArchiveReader-59"><span class="linenos"> 59</span></a><span class="sd">            use_mmap:  mmap </span>
</span><span id="ArchiveReader-60"><a href="#ArchiveReader-60"><span class="linenos"> 60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-61"><a href="#ArchiveReader-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
</span><span id="ArchiveReader-62"><a href="#ArchiveReader-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ArchiveReader-63"><a href="#ArchiveReader-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ArchiveReader-64"><a href="#ArchiveReader-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ArchiveReader-65"><a href="#ArchiveReader-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_use_mmap</span> <span class="o">=</span> <span class="n">use_mmap</span>
</span><span id="ArchiveReader-66"><a href="#ArchiveReader-66"><span class="linenos"> 66</span></a>        
</span><span id="ArchiveReader-67"><a href="#ArchiveReader-67"><span class="linenos"> 67</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader-68"><a href="#ArchiveReader-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">CompressionHook</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ArchiveReader-69"><a href="#ArchiveReader-69"><span class="linenos"> 69</span></a>        <span class="k">if</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveReader-70"><a href="#ArchiveReader-70"><span class="linenos"> 70</span></a>            <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveReader-71"><a href="#ArchiveReader-71"><span class="linenos"> 71</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">hook</span><span class="o">.</span><span class="n">algo_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">hook</span>
</span><span id="ArchiveReader-72"><a href="#ArchiveReader-72"><span class="linenos"> 72</span></a>        
</span><span id="ArchiveReader-73"><a href="#ArchiveReader-73"><span class="linenos"> 73</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader-74"><a href="#ArchiveReader-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BinaryIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-75"><a href="#ArchiveReader-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">mmap</span><span class="o">.</span><span class="n">mmap</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-76"><a href="#ArchiveReader-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-77"><a href="#ArchiveReader-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-78"><a href="#ArchiveReader-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-79"><a href="#ArchiveReader-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathDictionary</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-80"><a href="#ArchiveReader-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ArchiveEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># path_hash -&gt; Entry</span>
</span><span id="ArchiveReader-81"><a href="#ArchiveReader-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ArchiveReader-82"><a href="#ArchiveReader-82"><span class="linenos"> 82</span></a>        
</span><span id="ArchiveReader-83"><a href="#ArchiveReader-83"><span class="linenos"> 83</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader-84"><a href="#ArchiveReader-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>
</span><span id="ArchiveReader-85"><a href="#ArchiveReader-85"><span class="linenos"> 85</span></a>    
</span><span id="ArchiveReader-86"><a href="#ArchiveReader-86"><span class="linenos"> 86</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveReader-87"><a href="#ArchiveReader-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-88"><a href="#ArchiveReader-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="ArchiveReader-89"><a href="#ArchiveReader-89"><span class="linenos"> 89</span></a>        
</span><span id="ArchiveReader-90"><a href="#ArchiveReader-90"><span class="linenos"> 90</span></a>        <span class="c1">#  mmap</span>
</span><span id="ArchiveReader-91"><a href="#ArchiveReader-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_mmap</span><span class="p">:</span>
</span><span id="ArchiveReader-92"><a href="#ArchiveReader-92"><span class="linenos"> 92</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ArchiveReader-93"><a href="#ArchiveReader-93"><span class="linenos"> 93</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span> <span class="o">=</span> <span class="n">mmap</span><span class="o">.</span><span class="n">mmap</span><span class="p">(</span>
</span><span id="ArchiveReader-94"><a href="#ArchiveReader-94"><span class="linenos"> 94</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
</span><span id="ArchiveReader-95"><a href="#ArchiveReader-95"><span class="linenos"> 95</span></a>                    <span class="mi">0</span><span class="p">,</span>  <span class="c1"># </span>
</span><span id="ArchiveReader-96"><a href="#ArchiveReader-96"><span class="linenos"> 96</span></a>                    <span class="n">access</span><span class="o">=</span><span class="n">mmap</span><span class="o">.</span><span class="n">ACCESS_READ</span>
</span><span id="ArchiveReader-97"><a href="#ArchiveReader-97"><span class="linenos"> 97</span></a>                <span class="p">)</span>
</span><span id="ArchiveReader-98"><a href="#ArchiveReader-98"><span class="linenos"> 98</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="ArchiveReader-99"><a href="#ArchiveReader-99"><span class="linenos"> 99</span></a>                <span class="c1"># mmap </span>
</span><span id="ArchiveReader-100"><a href="#ArchiveReader-100"><span class="linenos">100</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_use_mmap</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ArchiveReader-101"><a href="#ArchiveReader-101"><span class="linenos">101</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-102"><a href="#ArchiveReader-102"><span class="linenos">102</span></a>        
</span><span id="ArchiveReader-103"><a href="#ArchiveReader-103"><span class="linenos">103</span></a>        <span class="n">reader</span> <span class="o">=</span> <span class="n">BinaryReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
</span><span id="ArchiveReader-104"><a href="#ArchiveReader-104"><span class="linenos">104</span></a>        
</span><span id="ArchiveReader-105"><a href="#ArchiveReader-105"><span class="linenos">105</span></a>        <span class="c1"># ========== 1.  FileHeader ==========</span>
</span><span id="ArchiveReader-106"><a href="#ArchiveReader-106"><span class="linenos">106</span></a>        <span class="n">header_data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveReader-107"><a href="#ArchiveReader-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">header_data</span><span class="p">)</span>
</span><span id="ArchiveReader-108"><a href="#ArchiveReader-108"><span class="linenos">108</span></a>        
</span><span id="ArchiveReader-109"><a href="#ArchiveReader-109"><span class="linenos">109</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader-110"><a href="#ArchiveReader-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">MODE_ARCHIVE</span><span class="p">:</span>
</span><span id="ArchiveReader-111"><a href="#ArchiveReader-111"><span class="linenos">111</span></a>            <span class="k">raise</span> <span class="n">InvalidFormatError</span><span class="p">(</span>
</span><span id="ArchiveReader-112"><a href="#ArchiveReader-112"><span class="linenos">112</span></a>                <span class="s2">&quot; Archive &quot;</span><span class="p">,</span>
</span><span id="ArchiveReader-113"><a href="#ArchiveReader-113"><span class="linenos">113</span></a>                <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;MODE_ARCHIVE (0x02)&quot;</span><span class="p">,</span>
</span><span id="ArchiveReader-114"><a href="#ArchiveReader-114"><span class="linenos">114</span></a>                <span class="n">actual</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;0x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">mode</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ArchiveReader-115"><a href="#ArchiveReader-115"><span class="linenos">115</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader-116"><a href="#ArchiveReader-116"><span class="linenos">116</span></a>        
</span><span id="ArchiveReader-117"><a href="#ArchiveReader-117"><span class="linenos">117</span></a>        <span class="c1"># ========== 2.  IndexHeader ==========</span>
</span><span id="ArchiveReader-118"><a href="#ArchiveReader-118"><span class="linenos">118</span></a>        <span class="n">index_header_data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">IndexHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveReader-119"><a href="#ArchiveReader-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span> <span class="o">=</span> <span class="n">IndexHeader</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">index_header_data</span><span class="p">)</span>
</span><span id="ArchiveReader-120"><a href="#ArchiveReader-120"><span class="linenos">120</span></a>        
</span><span id="ArchiveReader-121"><a href="#ArchiveReader-121"><span class="linenos">121</span></a>        <span class="c1"># ========== 3.  String Tables ==========</span>
</span><span id="ArchiveReader-122"><a href="#ArchiveReader-122"><span class="linenos">122</span></a>        <span class="n">string_data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">string_table_size</span><span class="p">)</span>
</span><span id="ArchiveReader-123"><a href="#ArchiveReader-123"><span class="linenos">123</span></a>        
</span><span id="ArchiveReader-124"><a href="#ArchiveReader-124"><span class="linenos">124</span></a>        <span class="c1"># flags  (/)</span>
</span><span id="ArchiveReader-125"><a href="#ArchiveReader-125"><span class="linenos">125</span></a>        <span class="n">needs_processing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">flags</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ArchiveReader-126"><a href="#ArchiveReader-126"><span class="linenos">126</span></a>        
</span><span id="ArchiveReader-127"><a href="#ArchiveReader-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="n">needs_processing</span><span class="p">:</span>
</span><span id="ArchiveReader-128"><a href="#ArchiveReader-128"><span class="linenos">128</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="p">:</span>
</span><span id="ArchiveReader-129"><a href="#ArchiveReader-129"><span class="linenos">129</span></a>                <span class="n">string_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">string_data</span><span class="p">)</span>
</span><span id="ArchiveReader-130"><a href="#ArchiveReader-130"><span class="linenos">130</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ArchiveReader-131"><a href="#ArchiveReader-131"><span class="linenos">131</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveReader-132"><a href="#ArchiveReader-132"><span class="linenos">132</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ArchiveReader-133"><a href="#ArchiveReader-133"><span class="linenos">133</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveReader-134"><a href="#ArchiveReader-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ArchiveReader-135"><a href="#ArchiveReader-135"><span class="linenos">135</span></a>        
</span><span id="ArchiveReader-136"><a href="#ArchiveReader-136"><span class="linenos">136</span></a>        <span class="c1">#  ()</span>
</span><span id="ArchiveReader-137"><a href="#ArchiveReader-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader-138"><a href="#ArchiveReader-138"><span class="linenos">138</span></a>            <span class="n">string_reader</span> <span class="o">=</span> <span class="n">BinaryReader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">string_data</span><span class="p">))</span>
</span><span id="ArchiveReader-139"><a href="#ArchiveReader-139"><span class="linenos">139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span> <span class="o">=</span> <span class="n">PathDictionary</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
</span><span id="ArchiveReader-140"><a href="#ArchiveReader-140"><span class="linenos">140</span></a>                <span class="n">string_reader</span><span class="p">,</span>
</span><span id="ArchiveReader-141"><a href="#ArchiveReader-141"><span class="linenos">141</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">dir_count</span><span class="p">,</span>
</span><span id="ArchiveReader-142"><a href="#ArchiveReader-142"><span class="linenos">142</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">name_count</span><span class="p">,</span>
</span><span id="ArchiveReader-143"><a href="#ArchiveReader-143"><span class="linenos">143</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">ext_count</span>
</span><span id="ArchiveReader-144"><a href="#ArchiveReader-144"><span class="linenos">144</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader-145"><a href="#ArchiveReader-145"><span class="linenos">145</span></a>        
</span><span id="ArchiveReader-146"><a href="#ArchiveReader-146"><span class="linenos">146</span></a>        <span class="c1"># ========== 4.  Entry Table ==========</span>
</span><span id="ArchiveReader-147"><a href="#ArchiveReader-147"><span class="linenos">147</span></a>        <span class="n">checksum_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="o">.</span><span class="n">checksum_size</span>
</span><span id="ArchiveReader-148"><a href="#ArchiveReader-148"><span class="linenos">148</span></a>        <span class="n">entry_size</span> <span class="o">=</span> <span class="n">ArchiveEntry</span><span class="o">.</span><span class="n">entry_size</span><span class="p">(</span><span class="n">checksum_size</span><span class="p">)</span>
</span><span id="ArchiveReader-149"><a href="#ArchiveReader-149"><span class="linenos">149</span></a>        
</span><span id="ArchiveReader-150"><a href="#ArchiveReader-150"><span class="linenos">150</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="o">.</span><span class="n">entry_count</span><span class="p">):</span>
</span><span id="ArchiveReader-151"><a href="#ArchiveReader-151"><span class="linenos">151</span></a>            <span class="n">entry_data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">entry_size</span><span class="p">)</span>
</span><span id="ArchiveReader-152"><a href="#ArchiveReader-152"><span class="linenos">152</span></a>            <span class="n">entry</span> <span class="o">=</span> <span class="n">ArchiveEntry</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">entry_data</span><span class="p">,</span> <span class="n">checksum_size</span><span class="p">)</span>
</span><span id="ArchiveReader-153"><a href="#ArchiveReader-153"><span class="linenos">153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
</span><span id="ArchiveReader-154"><a href="#ArchiveReader-154"><span class="linenos">154</span></a>        
</span><span id="ArchiveReader-155"><a href="#ArchiveReader-155"><span class="linenos">155</span></a>        <span class="c1"># ========== 5.  DataHeader ==========</span>
</span><span id="ArchiveReader-156"><a href="#ArchiveReader-156"><span class="linenos">156</span></a>        <span class="n">data_header_data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">DataHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">)</span>
</span><span id="ArchiveReader-157"><a href="#ArchiveReader-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span> <span class="o">=</span> <span class="n">DataHeader</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data_header_data</span><span class="p">)</span>
</span><span id="ArchiveReader-158"><a href="#ArchiveReader-158"><span class="linenos">158</span></a>        
</span><span id="ArchiveReader-159"><a href="#ArchiveReader-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span><span class="o">.</span><span class="n">magic</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;DATA&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-160"><a href="#ArchiveReader-160"><span class="linenos">160</span></a>            <span class="k">raise</span> <span class="n">InvalidFormatError</span><span class="p">(</span>
</span><span id="ArchiveReader-161"><a href="#ArchiveReader-161"><span class="linenos">161</span></a>                <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ArchiveReader-162"><a href="#ArchiveReader-162"><span class="linenos">162</span></a>                <span class="n">expected</span><span class="o">=</span><span class="s2">&quot;DATA&quot;</span><span class="p">,</span>
</span><span id="ArchiveReader-163"><a href="#ArchiveReader-163"><span class="linenos">163</span></a>                <span class="n">actual</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span><span class="o">.</span><span class="n">magic</span><span class="p">)</span>
</span><span id="ArchiveReader-164"><a href="#ArchiveReader-164"><span class="linenos">164</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader-165"><a href="#ArchiveReader-165"><span class="linenos">165</span></a>    
</span><span id="ArchiveReader-166"><a href="#ArchiveReader-166"><span class="linenos">166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ArchiveReader-167"><a href="#ArchiveReader-167"><span class="linenos">167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-168"><a href="#ArchiveReader-168"><span class="linenos">168</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-169"><a href="#ArchiveReader-169"><span class="linenos">169</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-170"><a href="#ArchiveReader-170"><span class="linenos">170</span></a><span class="sd">        mmap  seek+read</span>
</span><span id="ArchiveReader-171"><a href="#ArchiveReader-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-172"><a href="#ArchiveReader-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="p">:</span>
</span><span id="ArchiveReader-173"><a href="#ArchiveReader-173"><span class="linenos">173</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>
</span><span id="ArchiveReader-174"><a href="#ArchiveReader-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveReader-175"><a href="#ArchiveReader-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</span><span id="ArchiveReader-176"><a href="#ArchiveReader-176"><span class="linenos">176</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="ArchiveReader-177"><a href="#ArchiveReader-177"><span class="linenos">177</span></a>    
</span><span id="ArchiveReader-178"><a href="#ArchiveReader-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ArchiveReader-179"><a href="#ArchiveReader-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-180"><a href="#ArchiveReader-180"><span class="linenos">180</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ArchiveReader-181"><a href="#ArchiveReader-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>
</span><span id="ArchiveReader-182"><a href="#ArchiveReader-182"><span class="linenos">182</span></a>    
</span><span id="ArchiveReader-183"><a href="#ArchiveReader-183"><span class="linenos">183</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ArchiveReader-184"><a href="#ArchiveReader-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-185"><a href="#ArchiveReader-185"><span class="linenos">185</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-186"><a href="#ArchiveReader-186"><span class="linenos">186</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-187"><a href="#ArchiveReader-187"><span class="linenos">187</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader-188"><a href="#ArchiveReader-188"><span class="linenos">188</span></a><span class="sd">            vfs_path: </span>
</span><span id="ArchiveReader-189"><a href="#ArchiveReader-189"><span class="linenos">189</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader-190"><a href="#ArchiveReader-190"><span class="linenos">190</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-191"><a href="#ArchiveReader-191"><span class="linenos">191</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader-192"><a href="#ArchiveReader-192"><span class="linenos">192</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-193"><a href="#ArchiveReader-193"><span class="linenos">193</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-194"><a href="#ArchiveReader-194"><span class="linenos">194</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader-195"><a href="#ArchiveReader-195"><span class="linenos">195</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ArchiveReader-196"><a href="#ArchiveReader-196"><span class="linenos">196</span></a><span class="sd">            CorruptedDataError: </span>
</span><span id="ArchiveReader-197"><a href="#ArchiveReader-197"><span class="linenos">197</span></a><span class="sd">            UnknownAlgorithmError: </span>
</span><span id="ArchiveReader-198"><a href="#ArchiveReader-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-199"><a href="#ArchiveReader-199"><span class="linenos">199</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ArchiveReader-200"><a href="#ArchiveReader-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ArchiveReader-201"><a href="#ArchiveReader-201"><span class="linenos">201</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader-202"><a href="#ArchiveReader-202"><span class="linenos">202</span></a>        
</span><span id="ArchiveReader-203"><a href="#ArchiveReader-203"><span class="linenos">203</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ArchiveReader-204"><a href="#ArchiveReader-204"><span class="linenos">204</span></a>        
</span><span id="ArchiveReader-205"><a href="#ArchiveReader-205"><span class="linenos">205</span></a>        <span class="c1"># 1. </span>
</span><span id="ArchiveReader-206"><a href="#ArchiveReader-206"><span class="linenos">206</span></a>        <span class="n">packed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_data</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">packed_size</span><span class="p">)</span>
</span><span id="ArchiveReader-207"><a href="#ArchiveReader-207"><span class="linenos">207</span></a>        
</span><span id="ArchiveReader-208"><a href="#ArchiveReader-208"><span class="linenos">208</span></a>        <span class="c1"># 2.  ()</span>
</span><span id="ArchiveReader-209"><a href="#ArchiveReader-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ArchiveReader-210"><a href="#ArchiveReader-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveReader-211"><a href="#ArchiveReader-211"><span class="linenos">211</span></a>                <span class="k">raise</span> <span class="n">UnknownAlgorithmError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader-212"><a href="#ArchiveReader-212"><span class="linenos">212</span></a>            <span class="n">hook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span><span class="p">]</span>
</span><span id="ArchiveReader-213"><a href="#ArchiveReader-213"><span class="linenos">213</span></a>            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">hook</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">packed_data</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">)</span>
</span><span id="ArchiveReader-214"><a href="#ArchiveReader-214"><span class="linenos">214</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveReader-215"><a href="#ArchiveReader-215"><span class="linenos">215</span></a>            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">packed_data</span>
</span><span id="ArchiveReader-216"><a href="#ArchiveReader-216"><span class="linenos">216</span></a>        
</span><span id="ArchiveReader-217"><a href="#ArchiveReader-217"><span class="linenos">217</span></a>        <span class="c1"># 3.  ()</span>
</span><span id="ArchiveReader-218"><a href="#ArchiveReader-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="n">verify</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">:</span>
</span><span id="ArchiveReader-219"><a href="#ArchiveReader-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">):</span>
</span><span id="ArchiveReader-220"><a href="#ArchiveReader-220"><span class="linenos">220</span></a>                <span class="k">raise</span> <span class="n">CorruptedDataError</span><span class="p">(</span>
</span><span id="ArchiveReader-221"><a href="#ArchiveReader-221"><span class="linenos">221</span></a>                    <span class="n">vfs_path</span><span class="p">,</span>
</span><span id="ArchiveReader-222"><a href="#ArchiveReader-222"><span class="linenos">222</span></a>                    <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span>
</span><span id="ArchiveReader-223"><a href="#ArchiveReader-223"><span class="linenos">223</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveReader-224"><a href="#ArchiveReader-224"><span class="linenos">224</span></a>                <span class="p">)</span>
</span><span id="ArchiveReader-225"><a href="#ArchiveReader-225"><span class="linenos">225</span></a>        
</span><span id="ArchiveReader-226"><a href="#ArchiveReader-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="n">raw_data</span>
</span><span id="ArchiveReader-227"><a href="#ArchiveReader-227"><span class="linenos">227</span></a>    
</span><span id="ArchiveReader-228"><a href="#ArchiveReader-228"><span class="linenos">228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">:</span>
</span><span id="ArchiveReader-229"><a href="#ArchiveReader-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-230"><a href="#ArchiveReader-230"><span class="linenos">230</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-231"><a href="#ArchiveReader-231"><span class="linenos">231</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-232"><a href="#ArchiveReader-232"><span class="linenos">232</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader-233"><a href="#ArchiveReader-233"><span class="linenos">233</span></a><span class="sd">            vfs_path: </span>
</span><span id="ArchiveReader-234"><a href="#ArchiveReader-234"><span class="linenos">234</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader-235"><a href="#ArchiveReader-235"><span class="linenos">235</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-236"><a href="#ArchiveReader-236"><span class="linenos">236</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader-237"><a href="#ArchiveReader-237"><span class="linenos">237</span></a><span class="sd">            BytesIO </span>
</span><span id="ArchiveReader-238"><a href="#ArchiveReader-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-239"><a href="#ArchiveReader-239"><span class="linenos">239</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
</span><span id="ArchiveReader-240"><a href="#ArchiveReader-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ArchiveReader-241"><a href="#ArchiveReader-241"><span class="linenos">241</span></a>    
</span><span id="ArchiveReader-242"><a href="#ArchiveReader-242"><span class="linenos">242</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArchiveEntry</span><span class="p">:</span>
</span><span id="ArchiveReader-243"><a href="#ArchiveReader-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-244"><a href="#ArchiveReader-244"><span class="linenos">244</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ArchiveReader-245"><a href="#ArchiveReader-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ArchiveReader-246"><a href="#ArchiveReader-246"><span class="linenos">246</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader-247"><a href="#ArchiveReader-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ArchiveReader-248"><a href="#ArchiveReader-248"><span class="linenos">248</span></a>    
</span><span id="ArchiveReader-249"><a href="#ArchiveReader-249"><span class="linenos">249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ArchiveReader-250"><a href="#ArchiveReader-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-251"><a href="#ArchiveReader-251"><span class="linenos">251</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-252"><a href="#ArchiveReader-252"><span class="linenos">252</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-253"><a href="#ArchiveReader-253"><span class="linenos">253</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader-254"><a href="#ArchiveReader-254"><span class="linenos">254</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ArchiveReader-255"><a href="#ArchiveReader-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-256"><a href="#ArchiveReader-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader-257"><a href="#ArchiveReader-257"><span class="linenos">257</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ArchiveReader-258"><a href="#ArchiveReader-258"><span class="linenos">258</span></a>        
</span><span id="ArchiveReader-259"><a href="#ArchiveReader-259"><span class="linenos">259</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArchiveReader-260"><a href="#ArchiveReader-260"><span class="linenos">260</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ArchiveReader-261"><a href="#ArchiveReader-261"><span class="linenos">261</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ArchiveReader-262"><a href="#ArchiveReader-262"><span class="linenos">262</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ArchiveReader-263"><a href="#ArchiveReader-263"><span class="linenos">263</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader-264"><a href="#ArchiveReader-264"><span class="linenos">264</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
</span><span id="ArchiveReader-265"><a href="#ArchiveReader-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ArchiveReader-266"><a href="#ArchiveReader-266"><span class="linenos">266</span></a>    
</span><span id="ArchiveReader-267"><a href="#ArchiveReader-267"><span class="linenos">267</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="ArchiveReader-268"><a href="#ArchiveReader-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-269"><a href="#ArchiveReader-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-270"><a href="#ArchiveReader-270"><span class="linenos">270</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-271"><a href="#ArchiveReader-271"><span class="linenos">271</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-272"><a href="#ArchiveReader-272"><span class="linenos">272</span></a><span class="sd">         read() </span>
</span><span id="ArchiveReader-273"><a href="#ArchiveReader-273"><span class="linenos">273</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-274"><a href="#ArchiveReader-274"><span class="linenos">274</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader-275"><a href="#ArchiveReader-275"><span class="linenos">275</span></a><span class="sd">            :</span>
</span><span id="ArchiveReader-276"><a href="#ArchiveReader-276"><span class="linenos">276</span></a><span class="sd">            - path: </span>
</span><span id="ArchiveReader-277"><a href="#ArchiveReader-277"><span class="linenos">277</span></a><span class="sd">            - raw_size: </span>
</span><span id="ArchiveReader-278"><a href="#ArchiveReader-278"><span class="linenos">278</span></a><span class="sd">            - packed_size: </span>
</span><span id="ArchiveReader-279"><a href="#ArchiveReader-279"><span class="linenos">279</span></a><span class="sd">            - algo_id:  ID (0=)</span>
</span><span id="ArchiveReader-280"><a href="#ArchiveReader-280"><span class="linenos">280</span></a><span class="sd">            - checksum:  (bytes)</span>
</span><span id="ArchiveReader-281"><a href="#ArchiveReader-281"><span class="linenos">281</span></a><span class="sd">            - checksum_hex:  (hex)</span>
</span><span id="ArchiveReader-282"><a href="#ArchiveReader-282"><span class="linenos">282</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-283"><a href="#ArchiveReader-283"><span class="linenos">283</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader-284"><a href="#ArchiveReader-284"><span class="linenos">284</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ArchiveReader-285"><a href="#ArchiveReader-285"><span class="linenos">285</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-286"><a href="#ArchiveReader-286"><span class="linenos">286</span></a><span class="sd">        Example:</span>
</span><span id="ArchiveReader-287"><a href="#ArchiveReader-287"><span class="linenos">287</span></a><span class="sd">            &gt;&gt;&gt; for entry in reader.get_all_entries():</span>
</span><span id="ArchiveReader-288"><a href="#ArchiveReader-288"><span class="linenos">288</span></a><span class="sd">            ...     print(f&quot;{entry[&#39;path&#39;]}: {entry[&#39;raw_size&#39;]} bytes&quot;)</span>
</span><span id="ArchiveReader-289"><a href="#ArchiveReader-289"><span class="linenos">289</span></a><span class="sd">            ...     if entry[&#39;raw_size&#39;] &gt; 0:</span>
</span><span id="ArchiveReader-290"><a href="#ArchiveReader-290"><span class="linenos">290</span></a><span class="sd">            ...         data = reader.read(entry[&#39;path&#39;])  # </span>
</span><span id="ArchiveReader-291"><a href="#ArchiveReader-291"><span class="linenos">291</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-292"><a href="#ArchiveReader-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader-293"><a href="#ArchiveReader-293"><span class="linenos">293</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ArchiveReader-294"><a href="#ArchiveReader-294"><span class="linenos">294</span></a>        
</span><span id="ArchiveReader-295"><a href="#ArchiveReader-295"><span class="linenos">295</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArchiveReader-296"><a href="#ArchiveReader-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ArchiveReader-297"><a href="#ArchiveReader-297"><span class="linenos">297</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ArchiveReader-298"><a href="#ArchiveReader-298"><span class="linenos">298</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ArchiveReader-299"><a href="#ArchiveReader-299"><span class="linenos">299</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader-300"><a href="#ArchiveReader-300"><span class="linenos">300</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ArchiveReader-301"><a href="#ArchiveReader-301"><span class="linenos">301</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">full_path</span><span class="p">,</span>
</span><span id="ArchiveReader-302"><a href="#ArchiveReader-302"><span class="linenos">302</span></a>                <span class="s1">&#39;raw_size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ArchiveReader-303"><a href="#ArchiveReader-303"><span class="linenos">303</span></a>                <span class="s1">&#39;packed_size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">packed_size</span><span class="p">,</span>
</span><span id="ArchiveReader-304"><a href="#ArchiveReader-304"><span class="linenos">304</span></a>                <span class="s1">&#39;algo_id&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span><span class="p">,</span>
</span><span id="ArchiveReader-305"><a href="#ArchiveReader-305"><span class="linenos">305</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span>
</span><span id="ArchiveReader-306"><a href="#ArchiveReader-306"><span class="linenos">306</span></a>                <span class="s1">&#39;checksum_hex&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="ArchiveReader-307"><a href="#ArchiveReader-307"><span class="linenos">307</span></a>            <span class="p">})</span>
</span><span id="ArchiveReader-308"><a href="#ArchiveReader-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ArchiveReader-309"><a href="#ArchiveReader-309"><span class="linenos">309</span></a>    
</span><span id="ArchiveReader-310"><a href="#ArchiveReader-310"><span class="linenos">310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iter_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ArchiveReader-311"><a href="#ArchiveReader-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-312"><a href="#ArchiveReader-312"><span class="linenos">312</span></a><span class="sd">         ()</span>
</span><span id="ArchiveReader-313"><a href="#ArchiveReader-313"><span class="linenos">313</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-314"><a href="#ArchiveReader-314"><span class="linenos">314</span></a><span class="sd">        Yields:</span>
</span><span id="ArchiveReader-315"><a href="#ArchiveReader-315"><span class="linenos">315</span></a><span class="sd">            (path, entry) </span>
</span><span id="ArchiveReader-316"><a href="#ArchiveReader-316"><span class="linenos">316</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-317"><a href="#ArchiveReader-317"><span class="linenos">317</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader-318"><a href="#ArchiveReader-318"><span class="linenos">318</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ArchiveReader-319"><a href="#ArchiveReader-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-320"><a href="#ArchiveReader-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader-321"><a href="#ArchiveReader-321"><span class="linenos">321</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ArchiveReader-322"><a href="#ArchiveReader-322"><span class="linenos">322</span></a>        
</span><span id="ArchiveReader-323"><a href="#ArchiveReader-323"><span class="linenos">323</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ArchiveReader-324"><a href="#ArchiveReader-324"><span class="linenos">324</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ArchiveReader-325"><a href="#ArchiveReader-325"><span class="linenos">325</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ArchiveReader-326"><a href="#ArchiveReader-326"><span class="linenos">326</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader-327"><a href="#ArchiveReader-327"><span class="linenos">327</span></a>            <span class="k">yield</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">entry</span>
</span><span id="ArchiveReader-328"><a href="#ArchiveReader-328"><span class="linenos">328</span></a>    
</span><span id="ArchiveReader-329"><a href="#ArchiveReader-329"><span class="linenos">329</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ArchiveReader-330"><a href="#ArchiveReader-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Hash&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-331"><a href="#ArchiveReader-331"><span class="linenos">331</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ArchiveReader-332"><a href="#ArchiveReader-332"><span class="linenos">332</span></a>    
</span><span id="ArchiveReader-333"><a href="#ArchiveReader-333"><span class="linenos">333</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader-334"><a href="#ArchiveReader-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileHeader</span><span class="p">:</span>
</span><span id="ArchiveReader-335"><a href="#ArchiveReader-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span>
</span><span id="ArchiveReader-336"><a href="#ArchiveReader-336"><span class="linenos">336</span></a>    
</span><span id="ArchiveReader-337"><a href="#ArchiveReader-337"><span class="linenos">337</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader-338"><a href="#ArchiveReader-338"><span class="linenos">338</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">index_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndexHeader</span><span class="p">:</span>
</span><span id="ArchiveReader-339"><a href="#ArchiveReader-339"><span class="linenos">339</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span>
</span><span id="ArchiveReader-340"><a href="#ArchiveReader-340"><span class="linenos">340</span></a>    
</span><span id="ArchiveReader-341"><a href="#ArchiveReader-341"><span class="linenos">341</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader-342"><a href="#ArchiveReader-342"><span class="linenos">342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">data_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataHeader</span><span class="p">:</span>
</span><span id="ArchiveReader-343"><a href="#ArchiveReader-343"><span class="linenos">343</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span>
</span><span id="ArchiveReader-344"><a href="#ArchiveReader-344"><span class="linenos">344</span></a>    
</span><span id="ArchiveReader-345"><a href="#ArchiveReader-345"><span class="linenos">345</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader-346"><a href="#ArchiveReader-346"><span class="linenos">346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ArchiveReader-347"><a href="#ArchiveReader-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span><span id="ArchiveReader-348"><a href="#ArchiveReader-348"><span class="linenos">348</span></a>    
</span><span id="ArchiveReader-349"><a href="#ArchiveReader-349"><span class="linenos">349</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader-350"><a href="#ArchiveReader-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_decrypted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ArchiveReader-351"><a href="#ArchiveReader-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span>
</span><span id="ArchiveReader-352"><a href="#ArchiveReader-352"><span class="linenos">352</span></a>    
</span><span id="ArchiveReader-353"><a href="#ArchiveReader-353"><span class="linenos">353</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader-354"><a href="#ArchiveReader-354"><span class="linenos">354</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_mmap</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ArchiveReader-355"><a href="#ArchiveReader-355"><span class="linenos">355</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ArchiveReader-356"><a href="#ArchiveReader-356"><span class="linenos">356</span></a>    
</span><span id="ArchiveReader-357"><a href="#ArchiveReader-357"><span class="linenos">357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveReader-358"><a href="#ArchiveReader-358"><span class="linenos">358</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-359"><a href="#ArchiveReader-359"><span class="linenos">359</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="p">:</span>
</span><span id="ArchiveReader-360"><a href="#ArchiveReader-360"><span class="linenos">360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ArchiveReader-361"><a href="#ArchiveReader-361"><span class="linenos">361</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-362"><a href="#ArchiveReader-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span>
</span><span id="ArchiveReader-363"><a href="#ArchiveReader-363"><span class="linenos">363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ArchiveReader-364"><a href="#ArchiveReader-364"><span class="linenos">364</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-365"><a href="#ArchiveReader-365"><span class="linenos">365</span></a>    
</span><span id="ArchiveReader-366"><a href="#ArchiveReader-366"><span class="linenos">366</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ArchiveReader&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-367"><a href="#ArchiveReader-367"><span class="linenos">367</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="ArchiveReader-368"><a href="#ArchiveReader-368"><span class="linenos">368</span></a>    
</span><span id="ArchiveReader-369"><a href="#ArchiveReader-369"><span class="linenos">369</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveReader-370"><a href="#ArchiveReader-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ArchiveReader-371"><a href="#ArchiveReader-371"><span class="linenos">371</span></a>    
</span><span id="ArchiveReader-372"><a href="#ArchiveReader-372"><span class="linenos">372</span></a>    <span class="c1"># ====================  API ====================</span>
</span><span id="ArchiveReader-373"><a href="#ArchiveReader-373"><span class="linenos">373</span></a>    
</span><span id="ArchiveReader-374"><a href="#ArchiveReader-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_batch</span><span class="p">(</span>
</span><span id="ArchiveReader-375"><a href="#ArchiveReader-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveReader-376"><a href="#ArchiveReader-376"><span class="linenos">376</span></a>        <span class="n">vfs_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="ArchiveReader-377"><a href="#ArchiveReader-377"><span class="linenos">377</span></a>        <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ArchiveReader-378"><a href="#ArchiveReader-378"><span class="linenos">378</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>
</span><span id="ArchiveReader-379"><a href="#ArchiveReader-379"><span class="linenos">379</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="ArchiveReader-380"><a href="#ArchiveReader-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-381"><a href="#ArchiveReader-381"><span class="linenos">381</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-382"><a href="#ArchiveReader-382"><span class="linenos">382</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-383"><a href="#ArchiveReader-383"><span class="linenos">383</span></a><span class="sd">        mmap </span>
</span><span id="ArchiveReader-384"><a href="#ArchiveReader-384"><span class="linenos">384</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-385"><a href="#ArchiveReader-385"><span class="linenos">385</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader-386"><a href="#ArchiveReader-386"><span class="linenos">386</span></a><span class="sd">            vfs_paths: </span>
</span><span id="ArchiveReader-387"><a href="#ArchiveReader-387"><span class="linenos">387</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader-388"><a href="#ArchiveReader-388"><span class="linenos">388</span></a><span class="sd">            on_error:  (&#39;raise&#39;, &#39;skip&#39;)</span>
</span><span id="ArchiveReader-389"><a href="#ArchiveReader-389"><span class="linenos">389</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-390"><a href="#ArchiveReader-390"><span class="linenos">390</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader-391"><a href="#ArchiveReader-391"><span class="linenos">391</span></a><span class="sd">            {vfs_path: data} </span>
</span><span id="ArchiveReader-392"><a href="#ArchiveReader-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-393"><a href="#ArchiveReader-393"><span class="linenos">393</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ArchiveReader-394"><a href="#ArchiveReader-394"><span class="linenos">394</span></a>        
</span><span id="ArchiveReader-395"><a href="#ArchiveReader-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">vfs_paths</span><span class="p">:</span>
</span><span id="ArchiveReader-396"><a href="#ArchiveReader-396"><span class="linenos">396</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ArchiveReader-397"><a href="#ArchiveReader-397"><span class="linenos">397</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
</span><span id="ArchiveReader-398"><a href="#ArchiveReader-398"><span class="linenos">398</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="ArchiveReader-399"><a href="#ArchiveReader-399"><span class="linenos">399</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ArchiveReader-400"><a href="#ArchiveReader-400"><span class="linenos">400</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-401"><a href="#ArchiveReader-401"><span class="linenos">401</span></a>                    <span class="k">raise</span>
</span><span id="ArchiveReader-402"><a href="#ArchiveReader-402"><span class="linenos">402</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-403"><a href="#ArchiveReader-403"><span class="linenos">403</span></a>                    <span class="k">continue</span>  <span class="c1"># </span>
</span><span id="ArchiveReader-404"><a href="#ArchiveReader-404"><span class="linenos">404</span></a>        
</span><span id="ArchiveReader-405"><a href="#ArchiveReader-405"><span class="linenos">405</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ArchiveReader-406"><a href="#ArchiveReader-406"><span class="linenos">406</span></a>    
</span><span id="ArchiveReader-407"><a href="#ArchiveReader-407"><span class="linenos">407</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_all</span><span class="p">(</span>
</span><span id="ArchiveReader-408"><a href="#ArchiveReader-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveReader-409"><a href="#ArchiveReader-409"><span class="linenos">409</span></a>        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveReader-410"><a href="#ArchiveReader-410"><span class="linenos">410</span></a>        <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ArchiveReader-411"><a href="#ArchiveReader-411"><span class="linenos">411</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ArchiveReader-412"><a href="#ArchiveReader-412"><span class="linenos">412</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader-413"><a href="#ArchiveReader-413"><span class="linenos">413</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-414"><a href="#ArchiveReader-414"><span class="linenos">414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader-415"><a href="#ArchiveReader-415"><span class="linenos">415</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-416"><a href="#ArchiveReader-416"><span class="linenos">416</span></a><span class="sd">        </span>
</span><span id="ArchiveReader-417"><a href="#ArchiveReader-417"><span class="linenos">417</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader-418"><a href="#ArchiveReader-418"><span class="linenos">418</span></a><span class="sd">            output_dir: </span>
</span><span id="ArchiveReader-419"><a href="#ArchiveReader-419"><span class="linenos">419</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader-420"><a href="#ArchiveReader-420"><span class="linenos">420</span></a><span class="sd">            on_error: </span>
</span><span id="ArchiveReader-421"><a href="#ArchiveReader-421"><span class="linenos">421</span></a><span class="sd">            progress_callback: </span>
</span><span id="ArchiveReader-422"><a href="#ArchiveReader-422"><span class="linenos">422</span></a><span class="sd">            </span>
</span><span id="ArchiveReader-423"><a href="#ArchiveReader-423"><span class="linenos">423</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader-424"><a href="#ArchiveReader-424"><span class="linenos">424</span></a><span class="sd">            BatchResult </span>
</span><span id="ArchiveReader-425"><a href="#ArchiveReader-425"><span class="linenos">425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader-426"><a href="#ArchiveReader-426"><span class="linenos">426</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span><span class="p">,</span> <span class="n">ProgressInfo</span>
</span><span id="ArchiveReader-427"><a href="#ArchiveReader-427"><span class="linenos">427</span></a>        
</span><span id="ArchiveReader-428"><a href="#ArchiveReader-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader-429"><a href="#ArchiveReader-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader-430"><a href="#ArchiveReader-430"><span class="linenos">430</span></a>        
</span><span id="ArchiveReader-431"><a href="#ArchiveReader-431"><span class="linenos">431</span></a>        <span class="n">all_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
</span><span id="ArchiveReader-432"><a href="#ArchiveReader-432"><span class="linenos">432</span></a>        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_paths</span><span class="p">)</span>
</span><span id="ArchiveReader-433"><a href="#ArchiveReader-433"><span class="linenos">433</span></a>        <span class="n">total_bytes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">p</span><span class="p">))]</span><span class="o">.</span><span class="n">raw_size</span> 
</span><span id="ArchiveReader-434"><a href="#ArchiveReader-434"><span class="linenos">434</span></a>                         <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">)</span>
</span><span id="ArchiveReader-435"><a href="#ArchiveReader-435"><span class="linenos">435</span></a>        
</span><span id="ArchiveReader-436"><a href="#ArchiveReader-436"><span class="linenos">436</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ArchiveReader-437"><a href="#ArchiveReader-437"><span class="linenos">437</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="n">total_files</span><span class="p">,</span>
</span><span id="ArchiveReader-438"><a href="#ArchiveReader-438"><span class="linenos">438</span></a>            <span class="n">total_bytes</span><span class="o">=</span><span class="n">total_bytes</span><span class="p">,</span>
</span><span id="ArchiveReader-439"><a href="#ArchiveReader-439"><span class="linenos">439</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ArchiveReader-440"><a href="#ArchiveReader-440"><span class="linenos">440</span></a>        <span class="p">)</span>
</span><span id="ArchiveReader-441"><a href="#ArchiveReader-441"><span class="linenos">441</span></a>        
</span><span id="ArchiveReader-442"><a href="#ArchiveReader-442"><span class="linenos">442</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ArchiveReader-443"><a href="#ArchiveReader-443"><span class="linenos">443</span></a>        
</span><span id="ArchiveReader-444"><a href="#ArchiveReader-444"><span class="linenos">444</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader-445"><a href="#ArchiveReader-445"><span class="linenos">445</span></a>        <span class="n">dirs_to_create</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ArchiveReader-446"><a href="#ArchiveReader-446"><span class="linenos">446</span></a>        <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">:</span>
</span><span id="ArchiveReader-447"><a href="#ArchiveReader-447"><span class="linenos">447</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ArchiveReader-448"><a href="#ArchiveReader-448"><span class="linenos">448</span></a>            <span class="n">dirs_to_create</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">local_path</span><span class="p">))</span>
</span><span id="ArchiveReader-449"><a href="#ArchiveReader-449"><span class="linenos">449</span></a>        
</span><span id="ArchiveReader-450"><a href="#ArchiveReader-450"><span class="linenos">450</span></a>        <span class="k">for</span> <span class="n">dir_path</span> <span class="ow">in</span> <span class="n">dirs_to_create</span><span class="p">:</span>
</span><span id="ArchiveReader-451"><a href="#ArchiveReader-451"><span class="linenos">451</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ArchiveReader-452"><a href="#ArchiveReader-452"><span class="linenos">452</span></a>        
</span><span id="ArchiveReader-453"><a href="#ArchiveReader-453"><span class="linenos">453</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader-454"><a href="#ArchiveReader-454"><span class="linenos">454</span></a>        <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">:</span>
</span><span id="ArchiveReader-455"><a href="#ArchiveReader-455"><span class="linenos">455</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ArchiveReader-456"><a href="#ArchiveReader-456"><span class="linenos">456</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
</span><span id="ArchiveReader-457"><a href="#ArchiveReader-457"><span class="linenos">457</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ArchiveReader-458"><a href="#ArchiveReader-458"><span class="linenos">458</span></a>                
</span><span id="ArchiveReader-459"><a href="#ArchiveReader-459"><span class="linenos">459</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ArchiveReader-460"><a href="#ArchiveReader-460"><span class="linenos">460</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ArchiveReader-461"><a href="#ArchiveReader-461"><span class="linenos">461</span></a>                
</span><span id="ArchiveReader-462"><a href="#ArchiveReader-462"><span class="linenos">462</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveReader-463"><a href="#ArchiveReader-463"><span class="linenos">463</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ArchiveReader-464"><a href="#ArchiveReader-464"><span class="linenos">464</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="ArchiveReader-465"><a href="#ArchiveReader-465"><span class="linenos">465</span></a>                
</span><span id="ArchiveReader-466"><a href="#ArchiveReader-466"><span class="linenos">466</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ArchiveReader-467"><a href="#ArchiveReader-467"><span class="linenos">467</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-468"><a href="#ArchiveReader-468"><span class="linenos">468</span></a>                    <span class="k">raise</span>
</span><span id="ArchiveReader-469"><a href="#ArchiveReader-469"><span class="linenos">469</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-470"><a href="#ArchiveReader-470"><span class="linenos">470</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveReader-471"><a href="#ArchiveReader-471"><span class="linenos">471</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveReader-472"><a href="#ArchiveReader-472"><span class="linenos">472</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ArchiveReader-473"><a href="#ArchiveReader-473"><span class="linenos">473</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;abort&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader-474"><a href="#ArchiveReader-474"><span class="linenos">474</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveReader-475"><a href="#ArchiveReader-475"><span class="linenos">475</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveReader-476"><a href="#ArchiveReader-476"><span class="linenos">476</span></a>                    <span class="k">break</span>
</span><span id="ArchiveReader-477"><a href="#ArchiveReader-477"><span class="linenos">477</span></a>        
</span><span id="ArchiveReader-478"><a href="#ArchiveReader-478"><span class="linenos">478</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ArchiveReader-479"><a href="#ArchiveReader-479"><span class="linenos">479</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Archive </p>

<p>:</p>

<ul>
<li>mmap  (): </li>
<li>:  I/O</li>
</ul>
</div>


                            <div id="ArchiveReader.__init__" class="classattr">
                                        <input id="ArchiveReader.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ArchiveReader</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">compression_hooks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#CompressionHook">CompressionHook</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">checksum_hook</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_crypto</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_mmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="ArchiveReader.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.__init__-41"><a href="#ArchiveReader.__init__-41"><span class="linenos">41</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="ArchiveReader.__init__-42"><a href="#ArchiveReader.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveReader.__init__-43"><a href="#ArchiveReader.__init__-43"><span class="linenos">43</span></a>        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveReader.__init__-44"><a href="#ArchiveReader.__init__-44"><span class="linenos">44</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader.__init__-45"><a href="#ArchiveReader.__init__-45"><span class="linenos">45</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader.__init__-46"><a href="#ArchiveReader.__init__-46"><span class="linenos">46</span></a>        <span class="n">index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader.__init__-47"><a href="#ArchiveReader.__init__-47"><span class="linenos">47</span></a>        <span class="n">path_hash_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ArchiveReader.__init__-48"><a href="#ArchiveReader.__init__-48"><span class="linenos">48</span></a>        <span class="n">use_mmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ArchiveReader.__init__-49"><a href="#ArchiveReader.__init__-49"><span class="linenos">49</span></a>    <span class="p">):</span>
</span><span id="ArchiveReader.__init__-50"><a href="#ArchiveReader.__init__-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.__init__-51"><a href="#ArchiveReader.__init__-51"><span class="linenos">51</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.__init__-52"><a href="#ArchiveReader.__init__-52"><span class="linenos">52</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.__init__-53"><a href="#ArchiveReader.__init__-53"><span class="linenos">53</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader.__init__-54"><a href="#ArchiveReader.__init__-54"><span class="linenos">54</span></a><span class="sd">            file_path: Archive </span>
</span><span id="ArchiveReader.__init__-55"><a href="#ArchiveReader.__init__-55"><span class="linenos">55</span></a><span class="sd">            compression_hooks: </span>
</span><span id="ArchiveReader.__init__-56"><a href="#ArchiveReader.__init__-56"><span class="linenos">56</span></a><span class="sd">            checksum_hook: </span>
</span><span id="ArchiveReader.__init__-57"><a href="#ArchiveReader.__init__-57"><span class="linenos">57</span></a><span class="sd">            index_crypto: </span>
</span><span id="ArchiveReader.__init__-58"><a href="#ArchiveReader.__init__-58"><span class="linenos">58</span></a><span class="sd">            path_hash_func:  Hash </span>
</span><span id="ArchiveReader.__init__-59"><a href="#ArchiveReader.__init__-59"><span class="linenos">59</span></a><span class="sd">            use_mmap:  mmap </span>
</span><span id="ArchiveReader.__init__-60"><a href="#ArchiveReader.__init__-60"><span class="linenos">60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.__init__-61"><a href="#ArchiveReader.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
</span><span id="ArchiveReader.__init__-62"><a href="#ArchiveReader.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ArchiveReader.__init__-63"><a href="#ArchiveReader.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_crypto</span> <span class="o">=</span> <span class="n">index_crypto</span>
</span><span id="ArchiveReader.__init__-64"><a href="#ArchiveReader.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span> <span class="o">=</span> <span class="n">path_hash_func</span> <span class="ow">or</span> <span class="n">default_path_hash</span>
</span><span id="ArchiveReader.__init__-65"><a href="#ArchiveReader.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_use_mmap</span> <span class="o">=</span> <span class="n">use_mmap</span>
</span><span id="ArchiveReader.__init__-66"><a href="#ArchiveReader.__init__-66"><span class="linenos">66</span></a>        
</span><span id="ArchiveReader.__init__-67"><a href="#ArchiveReader.__init__-67"><span class="linenos">67</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader.__init__-68"><a href="#ArchiveReader.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">CompressionHook</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ArchiveReader.__init__-69"><a href="#ArchiveReader.__init__-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveReader.__init__-70"><a href="#ArchiveReader.__init__-70"><span class="linenos">70</span></a>            <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveReader.__init__-71"><a href="#ArchiveReader.__init__-71"><span class="linenos">71</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">hook</span><span class="o">.</span><span class="n">algo_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">hook</span>
</span><span id="ArchiveReader.__init__-72"><a href="#ArchiveReader.__init__-72"><span class="linenos">72</span></a>        
</span><span id="ArchiveReader.__init__-73"><a href="#ArchiveReader.__init__-73"><span class="linenos">73</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader.__init__-74"><a href="#ArchiveReader.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BinaryIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.__init__-75"><a href="#ArchiveReader.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">mmap</span><span class="o">.</span><span class="n">mmap</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.__init__-76"><a href="#ArchiveReader.__init__-76"><span class="linenos">76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FileHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.__init__-77"><a href="#ArchiveReader.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.__init__-78"><a href="#ArchiveReader.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataHeader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.__init__-79"><a href="#ArchiveReader.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PathDictionary</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.__init__-80"><a href="#ArchiveReader.__init__-80"><span class="linenos">80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ArchiveEntry</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># path_hash -&gt; Entry</span>
</span><span id="ArchiveReader.__init__-81"><a href="#ArchiveReader.__init__-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ArchiveReader.__init__-82"><a href="#ArchiveReader.__init__-82"><span class="linenos">82</span></a>        
</span><span id="ArchiveReader.__init__-83"><a href="#ArchiveReader.__init__-83"><span class="linenos">83</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader.__init__-84"><a href="#ArchiveReader.__init__-84"><span class="linenos">84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    file_path: Archive 
    compression_hooks: 
    checksum_hook: 
    index_crypto: 
    path_hash_func:  Hash 
    use_mmap:  mmap </p>
</div>


                            </div>
                            <div id="ArchiveReader.exists" class="classattr">
                                        <input id="ArchiveReader.exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.exists-178"><a href="#ArchiveReader.exists-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ArchiveReader.exists-179"><a href="#ArchiveReader.exists-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.exists-180"><a href="#ArchiveReader.exists-180"><span class="linenos">180</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ArchiveReader.exists-181"><a href="#ArchiveReader.exists-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="n">path_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ArchiveReader.read" class="classattr">
                                        <input id="ArchiveReader.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.read-183"><a href="#ArchiveReader.read-183"><span class="linenos">183</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ArchiveReader.read-184"><a href="#ArchiveReader.read-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.read-185"><a href="#ArchiveReader.read-185"><span class="linenos">185</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.read-186"><a href="#ArchiveReader.read-186"><span class="linenos">186</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.read-187"><a href="#ArchiveReader.read-187"><span class="linenos">187</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader.read-188"><a href="#ArchiveReader.read-188"><span class="linenos">188</span></a><span class="sd">            vfs_path: </span>
</span><span id="ArchiveReader.read-189"><a href="#ArchiveReader.read-189"><span class="linenos">189</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader.read-190"><a href="#ArchiveReader.read-190"><span class="linenos">190</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.read-191"><a href="#ArchiveReader.read-191"><span class="linenos">191</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader.read-192"><a href="#ArchiveReader.read-192"><span class="linenos">192</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.read-193"><a href="#ArchiveReader.read-193"><span class="linenos">193</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.read-194"><a href="#ArchiveReader.read-194"><span class="linenos">194</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader.read-195"><a href="#ArchiveReader.read-195"><span class="linenos">195</span></a><span class="sd">            FileNotFoundError: </span>
</span><span id="ArchiveReader.read-196"><a href="#ArchiveReader.read-196"><span class="linenos">196</span></a><span class="sd">            CorruptedDataError: </span>
</span><span id="ArchiveReader.read-197"><a href="#ArchiveReader.read-197"><span class="linenos">197</span></a><span class="sd">            UnknownAlgorithmError: </span>
</span><span id="ArchiveReader.read-198"><a href="#ArchiveReader.read-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.read-199"><a href="#ArchiveReader.read-199"><span class="linenos">199</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ArchiveReader.read-200"><a href="#ArchiveReader.read-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ArchiveReader.read-201"><a href="#ArchiveReader.read-201"><span class="linenos">201</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader.read-202"><a href="#ArchiveReader.read-202"><span class="linenos">202</span></a>        
</span><span id="ArchiveReader.read-203"><a href="#ArchiveReader.read-203"><span class="linenos">203</span></a>        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span><span id="ArchiveReader.read-204"><a href="#ArchiveReader.read-204"><span class="linenos">204</span></a>        
</span><span id="ArchiveReader.read-205"><a href="#ArchiveReader.read-205"><span class="linenos">205</span></a>        <span class="c1"># 1. </span>
</span><span id="ArchiveReader.read-206"><a href="#ArchiveReader.read-206"><span class="linenos">206</span></a>        <span class="n">packed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_data</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">packed_size</span><span class="p">)</span>
</span><span id="ArchiveReader.read-207"><a href="#ArchiveReader.read-207"><span class="linenos">207</span></a>        
</span><span id="ArchiveReader.read-208"><a href="#ArchiveReader.read-208"><span class="linenos">208</span></a>        <span class="c1"># 2.  ()</span>
</span><span id="ArchiveReader.read-209"><a href="#ArchiveReader.read-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ArchiveReader.read-210"><a href="#ArchiveReader.read-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">:</span>
</span><span id="ArchiveReader.read-211"><a href="#ArchiveReader.read-211"><span class="linenos">211</span></a>                <span class="k">raise</span> <span class="n">UnknownAlgorithmError</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader.read-212"><a href="#ArchiveReader.read-212"><span class="linenos">212</span></a>            <span class="n">hook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_hooks</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span><span class="p">]</span>
</span><span id="ArchiveReader.read-213"><a href="#ArchiveReader.read-213"><span class="linenos">213</span></a>            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">hook</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">packed_data</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">)</span>
</span><span id="ArchiveReader.read-214"><a href="#ArchiveReader.read-214"><span class="linenos">214</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ArchiveReader.read-215"><a href="#ArchiveReader.read-215"><span class="linenos">215</span></a>            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">packed_data</span>
</span><span id="ArchiveReader.read-216"><a href="#ArchiveReader.read-216"><span class="linenos">216</span></a>        
</span><span id="ArchiveReader.read-217"><a href="#ArchiveReader.read-217"><span class="linenos">217</span></a>        <span class="c1"># 3.  ()</span>
</span><span id="ArchiveReader.read-218"><a href="#ArchiveReader.read-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="n">verify</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">:</span>
</span><span id="ArchiveReader.read-219"><a href="#ArchiveReader.read-219"><span class="linenos">219</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">):</span>
</span><span id="ArchiveReader.read-220"><a href="#ArchiveReader.read-220"><span class="linenos">220</span></a>                <span class="k">raise</span> <span class="n">CorruptedDataError</span><span class="p">(</span>
</span><span id="ArchiveReader.read-221"><a href="#ArchiveReader.read-221"><span class="linenos">221</span></a>                    <span class="n">vfs_path</span><span class="p">,</span>
</span><span id="ArchiveReader.read-222"><a href="#ArchiveReader.read-222"><span class="linenos">222</span></a>                    <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span>
</span><span id="ArchiveReader.read-223"><a href="#ArchiveReader.read-223"><span class="linenos">223</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="ArchiveReader.read-224"><a href="#ArchiveReader.read-224"><span class="linenos">224</span></a>                <span class="p">)</span>
</span><span id="ArchiveReader.read-225"><a href="#ArchiveReader.read-225"><span class="linenos">225</span></a>        
</span><span id="ArchiveReader.read-226"><a href="#ArchiveReader.read-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="n">raw_data</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    vfs_path: 
    verify: </p>

<p>Returns:
    </p>

<p>Raises:
    FileNotFoundError: 
    CorruptedDataError: 
    UnknownAlgorithmError: </p>
</div>


                            </div>
                            <div id="ArchiveReader.open" class="classattr">
                                        <input id="ArchiveReader.open-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">open</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">_io</span><span class="o">.</span><span class="n">BytesIO</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.open-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.open"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.open-228"><a href="#ArchiveReader.open-228"><span class="linenos">228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">:</span>
</span><span id="ArchiveReader.open-229"><a href="#ArchiveReader.open-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.open-230"><a href="#ArchiveReader.open-230"><span class="linenos">230</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.open-231"><a href="#ArchiveReader.open-231"><span class="linenos">231</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.open-232"><a href="#ArchiveReader.open-232"><span class="linenos">232</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader.open-233"><a href="#ArchiveReader.open-233"><span class="linenos">233</span></a><span class="sd">            vfs_path: </span>
</span><span id="ArchiveReader.open-234"><a href="#ArchiveReader.open-234"><span class="linenos">234</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader.open-235"><a href="#ArchiveReader.open-235"><span class="linenos">235</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.open-236"><a href="#ArchiveReader.open-236"><span class="linenos">236</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader.open-237"><a href="#ArchiveReader.open-237"><span class="linenos">237</span></a><span class="sd">            BytesIO </span>
</span><span id="ArchiveReader.open-238"><a href="#ArchiveReader.open-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.open-239"><a href="#ArchiveReader.open-239"><span class="linenos">239</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
</span><span id="ArchiveReader.open-240"><a href="#ArchiveReader.open-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    vfs_path: 
    verify: </p>

<p>Returns:
    BytesIO </p>
</div>


                            </div>
                            <div id="ArchiveReader.get_entry" class="classattr">
                                        <input id="ArchiveReader.get_entry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_entry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">grimoire</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">ArchiveEntry</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.get_entry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.get_entry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.get_entry-242"><a href="#ArchiveReader.get_entry-242"><span class="linenos">242</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArchiveEntry</span><span class="p">:</span>
</span><span id="ArchiveReader.get_entry-243"><a href="#ArchiveReader.get_entry-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.get_entry-244"><a href="#ArchiveReader.get_entry-244"><span class="linenos">244</span></a>        <span class="n">path_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">))</span>
</span><span id="ArchiveReader.get_entry-245"><a href="#ArchiveReader.get_entry-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="n">path_hash</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
</span><span id="ArchiveReader.get_entry-246"><a href="#ArchiveReader.get_entry-246"><span class="linenos">246</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">vfs_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader.get_entry-247"><a href="#ArchiveReader.get_entry-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ArchiveReader.list_all" class="classattr">
                                        <input id="ArchiveReader.list_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_all</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.list_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.list_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.list_all-249"><a href="#ArchiveReader.list_all-249"><span class="linenos">249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="ArchiveReader.list_all-250"><a href="#ArchiveReader.list_all-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.list_all-251"><a href="#ArchiveReader.list_all-251"><span class="linenos">251</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.list_all-252"><a href="#ArchiveReader.list_all-252"><span class="linenos">252</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.list_all-253"><a href="#ArchiveReader.list_all-253"><span class="linenos">253</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader.list_all-254"><a href="#ArchiveReader.list_all-254"><span class="linenos">254</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ArchiveReader.list_all-255"><a href="#ArchiveReader.list_all-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.list_all-256"><a href="#ArchiveReader.list_all-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader.list_all-257"><a href="#ArchiveReader.list_all-257"><span class="linenos">257</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ArchiveReader.list_all-258"><a href="#ArchiveReader.list_all-258"><span class="linenos">258</span></a>        
</span><span id="ArchiveReader.list_all-259"><a href="#ArchiveReader.list_all-259"><span class="linenos">259</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArchiveReader.list_all-260"><a href="#ArchiveReader.list_all-260"><span class="linenos">260</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ArchiveReader.list_all-261"><a href="#ArchiveReader.list_all-261"><span class="linenos">261</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ArchiveReader.list_all-262"><a href="#ArchiveReader.list_all-262"><span class="linenos">262</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ArchiveReader.list_all-263"><a href="#ArchiveReader.list_all-263"><span class="linenos">263</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader.list_all-264"><a href="#ArchiveReader.list_all-264"><span class="linenos">264</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
</span><span id="ArchiveReader.list_all-265"><a href="#ArchiveReader.list_all-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Raises:
    IndexNotDecryptedError: </p>
</div>


                            </div>
                            <div id="ArchiveReader.get_all_entries" class="classattr">
                                        <input id="ArchiveReader.get_all_entries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_entries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.get_all_entries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.get_all_entries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.get_all_entries-267"><a href="#ArchiveReader.get_all_entries-267"><span class="linenos">267</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
</span><span id="ArchiveReader.get_all_entries-268"><a href="#ArchiveReader.get_all_entries-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.get_all_entries-269"><a href="#ArchiveReader.get_all_entries-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.get_all_entries-270"><a href="#ArchiveReader.get_all_entries-270"><span class="linenos">270</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.get_all_entries-271"><a href="#ArchiveReader.get_all_entries-271"><span class="linenos">271</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.get_all_entries-272"><a href="#ArchiveReader.get_all_entries-272"><span class="linenos">272</span></a><span class="sd">         read() </span>
</span><span id="ArchiveReader.get_all_entries-273"><a href="#ArchiveReader.get_all_entries-273"><span class="linenos">273</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.get_all_entries-274"><a href="#ArchiveReader.get_all_entries-274"><span class="linenos">274</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader.get_all_entries-275"><a href="#ArchiveReader.get_all_entries-275"><span class="linenos">275</span></a><span class="sd">            :</span>
</span><span id="ArchiveReader.get_all_entries-276"><a href="#ArchiveReader.get_all_entries-276"><span class="linenos">276</span></a><span class="sd">            - path: </span>
</span><span id="ArchiveReader.get_all_entries-277"><a href="#ArchiveReader.get_all_entries-277"><span class="linenos">277</span></a><span class="sd">            - raw_size: </span>
</span><span id="ArchiveReader.get_all_entries-278"><a href="#ArchiveReader.get_all_entries-278"><span class="linenos">278</span></a><span class="sd">            - packed_size: </span>
</span><span id="ArchiveReader.get_all_entries-279"><a href="#ArchiveReader.get_all_entries-279"><span class="linenos">279</span></a><span class="sd">            - algo_id:  ID (0=)</span>
</span><span id="ArchiveReader.get_all_entries-280"><a href="#ArchiveReader.get_all_entries-280"><span class="linenos">280</span></a><span class="sd">            - checksum:  (bytes)</span>
</span><span id="ArchiveReader.get_all_entries-281"><a href="#ArchiveReader.get_all_entries-281"><span class="linenos">281</span></a><span class="sd">            - checksum_hex:  (hex)</span>
</span><span id="ArchiveReader.get_all_entries-282"><a href="#ArchiveReader.get_all_entries-282"><span class="linenos">282</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.get_all_entries-283"><a href="#ArchiveReader.get_all_entries-283"><span class="linenos">283</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader.get_all_entries-284"><a href="#ArchiveReader.get_all_entries-284"><span class="linenos">284</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ArchiveReader.get_all_entries-285"><a href="#ArchiveReader.get_all_entries-285"><span class="linenos">285</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.get_all_entries-286"><a href="#ArchiveReader.get_all_entries-286"><span class="linenos">286</span></a><span class="sd">        Example:</span>
</span><span id="ArchiveReader.get_all_entries-287"><a href="#ArchiveReader.get_all_entries-287"><span class="linenos">287</span></a><span class="sd">            &gt;&gt;&gt; for entry in reader.get_all_entries():</span>
</span><span id="ArchiveReader.get_all_entries-288"><a href="#ArchiveReader.get_all_entries-288"><span class="linenos">288</span></a><span class="sd">            ...     print(f&quot;{entry[&#39;path&#39;]}: {entry[&#39;raw_size&#39;]} bytes&quot;)</span>
</span><span id="ArchiveReader.get_all_entries-289"><a href="#ArchiveReader.get_all_entries-289"><span class="linenos">289</span></a><span class="sd">            ...     if entry[&#39;raw_size&#39;] &gt; 0:</span>
</span><span id="ArchiveReader.get_all_entries-290"><a href="#ArchiveReader.get_all_entries-290"><span class="linenos">290</span></a><span class="sd">            ...         data = reader.read(entry[&#39;path&#39;])  # </span>
</span><span id="ArchiveReader.get_all_entries-291"><a href="#ArchiveReader.get_all_entries-291"><span class="linenos">291</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.get_all_entries-292"><a href="#ArchiveReader.get_all_entries-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader.get_all_entries-293"><a href="#ArchiveReader.get_all_entries-293"><span class="linenos">293</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ArchiveReader.get_all_entries-294"><a href="#ArchiveReader.get_all_entries-294"><span class="linenos">294</span></a>        
</span><span id="ArchiveReader.get_all_entries-295"><a href="#ArchiveReader.get_all_entries-295"><span class="linenos">295</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ArchiveReader.get_all_entries-296"><a href="#ArchiveReader.get_all_entries-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ArchiveReader.get_all_entries-297"><a href="#ArchiveReader.get_all_entries-297"><span class="linenos">297</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ArchiveReader.get_all_entries-298"><a href="#ArchiveReader.get_all_entries-298"><span class="linenos">298</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ArchiveReader.get_all_entries-299"><a href="#ArchiveReader.get_all_entries-299"><span class="linenos">299</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader.get_all_entries-300"><a href="#ArchiveReader.get_all_entries-300"><span class="linenos">300</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ArchiveReader.get_all_entries-301"><a href="#ArchiveReader.get_all_entries-301"><span class="linenos">301</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">full_path</span><span class="p">,</span>
</span><span id="ArchiveReader.get_all_entries-302"><a href="#ArchiveReader.get_all_entries-302"><span class="linenos">302</span></a>                <span class="s1">&#39;raw_size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ArchiveReader.get_all_entries-303"><a href="#ArchiveReader.get_all_entries-303"><span class="linenos">303</span></a>                <span class="s1">&#39;packed_size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">packed_size</span><span class="p">,</span>
</span><span id="ArchiveReader.get_all_entries-304"><a href="#ArchiveReader.get_all_entries-304"><span class="linenos">304</span></a>                <span class="s1">&#39;algo_id&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">algo_id</span><span class="p">,</span>
</span><span id="ArchiveReader.get_all_entries-305"><a href="#ArchiveReader.get_all_entries-305"><span class="linenos">305</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span>
</span><span id="ArchiveReader.get_all_entries-306"><a href="#ArchiveReader.get_all_entries-306"><span class="linenos">306</span></a>                <span class="s1">&#39;checksum_hex&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="ArchiveReader.get_all_entries-307"><a href="#ArchiveReader.get_all_entries-307"><span class="linenos">307</span></a>            <span class="p">})</span>
</span><span id="ArchiveReader.get_all_entries-308"><a href="#ArchiveReader.get_all_entries-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>
 read() </p>

<p>Returns:
    :
    - path: 
    - raw_size: 
    - packed_size: 
    - algo_id:  ID (0=)
    - checksum:  (bytes)
    - checksum_hex:  (hex)</p>

<p>Raises:
    IndexNotDecryptedError: </p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>for entry in reader.get_all_entries():
          ...     print(f"{entry['path']}: {entry['raw_size']} bytes")
          ...     if entry['raw_size'] &gt; 0:
          ...         data = reader.read(entry['path'])  # </p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="ArchiveReader.iter_entries" class="classattr">
                                        <input id="ArchiveReader.iter_entries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">iter_entries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ArchiveReader.iter_entries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.iter_entries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.iter_entries-310"><a href="#ArchiveReader.iter_entries-310"><span class="linenos">310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iter_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ArchiveReader.iter_entries-311"><a href="#ArchiveReader.iter_entries-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.iter_entries-312"><a href="#ArchiveReader.iter_entries-312"><span class="linenos">312</span></a><span class="sd">         ()</span>
</span><span id="ArchiveReader.iter_entries-313"><a href="#ArchiveReader.iter_entries-313"><span class="linenos">313</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.iter_entries-314"><a href="#ArchiveReader.iter_entries-314"><span class="linenos">314</span></a><span class="sd">        Yields:</span>
</span><span id="ArchiveReader.iter_entries-315"><a href="#ArchiveReader.iter_entries-315"><span class="linenos">315</span></a><span class="sd">            (path, entry) </span>
</span><span id="ArchiveReader.iter_entries-316"><a href="#ArchiveReader.iter_entries-316"><span class="linenos">316</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.iter_entries-317"><a href="#ArchiveReader.iter_entries-317"><span class="linenos">317</span></a><span class="sd">        Raises:</span>
</span><span id="ArchiveReader.iter_entries-318"><a href="#ArchiveReader.iter_entries-318"><span class="linenos">318</span></a><span class="sd">            IndexNotDecryptedError: </span>
</span><span id="ArchiveReader.iter_entries-319"><a href="#ArchiveReader.iter_entries-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.iter_entries-320"><a href="#ArchiveReader.iter_entries-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader.iter_entries-321"><a href="#ArchiveReader.iter_entries-321"><span class="linenos">321</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">()</span>
</span><span id="ArchiveReader.iter_entries-322"><a href="#ArchiveReader.iter_entries-322"><span class="linenos">322</span></a>        
</span><span id="ArchiveReader.iter_entries-323"><a href="#ArchiveReader.iter_entries-323"><span class="linenos">323</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ArchiveReader.iter_entries-324"><a href="#ArchiveReader.iter_entries-324"><span class="linenos">324</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
</span><span id="ArchiveReader.iter_entries-325"><a href="#ArchiveReader.iter_entries-325"><span class="linenos">325</span></a>                <span class="n">entry</span><span class="o">.</span><span class="n">dir_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">name_id</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">ext_id</span>
</span><span id="ArchiveReader.iter_entries-326"><a href="#ArchiveReader.iter_entries-326"><span class="linenos">326</span></a>            <span class="p">)</span>
</span><span id="ArchiveReader.iter_entries-327"><a href="#ArchiveReader.iter_entries-327"><span class="linenos">327</span></a>            <span class="k">yield</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">entry</span>
</span></pre></div>


            <div class="docstring"><p> ()</p>

<p>Yields:
    (path, entry) </p>

<p>Raises:
    IndexNotDecryptedError: </p>
</div>


                            </div>
                            <div id="ArchiveReader.list_hashes" class="classattr">
                                        <input id="ArchiveReader.list_hashes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_hashes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.list_hashes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.list_hashes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.list_hashes-329"><a href="#ArchiveReader.list_hashes-329"><span class="linenos">329</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ArchiveReader.list_hashes-330"><a href="#ArchiveReader.list_hashes-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Hash&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.list_hashes-331"><a href="#ArchiveReader.list_hashes-331"><span class="linenos">331</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p> Hash</p>
</div>


                            </div>
                            <div id="ArchiveReader.file_header" class="classattr">
                                        <input id="ArchiveReader.file_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">file_header</span><span class="annotation">: grimoire.core.schema.FileHeader</span>

                <label class="view-source-button" for="ArchiveReader.file_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.file_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.file_header-333"><a href="#ArchiveReader.file_header-333"><span class="linenos">333</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader.file_header-334"><a href="#ArchiveReader.file_header-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileHeader</span><span class="p">:</span>
</span><span id="ArchiveReader.file_header-335"><a href="#ArchiveReader.file_header-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_header</span>
</span></pre></div>


    

                            </div>
                            <div id="ArchiveReader.index_header" class="classattr">
                                        <input id="ArchiveReader.index_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">index_header</span><span class="annotation">: grimoire.core.schema.IndexHeader</span>

                <label class="view-source-button" for="ArchiveReader.index_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.index_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.index_header-337"><a href="#ArchiveReader.index_header-337"><span class="linenos">337</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader.index_header-338"><a href="#ArchiveReader.index_header-338"><span class="linenos">338</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">index_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IndexHeader</span><span class="p">:</span>
</span><span id="ArchiveReader.index_header-339"><a href="#ArchiveReader.index_header-339"><span class="linenos">339</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_header</span>
</span></pre></div>


    

                            </div>
                            <div id="ArchiveReader.data_header" class="classattr">
                                        <input id="ArchiveReader.data_header-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">data_header</span><span class="annotation">: grimoire.core.schema.DataHeader</span>

                <label class="view-source-button" for="ArchiveReader.data_header-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.data_header"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.data_header-341"><a href="#ArchiveReader.data_header-341"><span class="linenos">341</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader.data_header-342"><a href="#ArchiveReader.data_header-342"><span class="linenos">342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">data_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataHeader</span><span class="p">:</span>
</span><span id="ArchiveReader.data_header-343"><a href="#ArchiveReader.data_header-343"><span class="linenos">343</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span>
</span></pre></div>


    

                            </div>
                            <div id="ArchiveReader.entry_count" class="classattr">
                                        <input id="ArchiveReader.entry_count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">entry_count</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ArchiveReader.entry_count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.entry_count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.entry_count-345"><a href="#ArchiveReader.entry_count-345"><span class="linenos">345</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader.entry_count-346"><a href="#ArchiveReader.entry_count-346"><span class="linenos">346</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">entry_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ArchiveReader.entry_count-347"><a href="#ArchiveReader.entry_count-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ArchiveReader.is_decrypted" class="classattr">
                                        <input id="ArchiveReader.is_decrypted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">is_decrypted</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="ArchiveReader.is_decrypted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.is_decrypted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.is_decrypted-349"><a href="#ArchiveReader.is_decrypted-349"><span class="linenos">349</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader.is_decrypted-350"><a href="#ArchiveReader.is_decrypted-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_decrypted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ArchiveReader.is_decrypted-351"><a href="#ArchiveReader.is_decrypted-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span>
</span></pre></div>


    

                            </div>
                            <div id="ArchiveReader.is_mmap" class="classattr">
                                        <input id="ArchiveReader.is_mmap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">is_mmap</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="ArchiveReader.is_mmap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.is_mmap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.is_mmap-353"><a href="#ArchiveReader.is_mmap-353"><span class="linenos">353</span></a>    <span class="nd">@property</span>
</span><span id="ArchiveReader.is_mmap-354"><a href="#ArchiveReader.is_mmap-354"><span class="linenos">354</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_mmap</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ArchiveReader.is_mmap-355"><a href="#ArchiveReader.is_mmap-355"><span class="linenos">355</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="ArchiveReader.close" class="classattr">
                                        <input id="ArchiveReader.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.close-357"><a href="#ArchiveReader.close-357"><span class="linenos">357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ArchiveReader.close-358"><a href="#ArchiveReader.close-358"><span class="linenos">358</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.close-359"><a href="#ArchiveReader.close-359"><span class="linenos">359</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="p">:</span>
</span><span id="ArchiveReader.close-360"><a href="#ArchiveReader.close-360"><span class="linenos">360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ArchiveReader.close-361"><a href="#ArchiveReader.close-361"><span class="linenos">361</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mmap</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.close-362"><a href="#ArchiveReader.close-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span>
</span><span id="ArchiveReader.close-363"><a href="#ArchiveReader.close-363"><span class="linenos">363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="ArchiveReader.close-364"><a href="#ArchiveReader.close-364"><span class="linenos">364</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ArchiveReader.read_batch" class="classattr">
                                        <input id="ArchiveReader.read_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vfs_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.read_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.read_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.read_batch-374"><a href="#ArchiveReader.read_batch-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_batch</span><span class="p">(</span>
</span><span id="ArchiveReader.read_batch-375"><a href="#ArchiveReader.read_batch-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveReader.read_batch-376"><a href="#ArchiveReader.read_batch-376"><span class="linenos">376</span></a>        <span class="n">vfs_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="ArchiveReader.read_batch-377"><a href="#ArchiveReader.read_batch-377"><span class="linenos">377</span></a>        <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ArchiveReader.read_batch-378"><a href="#ArchiveReader.read_batch-378"><span class="linenos">378</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>
</span><span id="ArchiveReader.read_batch-379"><a href="#ArchiveReader.read_batch-379"><span class="linenos">379</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="ArchiveReader.read_batch-380"><a href="#ArchiveReader.read_batch-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.read_batch-381"><a href="#ArchiveReader.read_batch-381"><span class="linenos">381</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.read_batch-382"><a href="#ArchiveReader.read_batch-382"><span class="linenos">382</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.read_batch-383"><a href="#ArchiveReader.read_batch-383"><span class="linenos">383</span></a><span class="sd">        mmap </span>
</span><span id="ArchiveReader.read_batch-384"><a href="#ArchiveReader.read_batch-384"><span class="linenos">384</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.read_batch-385"><a href="#ArchiveReader.read_batch-385"><span class="linenos">385</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader.read_batch-386"><a href="#ArchiveReader.read_batch-386"><span class="linenos">386</span></a><span class="sd">            vfs_paths: </span>
</span><span id="ArchiveReader.read_batch-387"><a href="#ArchiveReader.read_batch-387"><span class="linenos">387</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader.read_batch-388"><a href="#ArchiveReader.read_batch-388"><span class="linenos">388</span></a><span class="sd">            on_error:  (&#39;raise&#39;, &#39;skip&#39;)</span>
</span><span id="ArchiveReader.read_batch-389"><a href="#ArchiveReader.read_batch-389"><span class="linenos">389</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.read_batch-390"><a href="#ArchiveReader.read_batch-390"><span class="linenos">390</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader.read_batch-391"><a href="#ArchiveReader.read_batch-391"><span class="linenos">391</span></a><span class="sd">            {vfs_path: data} </span>
</span><span id="ArchiveReader.read_batch-392"><a href="#ArchiveReader.read_batch-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.read_batch-393"><a href="#ArchiveReader.read_batch-393"><span class="linenos">393</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ArchiveReader.read_batch-394"><a href="#ArchiveReader.read_batch-394"><span class="linenos">394</span></a>        
</span><span id="ArchiveReader.read_batch-395"><a href="#ArchiveReader.read_batch-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">vfs_paths</span><span class="p">:</span>
</span><span id="ArchiveReader.read_batch-396"><a href="#ArchiveReader.read_batch-396"><span class="linenos">396</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ArchiveReader.read_batch-397"><a href="#ArchiveReader.read_batch-397"><span class="linenos">397</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
</span><span id="ArchiveReader.read_batch-398"><a href="#ArchiveReader.read_batch-398"><span class="linenos">398</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="ArchiveReader.read_batch-399"><a href="#ArchiveReader.read_batch-399"><span class="linenos">399</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ArchiveReader.read_batch-400"><a href="#ArchiveReader.read_batch-400"><span class="linenos">400</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader.read_batch-401"><a href="#ArchiveReader.read_batch-401"><span class="linenos">401</span></a>                    <span class="k">raise</span>
</span><span id="ArchiveReader.read_batch-402"><a href="#ArchiveReader.read_batch-402"><span class="linenos">402</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader.read_batch-403"><a href="#ArchiveReader.read_batch-403"><span class="linenos">403</span></a>                    <span class="k">continue</span>  <span class="c1"># </span>
</span><span id="ArchiveReader.read_batch-404"><a href="#ArchiveReader.read_batch-404"><span class="linenos">404</span></a>        
</span><span id="ArchiveReader.read_batch-405"><a href="#ArchiveReader.read_batch-405"><span class="linenos">405</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>mmap </p>

<p>Args:
    vfs_paths: 
    verify: 
    on_error:  ('raise', 'skip')</p>

<p>Returns:
    {vfs_path: data} </p>
</div>


                            </div>
                            <div id="ArchiveReader.extract_all" class="classattr">
                                        <input id="ArchiveReader.extract_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_all</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ArchiveReader.extract_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ArchiveReader.extract_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ArchiveReader.extract_all-407"><a href="#ArchiveReader.extract_all-407"><span class="linenos">407</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_all</span><span class="p">(</span>
</span><span id="ArchiveReader.extract_all-408"><a href="#ArchiveReader.extract_all-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ArchiveReader.extract_all-409"><a href="#ArchiveReader.extract_all-409"><span class="linenos">409</span></a>        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ArchiveReader.extract_all-410"><a href="#ArchiveReader.extract_all-410"><span class="linenos">410</span></a>        <span class="n">verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ArchiveReader.extract_all-411"><a href="#ArchiveReader.extract_all-411"><span class="linenos">411</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span>
</span><span id="ArchiveReader.extract_all-412"><a href="#ArchiveReader.extract_all-412"><span class="linenos">412</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ArchiveReader.extract_all-413"><a href="#ArchiveReader.extract_all-413"><span class="linenos">413</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-414"><a href="#ArchiveReader.extract_all-414"><span class="linenos">414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ArchiveReader.extract_all-415"><a href="#ArchiveReader.extract_all-415"><span class="linenos">415</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.extract_all-416"><a href="#ArchiveReader.extract_all-416"><span class="linenos">416</span></a><span class="sd">        </span>
</span><span id="ArchiveReader.extract_all-417"><a href="#ArchiveReader.extract_all-417"><span class="linenos">417</span></a><span class="sd">        Args:</span>
</span><span id="ArchiveReader.extract_all-418"><a href="#ArchiveReader.extract_all-418"><span class="linenos">418</span></a><span class="sd">            output_dir: </span>
</span><span id="ArchiveReader.extract_all-419"><a href="#ArchiveReader.extract_all-419"><span class="linenos">419</span></a><span class="sd">            verify: </span>
</span><span id="ArchiveReader.extract_all-420"><a href="#ArchiveReader.extract_all-420"><span class="linenos">420</span></a><span class="sd">            on_error: </span>
</span><span id="ArchiveReader.extract_all-421"><a href="#ArchiveReader.extract_all-421"><span class="linenos">421</span></a><span class="sd">            progress_callback: </span>
</span><span id="ArchiveReader.extract_all-422"><a href="#ArchiveReader.extract_all-422"><span class="linenos">422</span></a><span class="sd">            </span>
</span><span id="ArchiveReader.extract_all-423"><a href="#ArchiveReader.extract_all-423"><span class="linenos">423</span></a><span class="sd">        Returns:</span>
</span><span id="ArchiveReader.extract_all-424"><a href="#ArchiveReader.extract_all-424"><span class="linenos">424</span></a><span class="sd">            BatchResult </span>
</span><span id="ArchiveReader.extract_all-425"><a href="#ArchiveReader.extract_all-425"><span class="linenos">425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ArchiveReader.extract_all-426"><a href="#ArchiveReader.extract_all-426"><span class="linenos">426</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">..core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span><span class="p">,</span> <span class="n">ProgressInfo</span>
</span><span id="ArchiveReader.extract_all-427"><a href="#ArchiveReader.extract_all-427"><span class="linenos">427</span></a>        
</span><span id="ArchiveReader.extract_all-428"><a href="#ArchiveReader.extract_all-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_decrypted</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-429"><a href="#ArchiveReader.extract_all-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="n">IndexNotDecryptedError</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-430"><a href="#ArchiveReader.extract_all-430"><span class="linenos">430</span></a>        
</span><span id="ArchiveReader.extract_all-431"><a href="#ArchiveReader.extract_all-431"><span class="linenos">431</span></a>        <span class="n">all_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
</span><span id="ArchiveReader.extract_all-432"><a href="#ArchiveReader.extract_all-432"><span class="linenos">432</span></a>        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_paths</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-433"><a href="#ArchiveReader.extract_all-433"><span class="linenos">433</span></a>        <span class="n">total_bytes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_path_hash_func</span><span class="p">(</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">p</span><span class="p">))]</span><span class="o">.</span><span class="n">raw_size</span> 
</span><span id="ArchiveReader.extract_all-434"><a href="#ArchiveReader.extract_all-434"><span class="linenos">434</span></a>                         <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-435"><a href="#ArchiveReader.extract_all-435"><span class="linenos">435</span></a>        
</span><span id="ArchiveReader.extract_all-436"><a href="#ArchiveReader.extract_all-436"><span class="linenos">436</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ArchiveReader.extract_all-437"><a href="#ArchiveReader.extract_all-437"><span class="linenos">437</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="n">total_files</span><span class="p">,</span>
</span><span id="ArchiveReader.extract_all-438"><a href="#ArchiveReader.extract_all-438"><span class="linenos">438</span></a>            <span class="n">total_bytes</span><span class="o">=</span><span class="n">total_bytes</span><span class="p">,</span>
</span><span id="ArchiveReader.extract_all-439"><a href="#ArchiveReader.extract_all-439"><span class="linenos">439</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ArchiveReader.extract_all-440"><a href="#ArchiveReader.extract_all-440"><span class="linenos">440</span></a>        <span class="p">)</span>
</span><span id="ArchiveReader.extract_all-441"><a href="#ArchiveReader.extract_all-441"><span class="linenos">441</span></a>        
</span><span id="ArchiveReader.extract_all-442"><a href="#ArchiveReader.extract_all-442"><span class="linenos">442</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ArchiveReader.extract_all-443"><a href="#ArchiveReader.extract_all-443"><span class="linenos">443</span></a>        
</span><span id="ArchiveReader.extract_all-444"><a href="#ArchiveReader.extract_all-444"><span class="linenos">444</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader.extract_all-445"><a href="#ArchiveReader.extract_all-445"><span class="linenos">445</span></a>        <span class="n">dirs_to_create</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ArchiveReader.extract_all-446"><a href="#ArchiveReader.extract_all-446"><span class="linenos">446</span></a>        <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-447"><a href="#ArchiveReader.extract_all-447"><span class="linenos">447</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ArchiveReader.extract_all-448"><a href="#ArchiveReader.extract_all-448"><span class="linenos">448</span></a>            <span class="n">dirs_to_create</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">local_path</span><span class="p">))</span>
</span><span id="ArchiveReader.extract_all-449"><a href="#ArchiveReader.extract_all-449"><span class="linenos">449</span></a>        
</span><span id="ArchiveReader.extract_all-450"><a href="#ArchiveReader.extract_all-450"><span class="linenos">450</span></a>        <span class="k">for</span> <span class="n">dir_path</span> <span class="ow">in</span> <span class="n">dirs_to_create</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-451"><a href="#ArchiveReader.extract_all-451"><span class="linenos">451</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-452"><a href="#ArchiveReader.extract_all-452"><span class="linenos">452</span></a>        
</span><span id="ArchiveReader.extract_all-453"><a href="#ArchiveReader.extract_all-453"><span class="linenos">453</span></a>        <span class="c1"># </span>
</span><span id="ArchiveReader.extract_all-454"><a href="#ArchiveReader.extract_all-454"><span class="linenos">454</span></a>        <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-455"><a href="#ArchiveReader.extract_all-455"><span class="linenos">455</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-456"><a href="#ArchiveReader.extract_all-456"><span class="linenos">456</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-457"><a href="#ArchiveReader.extract_all-457"><span class="linenos">457</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ArchiveReader.extract_all-458"><a href="#ArchiveReader.extract_all-458"><span class="linenos">458</span></a>                
</span><span id="ArchiveReader.extract_all-459"><a href="#ArchiveReader.extract_all-459"><span class="linenos">459</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-460"><a href="#ArchiveReader.extract_all-460"><span class="linenos">460</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-461"><a href="#ArchiveReader.extract_all-461"><span class="linenos">461</span></a>                
</span><span id="ArchiveReader.extract_all-462"><a href="#ArchiveReader.extract_all-462"><span class="linenos">462</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveReader.extract_all-463"><a href="#ArchiveReader.extract_all-463"><span class="linenos">463</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-464"><a href="#ArchiveReader.extract_all-464"><span class="linenos">464</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="ArchiveReader.extract_all-465"><a href="#ArchiveReader.extract_all-465"><span class="linenos">465</span></a>                
</span><span id="ArchiveReader.extract_all-466"><a href="#ArchiveReader.extract_all-466"><span class="linenos">466</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-467"><a href="#ArchiveReader.extract_all-467"><span class="linenos">467</span></a>                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-468"><a href="#ArchiveReader.extract_all-468"><span class="linenos">468</span></a>                    <span class="k">raise</span>
</span><span id="ArchiveReader.extract_all-469"><a href="#ArchiveReader.extract_all-469"><span class="linenos">469</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-470"><a href="#ArchiveReader.extract_all-470"><span class="linenos">470</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveReader.extract_all-471"><a href="#ArchiveReader.extract_all-471"><span class="linenos">471</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveReader.extract_all-472"><a href="#ArchiveReader.extract_all-472"><span class="linenos">472</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ArchiveReader.extract_all-473"><a href="#ArchiveReader.extract_all-473"><span class="linenos">473</span></a>                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s1">&#39;abort&#39;</span><span class="p">:</span>
</span><span id="ArchiveReader.extract_all-474"><a href="#ArchiveReader.extract_all-474"><span class="linenos">474</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ArchiveReader.extract_all-475"><a href="#ArchiveReader.extract_all-475"><span class="linenos">475</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ArchiveReader.extract_all-476"><a href="#ArchiveReader.extract_all-476"><span class="linenos">476</span></a>                    <span class="k">break</span>
</span><span id="ArchiveReader.extract_all-477"><a href="#ArchiveReader.extract_all-477"><span class="linenos">477</span></a>        
</span><span id="ArchiveReader.extract_all-478"><a href="#ArchiveReader.extract_all-478"><span class="linenos">478</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ArchiveReader.extract_all-479"><a href="#ArchiveReader.extract_all-479"><span class="linenos">479</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    output_dir: 
    verify: 
    on_error: 
    progress_callback: </p>

<p>Returns:
    BatchResult </p>
</div>


                            </div>
                </section>
                <section id="ManifestJsonConverter">
                            <input id="ManifestJsonConverter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ManifestJsonConverter</span>:

                <label class="view-source-button" for="ManifestJsonConverter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestJsonConverter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestJsonConverter-25"><a href="#ManifestJsonConverter-25"><span class="linenos"> 25</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ManifestJsonConverter</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-26"><a href="#ManifestJsonConverter-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter-27"><a href="#ManifestJsonConverter-27"><span class="linenos"> 27</span></a><span class="sd">    Manifest  JSON </span>
</span><span id="ManifestJsonConverter-28"><a href="#ManifestJsonConverter-28"><span class="linenos"> 28</span></a><span class="sd">    </span>
</span><span id="ManifestJsonConverter-29"><a href="#ManifestJsonConverter-29"><span class="linenos"> 29</span></a><span class="sd">    JSON  (v2 -  ID):</span>
</span><span id="ManifestJsonConverter-30"><a href="#ManifestJsonConverter-30"><span class="linenos"> 30</span></a><span class="sd">    {</span>
</span><span id="ManifestJsonConverter-31"><a href="#ManifestJsonConverter-31"><span class="linenos"> 31</span></a><span class="sd">        &quot;version&quot;: 2,</span>
</span><span id="ManifestJsonConverter-32"><a href="#ManifestJsonConverter-32"><span class="linenos"> 32</span></a><span class="sd">        &quot;magic&quot;: &quot;GRIM&quot;,</span>
</span><span id="ManifestJsonConverter-33"><a href="#ManifestJsonConverter-33"><span class="linenos"> 33</span></a><span class="sd">        &quot;checksum_algo&quot;: 101,    //  ID ()</span>
</span><span id="ManifestJsonConverter-34"><a href="#ManifestJsonConverter-34"><span class="linenos"> 34</span></a><span class="sd">        &quot;index_flags&quot;: 2,        // </span>
</span><span id="ManifestJsonConverter-35"><a href="#ManifestJsonConverter-35"><span class="linenos"> 35</span></a><span class="sd">        &quot;entries&quot;: [...]</span>
</span><span id="ManifestJsonConverter-36"><a href="#ManifestJsonConverter-36"><span class="linenos"> 36</span></a><span class="sd">    }</span>
</span><span id="ManifestJsonConverter-37"><a href="#ManifestJsonConverter-37"><span class="linenos"> 37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter-38"><a href="#ManifestJsonConverter-38"><span class="linenos"> 38</span></a>    
</span><span id="ManifestJsonConverter-39"><a href="#ManifestJsonConverter-39"><span class="linenos"> 39</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ManifestJsonConverter-40"><a href="#ManifestJsonConverter-40"><span class="linenos"> 40</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">manifest_to_json</span><span class="p">(</span>
</span><span id="ManifestJsonConverter-41"><a href="#ManifestJsonConverter-41"><span class="linenos"> 41</span></a>        <span class="n">manifest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-42"><a href="#ManifestJsonConverter-42"><span class="linenos"> 42</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-43"><a href="#ManifestJsonConverter-43"><span class="linenos"> 43</span></a>        <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="ManifestJsonConverter-44"><a href="#ManifestJsonConverter-44"><span class="linenos"> 44</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-45"><a href="#ManifestJsonConverter-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter-46"><a href="#ManifestJsonConverter-46"><span class="linenos"> 46</span></a><span class="sd">         Manifest  JSON </span>
</span><span id="ManifestJsonConverter-47"><a href="#ManifestJsonConverter-47"><span class="linenos"> 47</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter-48"><a href="#ManifestJsonConverter-48"><span class="linenos"> 48</span></a><span class="sd">         ID  Hook</span>
</span><span id="ManifestJsonConverter-49"><a href="#ManifestJsonConverter-49"><span class="linenos"> 49</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter-50"><a href="#ManifestJsonConverter-50"><span class="linenos"> 50</span></a><span class="sd">        Args:</span>
</span><span id="ManifestJsonConverter-51"><a href="#ManifestJsonConverter-51"><span class="linenos"> 51</span></a><span class="sd">            manifest_path: Manifest </span>
</span><span id="ManifestJsonConverter-52"><a href="#ManifestJsonConverter-52"><span class="linenos"> 52</span></a><span class="sd">            output_path:  JSON </span>
</span><span id="ManifestJsonConverter-53"><a href="#ManifestJsonConverter-53"><span class="linenos"> 53</span></a><span class="sd">            indent: JSON </span>
</span><span id="ManifestJsonConverter-54"><a href="#ManifestJsonConverter-54"><span class="linenos"> 54</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter-55"><a href="#ManifestJsonConverter-55"><span class="linenos"> 55</span></a>        <span class="c1"># 1.  algo_id  flags Hook</span>
</span><span id="ManifestJsonConverter-56"><a href="#ManifestJsonConverter-56"><span class="linenos"> 56</span></a>        <span class="c1">#  Reader  ( Hook )</span>
</span><span id="ManifestJsonConverter-57"><a href="#ManifestJsonConverter-57"><span class="linenos"> 57</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileHeader</span>
</span><span id="ManifestJsonConverter-58"><a href="#ManifestJsonConverter-58"><span class="linenos"> 58</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.binary_io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BinaryReader</span>
</span><span id="ManifestJsonConverter-59"><a href="#ManifestJsonConverter-59"><span class="linenos"> 59</span></a>        
</span><span id="ManifestJsonConverter-60"><a href="#ManifestJsonConverter-60"><span class="linenos"> 60</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-61"><a href="#ManifestJsonConverter-61"><span class="linenos"> 61</span></a>            <span class="n">header</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">))</span>
</span><span id="ManifestJsonConverter-62"><a href="#ManifestJsonConverter-62"><span class="linenos"> 62</span></a>        
</span><span id="ManifestJsonConverter-63"><a href="#ManifestJsonConverter-63"><span class="linenos"> 63</span></a>        <span class="n">algo_id</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">checksum_algo</span>
</span><span id="ManifestJsonConverter-64"><a href="#ManifestJsonConverter-64"><span class="linenos"> 64</span></a>        <span class="n">flags</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">flags</span>
</span><span id="ManifestJsonConverter-65"><a href="#ManifestJsonConverter-65"><span class="linenos"> 65</span></a>        
</span><span id="ManifestJsonConverter-66"><a href="#ManifestJsonConverter-66"><span class="linenos"> 66</span></a>        <span class="c1"># 2.  ID  Hook</span>
</span><span id="ManifestJsonConverter-67"><a href="#ManifestJsonConverter-67"><span class="linenos"> 67</span></a>        <span class="n">checksum_hook</span> <span class="o">=</span> <span class="n">get_checksum_hook_by_id</span><span class="p">(</span><span class="n">algo_id</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-68"><a href="#ManifestJsonConverter-68"><span class="linenos"> 68</span></a>        <span class="n">index_crypto</span> <span class="o">=</span> <span class="n">get_index_crypto_by_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-69"><a href="#ManifestJsonConverter-69"><span class="linenos"> 69</span></a>        
</span><span id="ManifestJsonConverter-70"><a href="#ManifestJsonConverter-70"><span class="linenos"> 70</span></a>        <span class="c1"># 3.  Hook  Manifest</span>
</span><span id="ManifestJsonConverter-71"><a href="#ManifestJsonConverter-71"><span class="linenos"> 71</span></a>        <span class="k">with</span> <span class="n">ManifestReader</span><span class="p">(</span>
</span><span id="ManifestJsonConverter-72"><a href="#ManifestJsonConverter-72"><span class="linenos"> 72</span></a>            <span class="n">manifest_path</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-73"><a href="#ManifestJsonConverter-73"><span class="linenos"> 73</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-74"><a href="#ManifestJsonConverter-74"><span class="linenos"> 74</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto</span>
</span><span id="ManifestJsonConverter-75"><a href="#ManifestJsonConverter-75"><span class="linenos"> 75</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-76"><a href="#ManifestJsonConverter-76"><span class="linenos"> 76</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestJsonConverter-77"><a href="#ManifestJsonConverter-77"><span class="linenos"> 77</span></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">list_all</span><span class="p">():</span>
</span><span id="ManifestJsonConverter-78"><a href="#ManifestJsonConverter-78"><span class="linenos"> 78</span></a>                <span class="n">entry</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-79"><a href="#ManifestJsonConverter-79"><span class="linenos"> 79</span></a>                <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ManifestJsonConverter-80"><a href="#ManifestJsonConverter-80"><span class="linenos"> 80</span></a>                    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-81"><a href="#ManifestJsonConverter-81"><span class="linenos"> 81</span></a>                    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-82"><a href="#ManifestJsonConverter-82"><span class="linenos"> 82</span></a>                    <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="ManifestJsonConverter-83"><a href="#ManifestJsonConverter-83"><span class="linenos"> 83</span></a>                <span class="p">})</span>
</span><span id="ManifestJsonConverter-84"><a href="#ManifestJsonConverter-84"><span class="linenos"> 84</span></a>            
</span><span id="ManifestJsonConverter-85"><a href="#ManifestJsonConverter-85"><span class="linenos"> 85</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ManifestJsonConverter-86"><a href="#ManifestJsonConverter-86"><span class="linenos"> 86</span></a>                <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-87"><a href="#ManifestJsonConverter-87"><span class="linenos"> 87</span></a>                <span class="s1">&#39;magic&#39;</span><span class="p">:</span> <span class="n">reader</span><span class="o">.</span><span class="n">file_header</span><span class="o">.</span><span class="n">magic</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">),</span>
</span><span id="ManifestJsonConverter-88"><a href="#ManifestJsonConverter-88"><span class="linenos"> 88</span></a>                <span class="s1">&#39;checksum_algo&#39;</span><span class="p">:</span> <span class="n">algo_id</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-89"><a href="#ManifestJsonConverter-89"><span class="linenos"> 89</span></a>                <span class="s1">&#39;checksum_algo_name&#39;</span><span class="p">:</span> <span class="n">get_hook_name</span><span class="p">(</span><span class="n">checksum_hook</span><span class="p">),</span>
</span><span id="ManifestJsonConverter-90"><a href="#ManifestJsonConverter-90"><span class="linenos"> 90</span></a>                <span class="s1">&#39;index_flags&#39;</span><span class="p">:</span> <span class="n">flags</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-91"><a href="#ManifestJsonConverter-91"><span class="linenos"> 91</span></a>                <span class="s1">&#39;index_flags_name&#39;</span><span class="p">:</span> <span class="n">get_hook_name</span><span class="p">(</span><span class="n">index_crypto</span><span class="p">),</span>
</span><span id="ManifestJsonConverter-92"><a href="#ManifestJsonConverter-92"><span class="linenos"> 92</span></a>                <span class="s1">&#39;entry_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
</span><span id="ManifestJsonConverter-93"><a href="#ManifestJsonConverter-93"><span class="linenos"> 93</span></a>                <span class="s1">&#39;entries&#39;</span><span class="p">:</span> <span class="n">entries</span>
</span><span id="ManifestJsonConverter-94"><a href="#ManifestJsonConverter-94"><span class="linenos"> 94</span></a>            <span class="p">}</span>
</span><span id="ManifestJsonConverter-95"><a href="#ManifestJsonConverter-95"><span class="linenos"> 95</span></a>        
</span><span id="ManifestJsonConverter-96"><a href="#ManifestJsonConverter-96"><span class="linenos"> 96</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-97"><a href="#ManifestJsonConverter-97"><span class="linenos"> 97</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-98"><a href="#ManifestJsonConverter-98"><span class="linenos"> 98</span></a>    
</span><span id="ManifestJsonConverter-99"><a href="#ManifestJsonConverter-99"><span class="linenos"> 99</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ManifestJsonConverter-100"><a href="#ManifestJsonConverter-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json_to_manifest</span><span class="p">(</span>
</span><span id="ManifestJsonConverter-101"><a href="#ManifestJsonConverter-101"><span class="linenos">101</span></a>        <span class="n">json_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-102"><a href="#ManifestJsonConverter-102"><span class="linenos">102</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-103"><a href="#ManifestJsonConverter-103"><span class="linenos">103</span></a>        <span class="n">local_base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-104"><a href="#ManifestJsonConverter-104"><span class="linenos">104</span></a>        <span class="n">path_mappings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-105"><a href="#ManifestJsonConverter-105"><span class="linenos">105</span></a>        <span class="n">checksum_hook_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-106"><a href="#ManifestJsonConverter-106"><span class="linenos">106</span></a>        <span class="n">index_crypto_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-107"><a href="#ManifestJsonConverter-107"><span class="linenos">107</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestJsonConverter-108"><a href="#ManifestJsonConverter-108"><span class="linenos">108</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-109"><a href="#ManifestJsonConverter-109"><span class="linenos">109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter-110"><a href="#ManifestJsonConverter-110"><span class="linenos">110</span></a><span class="sd">         JSON  Manifest </span>
</span><span id="ManifestJsonConverter-111"><a href="#ManifestJsonConverter-111"><span class="linenos">111</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter-112"><a href="#ManifestJsonConverter-112"><span class="linenos">112</span></a><span class="sd">         JSON  checksum_algo/index_flags  Hook</span>
</span><span id="ManifestJsonConverter-113"><a href="#ManifestJsonConverter-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter-114"><a href="#ManifestJsonConverter-114"><span class="linenos">114</span></a><span class="sd">        Args:</span>
</span><span id="ManifestJsonConverter-115"><a href="#ManifestJsonConverter-115"><span class="linenos">115</span></a><span class="sd">            json_path: JSON </span>
</span><span id="ManifestJsonConverter-116"><a href="#ManifestJsonConverter-116"><span class="linenos">116</span></a><span class="sd">            output_path:  Manifest </span>
</span><span id="ManifestJsonConverter-117"><a href="#ManifestJsonConverter-117"><span class="linenos">117</span></a><span class="sd">            local_base_path: </span>
</span><span id="ManifestJsonConverter-118"><a href="#ManifestJsonConverter-118"><span class="linenos">118</span></a><span class="sd">            path_mappings:  {: }</span>
</span><span id="ManifestJsonConverter-119"><a href="#ManifestJsonConverter-119"><span class="linenos">119</span></a><span class="sd">            checksum_hook_override:  JSON  Hook</span>
</span><span id="ManifestJsonConverter-120"><a href="#ManifestJsonConverter-120"><span class="linenos">120</span></a><span class="sd">            index_crypto_override:  JSON  Hook</span>
</span><span id="ManifestJsonConverter-121"><a href="#ManifestJsonConverter-121"><span class="linenos">121</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestJsonConverter-122"><a href="#ManifestJsonConverter-122"><span class="linenos">122</span></a><span class="sd">            </span>
</span><span id="ManifestJsonConverter-123"><a href="#ManifestJsonConverter-123"><span class="linenos">123</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestJsonConverter-124"><a href="#ManifestJsonConverter-124"><span class="linenos">124</span></a><span class="sd">            BatchResult</span>
</span><span id="ManifestJsonConverter-125"><a href="#ManifestJsonConverter-125"><span class="linenos">125</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter-126"><a href="#ManifestJsonConverter-126"><span class="linenos">126</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileItem</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span>
</span><span id="ManifestJsonConverter-127"><a href="#ManifestJsonConverter-127"><span class="linenos">127</span></a>        
</span><span id="ManifestJsonConverter-128"><a href="#ManifestJsonConverter-128"><span class="linenos">128</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-129"><a href="#ManifestJsonConverter-129"><span class="linenos">129</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-130"><a href="#ManifestJsonConverter-130"><span class="linenos">130</span></a>        
</span><span id="ManifestJsonConverter-131"><a href="#ManifestJsonConverter-131"><span class="linenos">131</span></a>        <span class="c1">#  checksum_algo ID  Hook ( override)</span>
</span><span id="ManifestJsonConverter-132"><a href="#ManifestJsonConverter-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="n">checksum_hook_override</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-133"><a href="#ManifestJsonConverter-133"><span class="linenos">133</span></a>            <span class="n">checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook_override</span>
</span><span id="ManifestJsonConverter-134"><a href="#ManifestJsonConverter-134"><span class="linenos">134</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-135"><a href="#ManifestJsonConverter-135"><span class="linenos">135</span></a>            <span class="n">algo_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;checksum_algo&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-136"><a href="#ManifestJsonConverter-136"><span class="linenos">136</span></a>            <span class="n">checksum_hook</span> <span class="o">=</span> <span class="n">get_checksum_hook_by_id</span><span class="p">(</span><span class="n">algo_id</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-137"><a href="#ManifestJsonConverter-137"><span class="linenos">137</span></a>        
</span><span id="ManifestJsonConverter-138"><a href="#ManifestJsonConverter-138"><span class="linenos">138</span></a>        <span class="c1">#  index_flags  Hook ( override)</span>
</span><span id="ManifestJsonConverter-139"><a href="#ManifestJsonConverter-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">index_crypto_override</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-140"><a href="#ManifestJsonConverter-140"><span class="linenos">140</span></a>            <span class="n">index_crypto</span> <span class="o">=</span> <span class="n">index_crypto_override</span>
</span><span id="ManifestJsonConverter-141"><a href="#ManifestJsonConverter-141"><span class="linenos">141</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-142"><a href="#ManifestJsonConverter-142"><span class="linenos">142</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;index_flags&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-143"><a href="#ManifestJsonConverter-143"><span class="linenos">143</span></a>            <span class="n">index_crypto</span> <span class="o">=</span> <span class="n">get_index_crypto_by_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-144"><a href="#ManifestJsonConverter-144"><span class="linenos">144</span></a>        
</span><span id="ManifestJsonConverter-145"><a href="#ManifestJsonConverter-145"><span class="linenos">145</span></a>        <span class="c1"># </span>
</span><span id="ManifestJsonConverter-146"><a href="#ManifestJsonConverter-146"><span class="linenos">146</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-147"><a href="#ManifestJsonConverter-147"><span class="linenos">147</span></a>            <span class="k">if</span> <span class="n">path_mappings</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-148"><a href="#ManifestJsonConverter-148"><span class="linenos">148</span></a>                <span class="k">for</span> <span class="n">vfs_prefix</span><span class="p">,</span> <span class="n">local_prefix</span> <span class="ow">in</span> <span class="n">path_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ManifestJsonConverter-149"><a href="#ManifestJsonConverter-149"><span class="linenos">149</span></a>                    <span class="k">if</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):</span>
</span><span id="ManifestJsonConverter-150"><a href="#ManifestJsonConverter-150"><span class="linenos">150</span></a>                        <span class="n">rel</span> <span class="o">=</span> <span class="n">vfs_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-151"><a href="#ManifestJsonConverter-151"><span class="linenos">151</span></a>                        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_prefix</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-152"><a href="#ManifestJsonConverter-152"><span class="linenos">152</span></a>            <span class="c1"># : base_path + vfs_path</span>
</span><span id="ManifestJsonConverter-153"><a href="#ManifestJsonConverter-153"><span class="linenos">153</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_base_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ManifestJsonConverter-154"><a href="#ManifestJsonConverter-154"><span class="linenos">154</span></a>        
</span><span id="ManifestJsonConverter-155"><a href="#ManifestJsonConverter-155"><span class="linenos">155</span></a>        <span class="c1">#  Manifest</span>
</span><span id="ManifestJsonConverter-156"><a href="#ManifestJsonConverter-156"><span class="linenos">156</span></a>        <span class="n">magic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;magic&#39;</span><span class="p">,</span> <span class="s1">&#39;GRIM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-157"><a href="#ManifestJsonConverter-157"><span class="linenos">157</span></a>        <span class="n">builder</span> <span class="o">=</span> <span class="n">ManifestBuilder</span><span class="p">(</span>
</span><span id="ManifestJsonConverter-158"><a href="#ManifestJsonConverter-158"><span class="linenos">158</span></a>            <span class="n">output_path</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-159"><a href="#ManifestJsonConverter-159"><span class="linenos">159</span></a>            <span class="n">magic</span><span class="o">=</span><span class="n">magic</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-160"><a href="#ManifestJsonConverter-160"><span class="linenos">160</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook</span><span class="p">,</span>
</span><span id="ManifestJsonConverter-161"><a href="#ManifestJsonConverter-161"><span class="linenos">161</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto</span>
</span><span id="ManifestJsonConverter-162"><a href="#ManifestJsonConverter-162"><span class="linenos">162</span></a>        <span class="p">)</span>
</span><span id="ManifestJsonConverter-163"><a href="#ManifestJsonConverter-163"><span class="linenos">163</span></a>        
</span><span id="ManifestJsonConverter-164"><a href="#ManifestJsonConverter-164"><span class="linenos">164</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ManifestJsonConverter-165"><a href="#ManifestJsonConverter-165"><span class="linenos">165</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ManifestJsonConverter-166"><a href="#ManifestJsonConverter-166"><span class="linenos">166</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
</span><span id="ManifestJsonConverter-167"><a href="#ManifestJsonConverter-167"><span class="linenos">167</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ManifestJsonConverter-168"><a href="#ManifestJsonConverter-168"><span class="linenos">168</span></a>        <span class="p">)</span>
</span><span id="ManifestJsonConverter-169"><a href="#ManifestJsonConverter-169"><span class="linenos">169</span></a>        
</span><span id="ManifestJsonConverter-170"><a href="#ManifestJsonConverter-170"><span class="linenos">170</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ManifestJsonConverter-171"><a href="#ManifestJsonConverter-171"><span class="linenos">171</span></a>        
</span><span id="ManifestJsonConverter-172"><a href="#ManifestJsonConverter-172"><span class="linenos">172</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-173"><a href="#ManifestJsonConverter-173"><span class="linenos">173</span></a>            <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
</span><span id="ManifestJsonConverter-174"><a href="#ManifestJsonConverter-174"><span class="linenos">174</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="n">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-175"><a href="#ManifestJsonConverter-175"><span class="linenos">175</span></a>            
</span><span id="ManifestJsonConverter-176"><a href="#ManifestJsonConverter-176"><span class="linenos">176</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-177"><a href="#ManifestJsonConverter-177"><span class="linenos">177</span></a>                <span class="n">builder</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-178"><a href="#ManifestJsonConverter-178"><span class="linenos">178</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestJsonConverter-179"><a href="#ManifestJsonConverter-179"><span class="linenos">179</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-180"><a href="#ManifestJsonConverter-180"><span class="linenos">180</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_path</span><span class="p">))</span>
</span><span id="ManifestJsonConverter-181"><a href="#ManifestJsonConverter-181"><span class="linenos">181</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ManifestJsonConverter-182"><a href="#ManifestJsonConverter-182"><span class="linenos">182</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestJsonConverter-183"><a href="#ManifestJsonConverter-183"><span class="linenos">183</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestJsonConverter-184"><a href="#ManifestJsonConverter-184"><span class="linenos">184</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestJsonConverter-185"><a href="#ManifestJsonConverter-185"><span class="linenos">185</span></a>        
</span><span id="ManifestJsonConverter-186"><a href="#ManifestJsonConverter-186"><span class="linenos">186</span></a>        <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="ManifestJsonConverter-187"><a href="#ManifestJsonConverter-187"><span class="linenos">187</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ManifestJsonConverter-188"><a href="#ManifestJsonConverter-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Manifest  JSON </p>

<p>JSON  (v2 -  ID):
{
    "version": 2,
    "magic": "GRIM",
    "checksum_algo": 101,    //  ID ()
    "index_flags": 2,        // 
    "entries": [...]
}</p>
</div>


                            <div id="ManifestJsonConverter.manifest_to_json" class="classattr">
                                        <input id="ManifestJsonConverter.manifest_to_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">manifest_to_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">manifest_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ManifestJsonConverter.manifest_to_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestJsonConverter.manifest_to_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestJsonConverter.manifest_to_json-39"><a href="#ManifestJsonConverter.manifest_to_json-39"><span class="linenos">39</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ManifestJsonConverter.manifest_to_json-40"><a href="#ManifestJsonConverter.manifest_to_json-40"><span class="linenos">40</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">manifest_to_json</span><span class="p">(</span>
</span><span id="ManifestJsonConverter.manifest_to_json-41"><a href="#ManifestJsonConverter.manifest_to_json-41"><span class="linenos">41</span></a>        <span class="n">manifest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-42"><a href="#ManifestJsonConverter.manifest_to_json-42"><span class="linenos">42</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-43"><a href="#ManifestJsonConverter.manifest_to_json-43"><span class="linenos">43</span></a>        <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="ManifestJsonConverter.manifest_to_json-44"><a href="#ManifestJsonConverter.manifest_to_json-44"><span class="linenos">44</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.manifest_to_json-45"><a href="#ManifestJsonConverter.manifest_to_json-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter.manifest_to_json-46"><a href="#ManifestJsonConverter.manifest_to_json-46"><span class="linenos">46</span></a><span class="sd">         Manifest  JSON </span>
</span><span id="ManifestJsonConverter.manifest_to_json-47"><a href="#ManifestJsonConverter.manifest_to_json-47"><span class="linenos">47</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter.manifest_to_json-48"><a href="#ManifestJsonConverter.manifest_to_json-48"><span class="linenos">48</span></a><span class="sd">         ID  Hook</span>
</span><span id="ManifestJsonConverter.manifest_to_json-49"><a href="#ManifestJsonConverter.manifest_to_json-49"><span class="linenos">49</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter.manifest_to_json-50"><a href="#ManifestJsonConverter.manifest_to_json-50"><span class="linenos">50</span></a><span class="sd">        Args:</span>
</span><span id="ManifestJsonConverter.manifest_to_json-51"><a href="#ManifestJsonConverter.manifest_to_json-51"><span class="linenos">51</span></a><span class="sd">            manifest_path: Manifest </span>
</span><span id="ManifestJsonConverter.manifest_to_json-52"><a href="#ManifestJsonConverter.manifest_to_json-52"><span class="linenos">52</span></a><span class="sd">            output_path:  JSON </span>
</span><span id="ManifestJsonConverter.manifest_to_json-53"><a href="#ManifestJsonConverter.manifest_to_json-53"><span class="linenos">53</span></a><span class="sd">            indent: JSON </span>
</span><span id="ManifestJsonConverter.manifest_to_json-54"><a href="#ManifestJsonConverter.manifest_to_json-54"><span class="linenos">54</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter.manifest_to_json-55"><a href="#ManifestJsonConverter.manifest_to_json-55"><span class="linenos">55</span></a>        <span class="c1"># 1.  algo_id  flags Hook</span>
</span><span id="ManifestJsonConverter.manifest_to_json-56"><a href="#ManifestJsonConverter.manifest_to_json-56"><span class="linenos">56</span></a>        <span class="c1">#  Reader  ( Hook )</span>
</span><span id="ManifestJsonConverter.manifest_to_json-57"><a href="#ManifestJsonConverter.manifest_to_json-57"><span class="linenos">57</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileHeader</span>
</span><span id="ManifestJsonConverter.manifest_to_json-58"><a href="#ManifestJsonConverter.manifest_to_json-58"><span class="linenos">58</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.binary_io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BinaryReader</span>
</span><span id="ManifestJsonConverter.manifest_to_json-59"><a href="#ManifestJsonConverter.manifest_to_json-59"><span class="linenos">59</span></a>        
</span><span id="ManifestJsonConverter.manifest_to_json-60"><a href="#ManifestJsonConverter.manifest_to_json-60"><span class="linenos">60</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.manifest_to_json-61"><a href="#ManifestJsonConverter.manifest_to_json-61"><span class="linenos">61</span></a>            <span class="n">header</span> <span class="o">=</span> <span class="n">FileHeader</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">FileHeader</span><span class="o">.</span><span class="n">SIZE</span><span class="p">))</span>
</span><span id="ManifestJsonConverter.manifest_to_json-62"><a href="#ManifestJsonConverter.manifest_to_json-62"><span class="linenos">62</span></a>        
</span><span id="ManifestJsonConverter.manifest_to_json-63"><a href="#ManifestJsonConverter.manifest_to_json-63"><span class="linenos">63</span></a>        <span class="n">algo_id</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">checksum_algo</span>
</span><span id="ManifestJsonConverter.manifest_to_json-64"><a href="#ManifestJsonConverter.manifest_to_json-64"><span class="linenos">64</span></a>        <span class="n">flags</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">flags</span>
</span><span id="ManifestJsonConverter.manifest_to_json-65"><a href="#ManifestJsonConverter.manifest_to_json-65"><span class="linenos">65</span></a>        
</span><span id="ManifestJsonConverter.manifest_to_json-66"><a href="#ManifestJsonConverter.manifest_to_json-66"><span class="linenos">66</span></a>        <span class="c1"># 2.  ID  Hook</span>
</span><span id="ManifestJsonConverter.manifest_to_json-67"><a href="#ManifestJsonConverter.manifest_to_json-67"><span class="linenos">67</span></a>        <span class="n">checksum_hook</span> <span class="o">=</span> <span class="n">get_checksum_hook_by_id</span><span class="p">(</span><span class="n">algo_id</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.manifest_to_json-68"><a href="#ManifestJsonConverter.manifest_to_json-68"><span class="linenos">68</span></a>        <span class="n">index_crypto</span> <span class="o">=</span> <span class="n">get_index_crypto_by_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.manifest_to_json-69"><a href="#ManifestJsonConverter.manifest_to_json-69"><span class="linenos">69</span></a>        
</span><span id="ManifestJsonConverter.manifest_to_json-70"><a href="#ManifestJsonConverter.manifest_to_json-70"><span class="linenos">70</span></a>        <span class="c1"># 3.  Hook  Manifest</span>
</span><span id="ManifestJsonConverter.manifest_to_json-71"><a href="#ManifestJsonConverter.manifest_to_json-71"><span class="linenos">71</span></a>        <span class="k">with</span> <span class="n">ManifestReader</span><span class="p">(</span>
</span><span id="ManifestJsonConverter.manifest_to_json-72"><a href="#ManifestJsonConverter.manifest_to_json-72"><span class="linenos">72</span></a>            <span class="n">manifest_path</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-73"><a href="#ManifestJsonConverter.manifest_to_json-73"><span class="linenos">73</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-74"><a href="#ManifestJsonConverter.manifest_to_json-74"><span class="linenos">74</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto</span>
</span><span id="ManifestJsonConverter.manifest_to_json-75"><a href="#ManifestJsonConverter.manifest_to_json-75"><span class="linenos">75</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.manifest_to_json-76"><a href="#ManifestJsonConverter.manifest_to_json-76"><span class="linenos">76</span></a>            <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ManifestJsonConverter.manifest_to_json-77"><a href="#ManifestJsonConverter.manifest_to_json-77"><span class="linenos">77</span></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">list_all</span><span class="p">():</span>
</span><span id="ManifestJsonConverter.manifest_to_json-78"><a href="#ManifestJsonConverter.manifest_to_json-78"><span class="linenos">78</span></a>                <span class="n">entry</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.manifest_to_json-79"><a href="#ManifestJsonConverter.manifest_to_json-79"><span class="linenos">79</span></a>                <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ManifestJsonConverter.manifest_to_json-80"><a href="#ManifestJsonConverter.manifest_to_json-80"><span class="linenos">80</span></a>                    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-81"><a href="#ManifestJsonConverter.manifest_to_json-81"><span class="linenos">81</span></a>                    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">raw_size</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-82"><a href="#ManifestJsonConverter.manifest_to_json-82"><span class="linenos">82</span></a>                    <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">checksum</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="ManifestJsonConverter.manifest_to_json-83"><a href="#ManifestJsonConverter.manifest_to_json-83"><span class="linenos">83</span></a>                <span class="p">})</span>
</span><span id="ManifestJsonConverter.manifest_to_json-84"><a href="#ManifestJsonConverter.manifest_to_json-84"><span class="linenos">84</span></a>            
</span><span id="ManifestJsonConverter.manifest_to_json-85"><a href="#ManifestJsonConverter.manifest_to_json-85"><span class="linenos">85</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ManifestJsonConverter.manifest_to_json-86"><a href="#ManifestJsonConverter.manifest_to_json-86"><span class="linenos">86</span></a>                <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-87"><a href="#ManifestJsonConverter.manifest_to_json-87"><span class="linenos">87</span></a>                <span class="s1">&#39;magic&#39;</span><span class="p">:</span> <span class="n">reader</span><span class="o">.</span><span class="n">file_header</span><span class="o">.</span><span class="n">magic</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">),</span>
</span><span id="ManifestJsonConverter.manifest_to_json-88"><a href="#ManifestJsonConverter.manifest_to_json-88"><span class="linenos">88</span></a>                <span class="s1">&#39;checksum_algo&#39;</span><span class="p">:</span> <span class="n">algo_id</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-89"><a href="#ManifestJsonConverter.manifest_to_json-89"><span class="linenos">89</span></a>                <span class="s1">&#39;checksum_algo_name&#39;</span><span class="p">:</span> <span class="n">get_hook_name</span><span class="p">(</span><span class="n">checksum_hook</span><span class="p">),</span>
</span><span id="ManifestJsonConverter.manifest_to_json-90"><a href="#ManifestJsonConverter.manifest_to_json-90"><span class="linenos">90</span></a>                <span class="s1">&#39;index_flags&#39;</span><span class="p">:</span> <span class="n">flags</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.manifest_to_json-91"><a href="#ManifestJsonConverter.manifest_to_json-91"><span class="linenos">91</span></a>                <span class="s1">&#39;index_flags_name&#39;</span><span class="p">:</span> <span class="n">get_hook_name</span><span class="p">(</span><span class="n">index_crypto</span><span class="p">),</span>
</span><span id="ManifestJsonConverter.manifest_to_json-92"><a href="#ManifestJsonConverter.manifest_to_json-92"><span class="linenos">92</span></a>                <span class="s1">&#39;entry_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
</span><span id="ManifestJsonConverter.manifest_to_json-93"><a href="#ManifestJsonConverter.manifest_to_json-93"><span class="linenos">93</span></a>                <span class="s1">&#39;entries&#39;</span><span class="p">:</span> <span class="n">entries</span>
</span><span id="ManifestJsonConverter.manifest_to_json-94"><a href="#ManifestJsonConverter.manifest_to_json-94"><span class="linenos">94</span></a>            <span class="p">}</span>
</span><span id="ManifestJsonConverter.manifest_to_json-95"><a href="#ManifestJsonConverter.manifest_to_json-95"><span class="linenos">95</span></a>        
</span><span id="ManifestJsonConverter.manifest_to_json-96"><a href="#ManifestJsonConverter.manifest_to_json-96"><span class="linenos">96</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.manifest_to_json-97"><a href="#ManifestJsonConverter.manifest_to_json-97"><span class="linenos">97</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> Manifest  JSON </p>

<p> ID  Hook</p>

<p>Args:
    manifest_path: Manifest 
    output_path:  JSON 
    indent: JSON </p>
</div>


                            </div>
                            <div id="ManifestJsonConverter.json_to_manifest" class="classattr">
                                        <input id="ManifestJsonConverter.json_to_manifest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">json_to_manifest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">json_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">local_base_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">path_mappings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">checksum_hook_override</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_crypto_override</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ManifestJsonConverter.json_to_manifest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ManifestJsonConverter.json_to_manifest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ManifestJsonConverter.json_to_manifest-99"><a href="#ManifestJsonConverter.json_to_manifest-99"><span class="linenos"> 99</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ManifestJsonConverter.json_to_manifest-100"><a href="#ManifestJsonConverter.json_to_manifest-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json_to_manifest</span><span class="p">(</span>
</span><span id="ManifestJsonConverter.json_to_manifest-101"><a href="#ManifestJsonConverter.json_to_manifest-101"><span class="linenos">101</span></a>        <span class="n">json_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-102"><a href="#ManifestJsonConverter.json_to_manifest-102"><span class="linenos">102</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-103"><a href="#ManifestJsonConverter.json_to_manifest-103"><span class="linenos">103</span></a>        <span class="n">local_base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-104"><a href="#ManifestJsonConverter.json_to_manifest-104"><span class="linenos">104</span></a>        <span class="n">path_mappings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-105"><a href="#ManifestJsonConverter.json_to_manifest-105"><span class="linenos">105</span></a>        <span class="n">checksum_hook_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-106"><a href="#ManifestJsonConverter.json_to_manifest-106"><span class="linenos">106</span></a>        <span class="n">index_crypto_override</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-107"><a href="#ManifestJsonConverter.json_to_manifest-107"><span class="linenos">107</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ManifestJsonConverter.json_to_manifest-108"><a href="#ManifestJsonConverter.json_to_manifest-108"><span class="linenos">108</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-109"><a href="#ManifestJsonConverter.json_to_manifest-109"><span class="linenos">109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter.json_to_manifest-110"><a href="#ManifestJsonConverter.json_to_manifest-110"><span class="linenos">110</span></a><span class="sd">         JSON  Manifest </span>
</span><span id="ManifestJsonConverter.json_to_manifest-111"><a href="#ManifestJsonConverter.json_to_manifest-111"><span class="linenos">111</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter.json_to_manifest-112"><a href="#ManifestJsonConverter.json_to_manifest-112"><span class="linenos">112</span></a><span class="sd">         JSON  checksum_algo/index_flags  Hook</span>
</span><span id="ManifestJsonConverter.json_to_manifest-113"><a href="#ManifestJsonConverter.json_to_manifest-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="ManifestJsonConverter.json_to_manifest-114"><a href="#ManifestJsonConverter.json_to_manifest-114"><span class="linenos">114</span></a><span class="sd">        Args:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-115"><a href="#ManifestJsonConverter.json_to_manifest-115"><span class="linenos">115</span></a><span class="sd">            json_path: JSON </span>
</span><span id="ManifestJsonConverter.json_to_manifest-116"><a href="#ManifestJsonConverter.json_to_manifest-116"><span class="linenos">116</span></a><span class="sd">            output_path:  Manifest </span>
</span><span id="ManifestJsonConverter.json_to_manifest-117"><a href="#ManifestJsonConverter.json_to_manifest-117"><span class="linenos">117</span></a><span class="sd">            local_base_path: </span>
</span><span id="ManifestJsonConverter.json_to_manifest-118"><a href="#ManifestJsonConverter.json_to_manifest-118"><span class="linenos">118</span></a><span class="sd">            path_mappings:  {: }</span>
</span><span id="ManifestJsonConverter.json_to_manifest-119"><a href="#ManifestJsonConverter.json_to_manifest-119"><span class="linenos">119</span></a><span class="sd">            checksum_hook_override:  JSON  Hook</span>
</span><span id="ManifestJsonConverter.json_to_manifest-120"><a href="#ManifestJsonConverter.json_to_manifest-120"><span class="linenos">120</span></a><span class="sd">            index_crypto_override:  JSON  Hook</span>
</span><span id="ManifestJsonConverter.json_to_manifest-121"><a href="#ManifestJsonConverter.json_to_manifest-121"><span class="linenos">121</span></a><span class="sd">            progress_callback: </span>
</span><span id="ManifestJsonConverter.json_to_manifest-122"><a href="#ManifestJsonConverter.json_to_manifest-122"><span class="linenos">122</span></a><span class="sd">            </span>
</span><span id="ManifestJsonConverter.json_to_manifest-123"><a href="#ManifestJsonConverter.json_to_manifest-123"><span class="linenos">123</span></a><span class="sd">        Returns:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-124"><a href="#ManifestJsonConverter.json_to_manifest-124"><span class="linenos">124</span></a><span class="sd">            BatchResult</span>
</span><span id="ManifestJsonConverter.json_to_manifest-125"><a href="#ManifestJsonConverter.json_to_manifest-125"><span class="linenos">125</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ManifestJsonConverter.json_to_manifest-126"><a href="#ManifestJsonConverter.json_to_manifest-126"><span class="linenos">126</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileItem</span><span class="p">,</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span>
</span><span id="ManifestJsonConverter.json_to_manifest-127"><a href="#ManifestJsonConverter.json_to_manifest-127"><span class="linenos">127</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-128"><a href="#ManifestJsonConverter.json_to_manifest-128"><span class="linenos">128</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-129"><a href="#ManifestJsonConverter.json_to_manifest-129"><span class="linenos">129</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-130"><a href="#ManifestJsonConverter.json_to_manifest-130"><span class="linenos">130</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-131"><a href="#ManifestJsonConverter.json_to_manifest-131"><span class="linenos">131</span></a>        <span class="c1">#  checksum_algo ID  Hook ( override)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-132"><a href="#ManifestJsonConverter.json_to_manifest-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="n">checksum_hook_override</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-133"><a href="#ManifestJsonConverter.json_to_manifest-133"><span class="linenos">133</span></a>            <span class="n">checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook_override</span>
</span><span id="ManifestJsonConverter.json_to_manifest-134"><a href="#ManifestJsonConverter.json_to_manifest-134"><span class="linenos">134</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-135"><a href="#ManifestJsonConverter.json_to_manifest-135"><span class="linenos">135</span></a>            <span class="n">algo_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;checksum_algo&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-136"><a href="#ManifestJsonConverter.json_to_manifest-136"><span class="linenos">136</span></a>            <span class="n">checksum_hook</span> <span class="o">=</span> <span class="n">get_checksum_hook_by_id</span><span class="p">(</span><span class="n">algo_id</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-137"><a href="#ManifestJsonConverter.json_to_manifest-137"><span class="linenos">137</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-138"><a href="#ManifestJsonConverter.json_to_manifest-138"><span class="linenos">138</span></a>        <span class="c1">#  index_flags  Hook ( override)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-139"><a href="#ManifestJsonConverter.json_to_manifest-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">index_crypto_override</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-140"><a href="#ManifestJsonConverter.json_to_manifest-140"><span class="linenos">140</span></a>            <span class="n">index_crypto</span> <span class="o">=</span> <span class="n">index_crypto_override</span>
</span><span id="ManifestJsonConverter.json_to_manifest-141"><a href="#ManifestJsonConverter.json_to_manifest-141"><span class="linenos">141</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-142"><a href="#ManifestJsonConverter.json_to_manifest-142"><span class="linenos">142</span></a>            <span class="n">flags</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;index_flags&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-143"><a href="#ManifestJsonConverter.json_to_manifest-143"><span class="linenos">143</span></a>            <span class="n">index_crypto</span> <span class="o">=</span> <span class="n">get_index_crypto_by_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-144"><a href="#ManifestJsonConverter.json_to_manifest-144"><span class="linenos">144</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-145"><a href="#ManifestJsonConverter.json_to_manifest-145"><span class="linenos">145</span></a>        <span class="c1"># </span>
</span><span id="ManifestJsonConverter.json_to_manifest-146"><a href="#ManifestJsonConverter.json_to_manifest-146"><span class="linenos">146</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-147"><a href="#ManifestJsonConverter.json_to_manifest-147"><span class="linenos">147</span></a>            <span class="k">if</span> <span class="n">path_mappings</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-148"><a href="#ManifestJsonConverter.json_to_manifest-148"><span class="linenos">148</span></a>                <span class="k">for</span> <span class="n">vfs_prefix</span><span class="p">,</span> <span class="n">local_prefix</span> <span class="ow">in</span> <span class="n">path_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ManifestJsonConverter.json_to_manifest-149"><a href="#ManifestJsonConverter.json_to_manifest-149"><span class="linenos">149</span></a>                    <span class="k">if</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):</span>
</span><span id="ManifestJsonConverter.json_to_manifest-150"><a href="#ManifestJsonConverter.json_to_manifest-150"><span class="linenos">150</span></a>                        <span class="n">rel</span> <span class="o">=</span> <span class="n">vfs_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-151"><a href="#ManifestJsonConverter.json_to_manifest-151"><span class="linenos">151</span></a>                        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_prefix</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-152"><a href="#ManifestJsonConverter.json_to_manifest-152"><span class="linenos">152</span></a>            <span class="c1"># : base_path + vfs_path</span>
</span><span id="ManifestJsonConverter.json_to_manifest-153"><a href="#ManifestJsonConverter.json_to_manifest-153"><span class="linenos">153</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_base_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ManifestJsonConverter.json_to_manifest-154"><a href="#ManifestJsonConverter.json_to_manifest-154"><span class="linenos">154</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-155"><a href="#ManifestJsonConverter.json_to_manifest-155"><span class="linenos">155</span></a>        <span class="c1">#  Manifest</span>
</span><span id="ManifestJsonConverter.json_to_manifest-156"><a href="#ManifestJsonConverter.json_to_manifest-156"><span class="linenos">156</span></a>        <span class="n">magic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;magic&#39;</span><span class="p">,</span> <span class="s1">&#39;GRIM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-157"><a href="#ManifestJsonConverter.json_to_manifest-157"><span class="linenos">157</span></a>        <span class="n">builder</span> <span class="o">=</span> <span class="n">ManifestBuilder</span><span class="p">(</span>
</span><span id="ManifestJsonConverter.json_to_manifest-158"><a href="#ManifestJsonConverter.json_to_manifest-158"><span class="linenos">158</span></a>            <span class="n">output_path</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-159"><a href="#ManifestJsonConverter.json_to_manifest-159"><span class="linenos">159</span></a>            <span class="n">magic</span><span class="o">=</span><span class="n">magic</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-160"><a href="#ManifestJsonConverter.json_to_manifest-160"><span class="linenos">160</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook</span><span class="p">,</span>
</span><span id="ManifestJsonConverter.json_to_manifest-161"><a href="#ManifestJsonConverter.json_to_manifest-161"><span class="linenos">161</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto</span>
</span><span id="ManifestJsonConverter.json_to_manifest-162"><a href="#ManifestJsonConverter.json_to_manifest-162"><span class="linenos">162</span></a>        <span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-163"><a href="#ManifestJsonConverter.json_to_manifest-163"><span class="linenos">163</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-164"><a href="#ManifestJsonConverter.json_to_manifest-164"><span class="linenos">164</span></a>        <span class="n">entries</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entries&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ManifestJsonConverter.json_to_manifest-165"><a href="#ManifestJsonConverter.json_to_manifest-165"><span class="linenos">165</span></a>        <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ManifestJsonConverter.json_to_manifest-166"><a href="#ManifestJsonConverter.json_to_manifest-166"><span class="linenos">166</span></a>            <span class="n">total_files</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span>
</span><span id="ManifestJsonConverter.json_to_manifest-167"><a href="#ManifestJsonConverter.json_to_manifest-167"><span class="linenos">167</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ManifestJsonConverter.json_to_manifest-168"><a href="#ManifestJsonConverter.json_to_manifest-168"><span class="linenos">168</span></a>        <span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-169"><a href="#ManifestJsonConverter.json_to_manifest-169"><span class="linenos">169</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-170"><a href="#ManifestJsonConverter.json_to_manifest-170"><span class="linenos">170</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ManifestJsonConverter.json_to_manifest-171"><a href="#ManifestJsonConverter.json_to_manifest-171"><span class="linenos">171</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-172"><a href="#ManifestJsonConverter.json_to_manifest-172"><span class="linenos">172</span></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-173"><a href="#ManifestJsonConverter.json_to_manifest-173"><span class="linenos">173</span></a>            <span class="n">vfs_path</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
</span><span id="ManifestJsonConverter.json_to_manifest-174"><a href="#ManifestJsonConverter.json_to_manifest-174"><span class="linenos">174</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="n">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-175"><a href="#ManifestJsonConverter.json_to_manifest-175"><span class="linenos">175</span></a>            
</span><span id="ManifestJsonConverter.json_to_manifest-176"><a href="#ManifestJsonConverter.json_to_manifest-176"><span class="linenos">176</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-177"><a href="#ManifestJsonConverter.json_to_manifest-177"><span class="linenos">177</span></a>                <span class="n">builder</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-178"><a href="#ManifestJsonConverter.json_to_manifest-178"><span class="linenos">178</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestJsonConverter.json_to_manifest-179"><a href="#ManifestJsonConverter.json_to_manifest-179"><span class="linenos">179</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-180"><a href="#ManifestJsonConverter.json_to_manifest-180"><span class="linenos">180</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_path</span><span class="p">))</span>
</span><span id="ManifestJsonConverter.json_to_manifest-181"><a href="#ManifestJsonConverter.json_to_manifest-181"><span class="linenos">181</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ManifestJsonConverter.json_to_manifest-182"><a href="#ManifestJsonConverter.json_to_manifest-182"><span class="linenos">182</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ManifestJsonConverter.json_to_manifest-183"><a href="#ManifestJsonConverter.json_to_manifest-183"><span class="linenos">183</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">local_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ManifestJsonConverter.json_to_manifest-184"><a href="#ManifestJsonConverter.json_to_manifest-184"><span class="linenos">184</span></a>                <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ManifestJsonConverter.json_to_manifest-185"><a href="#ManifestJsonConverter.json_to_manifest-185"><span class="linenos">185</span></a>        
</span><span id="ManifestJsonConverter.json_to_manifest-186"><a href="#ManifestJsonConverter.json_to_manifest-186"><span class="linenos">186</span></a>        <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="ManifestJsonConverter.json_to_manifest-187"><a href="#ManifestJsonConverter.json_to_manifest-187"><span class="linenos">187</span></a>        <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ManifestJsonConverter.json_to_manifest-188"><a href="#ManifestJsonConverter.json_to_manifest-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p> JSON  Manifest </p>

<p> JSON  checksum_algo/index_flags  Hook</p>

<p>Args:
    json_path: JSON 
    output_path:  Manifest 
    local_base_path: 
    path_mappings:  {: }
    checksum_hook_override:  JSON  Hook
    index_crypto_override:  JSON  Hook
    progress_callback: </p>

<p>Returns:
    BatchResult</p>
</div>


                            </div>
                </section>
                <section id="ModeConverter">
                            <input id="ModeConverter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ModeConverter</span>:

                <label class="view-source-button" for="ModeConverter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModeConverter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModeConverter-191"><a href="#ModeConverter-191"><span class="linenos">191</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ModeConverter</span><span class="p">:</span>
</span><span id="ModeConverter-192"><a href="#ModeConverter-192"><span class="linenos">192</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModeConverter-193"><a href="#ModeConverter-193"><span class="linenos">193</span></a><span class="sd">    Manifest  Archive </span>
</span><span id="ModeConverter-194"><a href="#ModeConverter-194"><span class="linenos">194</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ModeConverter-195"><a href="#ModeConverter-195"><span class="linenos">195</span></a>    
</span><span id="ModeConverter-196"><a href="#ModeConverter-196"><span class="linenos">196</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModeConverter-197"><a href="#ModeConverter-197"><span class="linenos">197</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">archive_to_manifest</span><span class="p">(</span>
</span><span id="ModeConverter-198"><a href="#ModeConverter-198"><span class="linenos">198</span></a>        <span class="n">archive_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter-199"><a href="#ModeConverter-199"><span class="linenos">199</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter-200"><a href="#ModeConverter-200"><span class="linenos">200</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-201"><a href="#ModeConverter-201"><span class="linenos">201</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-202"><a href="#ModeConverter-202"><span class="linenos">202</span></a>        <span class="n">index_crypto_read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-203"><a href="#ModeConverter-203"><span class="linenos">203</span></a>        <span class="c1"># </span>
</span><span id="ModeConverter-204"><a href="#ModeConverter-204"><span class="linenos">204</span></a>        <span class="n">output_checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-205"><a href="#ModeConverter-205"><span class="linenos">205</span></a>        <span class="n">output_index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-206"><a href="#ModeConverter-206"><span class="linenos">206</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModeConverter-207"><a href="#ModeConverter-207"><span class="linenos">207</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ModeConverter-208"><a href="#ModeConverter-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModeConverter-209"><a href="#ModeConverter-209"><span class="linenos">209</span></a><span class="sd">         Archive  Manifest</span>
</span><span id="ModeConverter-210"><a href="#ModeConverter-210"><span class="linenos">210</span></a><span class="sd">        </span>
</span><span id="ModeConverter-211"><a href="#ModeConverter-211"><span class="linenos">211</span></a><span class="sd">        </span>
</span><span id="ModeConverter-212"><a href="#ModeConverter-212"><span class="linenos">212</span></a><span class="sd">        </span>
</span><span id="ModeConverter-213"><a href="#ModeConverter-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="ModeConverter-214"><a href="#ModeConverter-214"><span class="linenos">214</span></a><span class="sd">            archive_path: Archive </span>
</span><span id="ModeConverter-215"><a href="#ModeConverter-215"><span class="linenos">215</span></a><span class="sd">            output_path:  Manifest </span>
</span><span id="ModeConverter-216"><a href="#ModeConverter-216"><span class="linenos">216</span></a><span class="sd">            compression_hooks: Archive  Hook</span>
</span><span id="ModeConverter-217"><a href="#ModeConverter-217"><span class="linenos">217</span></a><span class="sd">            checksum_hook: Archive  Hook</span>
</span><span id="ModeConverter-218"><a href="#ModeConverter-218"><span class="linenos">218</span></a><span class="sd">            index_crypto_read: Archive  Hook</span>
</span><span id="ModeConverter-219"><a href="#ModeConverter-219"><span class="linenos">219</span></a><span class="sd">            output_checksum_hook:  Manifest  Hook ()</span>
</span><span id="ModeConverter-220"><a href="#ModeConverter-220"><span class="linenos">220</span></a><span class="sd">            output_index_crypto:  Manifest  Hook ()</span>
</span><span id="ModeConverter-221"><a href="#ModeConverter-221"><span class="linenos">221</span></a><span class="sd">            progress_callback: </span>
</span><span id="ModeConverter-222"><a href="#ModeConverter-222"><span class="linenos">222</span></a><span class="sd">            </span>
</span><span id="ModeConverter-223"><a href="#ModeConverter-223"><span class="linenos">223</span></a><span class="sd">        Returns:</span>
</span><span id="ModeConverter-224"><a href="#ModeConverter-224"><span class="linenos">224</span></a><span class="sd">            BatchResult</span>
</span><span id="ModeConverter-225"><a href="#ModeConverter-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModeConverter-226"><a href="#ModeConverter-226"><span class="linenos">226</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span>
</span><span id="ModeConverter-227"><a href="#ModeConverter-227"><span class="linenos">227</span></a>        
</span><span id="ModeConverter-228"><a href="#ModeConverter-228"><span class="linenos">228</span></a>        <span class="c1">#  checksum_hook</span>
</span><span id="ModeConverter-229"><a href="#ModeConverter-229"><span class="linenos">229</span></a>        <span class="k">if</span> <span class="n">output_checksum_hook</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModeConverter-230"><a href="#ModeConverter-230"><span class="linenos">230</span></a>            <span class="n">output_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ModeConverter-231"><a href="#ModeConverter-231"><span class="linenos">231</span></a>        
</span><span id="ModeConverter-232"><a href="#ModeConverter-232"><span class="linenos">232</span></a>        <span class="k">with</span> <span class="n">ArchiveReader</span><span class="p">(</span>
</span><span id="ModeConverter-233"><a href="#ModeConverter-233"><span class="linenos">233</span></a>            <span class="n">archive_path</span><span class="p">,</span>
</span><span id="ModeConverter-234"><a href="#ModeConverter-234"><span class="linenos">234</span></a>            <span class="n">compression_hooks</span><span class="o">=</span><span class="n">compression_hooks</span><span class="p">,</span>
</span><span id="ModeConverter-235"><a href="#ModeConverter-235"><span class="linenos">235</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook</span><span class="p">,</span>
</span><span id="ModeConverter-236"><a href="#ModeConverter-236"><span class="linenos">236</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto_read</span>
</span><span id="ModeConverter-237"><a href="#ModeConverter-237"><span class="linenos">237</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="ModeConverter-238"><a href="#ModeConverter-238"><span class="linenos">238</span></a>            <span class="n">all_paths</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
</span><span id="ModeConverter-239"><a href="#ModeConverter-239"><span class="linenos">239</span></a>            
</span><span id="ModeConverter-240"><a href="#ModeConverter-240"><span class="linenos">240</span></a>            <span class="n">builder</span> <span class="o">=</span> <span class="n">ManifestBuilder</span><span class="p">(</span>
</span><span id="ModeConverter-241"><a href="#ModeConverter-241"><span class="linenos">241</span></a>                <span class="n">output_path</span><span class="p">,</span>
</span><span id="ModeConverter-242"><a href="#ModeConverter-242"><span class="linenos">242</span></a>                <span class="n">magic</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">file_header</span><span class="o">.</span><span class="n">magic</span><span class="p">,</span>
</span><span id="ModeConverter-243"><a href="#ModeConverter-243"><span class="linenos">243</span></a>                <span class="n">checksum_hook</span><span class="o">=</span><span class="n">output_checksum_hook</span><span class="p">,</span>
</span><span id="ModeConverter-244"><a href="#ModeConverter-244"><span class="linenos">244</span></a>                <span class="n">index_crypto</span><span class="o">=</span><span class="n">output_index_crypto</span>
</span><span id="ModeConverter-245"><a href="#ModeConverter-245"><span class="linenos">245</span></a>            <span class="p">)</span>
</span><span id="ModeConverter-246"><a href="#ModeConverter-246"><span class="linenos">246</span></a>            
</span><span id="ModeConverter-247"><a href="#ModeConverter-247"><span class="linenos">247</span></a>            <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ModeConverter-248"><a href="#ModeConverter-248"><span class="linenos">248</span></a>                <span class="n">total_files</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">all_paths</span><span class="p">),</span>
</span><span id="ModeConverter-249"><a href="#ModeConverter-249"><span class="linenos">249</span></a>                <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ModeConverter-250"><a href="#ModeConverter-250"><span class="linenos">250</span></a>            <span class="p">)</span>
</span><span id="ModeConverter-251"><a href="#ModeConverter-251"><span class="linenos">251</span></a>            
</span><span id="ModeConverter-252"><a href="#ModeConverter-252"><span class="linenos">252</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ModeConverter-253"><a href="#ModeConverter-253"><span class="linenos">253</span></a>            
</span><span id="ModeConverter-254"><a href="#ModeConverter-254"><span class="linenos">254</span></a>            <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">:</span>
</span><span id="ModeConverter-255"><a href="#ModeConverter-255"><span class="linenos">255</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ModeConverter-256"><a href="#ModeConverter-256"><span class="linenos">256</span></a>                    <span class="c1">#  Archive </span>
</span><span id="ModeConverter-257"><a href="#ModeConverter-257"><span class="linenos">257</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ModeConverter-258"><a href="#ModeConverter-258"><span class="linenos">258</span></a>                    
</span><span id="ModeConverter-259"><a href="#ModeConverter-259"><span class="linenos">259</span></a>                    <span class="c1">#  ( add_file )</span>
</span><span id="ModeConverter-260"><a href="#ModeConverter-260"><span class="linenos">260</span></a>                    <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ModeConverter-261"><a href="#ModeConverter-261"><span class="linenos">261</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">split_path</span><span class="p">,</span> <span class="n">default_path_hash</span>
</span><span id="ModeConverter-262"><a href="#ModeConverter-262"><span class="linenos">262</span></a>                    <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ModeConverter-263"><a href="#ModeConverter-263"><span class="linenos">263</span></a>                    
</span><span id="ModeConverter-264"><a href="#ModeConverter-264"><span class="linenos">264</span></a>                    <span class="n">path_hash</span> <span class="o">=</span> <span class="n">default_path_hash</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ModeConverter-265"><a href="#ModeConverter-265"><span class="linenos">265</span></a>                    <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ModeConverter-266"><a href="#ModeConverter-266"><span class="linenos">266</span></a>                    
</span><span id="ModeConverter-267"><a href="#ModeConverter-267"><span class="linenos">267</span></a>                    <span class="n">checksum</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="ModeConverter-268"><a href="#ModeConverter-268"><span class="linenos">268</span></a>                    <span class="k">if</span> <span class="n">output_checksum_hook</span><span class="p">:</span>
</span><span id="ModeConverter-269"><a href="#ModeConverter-269"><span class="linenos">269</span></a>                        <span class="n">checksum</span> <span class="o">=</span> <span class="n">output_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ModeConverter-270"><a href="#ModeConverter-270"><span class="linenos">270</span></a>                    
</span><span id="ModeConverter-271"><a href="#ModeConverter-271"><span class="linenos">271</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">.core.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">ManifestEntry</span>
</span><span id="ModeConverter-272"><a href="#ModeConverter-272"><span class="linenos">272</span></a>                    <span class="n">entry</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="p">(</span>
</span><span id="ModeConverter-273"><a href="#ModeConverter-273"><span class="linenos">273</span></a>                        <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ModeConverter-274"><a href="#ModeConverter-274"><span class="linenos">274</span></a>                        <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ModeConverter-275"><a href="#ModeConverter-275"><span class="linenos">275</span></a>                        <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ModeConverter-276"><a href="#ModeConverter-276"><span class="linenos">276</span></a>                        <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ModeConverter-277"><a href="#ModeConverter-277"><span class="linenos">277</span></a>                        <span class="n">raw_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="ModeConverter-278"><a href="#ModeConverter-278"><span class="linenos">278</span></a>                        <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ModeConverter-279"><a href="#ModeConverter-279"><span class="linenos">279</span></a>                    <span class="p">)</span>
</span><span id="ModeConverter-280"><a href="#ModeConverter-280"><span class="linenos">280</span></a>                    <span class="n">builder</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="ModeConverter-281"><a href="#ModeConverter-281"><span class="linenos">281</span></a>                    <span class="n">builder</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ModeConverter-282"><a href="#ModeConverter-282"><span class="linenos">282</span></a>                    
</span><span id="ModeConverter-283"><a href="#ModeConverter-283"><span class="linenos">283</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ModeConverter-284"><a href="#ModeConverter-284"><span class="linenos">284</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ModeConverter-285"><a href="#ModeConverter-285"><span class="linenos">285</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="ModeConverter-286"><a href="#ModeConverter-286"><span class="linenos">286</span></a>                    
</span><span id="ModeConverter-287"><a href="#ModeConverter-287"><span class="linenos">287</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ModeConverter-288"><a href="#ModeConverter-288"><span class="linenos">288</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ModeConverter-289"><a href="#ModeConverter-289"><span class="linenos">289</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ModeConverter-290"><a href="#ModeConverter-290"><span class="linenos">290</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ModeConverter-291"><a href="#ModeConverter-291"><span class="linenos">291</span></a>            
</span><span id="ModeConverter-292"><a href="#ModeConverter-292"><span class="linenos">292</span></a>            <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="ModeConverter-293"><a href="#ModeConverter-293"><span class="linenos">293</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ModeConverter-294"><a href="#ModeConverter-294"><span class="linenos">294</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="ModeConverter-295"><a href="#ModeConverter-295"><span class="linenos">295</span></a>    
</span><span id="ModeConverter-296"><a href="#ModeConverter-296"><span class="linenos">296</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModeConverter-297"><a href="#ModeConverter-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">manifest_to_archive</span><span class="p">(</span>
</span><span id="ModeConverter-298"><a href="#ModeConverter-298"><span class="linenos">298</span></a>        <span class="n">manifest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter-299"><a href="#ModeConverter-299"><span class="linenos">299</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter-300"><a href="#ModeConverter-300"><span class="linenos">300</span></a>        <span class="n">local_base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter-301"><a href="#ModeConverter-301"><span class="linenos">301</span></a>        <span class="n">path_mappings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-302"><a href="#ModeConverter-302"><span class="linenos">302</span></a>        <span class="n">checksum_hook_read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-303"><a href="#ModeConverter-303"><span class="linenos">303</span></a>        <span class="n">index_crypto_read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-304"><a href="#ModeConverter-304"><span class="linenos">304</span></a>        <span class="c1"># </span>
</span><span id="ModeConverter-305"><a href="#ModeConverter-305"><span class="linenos">305</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-306"><a href="#ModeConverter-306"><span class="linenos">306</span></a>        <span class="n">default_algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ModeConverter-307"><a href="#ModeConverter-307"><span class="linenos">307</span></a>        <span class="n">output_checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-308"><a href="#ModeConverter-308"><span class="linenos">308</span></a>        <span class="n">output_index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-309"><a href="#ModeConverter-309"><span class="linenos">309</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter-310"><a href="#ModeConverter-310"><span class="linenos">310</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;skip&#39;</span>
</span><span id="ModeConverter-311"><a href="#ModeConverter-311"><span class="linenos">311</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ModeConverter-312"><a href="#ModeConverter-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModeConverter-313"><a href="#ModeConverter-313"><span class="linenos">313</span></a><span class="sd">         Manifest  Archive</span>
</span><span id="ModeConverter-314"><a href="#ModeConverter-314"><span class="linenos">314</span></a><span class="sd">        </span>
</span><span id="ModeConverter-315"><a href="#ModeConverter-315"><span class="linenos">315</span></a><span class="sd">        </span>
</span><span id="ModeConverter-316"><a href="#ModeConverter-316"><span class="linenos">316</span></a><span class="sd">        </span>
</span><span id="ModeConverter-317"><a href="#ModeConverter-317"><span class="linenos">317</span></a><span class="sd">        Args:</span>
</span><span id="ModeConverter-318"><a href="#ModeConverter-318"><span class="linenos">318</span></a><span class="sd">            manifest_path: Manifest </span>
</span><span id="ModeConverter-319"><a href="#ModeConverter-319"><span class="linenos">319</span></a><span class="sd">            output_path:  Archive </span>
</span><span id="ModeConverter-320"><a href="#ModeConverter-320"><span class="linenos">320</span></a><span class="sd">            local_base_path: </span>
</span><span id="ModeConverter-321"><a href="#ModeConverter-321"><span class="linenos">321</span></a><span class="sd">            path_mappings:  {: }</span>
</span><span id="ModeConverter-322"><a href="#ModeConverter-322"><span class="linenos">322</span></a><span class="sd">            checksum_hook_read: Manifest  Hook</span>
</span><span id="ModeConverter-323"><a href="#ModeConverter-323"><span class="linenos">323</span></a><span class="sd">            index_crypto_read: Manifest  Hook</span>
</span><span id="ModeConverter-324"><a href="#ModeConverter-324"><span class="linenos">324</span></a><span class="sd">            compression_hooks:  Archive  Hook </span>
</span><span id="ModeConverter-325"><a href="#ModeConverter-325"><span class="linenos">325</span></a><span class="sd">            default_algo_id:  ID</span>
</span><span id="ModeConverter-326"><a href="#ModeConverter-326"><span class="linenos">326</span></a><span class="sd">            output_checksum_hook:  Archive  Hook</span>
</span><span id="ModeConverter-327"><a href="#ModeConverter-327"><span class="linenos">327</span></a><span class="sd">            output_index_crypto:  Archive  Hook</span>
</span><span id="ModeConverter-328"><a href="#ModeConverter-328"><span class="linenos">328</span></a><span class="sd">            progress_callback: </span>
</span><span id="ModeConverter-329"><a href="#ModeConverter-329"><span class="linenos">329</span></a><span class="sd">            on_error: </span>
</span><span id="ModeConverter-330"><a href="#ModeConverter-330"><span class="linenos">330</span></a><span class="sd">            </span>
</span><span id="ModeConverter-331"><a href="#ModeConverter-331"><span class="linenos">331</span></a><span class="sd">        Returns:</span>
</span><span id="ModeConverter-332"><a href="#ModeConverter-332"><span class="linenos">332</span></a><span class="sd">            BatchResult</span>
</span><span id="ModeConverter-333"><a href="#ModeConverter-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModeConverter-334"><a href="#ModeConverter-334"><span class="linenos">334</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileItem</span>
</span><span id="ModeConverter-335"><a href="#ModeConverter-335"><span class="linenos">335</span></a>        
</span><span id="ModeConverter-336"><a href="#ModeConverter-336"><span class="linenos">336</span></a>        <span class="c1"># </span>
</span><span id="ModeConverter-337"><a href="#ModeConverter-337"><span class="linenos">337</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ModeConverter-338"><a href="#ModeConverter-338"><span class="linenos">338</span></a>            <span class="k">if</span> <span class="n">path_mappings</span><span class="p">:</span>
</span><span id="ModeConverter-339"><a href="#ModeConverter-339"><span class="linenos">339</span></a>                <span class="k">for</span> <span class="n">vfs_prefix</span><span class="p">,</span> <span class="n">local_prefix</span> <span class="ow">in</span> <span class="n">path_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModeConverter-340"><a href="#ModeConverter-340"><span class="linenos">340</span></a>                    <span class="k">if</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):</span>
</span><span id="ModeConverter-341"><a href="#ModeConverter-341"><span class="linenos">341</span></a>                        <span class="n">rel</span> <span class="o">=</span> <span class="n">vfs_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="ModeConverter-342"><a href="#ModeConverter-342"><span class="linenos">342</span></a>                        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_prefix</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span>
</span><span id="ModeConverter-343"><a href="#ModeConverter-343"><span class="linenos">343</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_base_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ModeConverter-344"><a href="#ModeConverter-344"><span class="linenos">344</span></a>        
</span><span id="ModeConverter-345"><a href="#ModeConverter-345"><span class="linenos">345</span></a>        <span class="k">with</span> <span class="n">ManifestReader</span><span class="p">(</span>
</span><span id="ModeConverter-346"><a href="#ModeConverter-346"><span class="linenos">346</span></a>            <span class="n">manifest_path</span><span class="p">,</span>
</span><span id="ModeConverter-347"><a href="#ModeConverter-347"><span class="linenos">347</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook_read</span><span class="p">,</span>
</span><span id="ModeConverter-348"><a href="#ModeConverter-348"><span class="linenos">348</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto_read</span>
</span><span id="ModeConverter-349"><a href="#ModeConverter-349"><span class="linenos">349</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="ModeConverter-350"><a href="#ModeConverter-350"><span class="linenos">350</span></a>            <span class="c1">#  FileItem </span>
</span><span id="ModeConverter-351"><a href="#ModeConverter-351"><span class="linenos">351</span></a>            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ModeConverter-352"><a href="#ModeConverter-352"><span class="linenos">352</span></a>            <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">list_all</span><span class="p">():</span>
</span><span id="ModeConverter-353"><a href="#ModeConverter-353"><span class="linenos">353</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ModeConverter-354"><a href="#ModeConverter-354"><span class="linenos">354</span></a>                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FileItem</span><span class="p">(</span>
</span><span id="ModeConverter-355"><a href="#ModeConverter-355"><span class="linenos">355</span></a>                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
</span><span id="ModeConverter-356"><a href="#ModeConverter-356"><span class="linenos">356</span></a>                    <span class="n">vfs_path</span><span class="o">=</span><span class="n">vfs_path</span><span class="p">,</span>
</span><span id="ModeConverter-357"><a href="#ModeConverter-357"><span class="linenos">357</span></a>                    <span class="n">algo_id</span><span class="o">=</span><span class="n">default_algo_id</span>
</span><span id="ModeConverter-358"><a href="#ModeConverter-358"><span class="linenos">358</span></a>                <span class="p">))</span>
</span><span id="ModeConverter-359"><a href="#ModeConverter-359"><span class="linenos">359</span></a>        
</span><span id="ModeConverter-360"><a href="#ModeConverter-360"><span class="linenos">360</span></a>        <span class="c1">#  Archive</span>
</span><span id="ModeConverter-361"><a href="#ModeConverter-361"><span class="linenos">361</span></a>        <span class="n">builder</span> <span class="o">=</span> <span class="n">ArchiveBuilder</span><span class="p">(</span>
</span><span id="ModeConverter-362"><a href="#ModeConverter-362"><span class="linenos">362</span></a>            <span class="n">output_path</span><span class="p">,</span>
</span><span id="ModeConverter-363"><a href="#ModeConverter-363"><span class="linenos">363</span></a>            <span class="n">compression_hooks</span><span class="o">=</span><span class="n">compression_hooks</span><span class="p">,</span>
</span><span id="ModeConverter-364"><a href="#ModeConverter-364"><span class="linenos">364</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">output_checksum_hook</span><span class="p">,</span>
</span><span id="ModeConverter-365"><a href="#ModeConverter-365"><span class="linenos">365</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">output_index_crypto</span>
</span><span id="ModeConverter-366"><a href="#ModeConverter-366"><span class="linenos">366</span></a>        <span class="p">)</span>
</span><span id="ModeConverter-367"><a href="#ModeConverter-367"><span class="linenos">367</span></a>        
</span><span id="ModeConverter-368"><a href="#ModeConverter-368"><span class="linenos">368</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">add_files_batch</span><span class="p">(</span>
</span><span id="ModeConverter-369"><a href="#ModeConverter-369"><span class="linenos">369</span></a>            <span class="n">items</span><span class="p">,</span>
</span><span id="ModeConverter-370"><a href="#ModeConverter-370"><span class="linenos">370</span></a>            <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
</span><span id="ModeConverter-371"><a href="#ModeConverter-371"><span class="linenos">371</span></a>            <span class="n">progress_callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ModeConverter-372"><a href="#ModeConverter-372"><span class="linenos">372</span></a>        <span class="p">)</span>
</span><span id="ModeConverter-373"><a href="#ModeConverter-373"><span class="linenos">373</span></a>        
</span><span id="ModeConverter-374"><a href="#ModeConverter-374"><span class="linenos">374</span></a>        <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="ModeConverter-375"><a href="#ModeConverter-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Manifest  Archive </p>
</div>


                            <div id="ModeConverter.archive_to_manifest" class="classattr">
                                        <input id="ModeConverter.archive_to_manifest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">archive_to_manifest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">archive_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">compression_hooks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#CompressionHook">CompressionHook</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">checksum_hook</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_crypto_read</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_checksum_hook</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_index_crypto</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ModeConverter.archive_to_manifest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModeConverter.archive_to_manifest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModeConverter.archive_to_manifest-196"><a href="#ModeConverter.archive_to_manifest-196"><span class="linenos">196</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModeConverter.archive_to_manifest-197"><a href="#ModeConverter.archive_to_manifest-197"><span class="linenos">197</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">archive_to_manifest</span><span class="p">(</span>
</span><span id="ModeConverter.archive_to_manifest-198"><a href="#ModeConverter.archive_to_manifest-198"><span class="linenos">198</span></a>        <span class="n">archive_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-199"><a href="#ModeConverter.archive_to_manifest-199"><span class="linenos">199</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-200"><a href="#ModeConverter.archive_to_manifest-200"><span class="linenos">200</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-201"><a href="#ModeConverter.archive_to_manifest-201"><span class="linenos">201</span></a>        <span class="n">checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-202"><a href="#ModeConverter.archive_to_manifest-202"><span class="linenos">202</span></a>        <span class="n">index_crypto_read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-203"><a href="#ModeConverter.archive_to_manifest-203"><span class="linenos">203</span></a>        <span class="c1"># </span>
</span><span id="ModeConverter.archive_to_manifest-204"><a href="#ModeConverter.archive_to_manifest-204"><span class="linenos">204</span></a>        <span class="n">output_checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-205"><a href="#ModeConverter.archive_to_manifest-205"><span class="linenos">205</span></a>        <span class="n">output_index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-206"><a href="#ModeConverter.archive_to_manifest-206"><span class="linenos">206</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ModeConverter.archive_to_manifest-207"><a href="#ModeConverter.archive_to_manifest-207"><span class="linenos">207</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ModeConverter.archive_to_manifest-208"><a href="#ModeConverter.archive_to_manifest-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModeConverter.archive_to_manifest-209"><a href="#ModeConverter.archive_to_manifest-209"><span class="linenos">209</span></a><span class="sd">         Archive  Manifest</span>
</span><span id="ModeConverter.archive_to_manifest-210"><a href="#ModeConverter.archive_to_manifest-210"><span class="linenos">210</span></a><span class="sd">        </span>
</span><span id="ModeConverter.archive_to_manifest-211"><a href="#ModeConverter.archive_to_manifest-211"><span class="linenos">211</span></a><span class="sd">        </span>
</span><span id="ModeConverter.archive_to_manifest-212"><a href="#ModeConverter.archive_to_manifest-212"><span class="linenos">212</span></a><span class="sd">        </span>
</span><span id="ModeConverter.archive_to_manifest-213"><a href="#ModeConverter.archive_to_manifest-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="ModeConverter.archive_to_manifest-214"><a href="#ModeConverter.archive_to_manifest-214"><span class="linenos">214</span></a><span class="sd">            archive_path: Archive </span>
</span><span id="ModeConverter.archive_to_manifest-215"><a href="#ModeConverter.archive_to_manifest-215"><span class="linenos">215</span></a><span class="sd">            output_path:  Manifest </span>
</span><span id="ModeConverter.archive_to_manifest-216"><a href="#ModeConverter.archive_to_manifest-216"><span class="linenos">216</span></a><span class="sd">            compression_hooks: Archive  Hook</span>
</span><span id="ModeConverter.archive_to_manifest-217"><a href="#ModeConverter.archive_to_manifest-217"><span class="linenos">217</span></a><span class="sd">            checksum_hook: Archive  Hook</span>
</span><span id="ModeConverter.archive_to_manifest-218"><a href="#ModeConverter.archive_to_manifest-218"><span class="linenos">218</span></a><span class="sd">            index_crypto_read: Archive  Hook</span>
</span><span id="ModeConverter.archive_to_manifest-219"><a href="#ModeConverter.archive_to_manifest-219"><span class="linenos">219</span></a><span class="sd">            output_checksum_hook:  Manifest  Hook ()</span>
</span><span id="ModeConverter.archive_to_manifest-220"><a href="#ModeConverter.archive_to_manifest-220"><span class="linenos">220</span></a><span class="sd">            output_index_crypto:  Manifest  Hook ()</span>
</span><span id="ModeConverter.archive_to_manifest-221"><a href="#ModeConverter.archive_to_manifest-221"><span class="linenos">221</span></a><span class="sd">            progress_callback: </span>
</span><span id="ModeConverter.archive_to_manifest-222"><a href="#ModeConverter.archive_to_manifest-222"><span class="linenos">222</span></a><span class="sd">            </span>
</span><span id="ModeConverter.archive_to_manifest-223"><a href="#ModeConverter.archive_to_manifest-223"><span class="linenos">223</span></a><span class="sd">        Returns:</span>
</span><span id="ModeConverter.archive_to_manifest-224"><a href="#ModeConverter.archive_to_manifest-224"><span class="linenos">224</span></a><span class="sd">            BatchResult</span>
</span><span id="ModeConverter.archive_to_manifest-225"><a href="#ModeConverter.archive_to_manifest-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModeConverter.archive_to_manifest-226"><a href="#ModeConverter.archive_to_manifest-226"><span class="linenos">226</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchResult</span><span class="p">,</span> <span class="n">ProgressTracker</span>
</span><span id="ModeConverter.archive_to_manifest-227"><a href="#ModeConverter.archive_to_manifest-227"><span class="linenos">227</span></a>        
</span><span id="ModeConverter.archive_to_manifest-228"><a href="#ModeConverter.archive_to_manifest-228"><span class="linenos">228</span></a>        <span class="c1">#  checksum_hook</span>
</span><span id="ModeConverter.archive_to_manifest-229"><a href="#ModeConverter.archive_to_manifest-229"><span class="linenos">229</span></a>        <span class="k">if</span> <span class="n">output_checksum_hook</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ModeConverter.archive_to_manifest-230"><a href="#ModeConverter.archive_to_manifest-230"><span class="linenos">230</span></a>            <span class="n">output_checksum_hook</span> <span class="o">=</span> <span class="n">checksum_hook</span>
</span><span id="ModeConverter.archive_to_manifest-231"><a href="#ModeConverter.archive_to_manifest-231"><span class="linenos">231</span></a>        
</span><span id="ModeConverter.archive_to_manifest-232"><a href="#ModeConverter.archive_to_manifest-232"><span class="linenos">232</span></a>        <span class="k">with</span> <span class="n">ArchiveReader</span><span class="p">(</span>
</span><span id="ModeConverter.archive_to_manifest-233"><a href="#ModeConverter.archive_to_manifest-233"><span class="linenos">233</span></a>            <span class="n">archive_path</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-234"><a href="#ModeConverter.archive_to_manifest-234"><span class="linenos">234</span></a>            <span class="n">compression_hooks</span><span class="o">=</span><span class="n">compression_hooks</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-235"><a href="#ModeConverter.archive_to_manifest-235"><span class="linenos">235</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-236"><a href="#ModeConverter.archive_to_manifest-236"><span class="linenos">236</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto_read</span>
</span><span id="ModeConverter.archive_to_manifest-237"><a href="#ModeConverter.archive_to_manifest-237"><span class="linenos">237</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="ModeConverter.archive_to_manifest-238"><a href="#ModeConverter.archive_to_manifest-238"><span class="linenos">238</span></a>            <span class="n">all_paths</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">list_all</span><span class="p">()</span>
</span><span id="ModeConverter.archive_to_manifest-239"><a href="#ModeConverter.archive_to_manifest-239"><span class="linenos">239</span></a>            
</span><span id="ModeConverter.archive_to_manifest-240"><a href="#ModeConverter.archive_to_manifest-240"><span class="linenos">240</span></a>            <span class="n">builder</span> <span class="o">=</span> <span class="n">ManifestBuilder</span><span class="p">(</span>
</span><span id="ModeConverter.archive_to_manifest-241"><a href="#ModeConverter.archive_to_manifest-241"><span class="linenos">241</span></a>                <span class="n">output_path</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-242"><a href="#ModeConverter.archive_to_manifest-242"><span class="linenos">242</span></a>                <span class="n">magic</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">file_header</span><span class="o">.</span><span class="n">magic</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-243"><a href="#ModeConverter.archive_to_manifest-243"><span class="linenos">243</span></a>                <span class="n">checksum_hook</span><span class="o">=</span><span class="n">output_checksum_hook</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-244"><a href="#ModeConverter.archive_to_manifest-244"><span class="linenos">244</span></a>                <span class="n">index_crypto</span><span class="o">=</span><span class="n">output_index_crypto</span>
</span><span id="ModeConverter.archive_to_manifest-245"><a href="#ModeConverter.archive_to_manifest-245"><span class="linenos">245</span></a>            <span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-246"><a href="#ModeConverter.archive_to_manifest-246"><span class="linenos">246</span></a>            
</span><span id="ModeConverter.archive_to_manifest-247"><a href="#ModeConverter.archive_to_manifest-247"><span class="linenos">247</span></a>            <span class="n">tracker</span> <span class="o">=</span> <span class="n">ProgressTracker</span><span class="p">(</span>
</span><span id="ModeConverter.archive_to_manifest-248"><a href="#ModeConverter.archive_to_manifest-248"><span class="linenos">248</span></a>                <span class="n">total_files</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">all_paths</span><span class="p">),</span>
</span><span id="ModeConverter.archive_to_manifest-249"><a href="#ModeConverter.archive_to_manifest-249"><span class="linenos">249</span></a>                <span class="n">callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ModeConverter.archive_to_manifest-250"><a href="#ModeConverter.archive_to_manifest-250"><span class="linenos">250</span></a>            <span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-251"><a href="#ModeConverter.archive_to_manifest-251"><span class="linenos">251</span></a>            
</span><span id="ModeConverter.archive_to_manifest-252"><a href="#ModeConverter.archive_to_manifest-252"><span class="linenos">252</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">BatchResult</span><span class="p">()</span>
</span><span id="ModeConverter.archive_to_manifest-253"><a href="#ModeConverter.archive_to_manifest-253"><span class="linenos">253</span></a>            
</span><span id="ModeConverter.archive_to_manifest-254"><a href="#ModeConverter.archive_to_manifest-254"><span class="linenos">254</span></a>            <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">:</span>
</span><span id="ModeConverter.archive_to_manifest-255"><a href="#ModeConverter.archive_to_manifest-255"><span class="linenos">255</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ModeConverter.archive_to_manifest-256"><a href="#ModeConverter.archive_to_manifest-256"><span class="linenos">256</span></a>                    <span class="c1">#  Archive </span>
</span><span id="ModeConverter.archive_to_manifest-257"><a href="#ModeConverter.archive_to_manifest-257"><span class="linenos">257</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-258"><a href="#ModeConverter.archive_to_manifest-258"><span class="linenos">258</span></a>                    
</span><span id="ModeConverter.archive_to_manifest-259"><a href="#ModeConverter.archive_to_manifest-259"><span class="linenos">259</span></a>                    <span class="c1">#  ( add_file )</span>
</span><span id="ModeConverter.archive_to_manifest-260"><a href="#ModeConverter.archive_to_manifest-260"><span class="linenos">260</span></a>                    <span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-261"><a href="#ModeConverter.archive_to_manifest-261"><span class="linenos">261</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">split_path</span><span class="p">,</span> <span class="n">default_path_hash</span>
</span><span id="ModeConverter.archive_to_manifest-262"><a href="#ModeConverter.archive_to_manifest-262"><span class="linenos">262</span></a>                    <span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-263"><a href="#ModeConverter.archive_to_manifest-263"><span class="linenos">263</span></a>                    
</span><span id="ModeConverter.archive_to_manifest-264"><a href="#ModeConverter.archive_to_manifest-264"><span class="linenos">264</span></a>                    <span class="n">path_hash</span> <span class="o">=</span> <span class="n">default_path_hash</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-265"><a href="#ModeConverter.archive_to_manifest-265"><span class="linenos">265</span></a>                    <span class="n">dir_id</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">ext_id</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">_path_dict</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">dir_part</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-266"><a href="#ModeConverter.archive_to_manifest-266"><span class="linenos">266</span></a>                    
</span><span id="ModeConverter.archive_to_manifest-267"><a href="#ModeConverter.archive_to_manifest-267"><span class="linenos">267</span></a>                    <span class="n">checksum</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="ModeConverter.archive_to_manifest-268"><a href="#ModeConverter.archive_to_manifest-268"><span class="linenos">268</span></a>                    <span class="k">if</span> <span class="n">output_checksum_hook</span><span class="p">:</span>
</span><span id="ModeConverter.archive_to_manifest-269"><a href="#ModeConverter.archive_to_manifest-269"><span class="linenos">269</span></a>                        <span class="n">checksum</span> <span class="o">=</span> <span class="n">output_checksum_hook</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-270"><a href="#ModeConverter.archive_to_manifest-270"><span class="linenos">270</span></a>                    
</span><span id="ModeConverter.archive_to_manifest-271"><a href="#ModeConverter.archive_to_manifest-271"><span class="linenos">271</span></a>                    <span class="kn">from</span><span class="w"> </span><span class="nn">.core.schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">ManifestEntry</span>
</span><span id="ModeConverter.archive_to_manifest-272"><a href="#ModeConverter.archive_to_manifest-272"><span class="linenos">272</span></a>                    <span class="n">entry</span> <span class="o">=</span> <span class="n">ManifestEntry</span><span class="p">(</span>
</span><span id="ModeConverter.archive_to_manifest-273"><a href="#ModeConverter.archive_to_manifest-273"><span class="linenos">273</span></a>                        <span class="n">path_hash</span><span class="o">=</span><span class="n">path_hash</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-274"><a href="#ModeConverter.archive_to_manifest-274"><span class="linenos">274</span></a>                        <span class="n">dir_id</span><span class="o">=</span><span class="n">dir_id</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-275"><a href="#ModeConverter.archive_to_manifest-275"><span class="linenos">275</span></a>                        <span class="n">name_id</span><span class="o">=</span><span class="n">name_id</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-276"><a href="#ModeConverter.archive_to_manifest-276"><span class="linenos">276</span></a>                        <span class="n">ext_id</span><span class="o">=</span><span class="n">ext_id</span><span class="p">,</span>
</span><span id="ModeConverter.archive_to_manifest-277"><a href="#ModeConverter.archive_to_manifest-277"><span class="linenos">277</span></a>                        <span class="n">raw_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
</span><span id="ModeConverter.archive_to_manifest-278"><a href="#ModeConverter.archive_to_manifest-278"><span class="linenos">278</span></a>                        <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span>
</span><span id="ModeConverter.archive_to_manifest-279"><a href="#ModeConverter.archive_to_manifest-279"><span class="linenos">279</span></a>                    <span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-280"><a href="#ModeConverter.archive_to_manifest-280"><span class="linenos">280</span></a>                    <span class="n">builder</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-281"><a href="#ModeConverter.archive_to_manifest-281"><span class="linenos">281</span></a>                    <span class="n">builder</span><span class="o">.</span><span class="n">_hash_to_path</span><span class="p">[</span><span class="n">path_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalized</span>
</span><span id="ModeConverter.archive_to_manifest-282"><a href="#ModeConverter.archive_to_manifest-282"><span class="linenos">282</span></a>                    
</span><span id="ModeConverter.archive_to_manifest-283"><a href="#ModeConverter.archive_to_manifest-283"><span class="linenos">283</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ModeConverter.archive_to_manifest-284"><a href="#ModeConverter.archive_to_manifest-284"><span class="linenos">284</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-285"><a href="#ModeConverter.archive_to_manifest-285"><span class="linenos">285</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="ModeConverter.archive_to_manifest-286"><a href="#ModeConverter.archive_to_manifest-286"><span class="linenos">286</span></a>                    
</span><span id="ModeConverter.archive_to_manifest-287"><a href="#ModeConverter.archive_to_manifest-287"><span class="linenos">287</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ModeConverter.archive_to_manifest-288"><a href="#ModeConverter.archive_to_manifest-288"><span class="linenos">288</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ModeConverter.archive_to_manifest-289"><a href="#ModeConverter.archive_to_manifest-289"><span class="linenos">289</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vfs_path</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
</span><span id="ModeConverter.archive_to_manifest-290"><a href="#ModeConverter.archive_to_manifest-290"><span class="linenos">290</span></a>                    <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ModeConverter.archive_to_manifest-291"><a href="#ModeConverter.archive_to_manifest-291"><span class="linenos">291</span></a>            
</span><span id="ModeConverter.archive_to_manifest-292"><a href="#ModeConverter.archive_to_manifest-292"><span class="linenos">292</span></a>            <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="ModeConverter.archive_to_manifest-293"><a href="#ModeConverter.archive_to_manifest-293"><span class="linenos">293</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</span><span id="ModeConverter.archive_to_manifest-294"><a href="#ModeConverter.archive_to_manifest-294"><span class="linenos">294</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p> Archive  Manifest</p>

<p></p>

<p>Args:
    archive_path: Archive 
    output_path:  Manifest 
    compression_hooks: Archive  Hook
    checksum_hook: Archive  Hook
    index_crypto_read: Archive  Hook
    output_checksum_hook:  Manifest  Hook ()
    output_index_crypto:  Manifest  Hook ()
    progress_callback: </p>

<p>Returns:
    BatchResult</p>
</div>


                            </div>
                            <div id="ModeConverter.manifest_to_archive" class="classattr">
                                        <input id="ModeConverter.manifest_to_archive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">manifest_to_archive</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">manifest_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">local_base_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">path_mappings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">checksum_hook_read</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_crypto_read</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">compression_hooks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#CompressionHook">CompressionHook</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">output_checksum_hook</span><span class="p">:</span> <span class="n"><a href="#ChecksumHook">ChecksumHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">output_index_crypto</span><span class="p">:</span> <span class="n"><a href="#IndexCryptoHook">IndexCryptoHook</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;skip&#39;</span></span><span class="return-annotation">) -> <span class="s1">&#39;BatchResult&#39;</span>:</span></span>

                <label class="view-source-button" for="ModeConverter.manifest_to_archive-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModeConverter.manifest_to_archive"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModeConverter.manifest_to_archive-296"><a href="#ModeConverter.manifest_to_archive-296"><span class="linenos">296</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ModeConverter.manifest_to_archive-297"><a href="#ModeConverter.manifest_to_archive-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">manifest_to_archive</span><span class="p">(</span>
</span><span id="ModeConverter.manifest_to_archive-298"><a href="#ModeConverter.manifest_to_archive-298"><span class="linenos">298</span></a>        <span class="n">manifest_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-299"><a href="#ModeConverter.manifest_to_archive-299"><span class="linenos">299</span></a>        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-300"><a href="#ModeConverter.manifest_to_archive-300"><span class="linenos">300</span></a>        <span class="n">local_base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-301"><a href="#ModeConverter.manifest_to_archive-301"><span class="linenos">301</span></a>        <span class="n">path_mappings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-302"><a href="#ModeConverter.manifest_to_archive-302"><span class="linenos">302</span></a>        <span class="n">checksum_hook_read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-303"><a href="#ModeConverter.manifest_to_archive-303"><span class="linenos">303</span></a>        <span class="n">index_crypto_read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-304"><a href="#ModeConverter.manifest_to_archive-304"><span class="linenos">304</span></a>        <span class="c1"># </span>
</span><span id="ModeConverter.manifest_to_archive-305"><a href="#ModeConverter.manifest_to_archive-305"><span class="linenos">305</span></a>        <span class="n">compression_hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CompressionHook</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-306"><a href="#ModeConverter.manifest_to_archive-306"><span class="linenos">306</span></a>        <span class="n">default_algo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-307"><a href="#ModeConverter.manifest_to_archive-307"><span class="linenos">307</span></a>        <span class="n">output_checksum_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChecksumHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-308"><a href="#ModeConverter.manifest_to_archive-308"><span class="linenos">308</span></a>        <span class="n">output_index_crypto</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexCryptoHook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-309"><a href="#ModeConverter.manifest_to_archive-309"><span class="linenos">309</span></a>        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-310"><a href="#ModeConverter.manifest_to_archive-310"><span class="linenos">310</span></a>        <span class="n">on_error</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;skip&#39;</span>
</span><span id="ModeConverter.manifest_to_archive-311"><a href="#ModeConverter.manifest_to_archive-311"><span class="linenos">311</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;BatchResult&#39;</span><span class="p">:</span>
</span><span id="ModeConverter.manifest_to_archive-312"><a href="#ModeConverter.manifest_to_archive-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModeConverter.manifest_to_archive-313"><a href="#ModeConverter.manifest_to_archive-313"><span class="linenos">313</span></a><span class="sd">         Manifest  Archive</span>
</span><span id="ModeConverter.manifest_to_archive-314"><a href="#ModeConverter.manifest_to_archive-314"><span class="linenos">314</span></a><span class="sd">        </span>
</span><span id="ModeConverter.manifest_to_archive-315"><a href="#ModeConverter.manifest_to_archive-315"><span class="linenos">315</span></a><span class="sd">        </span>
</span><span id="ModeConverter.manifest_to_archive-316"><a href="#ModeConverter.manifest_to_archive-316"><span class="linenos">316</span></a><span class="sd">        </span>
</span><span id="ModeConverter.manifest_to_archive-317"><a href="#ModeConverter.manifest_to_archive-317"><span class="linenos">317</span></a><span class="sd">        Args:</span>
</span><span id="ModeConverter.manifest_to_archive-318"><a href="#ModeConverter.manifest_to_archive-318"><span class="linenos">318</span></a><span class="sd">            manifest_path: Manifest </span>
</span><span id="ModeConverter.manifest_to_archive-319"><a href="#ModeConverter.manifest_to_archive-319"><span class="linenos">319</span></a><span class="sd">            output_path:  Archive </span>
</span><span id="ModeConverter.manifest_to_archive-320"><a href="#ModeConverter.manifest_to_archive-320"><span class="linenos">320</span></a><span class="sd">            local_base_path: </span>
</span><span id="ModeConverter.manifest_to_archive-321"><a href="#ModeConverter.manifest_to_archive-321"><span class="linenos">321</span></a><span class="sd">            path_mappings:  {: }</span>
</span><span id="ModeConverter.manifest_to_archive-322"><a href="#ModeConverter.manifest_to_archive-322"><span class="linenos">322</span></a><span class="sd">            checksum_hook_read: Manifest  Hook</span>
</span><span id="ModeConverter.manifest_to_archive-323"><a href="#ModeConverter.manifest_to_archive-323"><span class="linenos">323</span></a><span class="sd">            index_crypto_read: Manifest  Hook</span>
</span><span id="ModeConverter.manifest_to_archive-324"><a href="#ModeConverter.manifest_to_archive-324"><span class="linenos">324</span></a><span class="sd">            compression_hooks:  Archive  Hook </span>
</span><span id="ModeConverter.manifest_to_archive-325"><a href="#ModeConverter.manifest_to_archive-325"><span class="linenos">325</span></a><span class="sd">            default_algo_id:  ID</span>
</span><span id="ModeConverter.manifest_to_archive-326"><a href="#ModeConverter.manifest_to_archive-326"><span class="linenos">326</span></a><span class="sd">            output_checksum_hook:  Archive  Hook</span>
</span><span id="ModeConverter.manifest_to_archive-327"><a href="#ModeConverter.manifest_to_archive-327"><span class="linenos">327</span></a><span class="sd">            output_index_crypto:  Archive  Hook</span>
</span><span id="ModeConverter.manifest_to_archive-328"><a href="#ModeConverter.manifest_to_archive-328"><span class="linenos">328</span></a><span class="sd">            progress_callback: </span>
</span><span id="ModeConverter.manifest_to_archive-329"><a href="#ModeConverter.manifest_to_archive-329"><span class="linenos">329</span></a><span class="sd">            on_error: </span>
</span><span id="ModeConverter.manifest_to_archive-330"><a href="#ModeConverter.manifest_to_archive-330"><span class="linenos">330</span></a><span class="sd">            </span>
</span><span id="ModeConverter.manifest_to_archive-331"><a href="#ModeConverter.manifest_to_archive-331"><span class="linenos">331</span></a><span class="sd">        Returns:</span>
</span><span id="ModeConverter.manifest_to_archive-332"><a href="#ModeConverter.manifest_to_archive-332"><span class="linenos">332</span></a><span class="sd">            BatchResult</span>
</span><span id="ModeConverter.manifest_to_archive-333"><a href="#ModeConverter.manifest_to_archive-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModeConverter.manifest_to_archive-334"><a href="#ModeConverter.manifest_to_archive-334"><span class="linenos">334</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.core.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileItem</span>
</span><span id="ModeConverter.manifest_to_archive-335"><a href="#ModeConverter.manifest_to_archive-335"><span class="linenos">335</span></a>        
</span><span id="ModeConverter.manifest_to_archive-336"><a href="#ModeConverter.manifest_to_archive-336"><span class="linenos">336</span></a>        <span class="c1"># </span>
</span><span id="ModeConverter.manifest_to_archive-337"><a href="#ModeConverter.manifest_to_archive-337"><span class="linenos">337</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ModeConverter.manifest_to_archive-338"><a href="#ModeConverter.manifest_to_archive-338"><span class="linenos">338</span></a>            <span class="k">if</span> <span class="n">path_mappings</span><span class="p">:</span>
</span><span id="ModeConverter.manifest_to_archive-339"><a href="#ModeConverter.manifest_to_archive-339"><span class="linenos">339</span></a>                <span class="k">for</span> <span class="n">vfs_prefix</span><span class="p">,</span> <span class="n">local_prefix</span> <span class="ow">in</span> <span class="n">path_mappings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ModeConverter.manifest_to_archive-340"><a href="#ModeConverter.manifest_to_archive-340"><span class="linenos">340</span></a>                    <span class="k">if</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):</span>
</span><span id="ModeConverter.manifest_to_archive-341"><a href="#ModeConverter.manifest_to_archive-341"><span class="linenos">341</span></a>                        <span class="n">rel</span> <span class="o">=</span> <span class="n">vfs_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">vfs_prefix</span><span class="p">):]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="ModeConverter.manifest_to_archive-342"><a href="#ModeConverter.manifest_to_archive-342"><span class="linenos">342</span></a>                        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_prefix</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span>
</span><span id="ModeConverter.manifest_to_archive-343"><a href="#ModeConverter.manifest_to_archive-343"><span class="linenos">343</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_base_path</span><span class="p">,</span> <span class="n">vfs_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
</span><span id="ModeConverter.manifest_to_archive-344"><a href="#ModeConverter.manifest_to_archive-344"><span class="linenos">344</span></a>        
</span><span id="ModeConverter.manifest_to_archive-345"><a href="#ModeConverter.manifest_to_archive-345"><span class="linenos">345</span></a>        <span class="k">with</span> <span class="n">ManifestReader</span><span class="p">(</span>
</span><span id="ModeConverter.manifest_to_archive-346"><a href="#ModeConverter.manifest_to_archive-346"><span class="linenos">346</span></a>            <span class="n">manifest_path</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-347"><a href="#ModeConverter.manifest_to_archive-347"><span class="linenos">347</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">checksum_hook_read</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-348"><a href="#ModeConverter.manifest_to_archive-348"><span class="linenos">348</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">index_crypto_read</span>
</span><span id="ModeConverter.manifest_to_archive-349"><a href="#ModeConverter.manifest_to_archive-349"><span class="linenos">349</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
</span><span id="ModeConverter.manifest_to_archive-350"><a href="#ModeConverter.manifest_to_archive-350"><span class="linenos">350</span></a>            <span class="c1">#  FileItem </span>
</span><span id="ModeConverter.manifest_to_archive-351"><a href="#ModeConverter.manifest_to_archive-351"><span class="linenos">351</span></a>            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ModeConverter.manifest_to_archive-352"><a href="#ModeConverter.manifest_to_archive-352"><span class="linenos">352</span></a>            <span class="k">for</span> <span class="n">vfs_path</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">list_all</span><span class="p">():</span>
</span><span id="ModeConverter.manifest_to_archive-353"><a href="#ModeConverter.manifest_to_archive-353"><span class="linenos">353</span></a>                <span class="n">local_path</span> <span class="o">=</span> <span class="n">resolve_local_path</span><span class="p">(</span><span class="n">vfs_path</span><span class="p">)</span>
</span><span id="ModeConverter.manifest_to_archive-354"><a href="#ModeConverter.manifest_to_archive-354"><span class="linenos">354</span></a>                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FileItem</span><span class="p">(</span>
</span><span id="ModeConverter.manifest_to_archive-355"><a href="#ModeConverter.manifest_to_archive-355"><span class="linenos">355</span></a>                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-356"><a href="#ModeConverter.manifest_to_archive-356"><span class="linenos">356</span></a>                    <span class="n">vfs_path</span><span class="o">=</span><span class="n">vfs_path</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-357"><a href="#ModeConverter.manifest_to_archive-357"><span class="linenos">357</span></a>                    <span class="n">algo_id</span><span class="o">=</span><span class="n">default_algo_id</span>
</span><span id="ModeConverter.manifest_to_archive-358"><a href="#ModeConverter.manifest_to_archive-358"><span class="linenos">358</span></a>                <span class="p">))</span>
</span><span id="ModeConverter.manifest_to_archive-359"><a href="#ModeConverter.manifest_to_archive-359"><span class="linenos">359</span></a>        
</span><span id="ModeConverter.manifest_to_archive-360"><a href="#ModeConverter.manifest_to_archive-360"><span class="linenos">360</span></a>        <span class="c1">#  Archive</span>
</span><span id="ModeConverter.manifest_to_archive-361"><a href="#ModeConverter.manifest_to_archive-361"><span class="linenos">361</span></a>        <span class="n">builder</span> <span class="o">=</span> <span class="n">ArchiveBuilder</span><span class="p">(</span>
</span><span id="ModeConverter.manifest_to_archive-362"><a href="#ModeConverter.manifest_to_archive-362"><span class="linenos">362</span></a>            <span class="n">output_path</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-363"><a href="#ModeConverter.manifest_to_archive-363"><span class="linenos">363</span></a>            <span class="n">compression_hooks</span><span class="o">=</span><span class="n">compression_hooks</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-364"><a href="#ModeConverter.manifest_to_archive-364"><span class="linenos">364</span></a>            <span class="n">checksum_hook</span><span class="o">=</span><span class="n">output_checksum_hook</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-365"><a href="#ModeConverter.manifest_to_archive-365"><span class="linenos">365</span></a>            <span class="n">index_crypto</span><span class="o">=</span><span class="n">output_index_crypto</span>
</span><span id="ModeConverter.manifest_to_archive-366"><a href="#ModeConverter.manifest_to_archive-366"><span class="linenos">366</span></a>        <span class="p">)</span>
</span><span id="ModeConverter.manifest_to_archive-367"><a href="#ModeConverter.manifest_to_archive-367"><span class="linenos">367</span></a>        
</span><span id="ModeConverter.manifest_to_archive-368"><a href="#ModeConverter.manifest_to_archive-368"><span class="linenos">368</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">add_files_batch</span><span class="p">(</span>
</span><span id="ModeConverter.manifest_to_archive-369"><a href="#ModeConverter.manifest_to_archive-369"><span class="linenos">369</span></a>            <span class="n">items</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-370"><a href="#ModeConverter.manifest_to_archive-370"><span class="linenos">370</span></a>            <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
</span><span id="ModeConverter.manifest_to_archive-371"><a href="#ModeConverter.manifest_to_archive-371"><span class="linenos">371</span></a>            <span class="n">progress_callback</span><span class="o">=</span><span class="n">progress_callback</span>
</span><span id="ModeConverter.manifest_to_archive-372"><a href="#ModeConverter.manifest_to_archive-372"><span class="linenos">372</span></a>        <span class="p">)</span>
</span><span id="ModeConverter.manifest_to_archive-373"><a href="#ModeConverter.manifest_to_archive-373"><span class="linenos">373</span></a>        
</span><span id="ModeConverter.manifest_to_archive-374"><a href="#ModeConverter.manifest_to_archive-374"><span class="linenos">374</span></a>        <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="ModeConverter.manifest_to_archive-375"><a href="#ModeConverter.manifest_to_archive-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p> Manifest  Archive</p>

<p></p>

<p>Args:
    manifest_path: Manifest 
    output_path:  Archive 
    local_base_path: 
    path_mappings:  {: }
    checksum_hook_read: Manifest  Hook
    index_crypto_read: Manifest  Hook
    compression_hooks:  Archive  Hook 
    default_algo_id:  ID
    output_checksum_hook:  Archive  Hook
    output_index_crypto:  Archive  Hook
    progress_callback: 
    on_error: </p>

<p>Returns:
    BatchResult</p>
</div>


                            </div>
                </section>
                <section id="CompressionHook">
                            <input id="CompressionHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CompressionHook</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="CompressionHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CompressionHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CompressionHook-13"><a href="#CompressionHook-13"><span class="linenos">13</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CompressionHook</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="CompressionHook-14"><a href="#CompressionHook-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompressionHook-15"><a href="#CompressionHook-15"><span class="linenos">15</span></a><span class="sd">    </span>
</span><span id="CompressionHook-16"><a href="#CompressionHook-16"><span class="linenos">16</span></a><span class="sd">    </span>
</span><span id="CompressionHook-17"><a href="#CompressionHook-17"><span class="linenos">17</span></a><span class="sd">     ( Zstd, LZ4, LZMA)</span>
</span><span id="CompressionHook-18"><a href="#CompressionHook-18"><span class="linenos">18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CompressionHook-19"><a href="#CompressionHook-19"><span class="linenos">19</span></a>    
</span><span id="CompressionHook-20"><a href="#CompressionHook-20"><span class="linenos">20</span></a>    <span class="nd">@property</span>
</span><span id="CompressionHook-21"><a href="#CompressionHook-21"><span class="linenos">21</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="CompressionHook-22"><a href="#CompressionHook-22"><span class="linenos">22</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CompressionHook-23"><a href="#CompressionHook-23"><span class="linenos">23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompressionHook-24"><a href="#CompressionHook-24"><span class="linenos">24</span></a><span class="sd">         ID</span>
</span><span id="CompressionHook-25"><a href="#CompressionHook-25"><span class="linenos">25</span></a><span class="sd">        </span>
</span><span id="CompressionHook-26"><a href="#CompressionHook-26"><span class="linenos">26</span></a><span class="sd">         Entry  algo_id </span>
</span><span id="CompressionHook-27"><a href="#CompressionHook-27"><span class="linenos">27</span></a><span class="sd">        0 &quot;&quot;</span>
</span><span id="CompressionHook-28"><a href="#CompressionHook-28"><span class="linenos">28</span></a><span class="sd">        </span>
</span><span id="CompressionHook-29"><a href="#CompressionHook-29"><span class="linenos">29</span></a><span class="sd">        Returns:</span>
</span><span id="CompressionHook-30"><a href="#CompressionHook-30"><span class="linenos">30</span></a><span class="sd">            1-255 </span>
</span><span id="CompressionHook-31"><a href="#CompressionHook-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompressionHook-32"><a href="#CompressionHook-32"><span class="linenos">32</span></a>        <span class="k">pass</span>
</span><span id="CompressionHook-33"><a href="#CompressionHook-33"><span class="linenos">33</span></a>    
</span><span id="CompressionHook-34"><a href="#CompressionHook-34"><span class="linenos">34</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="CompressionHook-35"><a href="#CompressionHook-35"><span class="linenos">35</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="CompressionHook-36"><a href="#CompressionHook-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompressionHook-37"><a href="#CompressionHook-37"><span class="linenos">37</span></a><span class="sd">        </span>
</span><span id="CompressionHook-38"><a href="#CompressionHook-38"><span class="linenos">38</span></a><span class="sd">        </span>
</span><span id="CompressionHook-39"><a href="#CompressionHook-39"><span class="linenos">39</span></a><span class="sd">        Args:</span>
</span><span id="CompressionHook-40"><a href="#CompressionHook-40"><span class="linenos">40</span></a><span class="sd">            data: </span>
</span><span id="CompressionHook-41"><a href="#CompressionHook-41"><span class="linenos">41</span></a><span class="sd">            </span>
</span><span id="CompressionHook-42"><a href="#CompressionHook-42"><span class="linenos">42</span></a><span class="sd">        Returns:</span>
</span><span id="CompressionHook-43"><a href="#CompressionHook-43"><span class="linenos">43</span></a><span class="sd">            </span>
</span><span id="CompressionHook-44"><a href="#CompressionHook-44"><span class="linenos">44</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompressionHook-45"><a href="#CompressionHook-45"><span class="linenos">45</span></a>        <span class="k">pass</span>
</span><span id="CompressionHook-46"><a href="#CompressionHook-46"><span class="linenos">46</span></a>    
</span><span id="CompressionHook-47"><a href="#CompressionHook-47"><span class="linenos">47</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="CompressionHook-48"><a href="#CompressionHook-48"><span class="linenos">48</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decompress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">raw_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="CompressionHook-49"><a href="#CompressionHook-49"><span class="linenos">49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompressionHook-50"><a href="#CompressionHook-50"><span class="linenos">50</span></a><span class="sd">        </span>
</span><span id="CompressionHook-51"><a href="#CompressionHook-51"><span class="linenos">51</span></a><span class="sd">        </span>
</span><span id="CompressionHook-52"><a href="#CompressionHook-52"><span class="linenos">52</span></a><span class="sd">        Args:</span>
</span><span id="CompressionHook-53"><a href="#CompressionHook-53"><span class="linenos">53</span></a><span class="sd">            data: </span>
</span><span id="CompressionHook-54"><a href="#CompressionHook-54"><span class="linenos">54</span></a><span class="sd">            raw_size: </span>
</span><span id="CompressionHook-55"><a href="#CompressionHook-55"><span class="linenos">55</span></a><span class="sd">            </span>
</span><span id="CompressionHook-56"><a href="#CompressionHook-56"><span class="linenos">56</span></a><span class="sd">        Returns:</span>
</span><span id="CompressionHook-57"><a href="#CompressionHook-57"><span class="linenos">57</span></a><span class="sd">            </span>
</span><span id="CompressionHook-58"><a href="#CompressionHook-58"><span class="linenos">58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompressionHook-59"><a href="#CompressionHook-59"><span class="linenos">59</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p> ( Zstd, LZ4, LZMA)</p>
</div>


                            <div id="CompressionHook.algo_id" class="classattr">
                                        <input id="CompressionHook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="CompressionHook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CompressionHook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CompressionHook.algo_id-20"><a href="#CompressionHook.algo_id-20"><span class="linenos">20</span></a>    <span class="nd">@property</span>
</span><span id="CompressionHook.algo_id-21"><a href="#CompressionHook.algo_id-21"><span class="linenos">21</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="CompressionHook.algo_id-22"><a href="#CompressionHook.algo_id-22"><span class="linenos">22</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CompressionHook.algo_id-23"><a href="#CompressionHook.algo_id-23"><span class="linenos">23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompressionHook.algo_id-24"><a href="#CompressionHook.algo_id-24"><span class="linenos">24</span></a><span class="sd">         ID</span>
</span><span id="CompressionHook.algo_id-25"><a href="#CompressionHook.algo_id-25"><span class="linenos">25</span></a><span class="sd">        </span>
</span><span id="CompressionHook.algo_id-26"><a href="#CompressionHook.algo_id-26"><span class="linenos">26</span></a><span class="sd">         Entry  algo_id </span>
</span><span id="CompressionHook.algo_id-27"><a href="#CompressionHook.algo_id-27"><span class="linenos">27</span></a><span class="sd">        0 &quot;&quot;</span>
</span><span id="CompressionHook.algo_id-28"><a href="#CompressionHook.algo_id-28"><span class="linenos">28</span></a><span class="sd">        </span>
</span><span id="CompressionHook.algo_id-29"><a href="#CompressionHook.algo_id-29"><span class="linenos">29</span></a><span class="sd">        Returns:</span>
</span><span id="CompressionHook.algo_id-30"><a href="#CompressionHook.algo_id-30"><span class="linenos">30</span></a><span class="sd">            1-255 </span>
</span><span id="CompressionHook.algo_id-31"><a href="#CompressionHook.algo_id-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompressionHook.algo_id-32"><a href="#CompressionHook.algo_id-32"><span class="linenos">32</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> Entry  algo_id 
0 ""</p>

<p>Returns:
    1-255 </p>
</div>


                            </div>
                            <div id="CompressionHook.compress" class="classattr">
                                        <input id="CompressionHook.compress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="CompressionHook.compress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CompressionHook.compress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CompressionHook.compress-34"><a href="#CompressionHook.compress-34"><span class="linenos">34</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="CompressionHook.compress-35"><a href="#CompressionHook.compress-35"><span class="linenos">35</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="CompressionHook.compress-36"><a href="#CompressionHook.compress-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompressionHook.compress-37"><a href="#CompressionHook.compress-37"><span class="linenos">37</span></a><span class="sd">        </span>
</span><span id="CompressionHook.compress-38"><a href="#CompressionHook.compress-38"><span class="linenos">38</span></a><span class="sd">        </span>
</span><span id="CompressionHook.compress-39"><a href="#CompressionHook.compress-39"><span class="linenos">39</span></a><span class="sd">        Args:</span>
</span><span id="CompressionHook.compress-40"><a href="#CompressionHook.compress-40"><span class="linenos">40</span></a><span class="sd">            data: </span>
</span><span id="CompressionHook.compress-41"><a href="#CompressionHook.compress-41"><span class="linenos">41</span></a><span class="sd">            </span>
</span><span id="CompressionHook.compress-42"><a href="#CompressionHook.compress-42"><span class="linenos">42</span></a><span class="sd">        Returns:</span>
</span><span id="CompressionHook.compress-43"><a href="#CompressionHook.compress-43"><span class="linenos">43</span></a><span class="sd">            </span>
</span><span id="CompressionHook.compress-44"><a href="#CompressionHook.compress-44"><span class="linenos">44</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompressionHook.compress-45"><a href="#CompressionHook.compress-45"><span class="linenos">45</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="CompressionHook.decompress" class="classattr">
                                        <input id="CompressionHook.decompress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">decompress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span>, </span><span class="param"><span class="n">raw_size</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="CompressionHook.decompress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CompressionHook.decompress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CompressionHook.decompress-47"><a href="#CompressionHook.decompress-47"><span class="linenos">47</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="CompressionHook.decompress-48"><a href="#CompressionHook.decompress-48"><span class="linenos">48</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decompress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">raw_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="CompressionHook.decompress-49"><a href="#CompressionHook.decompress-49"><span class="linenos">49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CompressionHook.decompress-50"><a href="#CompressionHook.decompress-50"><span class="linenos">50</span></a><span class="sd">        </span>
</span><span id="CompressionHook.decompress-51"><a href="#CompressionHook.decompress-51"><span class="linenos">51</span></a><span class="sd">        </span>
</span><span id="CompressionHook.decompress-52"><a href="#CompressionHook.decompress-52"><span class="linenos">52</span></a><span class="sd">        Args:</span>
</span><span id="CompressionHook.decompress-53"><a href="#CompressionHook.decompress-53"><span class="linenos">53</span></a><span class="sd">            data: </span>
</span><span id="CompressionHook.decompress-54"><a href="#CompressionHook.decompress-54"><span class="linenos">54</span></a><span class="sd">            raw_size: </span>
</span><span id="CompressionHook.decompress-55"><a href="#CompressionHook.decompress-55"><span class="linenos">55</span></a><span class="sd">            </span>
</span><span id="CompressionHook.decompress-56"><a href="#CompressionHook.decompress-56"><span class="linenos">56</span></a><span class="sd">        Returns:</span>
</span><span id="CompressionHook.decompress-57"><a href="#CompressionHook.decompress-57"><span class="linenos">57</span></a><span class="sd">            </span>
</span><span id="CompressionHook.decompress-58"><a href="#CompressionHook.decompress-58"><span class="linenos">58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CompressionHook.decompress-59"><a href="#CompressionHook.decompress-59"><span class="linenos">59</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: 
    raw_size: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="ChecksumHook">
                            <input id="ChecksumHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ChecksumHook</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="ChecksumHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChecksumHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChecksumHook-62"><a href="#ChecksumHook-62"><span class="linenos"> 62</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ChecksumHook</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="ChecksumHook-63"><a href="#ChecksumHook-63"><span class="linenos"> 63</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook-64"><a href="#ChecksumHook-64"><span class="linenos"> 64</span></a><span class="sd">    </span>
</span><span id="ChecksumHook-65"><a href="#ChecksumHook-65"><span class="linenos"> 65</span></a><span class="sd">    </span>
</span><span id="ChecksumHook-66"><a href="#ChecksumHook-66"><span class="linenos"> 66</span></a><span class="sd">     ( MD5, SHA1, CRC32)</span>
</span><span id="ChecksumHook-67"><a href="#ChecksumHook-67"><span class="linenos"> 67</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ChecksumHook-68"><a href="#ChecksumHook-68"><span class="linenos"> 68</span></a>    
</span><span id="ChecksumHook-69"><a href="#ChecksumHook-69"><span class="linenos"> 69</span></a>    <span class="nd">@property</span>
</span><span id="ChecksumHook-70"><a href="#ChecksumHook-70"><span class="linenos"> 70</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ChecksumHook-71"><a href="#ChecksumHook-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChecksumHook-72"><a href="#ChecksumHook-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook-73"><a href="#ChecksumHook-73"><span class="linenos"> 73</span></a><span class="sd">         ID</span>
</span><span id="ChecksumHook-74"><a href="#ChecksumHook-74"><span class="linenos"> 74</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-75"><a href="#ChecksumHook-75"><span class="linenos"> 75</span></a><span class="sd">         FileHeader  checksum_algo </span>
</span><span id="ChecksumHook-76"><a href="#ChecksumHook-76"><span class="linenos"> 76</span></a><span class="sd">        0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</span>
</span><span id="ChecksumHook-77"><a href="#ChecksumHook-77"><span class="linenos"> 77</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-78"><a href="#ChecksumHook-78"><span class="linenos"> 78</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook-79"><a href="#ChecksumHook-79"><span class="linenos"> 79</span></a><span class="sd">             ID</span>
</span><span id="ChecksumHook-80"><a href="#ChecksumHook-80"><span class="linenos"> 80</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook-81"><a href="#ChecksumHook-81"><span class="linenos"> 81</span></a>        <span class="k">pass</span>
</span><span id="ChecksumHook-82"><a href="#ChecksumHook-82"><span class="linenos"> 82</span></a>    
</span><span id="ChecksumHook-83"><a href="#ChecksumHook-83"><span class="linenos"> 83</span></a>    <span class="nd">@property</span>
</span><span id="ChecksumHook-84"><a href="#ChecksumHook-84"><span class="linenos"> 84</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChecksumHook-85"><a href="#ChecksumHook-85"><span class="linenos"> 85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook-86"><a href="#ChecksumHook-86"><span class="linenos"> 86</span></a><span class="sd">         ( JSON )</span>
</span><span id="ChecksumHook-87"><a href="#ChecksumHook-87"><span class="linenos"> 87</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-88"><a href="#ChecksumHook-88"><span class="linenos"> 88</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-89"><a href="#ChecksumHook-89"><span class="linenos"> 89</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-90"><a href="#ChecksumHook-90"><span class="linenos"> 90</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook-91"><a href="#ChecksumHook-91"><span class="linenos"> 91</span></a><span class="sd">            </span>
</span><span id="ChecksumHook-92"><a href="#ChecksumHook-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook-93"><a href="#ChecksumHook-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="ChecksumHook-94"><a href="#ChecksumHook-94"><span class="linenos"> 94</span></a>    
</span><span id="ChecksumHook-95"><a href="#ChecksumHook-95"><span class="linenos"> 95</span></a>    <span class="nd">@property</span>
</span><span id="ChecksumHook-96"><a href="#ChecksumHook-96"><span class="linenos"> 96</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ChecksumHook-97"><a href="#ChecksumHook-97"><span class="linenos"> 97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChecksumHook-98"><a href="#ChecksumHook-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook-99"><a href="#ChecksumHook-99"><span class="linenos"> 99</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-100"><a href="#ChecksumHook-100"><span class="linenos">100</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-101"><a href="#ChecksumHook-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook-102"><a href="#ChecksumHook-102"><span class="linenos">102</span></a><span class="sd">             (bytes)</span>
</span><span id="ChecksumHook-103"><a href="#ChecksumHook-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook-104"><a href="#ChecksumHook-104"><span class="linenos">104</span></a>        <span class="k">pass</span>
</span><span id="ChecksumHook-105"><a href="#ChecksumHook-105"><span class="linenos">105</span></a>    
</span><span id="ChecksumHook-106"><a href="#ChecksumHook-106"><span class="linenos">106</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ChecksumHook-107"><a href="#ChecksumHook-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ChecksumHook-108"><a href="#ChecksumHook-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook-109"><a href="#ChecksumHook-109"><span class="linenos">109</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-110"><a href="#ChecksumHook-110"><span class="linenos">110</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-111"><a href="#ChecksumHook-111"><span class="linenos">111</span></a><span class="sd">        Args:</span>
</span><span id="ChecksumHook-112"><a href="#ChecksumHook-112"><span class="linenos">112</span></a><span class="sd">            data: </span>
</span><span id="ChecksumHook-113"><a href="#ChecksumHook-113"><span class="linenos">113</span></a><span class="sd">            </span>
</span><span id="ChecksumHook-114"><a href="#ChecksumHook-114"><span class="linenos">114</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook-115"><a href="#ChecksumHook-115"><span class="linenos">115</span></a><span class="sd">            </span>
</span><span id="ChecksumHook-116"><a href="#ChecksumHook-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook-117"><a href="#ChecksumHook-117"><span class="linenos">117</span></a>        <span class="k">pass</span>
</span><span id="ChecksumHook-118"><a href="#ChecksumHook-118"><span class="linenos">118</span></a>    
</span><span id="ChecksumHook-119"><a href="#ChecksumHook-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ChecksumHook-120"><a href="#ChecksumHook-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook-121"><a href="#ChecksumHook-121"><span class="linenos">121</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-122"><a href="#ChecksumHook-122"><span class="linenos">122</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-123"><a href="#ChecksumHook-123"><span class="linenos">123</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-124"><a href="#ChecksumHook-124"><span class="linenos">124</span></a><span class="sd">        </span>
</span><span id="ChecksumHook-125"><a href="#ChecksumHook-125"><span class="linenos">125</span></a><span class="sd">        Args:</span>
</span><span id="ChecksumHook-126"><a href="#ChecksumHook-126"><span class="linenos">126</span></a><span class="sd">            data: </span>
</span><span id="ChecksumHook-127"><a href="#ChecksumHook-127"><span class="linenos">127</span></a><span class="sd">            expected: </span>
</span><span id="ChecksumHook-128"><a href="#ChecksumHook-128"><span class="linenos">128</span></a><span class="sd">            </span>
</span><span id="ChecksumHook-129"><a href="#ChecksumHook-129"><span class="linenos">129</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook-130"><a href="#ChecksumHook-130"><span class="linenos">130</span></a><span class="sd">            </span>
</span><span id="ChecksumHook-131"><a href="#ChecksumHook-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook-132"><a href="#ChecksumHook-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p> ( MD5, SHA1, CRC32)</p>
</div>


                            <div id="ChecksumHook.algo_id" class="classattr">
                                        <input id="ChecksumHook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ChecksumHook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChecksumHook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChecksumHook.algo_id-69"><a href="#ChecksumHook.algo_id-69"><span class="linenos">69</span></a>    <span class="nd">@property</span>
</span><span id="ChecksumHook.algo_id-70"><a href="#ChecksumHook.algo_id-70"><span class="linenos">70</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ChecksumHook.algo_id-71"><a href="#ChecksumHook.algo_id-71"><span class="linenos">71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChecksumHook.algo_id-72"><a href="#ChecksumHook.algo_id-72"><span class="linenos">72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook.algo_id-73"><a href="#ChecksumHook.algo_id-73"><span class="linenos">73</span></a><span class="sd">         ID</span>
</span><span id="ChecksumHook.algo_id-74"><a href="#ChecksumHook.algo_id-74"><span class="linenos">74</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.algo_id-75"><a href="#ChecksumHook.algo_id-75"><span class="linenos">75</span></a><span class="sd">         FileHeader  checksum_algo </span>
</span><span id="ChecksumHook.algo_id-76"><a href="#ChecksumHook.algo_id-76"><span class="linenos">76</span></a><span class="sd">        0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</span>
</span><span id="ChecksumHook.algo_id-77"><a href="#ChecksumHook.algo_id-77"><span class="linenos">77</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.algo_id-78"><a href="#ChecksumHook.algo_id-78"><span class="linenos">78</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook.algo_id-79"><a href="#ChecksumHook.algo_id-79"><span class="linenos">79</span></a><span class="sd">             ID</span>
</span><span id="ChecksumHook.algo_id-80"><a href="#ChecksumHook.algo_id-80"><span class="linenos">80</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook.algo_id-81"><a href="#ChecksumHook.algo_id-81"><span class="linenos">81</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  checksum_algo 
0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</p>

<p>Returns:
     ID</p>
</div>


                            </div>
                            <div id="ChecksumHook.display_name" class="classattr">
                                        <input id="ChecksumHook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="ChecksumHook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChecksumHook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChecksumHook.display_name-83"><a href="#ChecksumHook.display_name-83"><span class="linenos">83</span></a>    <span class="nd">@property</span>
</span><span id="ChecksumHook.display_name-84"><a href="#ChecksumHook.display_name-84"><span class="linenos">84</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ChecksumHook.display_name-85"><a href="#ChecksumHook.display_name-85"><span class="linenos">85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook.display_name-86"><a href="#ChecksumHook.display_name-86"><span class="linenos">86</span></a><span class="sd">         ( JSON )</span>
</span><span id="ChecksumHook.display_name-87"><a href="#ChecksumHook.display_name-87"><span class="linenos">87</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.display_name-88"><a href="#ChecksumHook.display_name-88"><span class="linenos">88</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.display_name-89"><a href="#ChecksumHook.display_name-89"><span class="linenos">89</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.display_name-90"><a href="#ChecksumHook.display_name-90"><span class="linenos">90</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook.display_name-91"><a href="#ChecksumHook.display_name-91"><span class="linenos">91</span></a><span class="sd">            </span>
</span><span id="ChecksumHook.display_name-92"><a href="#ChecksumHook.display_name-92"><span class="linenos">92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook.display_name-93"><a href="#ChecksumHook.display_name-93"><span class="linenos">93</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="ChecksumHook.digest_size" class="classattr">
                                        <input id="ChecksumHook.digest_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">digest_size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ChecksumHook.digest_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChecksumHook.digest_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChecksumHook.digest_size-95"><a href="#ChecksumHook.digest_size-95"><span class="linenos"> 95</span></a>    <span class="nd">@property</span>
</span><span id="ChecksumHook.digest_size-96"><a href="#ChecksumHook.digest_size-96"><span class="linenos"> 96</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ChecksumHook.digest_size-97"><a href="#ChecksumHook.digest_size-97"><span class="linenos"> 97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ChecksumHook.digest_size-98"><a href="#ChecksumHook.digest_size-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook.digest_size-99"><a href="#ChecksumHook.digest_size-99"><span class="linenos"> 99</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.digest_size-100"><a href="#ChecksumHook.digest_size-100"><span class="linenos">100</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.digest_size-101"><a href="#ChecksumHook.digest_size-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook.digest_size-102"><a href="#ChecksumHook.digest_size-102"><span class="linenos">102</span></a><span class="sd">             (bytes)</span>
</span><span id="ChecksumHook.digest_size-103"><a href="#ChecksumHook.digest_size-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook.digest_size-104"><a href="#ChecksumHook.digest_size-104"><span class="linenos">104</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="ChecksumHook.compute" class="classattr">
                                        <input id="ChecksumHook.compute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">compute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="ChecksumHook.compute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChecksumHook.compute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChecksumHook.compute-106"><a href="#ChecksumHook.compute-106"><span class="linenos">106</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ChecksumHook.compute-107"><a href="#ChecksumHook.compute-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ChecksumHook.compute-108"><a href="#ChecksumHook.compute-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook.compute-109"><a href="#ChecksumHook.compute-109"><span class="linenos">109</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.compute-110"><a href="#ChecksumHook.compute-110"><span class="linenos">110</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.compute-111"><a href="#ChecksumHook.compute-111"><span class="linenos">111</span></a><span class="sd">        Args:</span>
</span><span id="ChecksumHook.compute-112"><a href="#ChecksumHook.compute-112"><span class="linenos">112</span></a><span class="sd">            data: </span>
</span><span id="ChecksumHook.compute-113"><a href="#ChecksumHook.compute-113"><span class="linenos">113</span></a><span class="sd">            </span>
</span><span id="ChecksumHook.compute-114"><a href="#ChecksumHook.compute-114"><span class="linenos">114</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook.compute-115"><a href="#ChecksumHook.compute-115"><span class="linenos">115</span></a><span class="sd">            </span>
</span><span id="ChecksumHook.compute-116"><a href="#ChecksumHook.compute-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook.compute-117"><a href="#ChecksumHook.compute-117"><span class="linenos">117</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="ChecksumHook.verify" class="classattr">
                                        <input id="ChecksumHook.verify-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">verify</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span>, </span><span class="param"><span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ChecksumHook.verify-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChecksumHook.verify"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChecksumHook.verify-119"><a href="#ChecksumHook.verify-119"><span class="linenos">119</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ChecksumHook.verify-120"><a href="#ChecksumHook.verify-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChecksumHook.verify-121"><a href="#ChecksumHook.verify-121"><span class="linenos">121</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.verify-122"><a href="#ChecksumHook.verify-122"><span class="linenos">122</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.verify-123"><a href="#ChecksumHook.verify-123"><span class="linenos">123</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.verify-124"><a href="#ChecksumHook.verify-124"><span class="linenos">124</span></a><span class="sd">        </span>
</span><span id="ChecksumHook.verify-125"><a href="#ChecksumHook.verify-125"><span class="linenos">125</span></a><span class="sd">        Args:</span>
</span><span id="ChecksumHook.verify-126"><a href="#ChecksumHook.verify-126"><span class="linenos">126</span></a><span class="sd">            data: </span>
</span><span id="ChecksumHook.verify-127"><a href="#ChecksumHook.verify-127"><span class="linenos">127</span></a><span class="sd">            expected: </span>
</span><span id="ChecksumHook.verify-128"><a href="#ChecksumHook.verify-128"><span class="linenos">128</span></a><span class="sd">            </span>
</span><span id="ChecksumHook.verify-129"><a href="#ChecksumHook.verify-129"><span class="linenos">129</span></a><span class="sd">        Returns:</span>
</span><span id="ChecksumHook.verify-130"><a href="#ChecksumHook.verify-130"><span class="linenos">130</span></a><span class="sd">            </span>
</span><span id="ChecksumHook.verify-131"><a href="#ChecksumHook.verify-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChecksumHook.verify-132"><a href="#ChecksumHook.verify-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>

<p>Args:
    data: 
    expected: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="IndexCryptoHook">
                            <input id="IndexCryptoHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IndexCryptoHook</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="IndexCryptoHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexCryptoHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexCryptoHook-134"><a href="#IndexCryptoHook-134"><span class="linenos">134</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IndexCryptoHook</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="IndexCryptoHook-135"><a href="#IndexCryptoHook-135"><span class="linenos">135</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-136"><a href="#IndexCryptoHook-136"><span class="linenos">136</span></a><span class="sd">    </span>
</span><span id="IndexCryptoHook-137"><a href="#IndexCryptoHook-137"><span class="linenos">137</span></a><span class="sd">    </span>
</span><span id="IndexCryptoHook-138"><a href="#IndexCryptoHook-138"><span class="linenos">138</span></a><span class="sd">    / String Tables </span>
</span><span id="IndexCryptoHook-139"><a href="#IndexCryptoHook-139"><span class="linenos">139</span></a><span class="sd">    </span>
</span><span id="IndexCryptoHook-140"><a href="#IndexCryptoHook-140"><span class="linenos">140</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-141"><a href="#IndexCryptoHook-141"><span class="linenos">141</span></a>    
</span><span id="IndexCryptoHook-142"><a href="#IndexCryptoHook-142"><span class="linenos">142</span></a>    <span class="nd">@property</span>
</span><span id="IndexCryptoHook-143"><a href="#IndexCryptoHook-143"><span class="linenos">143</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="IndexCryptoHook-144"><a href="#IndexCryptoHook-144"><span class="linenos">144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="IndexCryptoHook-145"><a href="#IndexCryptoHook-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-146"><a href="#IndexCryptoHook-146"><span class="linenos">146</span></a><span class="sd">         ID</span>
</span><span id="IndexCryptoHook-147"><a href="#IndexCryptoHook-147"><span class="linenos">147</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-148"><a href="#IndexCryptoHook-148"><span class="linenos">148</span></a><span class="sd">         FileHeader  flags </span>
</span><span id="IndexCryptoHook-149"><a href="#IndexCryptoHook-149"><span class="linenos">149</span></a><span class="sd">        /</span>
</span><span id="IndexCryptoHook-150"><a href="#IndexCryptoHook-150"><span class="linenos">150</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-151"><a href="#IndexCryptoHook-151"><span class="linenos">151</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook-152"><a href="#IndexCryptoHook-152"><span class="linenos">152</span></a><span class="sd">             (e.g., 0x01, 0x02, 0x03)</span>
</span><span id="IndexCryptoHook-153"><a href="#IndexCryptoHook-153"><span class="linenos">153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-154"><a href="#IndexCryptoHook-154"><span class="linenos">154</span></a>        <span class="k">pass</span>
</span><span id="IndexCryptoHook-155"><a href="#IndexCryptoHook-155"><span class="linenos">155</span></a>    
</span><span id="IndexCryptoHook-156"><a href="#IndexCryptoHook-156"><span class="linenos">156</span></a>    <span class="nd">@property</span>
</span><span id="IndexCryptoHook-157"><a href="#IndexCryptoHook-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="IndexCryptoHook-158"><a href="#IndexCryptoHook-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-159"><a href="#IndexCryptoHook-159"><span class="linenos">159</span></a><span class="sd">         ( JSON )</span>
</span><span id="IndexCryptoHook-160"><a href="#IndexCryptoHook-160"><span class="linenos">160</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-161"><a href="#IndexCryptoHook-161"><span class="linenos">161</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-162"><a href="#IndexCryptoHook-162"><span class="linenos">162</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-163"><a href="#IndexCryptoHook-163"><span class="linenos">163</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook-164"><a href="#IndexCryptoHook-164"><span class="linenos">164</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook-165"><a href="#IndexCryptoHook-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-166"><a href="#IndexCryptoHook-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="IndexCryptoHook-167"><a href="#IndexCryptoHook-167"><span class="linenos">167</span></a>    
</span><span id="IndexCryptoHook-168"><a href="#IndexCryptoHook-168"><span class="linenos">168</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="IndexCryptoHook-169"><a href="#IndexCryptoHook-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="IndexCryptoHook-170"><a href="#IndexCryptoHook-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-171"><a href="#IndexCryptoHook-171"><span class="linenos">171</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-172"><a href="#IndexCryptoHook-172"><span class="linenos">172</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-173"><a href="#IndexCryptoHook-173"><span class="linenos">173</span></a><span class="sd">        Args:</span>
</span><span id="IndexCryptoHook-174"><a href="#IndexCryptoHook-174"><span class="linenos">174</span></a><span class="sd">            data: </span>
</span><span id="IndexCryptoHook-175"><a href="#IndexCryptoHook-175"><span class="linenos">175</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook-176"><a href="#IndexCryptoHook-176"><span class="linenos">176</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook-177"><a href="#IndexCryptoHook-177"><span class="linenos">177</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook-178"><a href="#IndexCryptoHook-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-179"><a href="#IndexCryptoHook-179"><span class="linenos">179</span></a>        <span class="k">pass</span>
</span><span id="IndexCryptoHook-180"><a href="#IndexCryptoHook-180"><span class="linenos">180</span></a>    
</span><span id="IndexCryptoHook-181"><a href="#IndexCryptoHook-181"><span class="linenos">181</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="IndexCryptoHook-182"><a href="#IndexCryptoHook-182"><span class="linenos">182</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="IndexCryptoHook-183"><a href="#IndexCryptoHook-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-184"><a href="#IndexCryptoHook-184"><span class="linenos">184</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-185"><a href="#IndexCryptoHook-185"><span class="linenos">185</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook-186"><a href="#IndexCryptoHook-186"><span class="linenos">186</span></a><span class="sd">        Args:</span>
</span><span id="IndexCryptoHook-187"><a href="#IndexCryptoHook-187"><span class="linenos">187</span></a><span class="sd">            data: </span>
</span><span id="IndexCryptoHook-188"><a href="#IndexCryptoHook-188"><span class="linenos">188</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook-189"><a href="#IndexCryptoHook-189"><span class="linenos">189</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook-190"><a href="#IndexCryptoHook-190"><span class="linenos">190</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook-191"><a href="#IndexCryptoHook-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook-192"><a href="#IndexCryptoHook-192"><span class="linenos">192</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>/ String Tables 
</p>
</div>


                            <div id="IndexCryptoHook.flags_id" class="classattr">
                                        <input id="IndexCryptoHook.flags_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">flags_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="IndexCryptoHook.flags_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexCryptoHook.flags_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexCryptoHook.flags_id-142"><a href="#IndexCryptoHook.flags_id-142"><span class="linenos">142</span></a>    <span class="nd">@property</span>
</span><span id="IndexCryptoHook.flags_id-143"><a href="#IndexCryptoHook.flags_id-143"><span class="linenos">143</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="IndexCryptoHook.flags_id-144"><a href="#IndexCryptoHook.flags_id-144"><span class="linenos">144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="IndexCryptoHook.flags_id-145"><a href="#IndexCryptoHook.flags_id-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.flags_id-146"><a href="#IndexCryptoHook.flags_id-146"><span class="linenos">146</span></a><span class="sd">         ID</span>
</span><span id="IndexCryptoHook.flags_id-147"><a href="#IndexCryptoHook.flags_id-147"><span class="linenos">147</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.flags_id-148"><a href="#IndexCryptoHook.flags_id-148"><span class="linenos">148</span></a><span class="sd">         FileHeader  flags </span>
</span><span id="IndexCryptoHook.flags_id-149"><a href="#IndexCryptoHook.flags_id-149"><span class="linenos">149</span></a><span class="sd">        /</span>
</span><span id="IndexCryptoHook.flags_id-150"><a href="#IndexCryptoHook.flags_id-150"><span class="linenos">150</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.flags_id-151"><a href="#IndexCryptoHook.flags_id-151"><span class="linenos">151</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook.flags_id-152"><a href="#IndexCryptoHook.flags_id-152"><span class="linenos">152</span></a><span class="sd">             (e.g., 0x01, 0x02, 0x03)</span>
</span><span id="IndexCryptoHook.flags_id-153"><a href="#IndexCryptoHook.flags_id-153"><span class="linenos">153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.flags_id-154"><a href="#IndexCryptoHook.flags_id-154"><span class="linenos">154</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  flags 
/</p>

<p>Returns:
     (e.g., 0x01, 0x02, 0x03)</p>
</div>


                            </div>
                            <div id="IndexCryptoHook.display_name" class="classattr">
                                        <input id="IndexCryptoHook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="IndexCryptoHook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexCryptoHook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexCryptoHook.display_name-156"><a href="#IndexCryptoHook.display_name-156"><span class="linenos">156</span></a>    <span class="nd">@property</span>
</span><span id="IndexCryptoHook.display_name-157"><a href="#IndexCryptoHook.display_name-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="IndexCryptoHook.display_name-158"><a href="#IndexCryptoHook.display_name-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.display_name-159"><a href="#IndexCryptoHook.display_name-159"><span class="linenos">159</span></a><span class="sd">         ( JSON )</span>
</span><span id="IndexCryptoHook.display_name-160"><a href="#IndexCryptoHook.display_name-160"><span class="linenos">160</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.display_name-161"><a href="#IndexCryptoHook.display_name-161"><span class="linenos">161</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.display_name-162"><a href="#IndexCryptoHook.display_name-162"><span class="linenos">162</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.display_name-163"><a href="#IndexCryptoHook.display_name-163"><span class="linenos">163</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook.display_name-164"><a href="#IndexCryptoHook.display_name-164"><span class="linenos">164</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook.display_name-165"><a href="#IndexCryptoHook.display_name-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.display_name-166"><a href="#IndexCryptoHook.display_name-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="IndexCryptoHook.encrypt" class="classattr">
                                        <input id="IndexCryptoHook.encrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">encrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="IndexCryptoHook.encrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexCryptoHook.encrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexCryptoHook.encrypt-168"><a href="#IndexCryptoHook.encrypt-168"><span class="linenos">168</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="IndexCryptoHook.encrypt-169"><a href="#IndexCryptoHook.encrypt-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="IndexCryptoHook.encrypt-170"><a href="#IndexCryptoHook.encrypt-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.encrypt-171"><a href="#IndexCryptoHook.encrypt-171"><span class="linenos">171</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.encrypt-172"><a href="#IndexCryptoHook.encrypt-172"><span class="linenos">172</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.encrypt-173"><a href="#IndexCryptoHook.encrypt-173"><span class="linenos">173</span></a><span class="sd">        Args:</span>
</span><span id="IndexCryptoHook.encrypt-174"><a href="#IndexCryptoHook.encrypt-174"><span class="linenos">174</span></a><span class="sd">            data: </span>
</span><span id="IndexCryptoHook.encrypt-175"><a href="#IndexCryptoHook.encrypt-175"><span class="linenos">175</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook.encrypt-176"><a href="#IndexCryptoHook.encrypt-176"><span class="linenos">176</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook.encrypt-177"><a href="#IndexCryptoHook.encrypt-177"><span class="linenos">177</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook.encrypt-178"><a href="#IndexCryptoHook.encrypt-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.encrypt-179"><a href="#IndexCryptoHook.encrypt-179"><span class="linenos">179</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="IndexCryptoHook.decrypt" class="classattr">
                                        <input id="IndexCryptoHook.decrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">decrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="IndexCryptoHook.decrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IndexCryptoHook.decrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IndexCryptoHook.decrypt-181"><a href="#IndexCryptoHook.decrypt-181"><span class="linenos">181</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="IndexCryptoHook.decrypt-182"><a href="#IndexCryptoHook.decrypt-182"><span class="linenos">182</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="IndexCryptoHook.decrypt-183"><a href="#IndexCryptoHook.decrypt-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.decrypt-184"><a href="#IndexCryptoHook.decrypt-184"><span class="linenos">184</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.decrypt-185"><a href="#IndexCryptoHook.decrypt-185"><span class="linenos">185</span></a><span class="sd">        </span>
</span><span id="IndexCryptoHook.decrypt-186"><a href="#IndexCryptoHook.decrypt-186"><span class="linenos">186</span></a><span class="sd">        Args:</span>
</span><span id="IndexCryptoHook.decrypt-187"><a href="#IndexCryptoHook.decrypt-187"><span class="linenos">187</span></a><span class="sd">            data: </span>
</span><span id="IndexCryptoHook.decrypt-188"><a href="#IndexCryptoHook.decrypt-188"><span class="linenos">188</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook.decrypt-189"><a href="#IndexCryptoHook.decrypt-189"><span class="linenos">189</span></a><span class="sd">        Returns:</span>
</span><span id="IndexCryptoHook.decrypt-190"><a href="#IndexCryptoHook.decrypt-190"><span class="linenos">190</span></a><span class="sd">            </span>
</span><span id="IndexCryptoHook.decrypt-191"><a href="#IndexCryptoHook.decrypt-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IndexCryptoHook.decrypt-192"><a href="#IndexCryptoHook.decrypt-192"><span class="linenos">192</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="NoneChecksumHook">
                            <input id="NoneChecksumHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NoneChecksumHook</span><wbr>(<span class="base"><a href="#ChecksumHook">grimoire.ChecksumHook</a></span>):

                <label class="view-source-button" for="NoneChecksumHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NoneChecksumHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NoneChecksumHook-15"><a href="#NoneChecksumHook-15"><span class="linenos">15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NoneChecksumHook</span><span class="p">(</span><span class="n">ChecksumHook</span><span class="p">):</span>
</span><span id="NoneChecksumHook-16"><a href="#NoneChecksumHook-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NoneChecksumHook-17"><a href="#NoneChecksumHook-17"><span class="linenos">17</span></a><span class="sd">    </span>
</span><span id="NoneChecksumHook-18"><a href="#NoneChecksumHook-18"><span class="linenos">18</span></a><span class="sd">    </span>
</span><span id="NoneChecksumHook-19"><a href="#NoneChecksumHook-19"><span class="linenos">19</span></a><span class="sd">    </span>
</span><span id="NoneChecksumHook-20"><a href="#NoneChecksumHook-20"><span class="linenos">20</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NoneChecksumHook-21"><a href="#NoneChecksumHook-21"><span class="linenos">21</span></a>    
</span><span id="NoneChecksumHook-22"><a href="#NoneChecksumHook-22"><span class="linenos">22</span></a>    <span class="nd">@property</span>
</span><span id="NoneChecksumHook-23"><a href="#NoneChecksumHook-23"><span class="linenos">23</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="NoneChecksumHook-24"><a href="#NoneChecksumHook-24"><span class="linenos">24</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="NoneChecksumHook-25"><a href="#NoneChecksumHook-25"><span class="linenos">25</span></a>    
</span><span id="NoneChecksumHook-26"><a href="#NoneChecksumHook-26"><span class="linenos">26</span></a>    <span class="nd">@property</span>
</span><span id="NoneChecksumHook-27"><a href="#NoneChecksumHook-27"><span class="linenos">27</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="NoneChecksumHook-28"><a href="#NoneChecksumHook-28"><span class="linenos">28</span></a>        <span class="k">return</span> <span class="s2">&quot;none&quot;</span>
</span><span id="NoneChecksumHook-29"><a href="#NoneChecksumHook-29"><span class="linenos">29</span></a>    
</span><span id="NoneChecksumHook-30"><a href="#NoneChecksumHook-30"><span class="linenos">30</span></a>    <span class="nd">@property</span>
</span><span id="NoneChecksumHook-31"><a href="#NoneChecksumHook-31"><span class="linenos">31</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="NoneChecksumHook-32"><a href="#NoneChecksumHook-32"><span class="linenos">32</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="NoneChecksumHook-33"><a href="#NoneChecksumHook-33"><span class="linenos">33</span></a>    
</span><span id="NoneChecksumHook-34"><a href="#NoneChecksumHook-34"><span class="linenos">34</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="NoneChecksumHook-35"><a href="#NoneChecksumHook-35"><span class="linenos">35</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="NoneChecksumHook-36"><a href="#NoneChecksumHook-36"><span class="linenos">36</span></a>    
</span><span id="NoneChecksumHook-37"><a href="#NoneChecksumHook-37"><span class="linenos">37</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="NoneChecksumHook-38"><a href="#NoneChecksumHook-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>
</div>


                            <div id="NoneChecksumHook.algo_id" class="classattr">
                                        <input id="NoneChecksumHook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="NoneChecksumHook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NoneChecksumHook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NoneChecksumHook.algo_id-22"><a href="#NoneChecksumHook.algo_id-22"><span class="linenos">22</span></a>    <span class="nd">@property</span>
</span><span id="NoneChecksumHook.algo_id-23"><a href="#NoneChecksumHook.algo_id-23"><span class="linenos">23</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="NoneChecksumHook.algo_id-24"><a href="#NoneChecksumHook.algo_id-24"><span class="linenos">24</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  checksum_algo 
0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</p>

<p>Returns:
     ID</p>
</div>


                            </div>
                            <div id="NoneChecksumHook.display_name" class="classattr">
                                        <input id="NoneChecksumHook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="NoneChecksumHook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NoneChecksumHook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NoneChecksumHook.display_name-26"><a href="#NoneChecksumHook.display_name-26"><span class="linenos">26</span></a>    <span class="nd">@property</span>
</span><span id="NoneChecksumHook.display_name-27"><a href="#NoneChecksumHook.display_name-27"><span class="linenos">27</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="NoneChecksumHook.display_name-28"><a href="#NoneChecksumHook.display_name-28"><span class="linenos">28</span></a>        <span class="k">return</span> <span class="s2">&quot;none&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="NoneChecksumHook.digest_size" class="classattr">
                                        <input id="NoneChecksumHook.digest_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">digest_size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="NoneChecksumHook.digest_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NoneChecksumHook.digest_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NoneChecksumHook.digest_size-30"><a href="#NoneChecksumHook.digest_size-30"><span class="linenos">30</span></a>    <span class="nd">@property</span>
</span><span id="NoneChecksumHook.digest_size-31"><a href="#NoneChecksumHook.digest_size-31"><span class="linenos">31</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="NoneChecksumHook.digest_size-32"><a href="#NoneChecksumHook.digest_size-32"><span class="linenos">32</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="NoneChecksumHook.compute" class="classattr">
                                        <input id="NoneChecksumHook.compute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="NoneChecksumHook.compute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NoneChecksumHook.compute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NoneChecksumHook.compute-34"><a href="#NoneChecksumHook.compute-34"><span class="linenos">34</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="NoneChecksumHook.compute-35"><a href="#NoneChecksumHook.compute-35"><span class="linenos">35</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="NoneChecksumHook.verify" class="classattr">
                                        <input id="NoneChecksumHook.verify-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">verify</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span>, </span><span class="param"><span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="NoneChecksumHook.verify-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NoneChecksumHook.verify"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NoneChecksumHook.verify-37"><a href="#NoneChecksumHook.verify-37"><span class="linenos">37</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="NoneChecksumHook.verify-38"><a href="#NoneChecksumHook.verify-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>

<p>Args:
    data: 
    expected: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="CRC32Hook">
                            <input id="CRC32Hook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CRC32Hook</span><wbr>(<span class="base"><a href="#ChecksumHook">grimoire.ChecksumHook</a></span>):

                <label class="view-source-button" for="CRC32Hook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CRC32Hook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CRC32Hook-41"><a href="#CRC32Hook-41"><span class="linenos">41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CRC32Hook</span><span class="p">(</span><span class="n">ChecksumHook</span><span class="p">):</span>
</span><span id="CRC32Hook-42"><a href="#CRC32Hook-42"><span class="linenos">42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CRC32Hook-43"><a href="#CRC32Hook-43"><span class="linenos">43</span></a><span class="sd">    CRC32 </span>
</span><span id="CRC32Hook-44"><a href="#CRC32Hook-44"><span class="linenos">44</span></a><span class="sd">    </span>
</span><span id="CRC32Hook-45"><a href="#CRC32Hook-45"><span class="linenos">45</span></a><span class="sd">    4 </span>
</span><span id="CRC32Hook-46"><a href="#CRC32Hook-46"><span class="linenos">46</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CRC32Hook-47"><a href="#CRC32Hook-47"><span class="linenos">47</span></a>    
</span><span id="CRC32Hook-48"><a href="#CRC32Hook-48"><span class="linenos">48</span></a>    <span class="nd">@property</span>
</span><span id="CRC32Hook-49"><a href="#CRC32Hook-49"><span class="linenos">49</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CRC32Hook-50"><a href="#CRC32Hook-50"><span class="linenos">50</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span><span id="CRC32Hook-51"><a href="#CRC32Hook-51"><span class="linenos">51</span></a>    
</span><span id="CRC32Hook-52"><a href="#CRC32Hook-52"><span class="linenos">52</span></a>    <span class="nd">@property</span>
</span><span id="CRC32Hook-53"><a href="#CRC32Hook-53"><span class="linenos">53</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="CRC32Hook-54"><a href="#CRC32Hook-54"><span class="linenos">54</span></a>        <span class="k">return</span> <span class="s2">&quot;crc32&quot;</span>
</span><span id="CRC32Hook-55"><a href="#CRC32Hook-55"><span class="linenos">55</span></a>    
</span><span id="CRC32Hook-56"><a href="#CRC32Hook-56"><span class="linenos">56</span></a>    <span class="nd">@property</span>
</span><span id="CRC32Hook-57"><a href="#CRC32Hook-57"><span class="linenos">57</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CRC32Hook-58"><a href="#CRC32Hook-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="mi">4</span>
</span><span id="CRC32Hook-59"><a href="#CRC32Hook-59"><span class="linenos">59</span></a>    
</span><span id="CRC32Hook-60"><a href="#CRC32Hook-60"><span class="linenos">60</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="CRC32Hook-61"><a href="#CRC32Hook-61"><span class="linenos">61</span></a>        <span class="n">crc</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span>
</span><span id="CRC32Hook-62"><a href="#CRC32Hook-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="n">crc</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>CRC32 </p>

<p>4 </p>
</div>


                            <div id="CRC32Hook.algo_id" class="classattr">
                                        <input id="CRC32Hook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="CRC32Hook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CRC32Hook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CRC32Hook.algo_id-48"><a href="#CRC32Hook.algo_id-48"><span class="linenos">48</span></a>    <span class="nd">@property</span>
</span><span id="CRC32Hook.algo_id-49"><a href="#CRC32Hook.algo_id-49"><span class="linenos">49</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CRC32Hook.algo_id-50"><a href="#CRC32Hook.algo_id-50"><span class="linenos">50</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  checksum_algo 
0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</p>

<p>Returns:
     ID</p>
</div>


                            </div>
                            <div id="CRC32Hook.display_name" class="classattr">
                                        <input id="CRC32Hook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="CRC32Hook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CRC32Hook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CRC32Hook.display_name-52"><a href="#CRC32Hook.display_name-52"><span class="linenos">52</span></a>    <span class="nd">@property</span>
</span><span id="CRC32Hook.display_name-53"><a href="#CRC32Hook.display_name-53"><span class="linenos">53</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="CRC32Hook.display_name-54"><a href="#CRC32Hook.display_name-54"><span class="linenos">54</span></a>        <span class="k">return</span> <span class="s2">&quot;crc32&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="CRC32Hook.digest_size" class="classattr">
                                        <input id="CRC32Hook.digest_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">digest_size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="CRC32Hook.digest_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CRC32Hook.digest_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CRC32Hook.digest_size-56"><a href="#CRC32Hook.digest_size-56"><span class="linenos">56</span></a>    <span class="nd">@property</span>
</span><span id="CRC32Hook.digest_size-57"><a href="#CRC32Hook.digest_size-57"><span class="linenos">57</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CRC32Hook.digest_size-58"><a href="#CRC32Hook.digest_size-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="mi">4</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="CRC32Hook.compute" class="classattr">
                                        <input id="CRC32Hook.compute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="CRC32Hook.compute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CRC32Hook.compute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CRC32Hook.compute-60"><a href="#CRC32Hook.compute-60"><span class="linenos">60</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="CRC32Hook.compute-61"><a href="#CRC32Hook.compute-61"><span class="linenos">61</span></a>        <span class="n">crc</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span>
</span><span id="CRC32Hook.compute-62"><a href="#CRC32Hook.compute-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="n">crc</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="MD5Hook">
                            <input id="MD5Hook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MD5Hook</span><wbr>(<span class="base"><a href="#ChecksumHook">grimoire.ChecksumHook</a></span>):

                <label class="view-source-button" for="MD5Hook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MD5Hook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MD5Hook-65"><a href="#MD5Hook-65"><span class="linenos">65</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MD5Hook</span><span class="p">(</span><span class="n">ChecksumHook</span><span class="p">):</span>
</span><span id="MD5Hook-66"><a href="#MD5Hook-66"><span class="linenos">66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MD5Hook-67"><a href="#MD5Hook-67"><span class="linenos">67</span></a><span class="sd">    MD5 </span>
</span><span id="MD5Hook-68"><a href="#MD5Hook-68"><span class="linenos">68</span></a><span class="sd">    </span>
</span><span id="MD5Hook-69"><a href="#MD5Hook-69"><span class="linenos">69</span></a><span class="sd">    16 </span>
</span><span id="MD5Hook-70"><a href="#MD5Hook-70"><span class="linenos">70</span></a><span class="sd">    MD5 </span>
</span><span id="MD5Hook-71"><a href="#MD5Hook-71"><span class="linenos">71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MD5Hook-72"><a href="#MD5Hook-72"><span class="linenos">72</span></a>    
</span><span id="MD5Hook-73"><a href="#MD5Hook-73"><span class="linenos">73</span></a>    <span class="nd">@property</span>
</span><span id="MD5Hook-74"><a href="#MD5Hook-74"><span class="linenos">74</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MD5Hook-75"><a href="#MD5Hook-75"><span class="linenos">75</span></a>        <span class="k">return</span> <span class="mi">2</span>
</span><span id="MD5Hook-76"><a href="#MD5Hook-76"><span class="linenos">76</span></a>    
</span><span id="MD5Hook-77"><a href="#MD5Hook-77"><span class="linenos">77</span></a>    <span class="nd">@property</span>
</span><span id="MD5Hook-78"><a href="#MD5Hook-78"><span class="linenos">78</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MD5Hook-79"><a href="#MD5Hook-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="s2">&quot;md5&quot;</span>
</span><span id="MD5Hook-80"><a href="#MD5Hook-80"><span class="linenos">80</span></a>    
</span><span id="MD5Hook-81"><a href="#MD5Hook-81"><span class="linenos">81</span></a>    <span class="nd">@property</span>
</span><span id="MD5Hook-82"><a href="#MD5Hook-82"><span class="linenos">82</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MD5Hook-83"><a href="#MD5Hook-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="mi">16</span>
</span><span id="MD5Hook-84"><a href="#MD5Hook-84"><span class="linenos">84</span></a>    
</span><span id="MD5Hook-85"><a href="#MD5Hook-85"><span class="linenos">85</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="MD5Hook-86"><a href="#MD5Hook-86"><span class="linenos">86</span></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>MD5 </p>

<p>16 
MD5 </p>
</div>


                            <div id="MD5Hook.algo_id" class="classattr">
                                        <input id="MD5Hook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="MD5Hook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MD5Hook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MD5Hook.algo_id-73"><a href="#MD5Hook.algo_id-73"><span class="linenos">73</span></a>    <span class="nd">@property</span>
</span><span id="MD5Hook.algo_id-74"><a href="#MD5Hook.algo_id-74"><span class="linenos">74</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MD5Hook.algo_id-75"><a href="#MD5Hook.algo_id-75"><span class="linenos">75</span></a>        <span class="k">return</span> <span class="mi">2</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  checksum_algo 
0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</p>

<p>Returns:
     ID</p>
</div>


                            </div>
                            <div id="MD5Hook.display_name" class="classattr">
                                        <input id="MD5Hook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="MD5Hook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MD5Hook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MD5Hook.display_name-77"><a href="#MD5Hook.display_name-77"><span class="linenos">77</span></a>    <span class="nd">@property</span>
</span><span id="MD5Hook.display_name-78"><a href="#MD5Hook.display_name-78"><span class="linenos">78</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MD5Hook.display_name-79"><a href="#MD5Hook.display_name-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="s2">&quot;md5&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="MD5Hook.digest_size" class="classattr">
                                        <input id="MD5Hook.digest_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">digest_size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="MD5Hook.digest_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MD5Hook.digest_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MD5Hook.digest_size-81"><a href="#MD5Hook.digest_size-81"><span class="linenos">81</span></a>    <span class="nd">@property</span>
</span><span id="MD5Hook.digest_size-82"><a href="#MD5Hook.digest_size-82"><span class="linenos">82</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MD5Hook.digest_size-83"><a href="#MD5Hook.digest_size-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="mi">16</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="MD5Hook.compute" class="classattr">
                                        <input id="MD5Hook.compute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="MD5Hook.compute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MD5Hook.compute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MD5Hook.compute-85"><a href="#MD5Hook.compute-85"><span class="linenos">85</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="MD5Hook.compute-86"><a href="#MD5Hook.compute-86"><span class="linenos">86</span></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="SHA1Hook">
                            <input id="SHA1Hook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SHA1Hook</span><wbr>(<span class="base"><a href="#ChecksumHook">grimoire.ChecksumHook</a></span>):

                <label class="view-source-button" for="SHA1Hook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA1Hook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA1Hook-89"><a href="#SHA1Hook-89"><span class="linenos"> 89</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SHA1Hook</span><span class="p">(</span><span class="n">ChecksumHook</span><span class="p">):</span>
</span><span id="SHA1Hook-90"><a href="#SHA1Hook-90"><span class="linenos"> 90</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SHA1Hook-91"><a href="#SHA1Hook-91"><span class="linenos"> 91</span></a><span class="sd">    SHA1 </span>
</span><span id="SHA1Hook-92"><a href="#SHA1Hook-92"><span class="linenos"> 92</span></a><span class="sd">    </span>
</span><span id="SHA1Hook-93"><a href="#SHA1Hook-93"><span class="linenos"> 93</span></a><span class="sd">    Git 20 </span>
</span><span id="SHA1Hook-94"><a href="#SHA1Hook-94"><span class="linenos"> 94</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SHA1Hook-95"><a href="#SHA1Hook-95"><span class="linenos"> 95</span></a>    
</span><span id="SHA1Hook-96"><a href="#SHA1Hook-96"><span class="linenos"> 96</span></a>    <span class="nd">@property</span>
</span><span id="SHA1Hook-97"><a href="#SHA1Hook-97"><span class="linenos"> 97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA1Hook-98"><a href="#SHA1Hook-98"><span class="linenos"> 98</span></a>        <span class="k">return</span> <span class="mi">3</span>
</span><span id="SHA1Hook-99"><a href="#SHA1Hook-99"><span class="linenos"> 99</span></a>    
</span><span id="SHA1Hook-100"><a href="#SHA1Hook-100"><span class="linenos">100</span></a>    <span class="nd">@property</span>
</span><span id="SHA1Hook-101"><a href="#SHA1Hook-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SHA1Hook-102"><a href="#SHA1Hook-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="s2">&quot;sha1&quot;</span>
</span><span id="SHA1Hook-103"><a href="#SHA1Hook-103"><span class="linenos">103</span></a>    
</span><span id="SHA1Hook-104"><a href="#SHA1Hook-104"><span class="linenos">104</span></a>    <span class="nd">@property</span>
</span><span id="SHA1Hook-105"><a href="#SHA1Hook-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA1Hook-106"><a href="#SHA1Hook-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="mi">20</span>
</span><span id="SHA1Hook-107"><a href="#SHA1Hook-107"><span class="linenos">107</span></a>    
</span><span id="SHA1Hook-108"><a href="#SHA1Hook-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="SHA1Hook-109"><a href="#SHA1Hook-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>SHA1 </p>

<p>Git 20 </p>
</div>


                            <div id="SHA1Hook.algo_id" class="classattr">
                                        <input id="SHA1Hook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="SHA1Hook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA1Hook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA1Hook.algo_id-96"><a href="#SHA1Hook.algo_id-96"><span class="linenos">96</span></a>    <span class="nd">@property</span>
</span><span id="SHA1Hook.algo_id-97"><a href="#SHA1Hook.algo_id-97"><span class="linenos">97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA1Hook.algo_id-98"><a href="#SHA1Hook.algo_id-98"><span class="linenos">98</span></a>        <span class="k">return</span> <span class="mi">3</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  checksum_algo 
0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</p>

<p>Returns:
     ID</p>
</div>


                            </div>
                            <div id="SHA1Hook.display_name" class="classattr">
                                        <input id="SHA1Hook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="SHA1Hook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA1Hook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA1Hook.display_name-100"><a href="#SHA1Hook.display_name-100"><span class="linenos">100</span></a>    <span class="nd">@property</span>
</span><span id="SHA1Hook.display_name-101"><a href="#SHA1Hook.display_name-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SHA1Hook.display_name-102"><a href="#SHA1Hook.display_name-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="s2">&quot;sha1&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="SHA1Hook.digest_size" class="classattr">
                                        <input id="SHA1Hook.digest_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">digest_size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="SHA1Hook.digest_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA1Hook.digest_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA1Hook.digest_size-104"><a href="#SHA1Hook.digest_size-104"><span class="linenos">104</span></a>    <span class="nd">@property</span>
</span><span id="SHA1Hook.digest_size-105"><a href="#SHA1Hook.digest_size-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA1Hook.digest_size-106"><a href="#SHA1Hook.digest_size-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="mi">20</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="SHA1Hook.compute" class="classattr">
                                        <input id="SHA1Hook.compute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="SHA1Hook.compute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA1Hook.compute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA1Hook.compute-108"><a href="#SHA1Hook.compute-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="SHA1Hook.compute-109"><a href="#SHA1Hook.compute-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="SHA256Hook">
                            <input id="SHA256Hook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SHA256Hook</span><wbr>(<span class="base"><a href="#ChecksumHook">grimoire.ChecksumHook</a></span>):

                <label class="view-source-button" for="SHA256Hook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA256Hook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA256Hook-112"><a href="#SHA256Hook-112"><span class="linenos">112</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SHA256Hook</span><span class="p">(</span><span class="n">ChecksumHook</span><span class="p">):</span>
</span><span id="SHA256Hook-113"><a href="#SHA256Hook-113"><span class="linenos">113</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SHA256Hook-114"><a href="#SHA256Hook-114"><span class="linenos">114</span></a><span class="sd">    SHA256 </span>
</span><span id="SHA256Hook-115"><a href="#SHA256Hook-115"><span class="linenos">115</span></a><span class="sd">    </span>
</span><span id="SHA256Hook-116"><a href="#SHA256Hook-116"><span class="linenos">116</span></a><span class="sd">    32 </span>
</span><span id="SHA256Hook-117"><a href="#SHA256Hook-117"><span class="linenos">117</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SHA256Hook-118"><a href="#SHA256Hook-118"><span class="linenos">118</span></a>    
</span><span id="SHA256Hook-119"><a href="#SHA256Hook-119"><span class="linenos">119</span></a>    <span class="nd">@property</span>
</span><span id="SHA256Hook-120"><a href="#SHA256Hook-120"><span class="linenos">120</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA256Hook-121"><a href="#SHA256Hook-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="mi">4</span>
</span><span id="SHA256Hook-122"><a href="#SHA256Hook-122"><span class="linenos">122</span></a>    
</span><span id="SHA256Hook-123"><a href="#SHA256Hook-123"><span class="linenos">123</span></a>    <span class="nd">@property</span>
</span><span id="SHA256Hook-124"><a href="#SHA256Hook-124"><span class="linenos">124</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SHA256Hook-125"><a href="#SHA256Hook-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="s2">&quot;sha256&quot;</span>
</span><span id="SHA256Hook-126"><a href="#SHA256Hook-126"><span class="linenos">126</span></a>    
</span><span id="SHA256Hook-127"><a href="#SHA256Hook-127"><span class="linenos">127</span></a>    <span class="nd">@property</span>
</span><span id="SHA256Hook-128"><a href="#SHA256Hook-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA256Hook-129"><a href="#SHA256Hook-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="mi">32</span>
</span><span id="SHA256Hook-130"><a href="#SHA256Hook-130"><span class="linenos">130</span></a>    
</span><span id="SHA256Hook-131"><a href="#SHA256Hook-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="SHA256Hook-132"><a href="#SHA256Hook-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>SHA256 </p>

<p>32 </p>
</div>


                            <div id="SHA256Hook.algo_id" class="classattr">
                                        <input id="SHA256Hook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="SHA256Hook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA256Hook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA256Hook.algo_id-119"><a href="#SHA256Hook.algo_id-119"><span class="linenos">119</span></a>    <span class="nd">@property</span>
</span><span id="SHA256Hook.algo_id-120"><a href="#SHA256Hook.algo_id-120"><span class="linenos">120</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA256Hook.algo_id-121"><a href="#SHA256Hook.algo_id-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="mi">4</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  checksum_algo 
0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</p>

<p>Returns:
     ID</p>
</div>


                            </div>
                            <div id="SHA256Hook.display_name" class="classattr">
                                        <input id="SHA256Hook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="SHA256Hook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA256Hook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA256Hook.display_name-123"><a href="#SHA256Hook.display_name-123"><span class="linenos">123</span></a>    <span class="nd">@property</span>
</span><span id="SHA256Hook.display_name-124"><a href="#SHA256Hook.display_name-124"><span class="linenos">124</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="SHA256Hook.display_name-125"><a href="#SHA256Hook.display_name-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="s2">&quot;sha256&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="SHA256Hook.digest_size" class="classattr">
                                        <input id="SHA256Hook.digest_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">digest_size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="SHA256Hook.digest_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA256Hook.digest_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA256Hook.digest_size-127"><a href="#SHA256Hook.digest_size-127"><span class="linenos">127</span></a>    <span class="nd">@property</span>
</span><span id="SHA256Hook.digest_size-128"><a href="#SHA256Hook.digest_size-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SHA256Hook.digest_size-129"><a href="#SHA256Hook.digest_size-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="mi">32</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="SHA256Hook.compute" class="classattr">
                                        <input id="SHA256Hook.compute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="SHA256Hook.compute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SHA256Hook.compute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SHA256Hook.compute-131"><a href="#SHA256Hook.compute-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="SHA256Hook.compute-132"><a href="#SHA256Hook.compute-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="ZlibCompressHook">
                            <input id="ZlibCompressHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ZlibCompressHook</span><wbr>(<span class="base"><a href="#IndexCryptoHook">grimoire.IndexCryptoHook</a></span>):

                <label class="view-source-button" for="ZlibCompressHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibCompressHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibCompressHook-12"><a href="#ZlibCompressHook-12"><span class="linenos">12</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ZlibCompressHook</span><span class="p">(</span><span class="n">IndexCryptoHook</span><span class="p">):</span>
</span><span id="ZlibCompressHook-13"><a href="#ZlibCompressHook-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook-14"><a href="#ZlibCompressHook-14"><span class="linenos">14</span></a><span class="sd">     zlib </span>
</span><span id="ZlibCompressHook-15"><a href="#ZlibCompressHook-15"><span class="linenos">15</span></a><span class="sd">    </span>
</span><span id="ZlibCompressHook-16"><a href="#ZlibCompressHook-16"><span class="linenos">16</span></a><span class="sd">    </span>
</span><span id="ZlibCompressHook-17"><a href="#ZlibCompressHook-17"><span class="linenos">17</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook-18"><a href="#ZlibCompressHook-18"><span class="linenos">18</span></a>    
</span><span id="ZlibCompressHook-19"><a href="#ZlibCompressHook-19"><span class="linenos">19</span></a>    <span class="c1"># flags_id = 0x02 (FLAG_INDEX_COMPRESSED)</span>
</span><span id="ZlibCompressHook-20"><a href="#ZlibCompressHook-20"><span class="linenos">20</span></a>    <span class="nd">@property</span>
</span><span id="ZlibCompressHook-21"><a href="#ZlibCompressHook-21"><span class="linenos">21</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZlibCompressHook-22"><a href="#ZlibCompressHook-22"><span class="linenos">22</span></a>        <span class="k">return</span> <span class="mh">0x02</span>
</span><span id="ZlibCompressHook-23"><a href="#ZlibCompressHook-23"><span class="linenos">23</span></a>    
</span><span id="ZlibCompressHook-24"><a href="#ZlibCompressHook-24"><span class="linenos">24</span></a>    <span class="nd">@property</span>
</span><span id="ZlibCompressHook-25"><a href="#ZlibCompressHook-25"><span class="linenos">25</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZlibCompressHook-26"><a href="#ZlibCompressHook-26"><span class="linenos">26</span></a>        <span class="k">return</span> <span class="s2">&quot;zlib&quot;</span>
</span><span id="ZlibCompressHook-27"><a href="#ZlibCompressHook-27"><span class="linenos">27</span></a>    
</span><span id="ZlibCompressHook-28"><a href="#ZlibCompressHook-28"><span class="linenos">28</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">):</span>
</span><span id="ZlibCompressHook-29"><a href="#ZlibCompressHook-29"><span class="linenos">29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook-30"><a href="#ZlibCompressHook-30"><span class="linenos">30</span></a><span class="sd">        Args:</span>
</span><span id="ZlibCompressHook-31"><a href="#ZlibCompressHook-31"><span class="linenos">31</span></a><span class="sd">            level:  (0-9),  6</span>
</span><span id="ZlibCompressHook-32"><a href="#ZlibCompressHook-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook-33"><a href="#ZlibCompressHook-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
</span><span id="ZlibCompressHook-34"><a href="#ZlibCompressHook-34"><span class="linenos">34</span></a>    
</span><span id="ZlibCompressHook-35"><a href="#ZlibCompressHook-35"><span class="linenos">35</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibCompressHook-36"><a href="#ZlibCompressHook-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook-37"><a href="#ZlibCompressHook-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span><span class="p">)</span>
</span><span id="ZlibCompressHook-38"><a href="#ZlibCompressHook-38"><span class="linenos">38</span></a>    
</span><span id="ZlibCompressHook-39"><a href="#ZlibCompressHook-39"><span class="linenos">39</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibCompressHook-40"><a href="#ZlibCompressHook-40"><span class="linenos">40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook-41"><a href="#ZlibCompressHook-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> zlib </p>

<p></p>
</div>


                            <div id="ZlibCompressHook.__init__" class="classattr">
                                        <input id="ZlibCompressHook.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ZlibCompressHook</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span></span>)</span>

                <label class="view-source-button" for="ZlibCompressHook.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibCompressHook.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibCompressHook.__init__-28"><a href="#ZlibCompressHook.__init__-28"><span class="linenos">28</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">):</span>
</span><span id="ZlibCompressHook.__init__-29"><a href="#ZlibCompressHook.__init__-29"><span class="linenos">29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook.__init__-30"><a href="#ZlibCompressHook.__init__-30"><span class="linenos">30</span></a><span class="sd">        Args:</span>
</span><span id="ZlibCompressHook.__init__-31"><a href="#ZlibCompressHook.__init__-31"><span class="linenos">31</span></a><span class="sd">            level:  (0-9),  6</span>
</span><span id="ZlibCompressHook.__init__-32"><a href="#ZlibCompressHook.__init__-32"><span class="linenos">32</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook.__init__-33"><a href="#ZlibCompressHook.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
</span></pre></div>


            <div class="docstring"><p>Args:
    level:  (0-9),  6</p>
</div>


                            </div>
                            <div id="ZlibCompressHook.flags_id" class="classattr">
                                        <input id="ZlibCompressHook.flags_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">flags_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ZlibCompressHook.flags_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibCompressHook.flags_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibCompressHook.flags_id-20"><a href="#ZlibCompressHook.flags_id-20"><span class="linenos">20</span></a>    <span class="nd">@property</span>
</span><span id="ZlibCompressHook.flags_id-21"><a href="#ZlibCompressHook.flags_id-21"><span class="linenos">21</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZlibCompressHook.flags_id-22"><a href="#ZlibCompressHook.flags_id-22"><span class="linenos">22</span></a>        <span class="k">return</span> <span class="mh">0x02</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  flags 
/</p>

<p>Returns:
     (e.g., 0x01, 0x02, 0x03)</p>
</div>


                            </div>
                            <div id="ZlibCompressHook.display_name" class="classattr">
                                        <input id="ZlibCompressHook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="ZlibCompressHook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibCompressHook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibCompressHook.display_name-24"><a href="#ZlibCompressHook.display_name-24"><span class="linenos">24</span></a>    <span class="nd">@property</span>
</span><span id="ZlibCompressHook.display_name-25"><a href="#ZlibCompressHook.display_name-25"><span class="linenos">25</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZlibCompressHook.display_name-26"><a href="#ZlibCompressHook.display_name-26"><span class="linenos">26</span></a>        <span class="k">return</span> <span class="s2">&quot;zlib&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="ZlibCompressHook.encrypt" class="classattr">
                                        <input id="ZlibCompressHook.encrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="ZlibCompressHook.encrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibCompressHook.encrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibCompressHook.encrypt-35"><a href="#ZlibCompressHook.encrypt-35"><span class="linenos">35</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibCompressHook.encrypt-36"><a href="#ZlibCompressHook.encrypt-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook.encrypt-37"><a href="#ZlibCompressHook.encrypt-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                            <div id="ZlibCompressHook.decrypt" class="classattr">
                                        <input id="ZlibCompressHook.decrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="ZlibCompressHook.decrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibCompressHook.decrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibCompressHook.decrypt-39"><a href="#ZlibCompressHook.decrypt-39"><span class="linenos">39</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibCompressHook.decrypt-40"><a href="#ZlibCompressHook.decrypt-40"><span class="linenos">40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
</span><span id="ZlibCompressHook.decrypt-41"><a href="#ZlibCompressHook.decrypt-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>
</div>


                            </div>
                </section>
                <section id="XorObfuscateHook">
                            <input id="XorObfuscateHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">XorObfuscateHook</span><wbr>(<span class="base"><a href="#IndexCryptoHook">grimoire.IndexCryptoHook</a></span>):

                <label class="view-source-button" for="XorObfuscateHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XorObfuscateHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XorObfuscateHook-44"><a href="#XorObfuscateHook-44"><span class="linenos">44</span></a><span class="k">class</span><span class="w"> </span><span class="nc">XorObfuscateHook</span><span class="p">(</span><span class="n">IndexCryptoHook</span><span class="p">):</span>
</span><span id="XorObfuscateHook-45"><a href="#XorObfuscateHook-45"><span class="linenos">45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="XorObfuscateHook-46"><a href="#XorObfuscateHook-46"><span class="linenos">46</span></a><span class="sd">     XOR </span>
</span><span id="XorObfuscateHook-47"><a href="#XorObfuscateHook-47"><span class="linenos">47</span></a><span class="sd">    </span>
</span><span id="XorObfuscateHook-48"><a href="#XorObfuscateHook-48"><span class="linenos">48</span></a><span class="sd">     key  XOR </span>
</span><span id="XorObfuscateHook-49"><a href="#XorObfuscateHook-49"><span class="linenos">49</span></a><span class="sd">    </span>
</span><span id="XorObfuscateHook-50"><a href="#XorObfuscateHook-50"><span class="linenos">50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="XorObfuscateHook-51"><a href="#XorObfuscateHook-51"><span class="linenos">51</span></a>    
</span><span id="XorObfuscateHook-52"><a href="#XorObfuscateHook-52"><span class="linenos">52</span></a>    <span class="c1"># flags_id = 0x01 (FLAG_INDEX_ENCRYPTED)</span>
</span><span id="XorObfuscateHook-53"><a href="#XorObfuscateHook-53"><span class="linenos">53</span></a>    <span class="nd">@property</span>
</span><span id="XorObfuscateHook-54"><a href="#XorObfuscateHook-54"><span class="linenos">54</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="XorObfuscateHook-55"><a href="#XorObfuscateHook-55"><span class="linenos">55</span></a>        <span class="k">return</span> <span class="mh">0x01</span>
</span><span id="XorObfuscateHook-56"><a href="#XorObfuscateHook-56"><span class="linenos">56</span></a>    
</span><span id="XorObfuscateHook-57"><a href="#XorObfuscateHook-57"><span class="linenos">57</span></a>    <span class="nd">@property</span>
</span><span id="XorObfuscateHook-58"><a href="#XorObfuscateHook-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="XorObfuscateHook-59"><a href="#XorObfuscateHook-59"><span class="linenos">59</span></a>        <span class="k">return</span> <span class="s2">&quot;xor&quot;</span>
</span><span id="XorObfuscateHook-60"><a href="#XorObfuscateHook-60"><span class="linenos">60</span></a>    
</span><span id="XorObfuscateHook-61"><a href="#XorObfuscateHook-61"><span class="linenos">61</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GrimoireVFS&#39;</span><span class="p">):</span>
</span><span id="XorObfuscateHook-62"><a href="#XorObfuscateHook-62"><span class="linenos">62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="XorObfuscateHook-63"><a href="#XorObfuscateHook-63"><span class="linenos">63</span></a><span class="sd">        Args:</span>
</span><span id="XorObfuscateHook-64"><a href="#XorObfuscateHook-64"><span class="linenos">64</span></a><span class="sd">            key: XOR </span>
</span><span id="XorObfuscateHook-65"><a href="#XorObfuscateHook-65"><span class="linenos">65</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="XorObfuscateHook-66"><a href="#XorObfuscateHook-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="XorObfuscateHook-67"><a href="#XorObfuscateHook-67"><span class="linenos">67</span></a>    
</span><span id="XorObfuscateHook-68"><a href="#XorObfuscateHook-68"><span class="linenos">68</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_xor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="XorObfuscateHook-69"><a href="#XorObfuscateHook-69"><span class="linenos">69</span></a>        <span class="n">key_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">)</span>
</span><span id="XorObfuscateHook-70"><a href="#XorObfuscateHook-70"><span class="linenos">70</span></a>        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">key_len</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="XorObfuscateHook-71"><a href="#XorObfuscateHook-71"><span class="linenos">71</span></a>    
</span><span id="XorObfuscateHook-72"><a href="#XorObfuscateHook-72"><span class="linenos">72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="XorObfuscateHook-73"><a href="#XorObfuscateHook-73"><span class="linenos">73</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="XorObfuscateHook-74"><a href="#XorObfuscateHook-74"><span class="linenos">74</span></a>    
</span><span id="XorObfuscateHook-75"><a href="#XorObfuscateHook-75"><span class="linenos">75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="XorObfuscateHook-76"><a href="#XorObfuscateHook-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> XOR </p>

<p> key  XOR 
</p>
</div>


                            <div id="XorObfuscateHook.__init__" class="classattr">
                                        <input id="XorObfuscateHook.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">XorObfuscateHook</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GrimoireVFS&#39;</span></span>)</span>

                <label class="view-source-button" for="XorObfuscateHook.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XorObfuscateHook.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XorObfuscateHook.__init__-61"><a href="#XorObfuscateHook.__init__-61"><span class="linenos">61</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GrimoireVFS&#39;</span><span class="p">):</span>
</span><span id="XorObfuscateHook.__init__-62"><a href="#XorObfuscateHook.__init__-62"><span class="linenos">62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="XorObfuscateHook.__init__-63"><a href="#XorObfuscateHook.__init__-63"><span class="linenos">63</span></a><span class="sd">        Args:</span>
</span><span id="XorObfuscateHook.__init__-64"><a href="#XorObfuscateHook.__init__-64"><span class="linenos">64</span></a><span class="sd">            key: XOR </span>
</span><span id="XorObfuscateHook.__init__-65"><a href="#XorObfuscateHook.__init__-65"><span class="linenos">65</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="XorObfuscateHook.__init__-66"><a href="#XorObfuscateHook.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
</span></pre></div>


            <div class="docstring"><p>Args:
    key: XOR </p>
</div>


                            </div>
                            <div id="XorObfuscateHook.flags_id" class="classattr">
                                        <input id="XorObfuscateHook.flags_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">flags_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="XorObfuscateHook.flags_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XorObfuscateHook.flags_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XorObfuscateHook.flags_id-53"><a href="#XorObfuscateHook.flags_id-53"><span class="linenos">53</span></a>    <span class="nd">@property</span>
</span><span id="XorObfuscateHook.flags_id-54"><a href="#XorObfuscateHook.flags_id-54"><span class="linenos">54</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="XorObfuscateHook.flags_id-55"><a href="#XorObfuscateHook.flags_id-55"><span class="linenos">55</span></a>        <span class="k">return</span> <span class="mh">0x01</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  flags 
/</p>

<p>Returns:
     (e.g., 0x01, 0x02, 0x03)</p>
</div>


                            </div>
                            <div id="XorObfuscateHook.display_name" class="classattr">
                                        <input id="XorObfuscateHook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="XorObfuscateHook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XorObfuscateHook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XorObfuscateHook.display_name-57"><a href="#XorObfuscateHook.display_name-57"><span class="linenos">57</span></a>    <span class="nd">@property</span>
</span><span id="XorObfuscateHook.display_name-58"><a href="#XorObfuscateHook.display_name-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="XorObfuscateHook.display_name-59"><a href="#XorObfuscateHook.display_name-59"><span class="linenos">59</span></a>        <span class="k">return</span> <span class="s2">&quot;xor&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="XorObfuscateHook.encrypt" class="classattr">
                                        <input id="XorObfuscateHook.encrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="XorObfuscateHook.encrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XorObfuscateHook.encrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XorObfuscateHook.encrypt-72"><a href="#XorObfuscateHook.encrypt-72"><span class="linenos">72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="XorObfuscateHook.encrypt-73"><a href="#XorObfuscateHook.encrypt-73"><span class="linenos">73</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="XorObfuscateHook.decrypt" class="classattr">
                                        <input id="XorObfuscateHook.decrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="XorObfuscateHook.decrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XorObfuscateHook.decrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XorObfuscateHook.decrypt-75"><a href="#XorObfuscateHook.decrypt-75"><span class="linenos">75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="XorObfuscateHook.decrypt-76"><a href="#XorObfuscateHook.decrypt-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="ZlibXorHook">
                            <input id="ZlibXorHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ZlibXorHook</span><wbr>(<span class="base"><a href="#IndexCryptoHook">grimoire.IndexCryptoHook</a></span>):

                <label class="view-source-button" for="ZlibXorHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibXorHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibXorHook-79"><a href="#ZlibXorHook-79"><span class="linenos"> 79</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ZlibXorHook</span><span class="p">(</span><span class="n">IndexCryptoHook</span><span class="p">):</span>
</span><span id="ZlibXorHook-80"><a href="#ZlibXorHook-80"><span class="linenos"> 80</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZlibXorHook-81"><a href="#ZlibXorHook-81"><span class="linenos"> 81</span></a><span class="sd">     XOR </span>
</span><span id="ZlibXorHook-82"><a href="#ZlibXorHook-82"><span class="linenos"> 82</span></a><span class="sd">    </span>
</span><span id="ZlibXorHook-83"><a href="#ZlibXorHook-83"><span class="linenos"> 83</span></a><span class="sd">    </span>
</span><span id="ZlibXorHook-84"><a href="#ZlibXorHook-84"><span class="linenos"> 84</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ZlibXorHook-85"><a href="#ZlibXorHook-85"><span class="linenos"> 85</span></a>    
</span><span id="ZlibXorHook-86"><a href="#ZlibXorHook-86"><span class="linenos"> 86</span></a>    <span class="c1"># flags_id = 0x03 (FLAG_INDEX_COMPRESSED | FLAG_INDEX_ENCRYPTED)</span>
</span><span id="ZlibXorHook-87"><a href="#ZlibXorHook-87"><span class="linenos"> 87</span></a>    <span class="nd">@property</span>
</span><span id="ZlibXorHook-88"><a href="#ZlibXorHook-88"><span class="linenos"> 88</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZlibXorHook-89"><a href="#ZlibXorHook-89"><span class="linenos"> 89</span></a>        <span class="k">return</span> <span class="mh">0x03</span>
</span><span id="ZlibXorHook-90"><a href="#ZlibXorHook-90"><span class="linenos"> 90</span></a>    
</span><span id="ZlibXorHook-91"><a href="#ZlibXorHook-91"><span class="linenos"> 91</span></a>    <span class="nd">@property</span>
</span><span id="ZlibXorHook-92"><a href="#ZlibXorHook-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZlibXorHook-93"><a href="#ZlibXorHook-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="s2">&quot;zlib_xor&quot;</span>
</span><span id="ZlibXorHook-94"><a href="#ZlibXorHook-94"><span class="linenos"> 94</span></a>    
</span><span id="ZlibXorHook-95"><a href="#ZlibXorHook-95"><span class="linenos"> 95</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GrimoireVFS&#39;</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">):</span>
</span><span id="ZlibXorHook-96"><a href="#ZlibXorHook-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zlib</span> <span class="o">=</span> <span class="n">ZlibCompressHook</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="ZlibXorHook-97"><a href="#ZlibXorHook-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span> <span class="o">=</span> <span class="n">XorObfuscateHook</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="ZlibXorHook-98"><a href="#ZlibXorHook-98"><span class="linenos"> 98</span></a>    
</span><span id="ZlibXorHook-99"><a href="#ZlibXorHook-99"><span class="linenos"> 99</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibXorHook-100"><a href="#ZlibXorHook-100"><span class="linenos">100</span></a>        <span class="n">compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zlib</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ZlibXorHook-101"><a href="#ZlibXorHook-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>
</span><span id="ZlibXorHook-102"><a href="#ZlibXorHook-102"><span class="linenos">102</span></a>    
</span><span id="ZlibXorHook-103"><a href="#ZlibXorHook-103"><span class="linenos">103</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibXorHook-104"><a href="#ZlibXorHook-104"><span class="linenos">104</span></a>        <span class="n">deobfuscated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ZlibXorHook-105"><a href="#ZlibXorHook-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zlib</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">deobfuscated</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> XOR </p>

<p></p>
</div>


                            <div id="ZlibXorHook.__init__" class="classattr">
                                        <input id="ZlibXorHook.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ZlibXorHook</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GrimoireVFS&#39;</span>, </span><span class="param"><span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span></span>)</span>

                <label class="view-source-button" for="ZlibXorHook.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibXorHook.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibXorHook.__init__-95"><a href="#ZlibXorHook.__init__-95"><span class="linenos">95</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GrimoireVFS&#39;</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">):</span>
</span><span id="ZlibXorHook.__init__-96"><a href="#ZlibXorHook.__init__-96"><span class="linenos">96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zlib</span> <span class="o">=</span> <span class="n">ZlibCompressHook</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="ZlibXorHook.__init__-97"><a href="#ZlibXorHook.__init__-97"><span class="linenos">97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span> <span class="o">=</span> <span class="n">XorObfuscateHook</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ZlibXorHook.flags_id" class="classattr">
                                        <input id="ZlibXorHook.flags_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">flags_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="ZlibXorHook.flags_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibXorHook.flags_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibXorHook.flags_id-87"><a href="#ZlibXorHook.flags_id-87"><span class="linenos">87</span></a>    <span class="nd">@property</span>
</span><span id="ZlibXorHook.flags_id-88"><a href="#ZlibXorHook.flags_id-88"><span class="linenos">88</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flags_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZlibXorHook.flags_id-89"><a href="#ZlibXorHook.flags_id-89"><span class="linenos">89</span></a>        <span class="k">return</span> <span class="mh">0x03</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  flags 
/</p>

<p>Returns:
     (e.g., 0x01, 0x02, 0x03)</p>
</div>


                            </div>
                            <div id="ZlibXorHook.display_name" class="classattr">
                                        <input id="ZlibXorHook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="ZlibXorHook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibXorHook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibXorHook.display_name-91"><a href="#ZlibXorHook.display_name-91"><span class="linenos">91</span></a>    <span class="nd">@property</span>
</span><span id="ZlibXorHook.display_name-92"><a href="#ZlibXorHook.display_name-92"><span class="linenos">92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZlibXorHook.display_name-93"><a href="#ZlibXorHook.display_name-93"><span class="linenos">93</span></a>        <span class="k">return</span> <span class="s2">&quot;zlib_xor&quot;</span>
</span></pre></div>


            <div class="docstring"><p> ( JSON )</p>

<p></p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="ZlibXorHook.encrypt" class="classattr">
                                        <input id="ZlibXorHook.encrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="ZlibXorHook.encrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibXorHook.encrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibXorHook.encrypt-99"><a href="#ZlibXorHook.encrypt-99"><span class="linenos"> 99</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibXorHook.encrypt-100"><a href="#ZlibXorHook.encrypt-100"><span class="linenos">100</span></a>        <span class="n">compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zlib</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ZlibXorHook.encrypt-101"><a href="#ZlibXorHook.encrypt-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                            <div id="ZlibXorHook.decrypt" class="classattr">
                                        <input id="ZlibXorHook.decrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="ZlibXorHook.decrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZlibXorHook.decrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZlibXorHook.decrypt-103"><a href="#ZlibXorHook.decrypt-103"><span class="linenos">103</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ZlibXorHook.decrypt-104"><a href="#ZlibXorHook.decrypt-104"><span class="linenos">104</span></a>        <span class="n">deobfuscated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="ZlibXorHook.decrypt-105"><a href="#ZlibXorHook.decrypt-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zlib</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">deobfuscated</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    data: </p>

<p>Returns:
    </p>
</div>


                            </div>
                </section>
                <section id="RcloneHashHook">
                            <input id="RcloneHashHook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RcloneHashHook</span><wbr>(<span class="base"><a href="#ChecksumHook">grimoire.ChecksumHook</a></span>):

                <label class="view-source-button" for="RcloneHashHook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook-23"><a href="#RcloneHashHook-23"><span class="linenos"> 23</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RcloneHashHook</span><span class="p">(</span><span class="n">ChecksumHook</span><span class="p">):</span>
</span><span id="RcloneHashHook-24"><a href="#RcloneHashHook-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-25"><a href="#RcloneHashHook-25"><span class="linenos"> 25</span></a><span class="sd">    Rclone  Hook</span>
</span><span id="RcloneHashHook-26"><a href="#RcloneHashHook-26"><span class="linenos"> 26</span></a><span class="sd">    </span>
</span><span id="RcloneHashHook-27"><a href="#RcloneHashHook-27"><span class="linenos"> 27</span></a><span class="sd">     rclone hashsum </span>
</span><span id="RcloneHashHook-28"><a href="#RcloneHashHook-28"><span class="linenos"> 28</span></a><span class="sd">     Python </span>
</span><span id="RcloneHashHook-29"><a href="#RcloneHashHook-29"><span class="linenos"> 29</span></a><span class="sd">    </span>
</span><span id="RcloneHashHook-30"><a href="#RcloneHashHook-30"><span class="linenos"> 30</span></a><span class="sd">    :</span>
</span><span id="RcloneHashHook-31"><a href="#RcloneHashHook-31"><span class="linenos"> 31</span></a><span class="sd">        md5, sha1, sha256, sha512, crc32, blake3, xxh3, xxh128,</span>
</span><span id="RcloneHashHook-32"><a href="#RcloneHashHook-32"><span class="linenos"> 32</span></a><span class="sd">        quickxor, dropbox, whirlpool, hidrive, mailru</span>
</span><span id="RcloneHashHook-33"><a href="#RcloneHashHook-33"><span class="linenos"> 33</span></a><span class="sd">    </span>
</span><span id="RcloneHashHook-34"><a href="#RcloneHashHook-34"><span class="linenos"> 34</span></a><span class="sd">    Usage:</span>
</span><span id="RcloneHashHook-35"><a href="#RcloneHashHook-35"><span class="linenos"> 35</span></a><span class="sd">        hook = RcloneHashHook(&#39;quickxor&#39;)</span>
</span><span id="RcloneHashHook-36"><a href="#RcloneHashHook-36"><span class="linenos"> 36</span></a><span class="sd">        hash_bytes = hook.compute_file(&#39;/path/to/file&#39;)</span>
</span><span id="RcloneHashHook-37"><a href="#RcloneHashHook-37"><span class="linenos"> 37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-38"><a href="#RcloneHashHook-38"><span class="linenos"> 38</span></a>    
</span><span id="RcloneHashHook-39"><a href="#RcloneHashHook-39"><span class="linenos"> 39</span></a>    <span class="c1"># rclone </span>
</span><span id="RcloneHashHook-40"><a href="#RcloneHashHook-40"><span class="linenos"> 40</span></a>    <span class="n">SUPPORTED_ALGORITHMS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="RcloneHashHook-41"><a href="#RcloneHashHook-41"><span class="linenos"> 41</span></a>        <span class="s1">&#39;md5&#39;</span><span class="p">,</span> <span class="s1">&#39;sha1&#39;</span><span class="p">,</span> <span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="s1">&#39;sha512&#39;</span><span class="p">,</span> <span class="s1">&#39;crc32&#39;</span><span class="p">,</span>
</span><span id="RcloneHashHook-42"><a href="#RcloneHashHook-42"><span class="linenos"> 42</span></a>        <span class="s1">&#39;blake3&#39;</span><span class="p">,</span> <span class="s1">&#39;xxh3&#39;</span><span class="p">,</span> <span class="s1">&#39;xxh128&#39;</span><span class="p">,</span> <span class="s1">&#39;quickxor&#39;</span>
</span><span id="RcloneHashHook-43"><a href="#RcloneHashHook-43"><span class="linenos"> 43</span></a>    <span class="p">}</span>
</span><span id="RcloneHashHook-44"><a href="#RcloneHashHook-44"><span class="linenos"> 44</span></a>    
</span><span id="RcloneHashHook-45"><a href="#RcloneHashHook-45"><span class="linenos"> 45</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RcloneHashHook-46"><a href="#RcloneHashHook-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RcloneHashHook-47"><a href="#RcloneHashHook-47"><span class="linenos"> 47</span></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sha256&#39;</span><span class="p">,</span>
</span><span id="RcloneHashHook-48"><a href="#RcloneHashHook-48"><span class="linenos"> 48</span></a>        <span class="n">rclone_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rclone&#39;</span><span class="p">,</span>
</span><span id="RcloneHashHook-49"><a href="#RcloneHashHook-49"><span class="linenos"> 49</span></a>        <span class="n">check_on_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RcloneHashHook-50"><a href="#RcloneHashHook-50"><span class="linenos"> 50</span></a>    <span class="p">):</span>
</span><span id="RcloneHashHook-51"><a href="#RcloneHashHook-51"><span class="linenos"> 51</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-52"><a href="#RcloneHashHook-52"><span class="linenos"> 52</span></a><span class="sd">         RcloneHashHook</span>
</span><span id="RcloneHashHook-53"><a href="#RcloneHashHook-53"><span class="linenos"> 53</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-54"><a href="#RcloneHashHook-54"><span class="linenos"> 54</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook-55"><a href="#RcloneHashHook-55"><span class="linenos"> 55</span></a><span class="sd">            algorithm: </span>
</span><span id="RcloneHashHook-56"><a href="#RcloneHashHook-56"><span class="linenos"> 56</span></a><span class="sd">            rclone_path: rclone </span>
</span><span id="RcloneHashHook-57"><a href="#RcloneHashHook-57"><span class="linenos"> 57</span></a><span class="sd">            check_on_init:  rclone </span>
</span><span id="RcloneHashHook-58"><a href="#RcloneHashHook-58"><span class="linenos"> 58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-59"><a href="#RcloneHashHook-59"><span class="linenos"> 59</span></a>        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="RcloneHashHook-60"><a href="#RcloneHashHook-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_ALGORITHMS</span><span class="p">:</span>
</span><span id="RcloneHashHook-61"><a href="#RcloneHashHook-61"><span class="linenos"> 61</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="RcloneHashHook-62"><a href="#RcloneHashHook-62"><span class="linenos"> 62</span></a>                <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RcloneHashHook-63"><a href="#RcloneHashHook-63"><span class="linenos"> 63</span></a>                <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_ALGORITHMS</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RcloneHashHook-64"><a href="#RcloneHashHook-64"><span class="linenos"> 64</span></a>            <span class="p">)</span>
</span><span id="RcloneHashHook-65"><a href="#RcloneHashHook-65"><span class="linenos"> 65</span></a>        
</span><span id="RcloneHashHook-66"><a href="#RcloneHashHook-66"><span class="linenos"> 66</span></a>        <span class="c1">#  algo_id  digest_size</span>
</span><span id="RcloneHashHook-67"><a href="#RcloneHashHook-67"><span class="linenos"> 67</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.registry</span><span class="w"> </span><span class="kn">import</span> <span class="n">ALGORITHM_REGISTRY</span>
</span><span id="RcloneHashHook-68"><a href="#RcloneHashHook-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>
</span><span id="RcloneHashHook-69"><a href="#RcloneHashHook-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span> <span class="o">=</span> <span class="n">rclone_path</span>
</span><span id="RcloneHashHook-70"><a href="#RcloneHashHook-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_algo_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digest_size</span> <span class="o">=</span> <span class="n">ALGORITHM_REGISTRY</span><span class="p">[</span><span class="n">algorithm</span><span class="p">]</span>
</span><span id="RcloneHashHook-71"><a href="#RcloneHashHook-71"><span class="linenos"> 71</span></a>        
</span><span id="RcloneHashHook-72"><a href="#RcloneHashHook-72"><span class="linenos"> 72</span></a>        <span class="k">if</span> <span class="n">check_on_init</span><span class="p">:</span>
</span><span id="RcloneHashHook-73"><a href="#RcloneHashHook-73"><span class="linenos"> 73</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_rclone</span><span class="p">()</span>
</span><span id="RcloneHashHook-74"><a href="#RcloneHashHook-74"><span class="linenos"> 74</span></a>    
</span><span id="RcloneHashHook-75"><a href="#RcloneHashHook-75"><span class="linenos"> 75</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook-76"><a href="#RcloneHashHook-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RcloneHashHook-77"><a href="#RcloneHashHook-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; rclone:algorithm &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-78"><a href="#RcloneHashHook-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;rclone:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RcloneHashHook-79"><a href="#RcloneHashHook-79"><span class="linenos"> 79</span></a>    
</span><span id="RcloneHashHook-80"><a href="#RcloneHashHook-80"><span class="linenos"> 80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_rclone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="RcloneHashHook-81"><a href="#RcloneHashHook-81"><span class="linenos"> 81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; rclone &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-82"><a href="#RcloneHashHook-82"><span class="linenos"> 82</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="RcloneHashHook-83"><a href="#RcloneHashHook-83"><span class="linenos"> 83</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="RcloneHashHook-84"><a href="#RcloneHashHook-84"><span class="linenos"> 84</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">],</span>
</span><span id="RcloneHashHook-85"><a href="#RcloneHashHook-85"><span class="linenos"> 85</span></a>                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RcloneHashHook-86"><a href="#RcloneHashHook-86"><span class="linenos"> 86</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
</span><span id="RcloneHashHook-87"><a href="#RcloneHashHook-87"><span class="linenos"> 87</span></a>            <span class="p">)</span>
</span><span id="RcloneHashHook-88"><a href="#RcloneHashHook-88"><span class="linenos"> 88</span></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RcloneHashHook-89"><a href="#RcloneHashHook-89"><span class="linenos"> 89</span></a>                <span class="k">raise</span> <span class="n">RcloneNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rclone : </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RcloneHashHook-90"><a href="#RcloneHashHook-90"><span class="linenos"> 90</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="RcloneHashHook-91"><a href="#RcloneHashHook-91"><span class="linenos"> 91</span></a>            <span class="k">raise</span> <span class="n">RcloneNotFoundError</span><span class="p">(</span>
</span><span id="RcloneHashHook-92"><a href="#RcloneHashHook-92"><span class="linenos"> 92</span></a>                <span class="sa">f</span><span class="s2">&quot; rclone: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RcloneHashHook-93"><a href="#RcloneHashHook-93"><span class="linenos"> 93</span></a>                <span class="s2">&quot; rclone &quot;</span>
</span><span id="RcloneHashHook-94"><a href="#RcloneHashHook-94"><span class="linenos"> 94</span></a>            <span class="p">)</span>
</span><span id="RcloneHashHook-95"><a href="#RcloneHashHook-95"><span class="linenos"> 95</span></a>        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
</span><span id="RcloneHashHook-96"><a href="#RcloneHashHook-96"><span class="linenos"> 96</span></a>            <span class="k">raise</span> <span class="n">RcloneNotFoundError</span><span class="p">(</span><span class="s2">&quot;rclone &quot;</span><span class="p">)</span>
</span><span id="RcloneHashHook-97"><a href="#RcloneHashHook-97"><span class="linenos"> 97</span></a>    
</span><span id="RcloneHashHook-98"><a href="#RcloneHashHook-98"><span class="linenos"> 98</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook-99"><a href="#RcloneHashHook-99"><span class="linenos"> 99</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="RcloneHashHook-100"><a href="#RcloneHashHook-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algo_id</span>
</span><span id="RcloneHashHook-101"><a href="#RcloneHashHook-101"><span class="linenos">101</span></a>    
</span><span id="RcloneHashHook-102"><a href="#RcloneHashHook-102"><span class="linenos">102</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook-103"><a href="#RcloneHashHook-103"><span class="linenos">103</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="RcloneHashHook-104"><a href="#RcloneHashHook-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digest_size</span>
</span><span id="RcloneHashHook-105"><a href="#RcloneHashHook-105"><span class="linenos">105</span></a>    
</span><span id="RcloneHashHook-106"><a href="#RcloneHashHook-106"><span class="linenos">106</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook-107"><a href="#RcloneHashHook-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RcloneHashHook-108"><a href="#RcloneHashHook-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span>
</span><span id="RcloneHashHook-109"><a href="#RcloneHashHook-109"><span class="linenos">109</span></a>    
</span><span id="RcloneHashHook-110"><a href="#RcloneHashHook-110"><span class="linenos">110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="RcloneHashHook-111"><a href="#RcloneHashHook-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-112"><a href="#RcloneHashHook-112"><span class="linenos">112</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-113"><a href="#RcloneHashHook-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-114"><a href="#RcloneHashHook-114"><span class="linenos">114</span></a><span class="sd">        : </span>
</span><span id="RcloneHashHook-115"><a href="#RcloneHashHook-115"><span class="linenos">115</span></a><span class="sd">         compute_file() </span>
</span><span id="RcloneHashHook-116"><a href="#RcloneHashHook-116"><span class="linenos">116</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-117"><a href="#RcloneHashHook-117"><span class="linenos">117</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook-118"><a href="#RcloneHashHook-118"><span class="linenos">118</span></a><span class="sd">            data: </span>
</span><span id="RcloneHashHook-119"><a href="#RcloneHashHook-119"><span class="linenos">119</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook-120"><a href="#RcloneHashHook-120"><span class="linenos">120</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook-121"><a href="#RcloneHashHook-121"><span class="linenos">121</span></a><span class="sd">             (bytes)</span>
</span><span id="RcloneHashHook-122"><a href="#RcloneHashHook-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-123"><a href="#RcloneHashHook-123"><span class="linenos">123</span></a>        <span class="c1"># </span>
</span><span id="RcloneHashHook-124"><a href="#RcloneHashHook-124"><span class="linenos">124</span></a>        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
</span><span id="RcloneHashHook-125"><a href="#RcloneHashHook-125"><span class="linenos">125</span></a>            <span class="n">tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="RcloneHashHook-126"><a href="#RcloneHashHook-126"><span class="linenos">126</span></a>            <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">name</span>
</span><span id="RcloneHashHook-127"><a href="#RcloneHashHook-127"><span class="linenos">127</span></a>        
</span><span id="RcloneHashHook-128"><a href="#RcloneHashHook-128"><span class="linenos">128</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="RcloneHashHook-129"><a href="#RcloneHashHook-129"><span class="linenos">129</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_file</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="RcloneHashHook-130"><a href="#RcloneHashHook-130"><span class="linenos">130</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="RcloneHashHook-131"><a href="#RcloneHashHook-131"><span class="linenos">131</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="RcloneHashHook-132"><a href="#RcloneHashHook-132"><span class="linenos">132</span></a>    
</span><span id="RcloneHashHook-133"><a href="#RcloneHashHook-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="RcloneHashHook-134"><a href="#RcloneHashHook-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-135"><a href="#RcloneHashHook-135"><span class="linenos">135</span></a><span class="sd">         ()</span>
</span><span id="RcloneHashHook-136"><a href="#RcloneHashHook-136"><span class="linenos">136</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-137"><a href="#RcloneHashHook-137"><span class="linenos">137</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook-138"><a href="#RcloneHashHook-138"><span class="linenos">138</span></a><span class="sd">            file_path: </span>
</span><span id="RcloneHashHook-139"><a href="#RcloneHashHook-139"><span class="linenos">139</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook-140"><a href="#RcloneHashHook-140"><span class="linenos">140</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook-141"><a href="#RcloneHashHook-141"><span class="linenos">141</span></a><span class="sd">             (bytes)</span>
</span><span id="RcloneHashHook-142"><a href="#RcloneHashHook-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-143"><a href="#RcloneHashHook-143"><span class="linenos">143</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="RcloneHashHook-144"><a href="#RcloneHashHook-144"><span class="linenos">144</span></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span><span class="p">,</span> <span class="s1">&#39;hashsum&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span><span class="p">,</span> <span class="n">file_path</span><span class="p">],</span>
</span><span id="RcloneHashHook-145"><a href="#RcloneHashHook-145"><span class="linenos">145</span></a>            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RcloneHashHook-146"><a href="#RcloneHashHook-146"><span class="linenos">146</span></a>            <span class="n">check</span><span class="o">=</span><span class="kc">True</span>
</span><span id="RcloneHashHook-147"><a href="#RcloneHashHook-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="RcloneHashHook-148"><a href="#RcloneHashHook-148"><span class="linenos">148</span></a>        
</span><span id="RcloneHashHook-149"><a href="#RcloneHashHook-149"><span class="linenos">149</span></a>        <span class="c1"># : &quot;hash  filename\n&quot;</span>
</span><span id="RcloneHashHook-150"><a href="#RcloneHashHook-150"><span class="linenos">150</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="RcloneHashHook-151"><a href="#RcloneHashHook-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
</span><span id="RcloneHashHook-152"><a href="#RcloneHashHook-152"><span class="linenos">152</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rclone : </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RcloneHashHook-153"><a href="#RcloneHashHook-153"><span class="linenos">153</span></a>        
</span><span id="RcloneHashHook-154"><a href="#RcloneHashHook-154"><span class="linenos">154</span></a>        <span class="n">hash_hex</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RcloneHashHook-155"><a href="#RcloneHashHook-155"><span class="linenos">155</span></a>        <span class="k">return</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hash_hex</span><span class="p">)</span>
</span><span id="RcloneHashHook-156"><a href="#RcloneHashHook-156"><span class="linenos">156</span></a>    
</span><span id="RcloneHashHook-157"><a href="#RcloneHashHook-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_files_batch</span><span class="p">(</span>
</span><span id="RcloneHashHook-158"><a href="#RcloneHashHook-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RcloneHashHook-159"><a href="#RcloneHashHook-159"><span class="linenos">159</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="RcloneHashHook-160"><a href="#RcloneHashHook-160"><span class="linenos">160</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RcloneHashHook-161"><a href="#RcloneHashHook-161"><span class="linenos">161</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="RcloneHashHook-162"><a href="#RcloneHashHook-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-163"><a href="#RcloneHashHook-163"><span class="linenos">163</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-164"><a href="#RcloneHashHook-164"><span class="linenos">164</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-165"><a href="#RcloneHashHook-165"><span class="linenos">165</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-166"><a href="#RcloneHashHook-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-167"><a href="#RcloneHashHook-167"><span class="linenos">167</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook-168"><a href="#RcloneHashHook-168"><span class="linenos">168</span></a><span class="sd">            file_paths: </span>
</span><span id="RcloneHashHook-169"><a href="#RcloneHashHook-169"><span class="linenos">169</span></a><span class="sd">            timeout:  ()</span>
</span><span id="RcloneHashHook-170"><a href="#RcloneHashHook-170"><span class="linenos">170</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook-171"><a href="#RcloneHashHook-171"><span class="linenos">171</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook-172"><a href="#RcloneHashHook-172"><span class="linenos">172</span></a><span class="sd">            {file_path: hash_bytes} </span>
</span><span id="RcloneHashHook-173"><a href="#RcloneHashHook-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-174"><a href="#RcloneHashHook-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span id="RcloneHashHook-175"><a href="#RcloneHashHook-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="RcloneHashHook-176"><a href="#RcloneHashHook-176"><span class="linenos">176</span></a>        
</span><span id="RcloneHashHook-177"><a href="#RcloneHashHook-177"><span class="linenos">177</span></a>        <span class="c1"># </span>
</span><span id="RcloneHashHook-178"><a href="#RcloneHashHook-178"><span class="linenos">178</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="RcloneHashHook-179"><a href="#RcloneHashHook-179"><span class="linenos">179</span></a>        <span class="n">dir_groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="RcloneHashHook-180"><a href="#RcloneHashHook-180"><span class="linenos">180</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span id="RcloneHashHook-181"><a href="#RcloneHashHook-181"><span class="linenos">181</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="RcloneHashHook-182"><a href="#RcloneHashHook-182"><span class="linenos">182</span></a>            <span class="n">dir_groups</span><span class="p">[</span><span class="n">dir_path</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="RcloneHashHook-183"><a href="#RcloneHashHook-183"><span class="linenos">183</span></a>        
</span><span id="RcloneHashHook-184"><a href="#RcloneHashHook-184"><span class="linenos">184</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RcloneHashHook-185"><a href="#RcloneHashHook-185"><span class="linenos">185</span></a>        
</span><span id="RcloneHashHook-186"><a href="#RcloneHashHook-186"><span class="linenos">186</span></a>        <span class="k">for</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">paths</span> <span class="ow">in</span> <span class="n">dir_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="RcloneHashHook-187"><a href="#RcloneHashHook-187"><span class="linenos">187</span></a>            <span class="c1">#  rclone hashsum</span>
</span><span id="RcloneHashHook-188"><a href="#RcloneHashHook-188"><span class="linenos">188</span></a>            <span class="n">dir_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_dir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="RcloneHashHook-189"><a href="#RcloneHashHook-189"><span class="linenos">189</span></a>            
</span><span id="RcloneHashHook-190"><a href="#RcloneHashHook-190"><span class="linenos">190</span></a>            <span class="c1"># </span>
</span><span id="RcloneHashHook-191"><a href="#RcloneHashHook-191"><span class="linenos">191</span></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="RcloneHashHook-192"><a href="#RcloneHashHook-192"><span class="linenos">192</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="RcloneHashHook-193"><a href="#RcloneHashHook-193"><span class="linenos">193</span></a>                <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">dir_results</span><span class="p">:</span>
</span><span id="RcloneHashHook-194"><a href="#RcloneHashHook-194"><span class="linenos">194</span></a>                    <span class="n">results</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">dir_results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
</span><span id="RcloneHashHook-195"><a href="#RcloneHashHook-195"><span class="linenos">195</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="RcloneHashHook-196"><a href="#RcloneHashHook-196"><span class="linenos">196</span></a>                    <span class="c1"># </span>
</span><span id="RcloneHashHook-197"><a href="#RcloneHashHook-197"><span class="linenos">197</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="RcloneHashHook-198"><a href="#RcloneHashHook-198"><span class="linenos">198</span></a>                        <span class="n">results</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="RcloneHashHook-199"><a href="#RcloneHashHook-199"><span class="linenos">199</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="RcloneHashHook-200"><a href="#RcloneHashHook-200"><span class="linenos">200</span></a>                        <span class="k">pass</span>
</span><span id="RcloneHashHook-201"><a href="#RcloneHashHook-201"><span class="linenos">201</span></a>        
</span><span id="RcloneHashHook-202"><a href="#RcloneHashHook-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="RcloneHashHook-203"><a href="#RcloneHashHook-203"><span class="linenos">203</span></a>    
</span><span id="RcloneHashHook-204"><a href="#RcloneHashHook-204"><span class="linenos">204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_dir</span><span class="p">(</span>
</span><span id="RcloneHashHook-205"><a href="#RcloneHashHook-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RcloneHashHook-206"><a href="#RcloneHashHook-206"><span class="linenos">206</span></a>        <span class="n">dir_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="RcloneHashHook-207"><a href="#RcloneHashHook-207"><span class="linenos">207</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="RcloneHashHook-208"><a href="#RcloneHashHook-208"><span class="linenos">208</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RcloneHashHook-209"><a href="#RcloneHashHook-209"><span class="linenos">209</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="RcloneHashHook-210"><a href="#RcloneHashHook-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-211"><a href="#RcloneHashHook-211"><span class="linenos">211</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-212"><a href="#RcloneHashHook-212"><span class="linenos">212</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook-213"><a href="#RcloneHashHook-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook-214"><a href="#RcloneHashHook-214"><span class="linenos">214</span></a><span class="sd">            dir_path: </span>
</span><span id="RcloneHashHook-215"><a href="#RcloneHashHook-215"><span class="linenos">215</span></a><span class="sd">            recursive: </span>
</span><span id="RcloneHashHook-216"><a href="#RcloneHashHook-216"><span class="linenos">216</span></a><span class="sd">            timeout:  ()</span>
</span><span id="RcloneHashHook-217"><a href="#RcloneHashHook-217"><span class="linenos">217</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook-218"><a href="#RcloneHashHook-218"><span class="linenos">218</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook-219"><a href="#RcloneHashHook-219"><span class="linenos">219</span></a><span class="sd">            {filename: hash_bytes}  ()</span>
</span><span id="RcloneHashHook-220"><a href="#RcloneHashHook-220"><span class="linenos">220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook-221"><a href="#RcloneHashHook-221"><span class="linenos">221</span></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span><span class="p">,</span> <span class="s1">&#39;hashsum&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">]</span>
</span><span id="RcloneHashHook-222"><a href="#RcloneHashHook-222"><span class="linenos">222</span></a>        
</span><span id="RcloneHashHook-223"><a href="#RcloneHashHook-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="RcloneHashHook-224"><a href="#RcloneHashHook-224"><span class="linenos">224</span></a>            <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--max-depth&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">])</span>
</span><span id="RcloneHashHook-225"><a href="#RcloneHashHook-225"><span class="linenos">225</span></a>        
</span><span id="RcloneHashHook-226"><a href="#RcloneHashHook-226"><span class="linenos">226</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="RcloneHashHook-227"><a href="#RcloneHashHook-227"><span class="linenos">227</span></a>            <span class="n">cmd</span><span class="p">,</span>
</span><span id="RcloneHashHook-228"><a href="#RcloneHashHook-228"><span class="linenos">228</span></a>            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RcloneHashHook-229"><a href="#RcloneHashHook-229"><span class="linenos">229</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
</span><span id="RcloneHashHook-230"><a href="#RcloneHashHook-230"><span class="linenos">230</span></a>        <span class="p">)</span>
</span><span id="RcloneHashHook-231"><a href="#RcloneHashHook-231"><span class="linenos">231</span></a>        
</span><span id="RcloneHashHook-232"><a href="#RcloneHashHook-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RcloneHashHook-233"><a href="#RcloneHashHook-233"><span class="linenos">233</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="RcloneHashHook-234"><a href="#RcloneHashHook-234"><span class="linenos">234</span></a>        
</span><span id="RcloneHashHook-235"><a href="#RcloneHashHook-235"><span class="linenos">235</span></a>        <span class="c1"># </span>
</span><span id="RcloneHashHook-236"><a href="#RcloneHashHook-236"><span class="linenos">236</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RcloneHashHook-237"><a href="#RcloneHashHook-237"><span class="linenos">237</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
</span><span id="RcloneHashHook-238"><a href="#RcloneHashHook-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
</span><span id="RcloneHashHook-239"><a href="#RcloneHashHook-239"><span class="linenos">239</span></a>                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="RcloneHashHook-240"><a href="#RcloneHashHook-240"><span class="linenos">240</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="RcloneHashHook-241"><a href="#RcloneHashHook-241"><span class="linenos">241</span></a>                    <span class="n">hash_hex</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">parts</span>
</span><span id="RcloneHashHook-242"><a href="#RcloneHashHook-242"><span class="linenos">242</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="RcloneHashHook-243"><a href="#RcloneHashHook-243"><span class="linenos">243</span></a>                        <span class="n">results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hash_hex</span><span class="p">)</span>
</span><span id="RcloneHashHook-244"><a href="#RcloneHashHook-244"><span class="linenos">244</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="RcloneHashHook-245"><a href="#RcloneHashHook-245"><span class="linenos">245</span></a>                        <span class="k">pass</span>
</span><span id="RcloneHashHook-246"><a href="#RcloneHashHook-246"><span class="linenos">246</span></a>        
</span><span id="RcloneHashHook-247"><a href="#RcloneHashHook-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="RcloneHashHook-248"><a href="#RcloneHashHook-248"><span class="linenos">248</span></a>    
</span><span id="RcloneHashHook-249"><a href="#RcloneHashHook-249"><span class="linenos">249</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RcloneHashHook-250"><a href="#RcloneHashHook-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;RcloneHashHook(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Rclone  Hook</p>

<p> rclone hashsum 
 Python </p>

<p>:
    md5, sha1, sha256, sha512, crc32, blake3, xxh3, xxh128,
    quickxor, dropbox, whirlpool, hidrive, mailru</p>

<p>Usage:
    hook = RcloneHashHook('quickxor')
    hash_bytes = hook.compute_file('/path/to/file')</p>
</div>


                            <div id="RcloneHashHook.__init__" class="classattr">
                                        <input id="RcloneHashHook.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RcloneHashHook</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sha256&#39;</span>,</span><span class="param">	<span class="n">rclone_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rclone&#39;</span>,</span><span class="param">	<span class="n">check_on_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="RcloneHashHook.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.__init__-45"><a href="#RcloneHashHook.__init__-45"><span class="linenos">45</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="RcloneHashHook.__init__-46"><a href="#RcloneHashHook.__init__-46"><span class="linenos">46</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RcloneHashHook.__init__-47"><a href="#RcloneHashHook.__init__-47"><span class="linenos">47</span></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sha256&#39;</span><span class="p">,</span>
</span><span id="RcloneHashHook.__init__-48"><a href="#RcloneHashHook.__init__-48"><span class="linenos">48</span></a>        <span class="n">rclone_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rclone&#39;</span><span class="p">,</span>
</span><span id="RcloneHashHook.__init__-49"><a href="#RcloneHashHook.__init__-49"><span class="linenos">49</span></a>        <span class="n">check_on_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="RcloneHashHook.__init__-50"><a href="#RcloneHashHook.__init__-50"><span class="linenos">50</span></a>    <span class="p">):</span>
</span><span id="RcloneHashHook.__init__-51"><a href="#RcloneHashHook.__init__-51"><span class="linenos">51</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.__init__-52"><a href="#RcloneHashHook.__init__-52"><span class="linenos">52</span></a><span class="sd">         RcloneHashHook</span>
</span><span id="RcloneHashHook.__init__-53"><a href="#RcloneHashHook.__init__-53"><span class="linenos">53</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.__init__-54"><a href="#RcloneHashHook.__init__-54"><span class="linenos">54</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook.__init__-55"><a href="#RcloneHashHook.__init__-55"><span class="linenos">55</span></a><span class="sd">            algorithm: </span>
</span><span id="RcloneHashHook.__init__-56"><a href="#RcloneHashHook.__init__-56"><span class="linenos">56</span></a><span class="sd">            rclone_path: rclone </span>
</span><span id="RcloneHashHook.__init__-57"><a href="#RcloneHashHook.__init__-57"><span class="linenos">57</span></a><span class="sd">            check_on_init:  rclone </span>
</span><span id="RcloneHashHook.__init__-58"><a href="#RcloneHashHook.__init__-58"><span class="linenos">58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.__init__-59"><a href="#RcloneHashHook.__init__-59"><span class="linenos">59</span></a>        <span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="RcloneHashHook.__init__-60"><a href="#RcloneHashHook.__init__-60"><span class="linenos">60</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_ALGORITHMS</span><span class="p">:</span>
</span><span id="RcloneHashHook.__init__-61"><a href="#RcloneHashHook.__init__-61"><span class="linenos">61</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="RcloneHashHook.__init__-62"><a href="#RcloneHashHook.__init__-62"><span class="linenos">62</span></a>                <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RcloneHashHook.__init__-63"><a href="#RcloneHashHook.__init__-63"><span class="linenos">63</span></a>                <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUPPORTED_ALGORITHMS</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="RcloneHashHook.__init__-64"><a href="#RcloneHashHook.__init__-64"><span class="linenos">64</span></a>            <span class="p">)</span>
</span><span id="RcloneHashHook.__init__-65"><a href="#RcloneHashHook.__init__-65"><span class="linenos">65</span></a>        
</span><span id="RcloneHashHook.__init__-66"><a href="#RcloneHashHook.__init__-66"><span class="linenos">66</span></a>        <span class="c1">#  algo_id  digest_size</span>
</span><span id="RcloneHashHook.__init__-67"><a href="#RcloneHashHook.__init__-67"><span class="linenos">67</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">.registry</span><span class="w"> </span><span class="kn">import</span> <span class="n">ALGORITHM_REGISTRY</span>
</span><span id="RcloneHashHook.__init__-68"><a href="#RcloneHashHook.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>
</span><span id="RcloneHashHook.__init__-69"><a href="#RcloneHashHook.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span> <span class="o">=</span> <span class="n">rclone_path</span>
</span><span id="RcloneHashHook.__init__-70"><a href="#RcloneHashHook.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_algo_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digest_size</span> <span class="o">=</span> <span class="n">ALGORITHM_REGISTRY</span><span class="p">[</span><span class="n">algorithm</span><span class="p">]</span>
</span><span id="RcloneHashHook.__init__-71"><a href="#RcloneHashHook.__init__-71"><span class="linenos">71</span></a>        
</span><span id="RcloneHashHook.__init__-72"><a href="#RcloneHashHook.__init__-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="n">check_on_init</span><span class="p">:</span>
</span><span id="RcloneHashHook.__init__-73"><a href="#RcloneHashHook.__init__-73"><span class="linenos">73</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_rclone</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p> RcloneHashHook</p>

<p>Args:
    algorithm: 
    rclone_path: rclone 
    check_on_init:  rclone </p>
</div>


                            </div>
                            <div id="RcloneHashHook.SUPPORTED_ALGORITHMS" class="classattr">
                                <div class="attr variable">
            <span class="name">SUPPORTED_ALGORITHMS</span>        =
<span class="default_value">{&#39;md5&#39;, &#39;xxh3&#39;, &#39;sha512&#39;, &#39;xxh128&#39;, &#39;quickxor&#39;, &#39;sha1&#39;, &#39;sha256&#39;, &#39;crc32&#39;, &#39;blake3&#39;}</span>

        
    </div>
    <a class="headerlink" href="#RcloneHashHook.SUPPORTED_ALGORITHMS"></a>
    
    

                            </div>
                            <div id="RcloneHashHook.display_name" class="classattr">
                                        <input id="RcloneHashHook.display_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">display_name</span><span class="annotation">: str</span>

                <label class="view-source-button" for="RcloneHashHook.display_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.display_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.display_name-75"><a href="#RcloneHashHook.display_name-75"><span class="linenos">75</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook.display_name-76"><a href="#RcloneHashHook.display_name-76"><span class="linenos">76</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RcloneHashHook.display_name-77"><a href="#RcloneHashHook.display_name-77"><span class="linenos">77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; rclone:algorithm &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.display_name-78"><a href="#RcloneHashHook.display_name-78"><span class="linenos">78</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;rclone:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p> rclone:algorithm </p>
</div>


                            </div>
                            <div id="RcloneHashHook.algo_id" class="classattr">
                                        <input id="RcloneHashHook.algo_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algo_id</span><span class="annotation">: int</span>

                <label class="view-source-button" for="RcloneHashHook.algo_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.algo_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.algo_id-98"><a href="#RcloneHashHook.algo_id-98"><span class="linenos"> 98</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook.algo_id-99"><a href="#RcloneHashHook.algo_id-99"><span class="linenos"> 99</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="RcloneHashHook.algo_id-100"><a href="#RcloneHashHook.algo_id-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algo_id</span>
</span></pre></div>


            <div class="docstring"><p> ID</p>

<p> FileHeader  checksum_algo 
0 = , 1 = CRC32, 2 = MD5, 3 = SHA1, 4 = SHA256</p>

<p>Returns:
     ID</p>
</div>


                            </div>
                            <div id="RcloneHashHook.digest_size" class="classattr">
                                        <input id="RcloneHashHook.digest_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">digest_size</span><span class="annotation">: int</span>

                <label class="view-source-button" for="RcloneHashHook.digest_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.digest_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.digest_size-102"><a href="#RcloneHashHook.digest_size-102"><span class="linenos">102</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook.digest_size-103"><a href="#RcloneHashHook.digest_size-103"><span class="linenos">103</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">digest_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="RcloneHashHook.digest_size-104"><a href="#RcloneHashHook.digest_size-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digest_size</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="RcloneHashHook.algorithm" class="classattr">
                                        <input id="RcloneHashHook.algorithm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">algorithm</span><span class="annotation">: str</span>

                <label class="view-source-button" for="RcloneHashHook.algorithm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.algorithm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.algorithm-106"><a href="#RcloneHashHook.algorithm-106"><span class="linenos">106</span></a>    <span class="nd">@property</span>
</span><span id="RcloneHashHook.algorithm-107"><a href="#RcloneHashHook.algorithm-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="RcloneHashHook.algorithm-108"><a href="#RcloneHashHook.algorithm-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span>
</span></pre></div>


    

                            </div>
                            <div id="RcloneHashHook.compute" class="classattr">
                                        <input id="RcloneHashHook.compute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="RcloneHashHook.compute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.compute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.compute-110"><a href="#RcloneHashHook.compute-110"><span class="linenos">110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute-111"><a href="#RcloneHashHook.compute-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute-112"><a href="#RcloneHashHook.compute-112"><span class="linenos">112</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute-113"><a href="#RcloneHashHook.compute-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute-114"><a href="#RcloneHashHook.compute-114"><span class="linenos">114</span></a><span class="sd">        : </span>
</span><span id="RcloneHashHook.compute-115"><a href="#RcloneHashHook.compute-115"><span class="linenos">115</span></a><span class="sd">         compute_file() </span>
</span><span id="RcloneHashHook.compute-116"><a href="#RcloneHashHook.compute-116"><span class="linenos">116</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute-117"><a href="#RcloneHashHook.compute-117"><span class="linenos">117</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook.compute-118"><a href="#RcloneHashHook.compute-118"><span class="linenos">118</span></a><span class="sd">            data: </span>
</span><span id="RcloneHashHook.compute-119"><a href="#RcloneHashHook.compute-119"><span class="linenos">119</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook.compute-120"><a href="#RcloneHashHook.compute-120"><span class="linenos">120</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook.compute-121"><a href="#RcloneHashHook.compute-121"><span class="linenos">121</span></a><span class="sd">             (bytes)</span>
</span><span id="RcloneHashHook.compute-122"><a href="#RcloneHashHook.compute-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute-123"><a href="#RcloneHashHook.compute-123"><span class="linenos">123</span></a>        <span class="c1"># </span>
</span><span id="RcloneHashHook.compute-124"><a href="#RcloneHashHook.compute-124"><span class="linenos">124</span></a>        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute-125"><a href="#RcloneHashHook.compute-125"><span class="linenos">125</span></a>            <span class="n">tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute-126"><a href="#RcloneHashHook.compute-126"><span class="linenos">126</span></a>            <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">name</span>
</span><span id="RcloneHashHook.compute-127"><a href="#RcloneHashHook.compute-127"><span class="linenos">127</span></a>        
</span><span id="RcloneHashHook.compute-128"><a href="#RcloneHashHook.compute-128"><span class="linenos">128</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute-129"><a href="#RcloneHashHook.compute-129"><span class="linenos">129</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_file</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute-130"><a href="#RcloneHashHook.compute-130"><span class="linenos">130</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute-131"><a href="#RcloneHashHook.compute-131"><span class="linenos">131</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>: 
 compute_file() </p>

<p>Args:
    data: </p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="RcloneHashHook.compute_file" class="classattr">
                                        <input id="RcloneHashHook.compute_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="RcloneHashHook.compute_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.compute_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.compute_file-133"><a href="#RcloneHashHook.compute_file-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_file-134"><a href="#RcloneHashHook.compute_file-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute_file-135"><a href="#RcloneHashHook.compute_file-135"><span class="linenos">135</span></a><span class="sd">         ()</span>
</span><span id="RcloneHashHook.compute_file-136"><a href="#RcloneHashHook.compute_file-136"><span class="linenos">136</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute_file-137"><a href="#RcloneHashHook.compute_file-137"><span class="linenos">137</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook.compute_file-138"><a href="#RcloneHashHook.compute_file-138"><span class="linenos">138</span></a><span class="sd">            file_path: </span>
</span><span id="RcloneHashHook.compute_file-139"><a href="#RcloneHashHook.compute_file-139"><span class="linenos">139</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook.compute_file-140"><a href="#RcloneHashHook.compute_file-140"><span class="linenos">140</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook.compute_file-141"><a href="#RcloneHashHook.compute_file-141"><span class="linenos">141</span></a><span class="sd">             (bytes)</span>
</span><span id="RcloneHashHook.compute_file-142"><a href="#RcloneHashHook.compute_file-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute_file-143"><a href="#RcloneHashHook.compute_file-143"><span class="linenos">143</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="RcloneHashHook.compute_file-144"><a href="#RcloneHashHook.compute_file-144"><span class="linenos">144</span></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span><span class="p">,</span> <span class="s1">&#39;hashsum&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span><span class="p">,</span> <span class="n">file_path</span><span class="p">],</span>
</span><span id="RcloneHashHook.compute_file-145"><a href="#RcloneHashHook.compute_file-145"><span class="linenos">145</span></a>            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RcloneHashHook.compute_file-146"><a href="#RcloneHashHook.compute_file-146"><span class="linenos">146</span></a>            <span class="n">check</span><span class="o">=</span><span class="kc">True</span>
</span><span id="RcloneHashHook.compute_file-147"><a href="#RcloneHashHook.compute_file-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="RcloneHashHook.compute_file-148"><a href="#RcloneHashHook.compute_file-148"><span class="linenos">148</span></a>        
</span><span id="RcloneHashHook.compute_file-149"><a href="#RcloneHashHook.compute_file-149"><span class="linenos">149</span></a>        <span class="c1"># : &quot;hash  filename\n&quot;</span>
</span><span id="RcloneHashHook.compute_file-150"><a href="#RcloneHashHook.compute_file-150"><span class="linenos">150</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="RcloneHashHook.compute_file-151"><a href="#RcloneHashHook.compute_file-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_file-152"><a href="#RcloneHashHook.compute_file-152"><span class="linenos">152</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rclone : </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_file-153"><a href="#RcloneHashHook.compute_file-153"><span class="linenos">153</span></a>        
</span><span id="RcloneHashHook.compute_file-154"><a href="#RcloneHashHook.compute_file-154"><span class="linenos">154</span></a>        <span class="n">hash_hex</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RcloneHashHook.compute_file-155"><a href="#RcloneHashHook.compute_file-155"><span class="linenos">155</span></a>        <span class="k">return</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hash_hex</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> ()</p>

<p>Args:
    file_path: </p>

<p>Returns:
     (bytes)</p>
</div>


                            </div>
                            <div id="RcloneHashHook.compute_files_batch" class="classattr">
                                        <input id="RcloneHashHook.compute_files_batch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_files_batch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RcloneHashHook.compute_files_batch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.compute_files_batch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.compute_files_batch-157"><a href="#RcloneHashHook.compute_files_batch-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_files_batch</span><span class="p">(</span>
</span><span id="RcloneHashHook.compute_files_batch-158"><a href="#RcloneHashHook.compute_files_batch-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RcloneHashHook.compute_files_batch-159"><a href="#RcloneHashHook.compute_files_batch-159"><span class="linenos">159</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="RcloneHashHook.compute_files_batch-160"><a href="#RcloneHashHook.compute_files_batch-160"><span class="linenos">160</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RcloneHashHook.compute_files_batch-161"><a href="#RcloneHashHook.compute_files_batch-161"><span class="linenos">161</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="RcloneHashHook.compute_files_batch-162"><a href="#RcloneHashHook.compute_files_batch-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute_files_batch-163"><a href="#RcloneHashHook.compute_files_batch-163"><span class="linenos">163</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute_files_batch-164"><a href="#RcloneHashHook.compute_files_batch-164"><span class="linenos">164</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute_files_batch-165"><a href="#RcloneHashHook.compute_files_batch-165"><span class="linenos">165</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute_files_batch-166"><a href="#RcloneHashHook.compute_files_batch-166"><span class="linenos">166</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute_files_batch-167"><a href="#RcloneHashHook.compute_files_batch-167"><span class="linenos">167</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook.compute_files_batch-168"><a href="#RcloneHashHook.compute_files_batch-168"><span class="linenos">168</span></a><span class="sd">            file_paths: </span>
</span><span id="RcloneHashHook.compute_files_batch-169"><a href="#RcloneHashHook.compute_files_batch-169"><span class="linenos">169</span></a><span class="sd">            timeout:  ()</span>
</span><span id="RcloneHashHook.compute_files_batch-170"><a href="#RcloneHashHook.compute_files_batch-170"><span class="linenos">170</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook.compute_files_batch-171"><a href="#RcloneHashHook.compute_files_batch-171"><span class="linenos">171</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook.compute_files_batch-172"><a href="#RcloneHashHook.compute_files_batch-172"><span class="linenos">172</span></a><span class="sd">            {file_path: hash_bytes} </span>
</span><span id="RcloneHashHook.compute_files_batch-173"><a href="#RcloneHashHook.compute_files_batch-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute_files_batch-174"><a href="#RcloneHashHook.compute_files_batch-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_files_batch-175"><a href="#RcloneHashHook.compute_files_batch-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="RcloneHashHook.compute_files_batch-176"><a href="#RcloneHashHook.compute_files_batch-176"><span class="linenos">176</span></a>        
</span><span id="RcloneHashHook.compute_files_batch-177"><a href="#RcloneHashHook.compute_files_batch-177"><span class="linenos">177</span></a>        <span class="c1"># </span>
</span><span id="RcloneHashHook.compute_files_batch-178"><a href="#RcloneHashHook.compute_files_batch-178"><span class="linenos">178</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="RcloneHashHook.compute_files_batch-179"><a href="#RcloneHashHook.compute_files_batch-179"><span class="linenos">179</span></a>        <span class="n">dir_groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_files_batch-180"><a href="#RcloneHashHook.compute_files_batch-180"><span class="linenos">180</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_files_batch-181"><a href="#RcloneHashHook.compute_files_batch-181"><span class="linenos">181</span></a>            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="RcloneHashHook.compute_files_batch-182"><a href="#RcloneHashHook.compute_files_batch-182"><span class="linenos">182</span></a>            <span class="n">dir_groups</span><span class="p">[</span><span class="n">dir_path</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_files_batch-183"><a href="#RcloneHashHook.compute_files_batch-183"><span class="linenos">183</span></a>        
</span><span id="RcloneHashHook.compute_files_batch-184"><a href="#RcloneHashHook.compute_files_batch-184"><span class="linenos">184</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RcloneHashHook.compute_files_batch-185"><a href="#RcloneHashHook.compute_files_batch-185"><span class="linenos">185</span></a>        
</span><span id="RcloneHashHook.compute_files_batch-186"><a href="#RcloneHashHook.compute_files_batch-186"><span class="linenos">186</span></a>        <span class="k">for</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">paths</span> <span class="ow">in</span> <span class="n">dir_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="RcloneHashHook.compute_files_batch-187"><a href="#RcloneHashHook.compute_files_batch-187"><span class="linenos">187</span></a>            <span class="c1">#  rclone hashsum</span>
</span><span id="RcloneHashHook.compute_files_batch-188"><a href="#RcloneHashHook.compute_files_batch-188"><span class="linenos">188</span></a>            <span class="n">dir_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_dir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_files_batch-189"><a href="#RcloneHashHook.compute_files_batch-189"><span class="linenos">189</span></a>            
</span><span id="RcloneHashHook.compute_files_batch-190"><a href="#RcloneHashHook.compute_files_batch-190"><span class="linenos">190</span></a>            <span class="c1"># </span>
</span><span id="RcloneHashHook.compute_files_batch-191"><a href="#RcloneHashHook.compute_files_batch-191"><span class="linenos">191</span></a>            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_files_batch-192"><a href="#RcloneHashHook.compute_files_batch-192"><span class="linenos">192</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_files_batch-193"><a href="#RcloneHashHook.compute_files_batch-193"><span class="linenos">193</span></a>                <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">dir_results</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_files_batch-194"><a href="#RcloneHashHook.compute_files_batch-194"><span class="linenos">194</span></a>                    <span class="n">results</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">dir_results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
</span><span id="RcloneHashHook.compute_files_batch-195"><a href="#RcloneHashHook.compute_files_batch-195"><span class="linenos">195</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_files_batch-196"><a href="#RcloneHashHook.compute_files_batch-196"><span class="linenos">196</span></a>                    <span class="c1"># </span>
</span><span id="RcloneHashHook.compute_files_batch-197"><a href="#RcloneHashHook.compute_files_batch-197"><span class="linenos">197</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_files_batch-198"><a href="#RcloneHashHook.compute_files_batch-198"><span class="linenos">198</span></a>                        <span class="n">results</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_files_batch-199"><a href="#RcloneHashHook.compute_files_batch-199"><span class="linenos">199</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_files_batch-200"><a href="#RcloneHashHook.compute_files_batch-200"><span class="linenos">200</span></a>                        <span class="k">pass</span>
</span><span id="RcloneHashHook.compute_files_batch-201"><a href="#RcloneHashHook.compute_files_batch-201"><span class="linenos">201</span></a>        
</span><span id="RcloneHashHook.compute_files_batch-202"><a href="#RcloneHashHook.compute_files_batch-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p></p>

<p>Args:
    file_paths: 
    timeout:  ()</p>

<p>Returns:
    {file_path: hash_bytes} </p>
</div>


                            </div>
                            <div id="RcloneHashHook.compute_dir" class="classattr">
                                        <input id="RcloneHashHook.compute_dir-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_dir</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">dir_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RcloneHashHook.compute_dir-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneHashHook.compute_dir"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneHashHook.compute_dir-204"><a href="#RcloneHashHook.compute_dir-204"><span class="linenos">204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_dir</span><span class="p">(</span>
</span><span id="RcloneHashHook.compute_dir-205"><a href="#RcloneHashHook.compute_dir-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RcloneHashHook.compute_dir-206"><a href="#RcloneHashHook.compute_dir-206"><span class="linenos">206</span></a>        <span class="n">dir_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="RcloneHashHook.compute_dir-207"><a href="#RcloneHashHook.compute_dir-207"><span class="linenos">207</span></a>        <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="RcloneHashHook.compute_dir-208"><a href="#RcloneHashHook.compute_dir-208"><span class="linenos">208</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RcloneHashHook.compute_dir-209"><a href="#RcloneHashHook.compute_dir-209"><span class="linenos">209</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
</span><span id="RcloneHashHook.compute_dir-210"><a href="#RcloneHashHook.compute_dir-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute_dir-211"><a href="#RcloneHashHook.compute_dir-211"><span class="linenos">211</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute_dir-212"><a href="#RcloneHashHook.compute_dir-212"><span class="linenos">212</span></a><span class="sd">        </span>
</span><span id="RcloneHashHook.compute_dir-213"><a href="#RcloneHashHook.compute_dir-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="RcloneHashHook.compute_dir-214"><a href="#RcloneHashHook.compute_dir-214"><span class="linenos">214</span></a><span class="sd">            dir_path: </span>
</span><span id="RcloneHashHook.compute_dir-215"><a href="#RcloneHashHook.compute_dir-215"><span class="linenos">215</span></a><span class="sd">            recursive: </span>
</span><span id="RcloneHashHook.compute_dir-216"><a href="#RcloneHashHook.compute_dir-216"><span class="linenos">216</span></a><span class="sd">            timeout:  ()</span>
</span><span id="RcloneHashHook.compute_dir-217"><a href="#RcloneHashHook.compute_dir-217"><span class="linenos">217</span></a><span class="sd">            </span>
</span><span id="RcloneHashHook.compute_dir-218"><a href="#RcloneHashHook.compute_dir-218"><span class="linenos">218</span></a><span class="sd">        Returns:</span>
</span><span id="RcloneHashHook.compute_dir-219"><a href="#RcloneHashHook.compute_dir-219"><span class="linenos">219</span></a><span class="sd">            {filename: hash_bytes}  ()</span>
</span><span id="RcloneHashHook.compute_dir-220"><a href="#RcloneHashHook.compute_dir-220"><span class="linenos">220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RcloneHashHook.compute_dir-221"><a href="#RcloneHashHook.compute_dir-221"><span class="linenos">221</span></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rclone_path</span><span class="p">,</span> <span class="s1">&#39;hashsum&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">]</span>
</span><span id="RcloneHashHook.compute_dir-222"><a href="#RcloneHashHook.compute_dir-222"><span class="linenos">222</span></a>        
</span><span id="RcloneHashHook.compute_dir-223"><a href="#RcloneHashHook.compute_dir-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_dir-224"><a href="#RcloneHashHook.compute_dir-224"><span class="linenos">224</span></a>            <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--max-depth&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">])</span>
</span><span id="RcloneHashHook.compute_dir-225"><a href="#RcloneHashHook.compute_dir-225"><span class="linenos">225</span></a>        
</span><span id="RcloneHashHook.compute_dir-226"><a href="#RcloneHashHook.compute_dir-226"><span class="linenos">226</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="RcloneHashHook.compute_dir-227"><a href="#RcloneHashHook.compute_dir-227"><span class="linenos">227</span></a>            <span class="n">cmd</span><span class="p">,</span>
</span><span id="RcloneHashHook.compute_dir-228"><a href="#RcloneHashHook.compute_dir-228"><span class="linenos">228</span></a>            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="RcloneHashHook.compute_dir-229"><a href="#RcloneHashHook.compute_dir-229"><span class="linenos">229</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
</span><span id="RcloneHashHook.compute_dir-230"><a href="#RcloneHashHook.compute_dir-230"><span class="linenos">230</span></a>        <span class="p">)</span>
</span><span id="RcloneHashHook.compute_dir-231"><a href="#RcloneHashHook.compute_dir-231"><span class="linenos">231</span></a>        
</span><span id="RcloneHashHook.compute_dir-232"><a href="#RcloneHashHook.compute_dir-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_dir-233"><a href="#RcloneHashHook.compute_dir-233"><span class="linenos">233</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="RcloneHashHook.compute_dir-234"><a href="#RcloneHashHook.compute_dir-234"><span class="linenos">234</span></a>        
</span><span id="RcloneHashHook.compute_dir-235"><a href="#RcloneHashHook.compute_dir-235"><span class="linenos">235</span></a>        <span class="c1"># </span>
</span><span id="RcloneHashHook.compute_dir-236"><a href="#RcloneHashHook.compute_dir-236"><span class="linenos">236</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RcloneHashHook.compute_dir-237"><a href="#RcloneHashHook.compute_dir-237"><span class="linenos">237</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
</span><span id="RcloneHashHook.compute_dir-238"><a href="#RcloneHashHook.compute_dir-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_dir-239"><a href="#RcloneHashHook.compute_dir-239"><span class="linenos">239</span></a>                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_dir-240"><a href="#RcloneHashHook.compute_dir-240"><span class="linenos">240</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_dir-241"><a href="#RcloneHashHook.compute_dir-241"><span class="linenos">241</span></a>                    <span class="n">hash_hex</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">parts</span>
</span><span id="RcloneHashHook.compute_dir-242"><a href="#RcloneHashHook.compute_dir-242"><span class="linenos">242</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_dir-243"><a href="#RcloneHashHook.compute_dir-243"><span class="linenos">243</span></a>                        <span class="n">results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hash_hex</span><span class="p">)</span>
</span><span id="RcloneHashHook.compute_dir-244"><a href="#RcloneHashHook.compute_dir-244"><span class="linenos">244</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="RcloneHashHook.compute_dir-245"><a href="#RcloneHashHook.compute_dir-245"><span class="linenos">245</span></a>                        <span class="k">pass</span>
</span><span id="RcloneHashHook.compute_dir-246"><a href="#RcloneHashHook.compute_dir-246"><span class="linenos">246</span></a>        
</span><span id="RcloneHashHook.compute_dir-247"><a href="#RcloneHashHook.compute_dir-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p></p>

<p>Args:
    dir_path: 
    recursive: 
    timeout:  ()</p>

<p>Returns:
    {filename: hash_bytes}  ()</p>
</div>


                            </div>
                </section>
                <section id="RcloneNotFoundError">
                            <input id="RcloneNotFoundError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RcloneNotFoundError</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="RcloneNotFoundError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RcloneNotFoundError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RcloneNotFoundError-18"><a href="#RcloneNotFoundError-18"><span class="linenos">18</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RcloneNotFoundError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="RcloneNotFoundError-19"><a href="#RcloneNotFoundError-19"><span class="linenos">19</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;rclone  PATH &quot;&quot;&quot;</span>
</span><span id="RcloneNotFoundError-20"><a href="#RcloneNotFoundError-20"><span class="linenos">20</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>rclone  PATH </p>
</div>


                </section>
                <section id="rclone_hash">
                            <input id="rclone_hash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rclone_hash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sha256&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#RcloneHashHook">RcloneHashHook</a></span>:</span></span>

                <label class="view-source-button" for="rclone_hash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rclone_hash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rclone_hash-254"><a href="#rclone_hash-254"><span class="linenos">254</span></a><span class="k">def</span><span class="w"> </span><span class="nf">rclone_hash</span><span class="p">(</span><span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sha256&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RcloneHashHook</span><span class="p">:</span>
</span><span id="rclone_hash-255"><a href="#rclone_hash-255"><span class="linenos">255</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="rclone_hash-256"><a href="#rclone_hash-256"><span class="linenos">256</span></a><span class="sd">     RcloneHashHook </span>
</span><span id="rclone_hash-257"><a href="#rclone_hash-257"><span class="linenos">257</span></a><span class="sd">    </span>
</span><span id="rclone_hash-258"><a href="#rclone_hash-258"><span class="linenos">258</span></a><span class="sd">    Args:</span>
</span><span id="rclone_hash-259"><a href="#rclone_hash-259"><span class="linenos">259</span></a><span class="sd">        algorithm: </span>
</span><span id="rclone_hash-260"><a href="#rclone_hash-260"><span class="linenos">260</span></a><span class="sd">        </span>
</span><span id="rclone_hash-261"><a href="#rclone_hash-261"><span class="linenos">261</span></a><span class="sd">    Returns:</span>
</span><span id="rclone_hash-262"><a href="#rclone_hash-262"><span class="linenos">262</span></a><span class="sd">        RcloneHashHook </span>
</span><span id="rclone_hash-263"><a href="#rclone_hash-263"><span class="linenos">263</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="rclone_hash-264"><a href="#rclone_hash-264"><span class="linenos">264</span></a>    <span class="k">return</span> <span class="n">RcloneHashHook</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p> RcloneHashHook </p>

<p>Args:
    algorithm: </p>

<p>Returns:
    RcloneHashHook </p>
</div>


                </section>
    </main>
</body>
</html>